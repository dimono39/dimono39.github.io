</html><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ :)</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html-docx-js@0.3.1/dist/html-docx.js"></script>
    
    <style>
		/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à */
		@keyframes fadeInOut {
			0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
			15% { opacity: 1; transform: translateX(-50%) translateY(0); }
			85% { opacity: 1; transform: translateX(-50%) translateY(0); }
			100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
		}

		/* –°—Ç–∏–ª–∏ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ –æ—Ç—á–µ—Ç–æ–≤ */
		.template-item {
			transition: all 0.3s ease;
			cursor: pointer;
		}

		.template-item:hover {
			background: #e8f4fc !important;
			transform: translateX(5px);
		}

		/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è */
		.status-indicator {
			padding: 2px 8px;
			border-radius: 10px;
			font-size: 11px;
			font-weight: bold;
		}

		.status-saving { background: #fff3cd; color: #f39c12; }
		.status-saved { background: #d4edda; color: #27ae60; }
		.status-error { background: #f8d7da; color: #e74c3c; }
		/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—É—Ä–∞/–æ–±—É—á–µ–Ω–∏—è */
		.tour-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.7);
			z-index: 10000;
			display: none;
		}

		.tour-step {
			position: absolute;
			background: white;
			border-radius: 12px;
			padding: 20px;
			max-width: 400px;
			box-shadow: 0 10px 40px rgba(0,0,0,0.3);
			z-index: 10001;
			animation: tourSlideIn 0.3s ease;
		}

		@keyframes tourSlideIn {
			from { opacity: 0; transform: translateY(20px); }
			to { opacity: 1; transform: translateY(0); }
		}

		.tour-step h3 {
			margin-top: 0;
			color: #2c3e50;
		}

		.tour-step p {
			margin: 10px 0;
			color: #34495e;
		}

		.tour-actions {
			display: flex;
			justify-content: space-between;
			margin-top: 20px;
		}

		.tour-counter {
			font-size: 0.9em;
			color: #7f8c8d;
			text-align: center;
			margin-top: 10px;
		}

		.tour-highlight {
			position: relative;
			z-index: 10002 !important;
			box-shadow: 0 0 0 4px #3498db, 0 0 20px rgba(52, 152, 219, 0.5) !important;
			animation: pulse 1.5s infinite;
		}

		@keyframes pulse {
			0% { box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.5); }
			50% { box-shadow: 0 0 0 8px rgba(52, 152, 219, 0.3); }
			100% { box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.5); }
		}

		.tour-start-btn {
			position: fixed;
			bottom: 20px;
			right: 20px;
			z-index: 9999;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border: none;
			border-radius: 50%;
			width: 60px;
			height: 60px;
			font-size: 24px;
			cursor: pointer;
			box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			transition: all 0.3s;
		}

		.tour-start-btn:hover {
			transform: scale(1.1);
			box-shadow: 0 6px 20px rgba(0,0,0,0.3);
		}	
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
		[data-theme="dark"] {
		  --bg-primary: #1a1a2e;
		  --bg-secondary: #16213e;
		  --text-primary: #e6e6e6;
		}
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            background: #34495e;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: none;
            color: white;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            flex: 1;
            min-width: 140px;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab-btn.active {
            background: #3498db;
            box-shadow: inset 0 -3px 0 #2980b9;
        }

        .tab-content {
            display: none;
            padding: 25px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-container {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9em;
            color: #666;
            text-align: center;
        }

        /* –ú–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .setup-wizard {
            padding: 30px;
        }

        .wizard-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .wizard-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –®–∞–≥–∏ */
        .step-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .step-description {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç */
        .worktype-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .worktype-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .worktype-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .worktype-card.selected {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .worktype-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .worktype-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .worktype-card p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .worktype-details {
            display: flex;
            gap: 15px;
            color: #888;
            font-size: 0.85em;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .card-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* –§–æ—Ä–º—ã */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        label.required::after {
            content: " *";
            color: #e74c3c;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-hint {
            color: #666;
            font-size: 0.85em;
            margin-top: 5px;
            display: block;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-icon {
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn-icon:hover {
            background: #5a6fd8;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è —à–∞–≥–æ–≤ */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
        .info-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-weight: 600;
            color: #333;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ */
        .attendance-stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            border: 2px solid #e9ecef;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        /* –ö—Ä–∏—Ç–µ—Ä–∏–∏ */
        .criteria-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .criteria-type-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .criteria-presets {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .preset-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px 15px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .preset-btn:hover {
            border-color: #667eea;
            background: #eef1ff;
        }

        .criteria-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .recommendation-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .recommendation-card ul {
            margin: 10px 0 0 20px;
        }

        .recommendation-card li {
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */


		.modal-actions {
			display: flex;
			gap: 10px;
			justify-content: flex-end;
			margin-top: 20px;
		}
		.modal-overlay.show {
			display: flex;
		}
		.modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0,0,0,0.5);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 2000;
		}
        .modal-content {
			background: white;
			padding: 30px;
			border-radius: 15px;
			max-width: 500px;
			width: 90%;
			max-height: 80vh;
			overflow-y: auto;
			animation: modalSlideIn 0.3s ease;
			box-shadow: 0 20px 40px rgba(0,0,0,0.3);
			margin: 20px;
		}

		@keyframes modalSlideIn {
			from { transform: translateY(-50px); opacity: 0; }
			to { transform: translateY(0); opacity: 1; }
		}
		.modal-content.success {
			text-align: center;
		}

		.modal-icon {
			font-size: 4em;
			margin-bottom: 20px;
		}

		.modal-actions {
			display: flex;
			gap: 10px;
			justify-content: flex-end;
			margin-top: 20px;
		}

        /* –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è */
        .criteria-grid {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }

        .criteria-row {
            display: grid;
            grid-template-columns: 150px 150px 1fr;
            gap: 15px;
            padding: 12px 15px;
            border-bottom: 1px solid #f1f1f1;
            align-items: center;
        }

        .criteria-row.header {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .criteria-grade {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .criteria-range {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .criteria-range input {
            width: 70px;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .criteria-range input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .criteria-description input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .grade-badge {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .grade-5 { background: #4CAF50; }
        .grade-4 { background: #8BC34A; }
        .grade-3 { background: #FFC107; }
        .grade-2 { background: #F44336; }
        .level-high { background: #4CAF50; }
        .level-medium { background: #FFC107; }
        .level-low { background: #F44336; }

        .criteria-action {
            display: flex;
            gap: 5px;
        }

        .btn-icon.small {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-icon.small.danger {
            background: #F44336;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .preview-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e9ecef;
            text-align: center;
            transition: all 0.3s ease;
        }

        .preview-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .preview-grade {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .preview-range {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .preview-desc {
            font-size: 0.85em;
            color: #333;
            line-height: 1.4;
        }

        .input-with-button {
            display: flex;
            gap: 10px;
        }

        .input-with-button input {
            flex: 1;
        }

        .form-control-large {
            padding: 12px;
            font-size: 16px;
            width: 100%;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .worktype-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .step-navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
            
            .container {
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .setup-wizard {
                padding: 20px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: 100%;
                font-size: 12px;
                padding: 12px 15px;
            }
            
            .criteria-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .preview-grid {
                grid-template-columns: 1fr;
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 480px) {
            .tab-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—á–∞—Ç–∏ */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            .avoid-page-break {
                page-break-inside: avoid;
            }
            
            .force-page-break {
                page-break-before: always;
            }
        }

        /* –ö–ª–∞—Å—Å—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—á–∞—Ç—å—é –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ */
        .print-ignore {
            display: none !important;
        }

        .print-chart {
            max-width: 100%;
            height: auto;
        }

        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç—á–µ—Ç–∞ */
        @media print {
            @page {
                margin: 15mm;
            }
            
            body {
                font-size: 12pt !important;
                line-height: 1.5 !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-break {
                page-break-before: always;
            }
            
            .avoid-break {
                page-break-inside: avoid;
            }
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.info {
            background: #3498db;
        }

        .notification.success {
            background: #2ecc71;
        }

        .notification.warning {
            background: #f39c12;
        }

        .notification.error {
            background: #e74c3c;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏ */
        @media print {
            /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–µ–ø–µ—á–∞—Ç–∞–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
            .no-print, .tabs, .tab-btn, .btn, .search-box, 
            input, select, textarea, .modal-overlay, .notification {
                display: none !important;
            }
            
            /* –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            @page {
                size: A4;
                margin: 15mm;
                orphans: 3;
                widows: 3;
            }
            
            /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü */
            body {
                font-size: 12pt !important;
                line-height: 1.4 !important;
                color: black !important;
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ê4 */
            .container {
                width: 210mm !important;
                max-width: 210mm !important;
                min-height: 297mm !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
                background: white !important;
            }
        }

        .section-title {
            color: #2c3e50;
            margin: 20px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-size: 1.3em;
        }

        /* –≠–∫—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .export-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        /* –ì—Ä–∞—Ñ–∏–∫–∏ */
        .chart-container {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        /* KPI –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .kpi-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .kpi-card.success { border-left-color: #27ae60 !important; }
        .kpi-card.warning { border-left-color: #f39c12 !important; }
        .kpi-card.danger { border-left-color: #e74c3c !important; }

        .kpi-card.success .kpi-value { color: #27ae60; }
        .kpi-card.warning .kpi-value { color: #f39c12; }
        .kpi-card.danger .kpi-value { color: #e74c3c; }

        .kpi-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #2c3e50;
            margin: 8px 0;
        }

        .kpi-label {
            color: #7f8c8d;
            font-size: 0.85em;
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
            font-size: 13px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 13px;
        }

        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
        }

        th:hover {
            background: #2c3e50;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e8f4fc;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-box {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #3498db;
            border-radius: 20px;
            font-size: 14px;
        }

        .print-only {
            display: none;
        }

        .print-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .btn-print {
            background: #9b59b6;
            color: white;
        }

        .btn-print:hover {
            background: #8e44ad;
        }
		/* –°—Ç–∏–ª–∏ –¥–ª—è QR-–∫–æ–¥–∞ */
		.qr-code-container {
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 9999;
		}
		
		.qr-code-tooltip {
			position: relative;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 10px 15px;
			border-radius: 8px;
			font-size: 12px;
			font-weight: bold;
			box-shadow: 0 5px 15px rgba(0,0,0,0.3);
			cursor: help;
			transition: all 0.3s;
			text-align: center;
		}
		
		.qr-code-tooltip:hover {
			transform: scale(1.05);
			box-shadow: 0 8px 20px rgba(0,0,0,0.4);
		}
		
		.qr-code-tooltip:hover .qr-code-image {
			opacity: 1;
			visibility: visible;
			transform: translateY(0);
		}
		
		.qr-code-image {
			position: absolute;
			top: 100%;
			right: 0;
			margin-top: 10px;
			opacity: 0;
			visibility: hidden;
			transform: translateY(-10px);
			transition: all 0.3s;
			z-index: 10000;
			background: white;
			padding: 10px;
			border-radius: 8px;
			box-shadow: 0 10px 30px rgba(0,0,0,0.3);
		}
		
		.qr-code-image img {
			width: 150px;
			height: 150px;
			border: 2px solid #3498db;
			border-radius: 5px;
		}
		
		/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
		@media (max-width: 768px) {
			.qr-code-container {
				top: 10px;
				right: 10px;
			}
			
			.qr-code-tooltip {
				font-size: 11px;
				padding: 8px 12px;
			}
			
			.qr-code-image {
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%) scale(0.9);
			}
			
			.qr-code-tooltip:hover .qr-code-image {
				transform: translate(-50%, -50%) scale(1);
			}
		}
		/* –°—Ç–∏–ª–∏ –¥–ª—è QR-–∫–æ–¥–∞ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ */
		/* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
		.author-support {
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 10000;
		}
		
		/* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ */
		.support-btn {
			background: linear-gradient(135deg, #ff6b6b, #ffa726, #4caf50, #2196f3);
			background-size: 300% 300%;
			animation: gradient 4s ease infinite;
			color: white;
			padding: 12px 20px;
			border-radius: 50px;
			font-size: 14px;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			transition: all 0.3s;
			user-select: none;
			border: 2px solid rgba(255,255,255,0.3);
			text-align: center;
		}
		
		/* –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
		@keyframes gradient {
			0% { background-position: 0% 50%; }
			50% { background-position: 100% 50%; }
			100% { background-position: 0% 50%; }
		}
		
		.support-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(0,0,0,0.3);
		}
		
		/* –ü—É–ª—å—Å–∏—Ä—É—é—â–µ–µ —Å–µ—Ä–¥–µ—á–∫–æ */
		.heart {
			display: inline-block;
			animation: heartbeat 1.2s ease-in-out infinite;
		}
		
		@keyframes heartbeat {
			0%, 100% { transform: scale(1); }
			50% { transform: scale(1.2); }
		}
		
		/* –°—Ç–∏–ª–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ —Å QR-–∫–æ–¥–æ–º */
		.qr-popup {
			position: absolute;
			top: calc(100% + 15px);
			right: 0;
			background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			padding: 20px;
			border-radius: 15px;
			box-shadow: 0 10px 40px rgba(0,0,0,0.15);
			border: 1px solid rgba(255,255,255,0.5);
			opacity: 0;
			visibility: hidden;
			transform: translateY(-10px);
			transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
			min-width: 180px;
		}
		
		/* –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–ø–∞ (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è JavaScript) */
		.qr-popup.show {
			opacity: 1;
			visibility: visible;
			transform: translateY(0);
		}
		
		/* –†–∞–º–∫–∞ –¥–ª—è QR-–∫–æ–¥–∞ */
		.qr-frame {
			background: white;
			padding: 10px;
			border-radius: 10px;
			box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
			margin-bottom: 15px;
			border: 2px solid #3498db;
		}
		
		.qr-frame img {
			width: 150px;
			height: 150px;
			display: block;
			border-radius: 5px;
		}
		
		/* –¢–µ–∫—Å—Ç –ø–æ–¥ QR-–∫–æ–¥–æ–º */
		.qr-text {
			margin: 10px 0 5px 0;
			color: #2c3e50;
			font-size: 13px;
			font-weight: bold;
			text-align: center;
		}
		
		.qr-thanks {
			margin: 0;
			color: #7f8c8d;
			font-size: 11px;
			text-align: center;
			font-style: italic;
		}
		
		/* –ë–ª–µ—Å—Ç—è—â–∞—è –∑–≤–µ–∑–¥–æ—á–∫–∞ */
		.sparkle {
			display: inline-block;
			animation: sparkle 2s infinite;
		}
		
		@keyframes sparkle {
			0%, 100% { opacity: 0.5; transform: scale(1); }
			50% { opacity: 1; transform: scale(1.2); }
		}
		
		/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
		@media (max-width: 768px) {
			.author-support {
				top: 10px;
				right: 10px;
			}
			
			.support-btn {
				padding: 10px 16px;
				font-size: 13px;
			}
			
			.qr-popup {
				position: fixed;
				top: 50%;
				left: 50%;
				right: auto;
				transform: translate(-50%, -50%) scale(0.9);
			}
			
			.qr-popup.show {
				transform: translate(-50%, -50%) scale(1);
			}
		}
		/* –¢—É—Ç–æ—Ä–∏–∞–ª */
		.tutorial-overlay {
		  position: fixed;
		  top: 0;
		  left: 0;
		  right: 0;
		  bottom: 0;
		  background: rgba(0,0,0,0.85);
		  z-index: 999999;
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  backdrop-filter: blur(5px);
		}

		.tutorial-container {
		  background: white;
		  border-radius: 20px;
		  max-width: 500px;
		  width: 90%;
		  padding: 25px;
		  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
		  animation: tutorialSlideIn 0.4s ease;
		}

		@keyframes tutorialSlideIn {
		  from { opacity: 0; transform: translateY(-30px); }
		  to { opacity: 1; transform: translateY(0); }
		}

		.tutorial-header {
		  display: flex;
		  justify-content: space-between;
		  align-items: center;
		  margin-bottom: 20px;
		  padding-bottom: 15px;
		  border-bottom: 2px solid #eee;
		}

		.tutorial-content {
		  margin: 20px 0;
		  min-height: 80px;
		  font-size: 16px;
		  line-height: 1.6;
		}

		.tutorial-actions {
		  display: flex;
		  justify-content: space-between;
		  margin-top: 25px;
		  gap: 10px;
		}

		.tutorial-progress {
		  margin-top: 20px;
		}

		.tutorial-helper {
		  position: fixed;
		  bottom: 25px;
		  right: 25px;
		  width: 60px;
		  height: 60px;
		  border-radius: 50%;
		  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		  color: white;
		  border: none;
		  font-size: 24px;
		  cursor: pointer;
		  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
		  z-index: 9999;
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  transition: all 0.3s;
		}

		.tutorial-helper:hover {
		  transform: scale(1.1);
		  box-shadow: 0 12px 30px rgba(102, 126, 234, 0.7);
		}

		.tutorial-highlight {
		  position: absolute;
		  border: 3px solid #667eea;
		  border-radius: 10px;
		  background: rgba(102, 126, 234, 0.1);
		  box-shadow: 0 0 0 9999px rgba(0,0,0,0.7);
		  z-index: 999998;
		  pointer-events: none;
		  animation: pulse 2s infinite;
		}

		@keyframes pulse {
		  0% { box-shadow: 0 0 0 9999px rgba(0,0,0,0.7); }
		  50% { box-shadow: 0 0 0 9999px rgba(0,0,0,0.8); }
		  100% { box-shadow: 0 0 0 9999px rgba(0,0,0,0.7); }
		}

		/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
		@media (max-width: 768px) {
		  .tutorial-container {
			padding: 20px;
			width: 95%;
		  }
		  
		  .tutorial-helper {
			bottom: 20px;
			right: 20px;
			width: 50px;
			height: 50px;
			font-size: 20px;
		  }
		}
		/* PWA –°—Ç–∏–ª–∏ */
		.pwa-prompt {
		  position: fixed;
		  bottom: 20px;
		  left: 50%;
		  transform: translateX(-50%);
		  background: white;
		  border-radius: 15px;
		  padding: 15px;
		  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
		  z-index: 100000;
		  max-width: 400px;
		  width: 90%;
		  animation: slideUp 0.3s ease;
		}

		@keyframes slideUp {
		  from { transform: translateX(-50%) translateY(100px); opacity: 0; }
		  to { transform: translateX(-50%) translateY(0); opacity: 1; }
		}

		.pwa-prompt-content {
		  display: flex;
		  align-items: center;
		  gap: 15px;
		}

		.pwa-prompt-icon {
		  font-size: 2em;
		  color: #667eea;
		}

		.pwa-prompt-text {
		  flex: 1;
		}

		.pwa-prompt-text h4 {
		  margin: 0 0 5px 0;
		  color: #2c3e50;
		}

		.pwa-prompt-text p {
		  margin: 0;
		  color: #7f8c8d;
		  font-size: 0.9em;
		}

		.pwa-prompt-actions {
		  display: flex;
		  gap: 10px;
		}

		.offline-indicator {
		  position: fixed;
		  top: 0;
		  left: 0;
		  right: 0;
		  background: #f39c12;
		  color: white;
		  padding: 10px;
		  text-align: center;
		  z-index: 100001;
		  font-size: 0.9em;
		}

		.offline-content {
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  gap: 10px;
		}

		/* Mobile-specific improvements */
		@media (max-width: 768px) {
		  .mobile-optimized {
			/* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±–ª–∞—Å—Ç–∏ –∫–ª–∏–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
			min-height: 44px;
			min-width: 44px;
		  }
		  
		  /* –£–ª—É—á—à–∞–µ–º –≤–≤–æ–¥ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
		  input, select, textarea {
			font-size: 16px !important; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ iOS */
		  }
		  
		  /* –£–±–∏—Ä–∞–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
		  @media (hover: none) {
			.btn:hover {
			  transform: none !important;
			}
			
			.worktype-card:hover {
			  transform: none !important;
			  border-color: #e9ecef !important;
			}
		  }
		}

		/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ */
		@media (max-width: 768px) and (orientation: landscape) {
		  .table-container {
			max-height: 60vh;
			overflow-x: auto;
		  }
		}

		/* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
		@media (max-width: 360px) {
		  .header h1 {
			font-size: 1.8em !important;
		  }
		  
		  .tab-btn {
			padding: 10px 5px !important;
			font-size: 11px !important;
			min-width: 80px !important;
		  }
		}		
		
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay" id="modalOverlay">
       <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification"></div>

    <div class="container">
        <div class="header">
            <h1>üìä –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö, –í–ü–†, –û–ì–≠, –ï–ì–≠ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</p>
        </div>
        
        <div class="tabs no-print">
            <button class="tab-btn active" onclick="showTab('setup')">üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—Ç—ã</button>
            <button class="tab-btn" onclick="showTab('tasks')">üìù –¢–∞–∫—Å–æ–Ω–æ–º–∏—è –∑–∞–¥–∞–Ω–∏–π</button>
            <button class="tab-btn" onclick="showTab('students')">üë• –£—á–∞—â–∏–µ—Å—è</button>
            <button class="tab-btn" onclick="showTab('results')">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ—à–∏–±–∫–∏</button>
            <button class="tab-btn" onclick="showTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="showTab('visualization')">üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</button>
            <button class="tab-btn" onclick="showTab('recommendations')">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
            <button class="tab-btn" onclick="showTab('export')">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>
	
        <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ -->
        <div id="setup" class="tab-content active">
            <header class="header">
                <h1>üìä –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç</h1>
                <p class="subtitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
            </header>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="setupProgress" style="width: 10%;"></div>
                </div>
                <div class="progress-text" id="progressText">–ù–∞—á–Ω–∏—Ç–µ —Å –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã</div>
            </div>

            <div class="setup-wizard">
                <!-- –®–∞–≥ 1: –¢–∏–ø —Ä–∞–±–æ—Ç—ã -->
                <div class="wizard-step active" id="step1">
                    <div class="step-header">
                        <span class="step-number">1</span>
                        <h2>üìä –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã</h2>
                    </div>
                    <p class="step-description">–≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</p>
                    
                    <div class="worktype-grid">
                        <div class="worktype-card" onclick="selectWorkType('current')">
                            <div class="worktype-icon">üìù</div>
                            <h3>–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è</h3>
                            <p>–û—Ü–µ–Ω–∫–∞ –∑–Ω–∞–Ω–∏–π –ø–æ —Ç–µ–∫—É—â–µ–π —Ç–µ–º–µ</p>
                            <div class="worktype-details">
                                <span>‚è± 40-45 –º–∏–Ω</span>
                                <span>üìã 10-15 –∑–∞–¥–∞–Ω–∏–π</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('milestone')">
                            <div class="worktype-icon">üéØ</div>
                            <h3>–†—É–±–µ–∂–Ω–∞—è</h3>
                            <p>–ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ —á–µ—Ç–≤–µ—Ä—Ç—å/—Ç—Ä–∏–º–µ—Å—Ç—Ä</p>
                            <div class="worktype-details">
                                <span>‚è± 80-90 –º–∏–Ω</span>
                                <span>üìã 20-25 –∑–∞–¥–∞–Ω–∏–π</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('final')">
                            <div class="worktype-icon">üèÜ</div>
                            <h3>–ò—Ç–æ–≥–æ–≤–∞—è</h3>
                            <p>–ì–æ–¥–æ–≤–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</p>
                            <div class="worktype-details">
                                <span>‚è± 90-120 –º–∏–Ω</span>
                                <span>üìã 25-30 –∑–∞–¥–∞–Ω–∏–π</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('oge')">
                            <div class="worktype-icon">üìò</div>
                            <h3>–û–ì–≠</h3>
                            <p>–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω 9 –∫–ª–∞—Å—Å</p>
                            <div class="worktype-details">
                                <span>‚è± 180-235 –º–∏–Ω</span>
                                <span>üìã –ß–∞—Å—Ç–∏ 1 –∏ 2</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('ege')">
                            <div class="worktype-icon">üìó</div>
                            <h3>–ï–ì–≠</h3>
                            <p>–ï–¥–∏–Ω—ã–π –≥–æ—Å—ç–∫–∑–∞–º–µ–Ω 11 –∫–ª–∞—Å—Å</p>
                            <div class="worktype-details">
                                <span>‚è± 180-235 –º–∏–Ω</span>
                                <span>üìã –ß–∞—Å—Ç–∏ 1 –∏ 2</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('vpr')">
                            <div class="worktype-icon">üìô</div>
                            <h3>–í–ü–†</h3>
                            <p>–í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞</p>
                            <div class="worktype-details">
                                <span>‚è± 45-60 –º–∏–Ω</span>
                                <span>üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞–±–æ—Ä</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('func_literacy')">
                            <div class="worktype-icon">üß†</div>
                            <h3>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å</h3>
                            <p>–û—Ü–µ–Ω–∫–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≤—ã–∫–æ–≤</p>
                            <div class="worktype-details">
                                <span>‚è± 60-90 –º–∏–Ω</span>
                                <span>üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</span>
                            </div>
                        </div>
                        
                        <div class="worktype-card" onclick="selectWorkType('psychology')">
                            <div class="worktype-icon">üí≠</div>
                            <h3>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
                            <p>–û—Ü–µ–Ω–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤</p>
                            <div class="worktype-details">
                                <span>‚è± 40-60 –º–∏–Ω</span>
                                <span>üìã –¢–µ—Å—Ç—ã, –∞–Ω–∫–µ—Ç—ã</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="worktype-select-container" style="display: none;">
                        <label for="workType" class="section-label">–ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞:</label>
                        <select id="workType" class="form-control-large" onchange="updateWorkType(); scheduleAutoSave(); updateProgress();">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã --</option>
                            <option value="current">–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è</option>
                            <option value="milestone">–†—É–±–µ–∂–Ω–∞—è</option>
                            <option value="final">–ò—Ç–æ–≥–æ–≤–∞—è</option>
                            <option value="oge">–û–ì–≠</option>
                            <option value="ege">–ï–ì–≠</option>
                            <option value="vpr">–í–ü–†</option>
                            <option value="func_literacy">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å</option>
                            <option value="diagnostic">–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è</option>
                            <option value="psychology">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</option>
                        </select>
                    </div>
                    
                    <div class="worktype-info" id="worktypeInfo" style="display: none;">
                        <div class="info-card">
                            <h4 id="selectedWorktypeTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞</h4>
                            <p id="selectedWorktypeDesc">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã</p>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è:</span>
                                    <span class="info-value" id="infoTime">45 –º–∏–Ω—É—Ç</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">–§–æ—Ä–º–∞—Ç:</span>
                                    <span class="info-value" id="infoFormat">–¢–µ—Å—Ç</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è:</span>
                                    <span class="info-value" id="infoGrading">5-–±–∞–ª–ª—å–Ω–∞—è</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary btn-next" onclick="nextStep()" disabled id="nextStep1">
                        –î–∞–ª–µ–µ ‚Üí –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    </button>
                </div>

                <!-- –®–∞–≥ 2: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="wizard-step" id="step2">
                    <div class="step-header">
                        <span class="step-number">2</span>
                        <h2>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                    </div>
                    
                    <div class="settings-card">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="subject" class="required">üìö –ü—Ä–µ–¥–º–µ—Ç</label>
                                <input type="text" id="subject" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" 
                                       oninput="scheduleAutoSave(); updateProgress();" 
                                       class="form-input">
                                <small class="form-hint">–£–∫–∞–∂–∏—Ç–µ —É—á–µ–±–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="class" class="required">üë• –ö–ª–∞—Å—Å</label>
                                <input type="text" id="class" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5–ê" 
                                       oninput="scheduleAutoSave(); updateProgress();" 
                                       class="form-input">
                                <small class="form-hint">–£–∫–∞–∂–∏—Ç–µ –∫–ª–∞—Å—Å –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="testDate" class="required">üìÖ –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</label>
                                <input type="date" id="testDate" 
                                       onchange="scheduleAutoSave(); updateProgress();" 
                                       class="form-input">
                                <small class="form-hint">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="timeLimit" class="required">‚è± –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º–∏–Ω—É—Ç)</label>
                                <input type="number" id="timeLimit" min="1" value="45" 
                                       oninput="scheduleAutoSave(); updateProgress();" 
                                       class="form-input">
                                <small class="form-hint">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –º–∏–Ω—É—Ç–∞—Ö</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="card-title">üéØ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã</h3>
                        
                        <div class="form-group">
                            <label for="testTheme" class="required">üìñ –¢–µ–º–∞ —Ä–∞–±–æ—Ç—ã</label>
                            <input type="text" id="testTheme" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î—Ä–æ–±–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã" 
                                   oninput="scheduleAutoSave(); updateProgress();" 
                                   class="form-input">
                            <small class="form-hint">–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="testGoals" class="required">üéØ –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ü–µ–ª–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è</label>
                            <textarea id="testGoals" rows="4" 
                                      placeholder="–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∑–Ω–∞–Ω–∏—è, —É–º–µ–Ω–∏—è, –Ω–∞–≤—ã–∫–∏..." 
                                      oninput="scheduleAutoSave(); updateProgress();" 
                                      class="form-textarea"></textarea>
                            <small class="form-hint">–ö–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —É–º–µ–Ω–∏—è –∏ –∑–Ω–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–∞ —Ä–∞–±–æ—Ç–∞?</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="workFormat" class="required">üìÑ –§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</label>
                            <select id="workFormat" onchange="scheduleAutoSave(); updateProgress();" class="form-select">
                                <option value="traditional">–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è (—Å —Ä–µ—à–µ–Ω–∏—è–º–∏)</option>
                                <option value="test">–¢–µ—Å—Ç (–≤—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞)</option>
                                <option value="mixed">–°–º–µ—à–∞–Ω–Ω–∞—è</option>
                                <option value="extended">–° —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º</option>
                            </select>
                            <small class="form-hint">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞</small>
                        </div>
                    </div>
                    
                    <div class="step-navigation">
                        <button class="btn" onclick="prevStep()">
                            ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–∏–ø—É —Ä–∞–±–æ—Ç—ã
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()" id="nextStep2">
                            –î–∞–ª–µ–µ ‚Üí –£—á–∞—â–∏–µ—Å—è
                        </button>
                    </div>
                </div>

                <!-- –®–∞–≥ 3: –£—á–∞—â–∏–µ—Å—è -->
                <div class="wizard-step" id="step3">
                    <div class="step-header">
                        <span class="step-number">3</span>
                        <h2>üë• –£—á–∞—â–∏–µ—Å—è</h2>
                    </div>
                    
                    <div class="settings-card">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="totalStudents" class="required">üìã –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è –ø–æ —Å–ø–∏—Å–∫—É</label>
                                <input type="number" id="totalStudents" min="1" max="100" value="25" 
                                       oninput="updatePresentStudents(); scheduleAutoSave(); updateProgress();" 
                                       class="form-input">
                                <small class="form-hint">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤ –≤ –∫–ª–∞—Å—Å–µ</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="presentStudents" class="required">‚úèÔ∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Å–∞–≤—à–∏—Ö —Ä–∞–±–æ—Ç—É</label>
                                <div class="input-with-button">
                                    <input type="number" id="presentStudents" min="1" max="100" value="23" 
                                           oninput="scheduleAutoSave(); updateProgress();" 
                                           class="form-input">
                                    <button type="button" class="btn-icon" onclick="syncStudentsCount()" 
                                            title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º —Å–ø–∏—Å–∫–æ–º">
                                        üîÑ
                                    </button>
                                </div>
                                <small class="form-hint">–°–∫–æ–ª—å–∫–æ —É—á–µ–Ω–∏–∫–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –Ω–∞ —Ä–∞–±–æ—Ç–µ</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="absentReason">üìù –ü—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è</label>
                            <textarea id="absentReason" rows="3" 
                                      placeholder="–£–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É—á–∞—â–∏—Ö—Å—è..." 
                                      oninput="scheduleAutoSave();" 
                                      class="form-textarea"></textarea>
                            <small class="form-hint">–ë–æ–ª–µ–∑–Ω—å, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, —Å–µ–º–µ–π–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Ç.–¥.</small>
                        </div>
                        
                        <div class="attendance-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="attendancePercent">92%</div>
                                <div class="stat-label">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="absentCount">2</div>
                                <div class="stat-label">–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-navigation">
                        <button class="btn" onclick="prevStep()">
                            ‚Üê –ù–∞–∑–∞–¥ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()" id="nextStep3">
                            –î–∞–ª–µ–µ ‚Üí –ö—Ä–∏—Ç–µ—Ä–∏–∏
                        </button>
                    </div>
                </div>

                <!-- –®–∞–≥ 4: –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è -->
                <div class="wizard-step" id="step4">
                    <div class="step-header">
                        <span class="step-number">4</span>
                        <h2>üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h2>
                    </div>
                    
                    <div class="settings-card">
                        <div class="criteria-header">
                            <h3>–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h3>
                            <div class="criteria-type-selector">
                                <label>–¢–∏–ø —à–∫–∞–ª—ã:</label>
                                <select id="criteriaType" onchange="changeCriteriaType()">
                                    <option value="points">–ë–∞–ª–ª—ã (0-100)</option>
                                    <option value="percent">–ü—Ä–æ—Ü–µ–Ω—Ç—ã (0-100%)</option>
                                    <option value="custom">–°–≤–æ—è —à–∫–∞–ª–∞</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="criteriaSettingsContainer">
                            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ -->
                        </div>
                        
                        <div class="criteria-presets">
                            <h4>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</h4>
                            <div class="preset-grid">
                                <button class="preset-btn" onclick="applyPreset('standard_5')">
                                    üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)
                                </button>
                                <button class="preset-btn" onclick="applyPreset('five_point')">
                                    1Ô∏è‚É£ –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)
                                </button>
                                <button class="preset-btn" onclick="applyPreset('vpr_percent')">
                                    üìù –í–ü–† (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
                                </button>
                                <button class="preset-btn" onclick="applyPreset('psychology_levels')">
                                    üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è (—É—Ä–æ–≤–Ω–∏)
                                </button>
                                <button class="preset-btn" onclick="applyPreset('ege_scaled')">
                                    üìò –ï–ì–≠ (—à–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
                                </button>
                            </div>
                        </div>
                        
                        <div class="criteria-controls">
                            <button class="btn btn-success" onclick="saveCriteriaSettings()">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏
                            </button>
                            <button class="btn" onclick="loadDefaultCriteria()">
                                üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                            <button class="btn" onclick="generateAutoCriteria()">
                                üéØ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                            </button>
                        </div>
                        
                        <div class="recommendation-card">
                            <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong>
                            <ul>
                                <li><strong>–ë–∞–ª–ª—ã</strong> - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</li>
                                <li><strong>–ü—Ä–æ—Ü–µ–Ω—Ç—ã</strong> - —É–¥–æ–±–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –í–ü–†</li>
                                <li><strong>–°–≤–æ—è —à–∫–∞–ª–∞</strong> - –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3>üéØ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
                        <div class="preview-grid" id="criteriaPreview">
                            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ -->
                        </div>
                    </div>
                    
                    <div class="step-navigation">
                        <button class="btn" onclick="prevStep()">
                            ‚Üê –ù–∞–∑–∞–¥ –∫ —É—á–∞—â–∏–º—Å—è
                        </button>
                        <button class="btn btn-primary" onclick="completeSetup()" id="completeSetup">
                            ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è) -->
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <button class="btn btn-success" onclick="saveTestSettings()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                <button class="btn btn-warning" onclick="loadSampleData()">
                    üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä
                </button>
                <button class="btn" onclick="restoreBackupDialog()">
                    üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
                </button>
                <button class="btn btn-outline" onclick="editSetup()">
                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                <button class="btn btn-danger" onclick="showResetDialog()">
                    ‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                </button>
            </div>

            <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
			<div class="modal-overlay" id="resetDialog">
				<div class="modal-content">
					<h3>‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–±—Ä–æ—Å–∞</h3>
					<p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					<div class="modal-actions">
						<button class="btn" onclick="closeModal('resetDialog')">–û—Ç–º–µ–Ω–∞</button>
						<button class="btn btn-danger" onclick="resetAllData()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
					</div>
				</div>
			</div>

			<div class="modal-overlay" id="successModal">
				<div class="modal-content success">
					<div class="modal-icon">‚úÖ</div>
					<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</h3>
					<p>–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏–π.</p>
					<button class="btn btn-success" onclick="closeModal('successModal')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
				</div>
			</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ –∑–∞–¥–∞–Ω–∏–π -->
        <div id="tasks" class="tab-content">
            <h2 class="section-title">üìù –¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π</h2>
            <div id="tasksContainer"></div>
            <button class="btn btn-success" onclick="saveTasks()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —É—á–∞—â–∏—Ö—Å—è -->
        <div id="students" class="tab-content">
            <h2 class="section-title">üë• –°–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è</h2>
            
            <button class="btn btn-info mb-3" onclick="toggleViewMode()">
                <i class="fas fa-exchange-alt me-2"></i>
                <span id="viewModeText">–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–ª–∞—Å—Å–∞–º–∏</span>
            </button>

            <div id="classManagerContainer" style="display: none;"></div>          
            <div id="studentsContainer"></div>
            <button class="btn btn-success" onclick="saveStudents()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫ -->
        <div id="results" class="tab-content">
            <h2 class="section-title">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏</h2>
            <button class="btn btn-warning" onclick="showBulkEditScores()">üìù –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</button>
            <div id="resultsContainer"></div>
            <button class="btn btn-success" onclick="saveResults()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
        <div id="analytics" class="tab-content">
            <h2 class="section-title">üìà –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            
            <div class="export-buttons">
                <button class="btn" onclick="showComparativeAnalysis()">üìà –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</button>
                <button class="btn" onclick="initAdvancedSearch()">üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</button>
                <button class="btn" onclick="showSmartRecommendations()">ü§ñ –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
            </div>
            
            <h3 class="section-title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="kpi-grid" id="kpiDashboard"></div>

            <h3 class="section-title">–¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
            <div id="taxonomyAnalysis"></div>

            <h3 class="section-title">–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h3>
            <div id="errorsAnalysis"></div>

            <h3 class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É—á–∞—â–∏—Ö—Å—è</h3>
            <div id="personalAnalysis"></div>

            <div id="specializedAnalysis"></div>
            
            <div id="smartRecommendationsContainer"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
        <div id="visualization" class="tab-content">
            <h2 class="section-title">üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
            
            <div class="print-controls no-print">
                <h4>üñ®Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—á–∞—Ç—å—é</h4>
                <p>–î–ª—è –ø–µ—á–∞—Ç–∏ –æ—Ç—á–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à Ctrl+P</p>
                <button class="btn btn-print" onclick="printFullReport()">üñ®Ô∏è –ü–µ—á–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞</button>
                <button class="btn" onclick="printOptimizedReport()">üìÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—á–∞—Ç—å</button>
            </div>
            
            <div class="chart-row">
                <div class="chart-container">
                    <h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h3>
                    <canvas id="gradesChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üéØ –ö–æ—Ä–∏–¥–æ—Ä —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π</h3>
                    <canvas id="solvabilityChart"></canvas>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #e74c3c"></div>
                            <span>–ö—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ (&lt;30%) - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f39c12"></div>
                            <span>–ñ–µ–ª—Ç–∞—è –∑–æ–Ω–∞ (30-60%) - —Ç—Ä–µ–±—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2ecc71"></div>
                            <span>–ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ (60-90%) - –º–∞—Ç–µ—Ä–∏–∞–ª —É—Å–≤–æ–µ–Ω —Ö–æ—Ä–æ—à–æ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #27ae60"></div>
                            <span>–û—Ç–ª–∏—á–Ω–∞—è –∑–æ–Ω–∞ (&gt;90%) - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìà –°–≤—è–∑—å —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏</h3>
                <canvas id="complexityChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h3>
                <div id="heatmapContainer"></div>
            </div>

            <div id="specializedCharts"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π -->
        <div id="recommendations" class="tab-content">
            <h2 class="section-title">üí° –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
            
            <div class="print-only">
                <div class="header" style="padding: 15px; margin-bottom: 20px;">
                    <h2 style="font-size: 1.5em; margin: 0;">–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h2>
                    <p style="margin: 5px 0;"><strong id="printSubjectClass"></strong> | <span id="printTheme"></span> | <span id="printDate"></span></p>
                </div>
            </div>
            
            <h3 class="section-title">–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</h3>
            <div id="keyConclusions"></div>

            <h3 class="section-title">–ü–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h3>
            <div id="correctionPlan"></div>

            <h3 class="section-title">–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏</h3>
            <div id="nextSteps"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
        <div id="export" class="tab-content">
            <h2 class="section-title">üíæ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤</h2>
            
            <div class="export-buttons">
                <button class="btn btn-success" onclick="exportHTML()">üìä –ü–æ–ª–Ω—ã–π HTML –æ—Ç—á–µ—Ç</button>
                <button class="btn btn-print" onclick="printFullReport()">üñ®Ô∏è –ü–µ—á–∞—Ç—å –Ω–∞ –ê4</button>
                <button class="btn" onclick="printOptimizedReport()">üìÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—á–∞—Ç—å</button>
                <button class="btn" onclick="exportToExcel()">üìä Excel –æ—Ç—á–µ—Ç</button>
                <button class="btn" onclick="exportToPDF()">üìÑ PDF –æ—Ç—á–µ—Ç</button>
                <button class="btn" onclick="exportJSON()">üíæ –î–∞–Ω–Ω—ã–µ (JSON)</button>
                <button class="btn" onclick="exportSpecializedReport()">üéØ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç</button>
                <button class="btn" onclick="exportForTeacher()">üë©‚Äçüè´ –û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è</button>
                <button class="btn" onclick="exportForEJournal()">üìí –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è —ç–ª.–¥–Ω–µ–≤–Ω–∏–∫–∞</button>
                <button class="btn" onclick="showComparativeAnalysis()">üìà –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</button>
                <button class="btn" onclick="showBulkEditScores()">üìù –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                <button class="btn" onclick="initAdvancedSearch()">üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</button>
                <button class="btn" onclick="printPsychologyReport()">üß† –ü–µ—á–∞—Ç—å –ø—Å–∏—Ö. –∑–∞–∫–ª—é—á–µ–Ω–∏—è</button>
                <button class="btn" onclick="exportAppData('json')">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (JSON)</button>
                
                <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
                <input type="file" id="fileImport" accept=".json" style="display: none;" onchange="handleFileImport(event)">
                <button class="btn" onclick="document.getElementById('fileImport').click()">üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                
                <button class="btn btn-danger" onclick="showResetDialog()">‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
            </div>

            <div class="chart-container">
                <h3>üìã –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h3>
                <div id="reportPreview"></div>
            </div>
        </div>
		
		
		
    </div>
	

	


	<!-- QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–≤—Ç–æ—Ä–∞ -->
	<div class="qr-code-container no-print">
		<div class="qr-code-tooltip">
			<span class="heart-pulse">‚ù§Ô∏è</span> –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞
			<div class="qr-code-image">
				<div class="qr-frame">
					<img src="qr.jpg" 
						 alt="QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞" 
						 title="–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–≤—Ç–æ—Ä–∞">
					<div class="qr-sparkle"></div>
					<div class="qr-sparkle"></div>
					<div class="qr-sparkle"></div>
				</div>
				<div class="qr-text">
					–õ—é–±–∞—è —Å—É–º–º–∞ –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="sparkle">‚ú®</span>
				</div>
				<div class="qr-thanks">–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É! üôè</div>
			</div>
		</div>
	</div>
	<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ç—É—Ä–∞ -->
	<button class="tour-start-btn no-print" onclick="startTour()" title="–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ">
		üéì
	</button>

	<!-- –û–≤–µ—Ä–ª–µ–π —Ç—É—Ä–∞ -->
	<div class="tour-overlay" id="tourOverlay"></div>
	<!-- –¢—É—Ç–æ—Ä–∏–∞–ª -->
	<div id="tutorial-overlay" class="tutorial-overlay" style="display: none;">
	  <div class="tutorial-container" id="tutorial-container">
		<div class="tutorial-header">
		  <h3>üéì –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
		  <p id="tutorial-step">–®–∞–≥ 1 –∏–∑ 8</p>
		</div>
		<div class="tutorial-content" id="tutorial-content">
		  <p>–î–∞–≤–∞–π—Ç–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
		</div>
		<div class="tutorial-actions">
		  <button class="btn btn-outline" onclick="skipTutorial()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
		  <button class="btn" onclick="prevTutorialStep()" id="prev-btn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
		  <button class="btn btn-primary" onclick="nextTutorialStep()" id="next-btn">–î–∞–ª–µ–µ ‚Üí</button>
		</div>
		<div class="tutorial-progress">
		  <div class="progress-bar">
			<div class="progress-fill" id="tutorial-progress" style="width: 12.5%;"></div>
		  </div>
		</div>
	  </div>
	</div>

	<!-- –ö–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ -->
	<button class="tutorial-helper" id="tutorial-helper" title="–ü–æ–º–æ—â—å –∏ –æ–±—É—á–µ–Ω–∏–µ">
	  <i class="fas fa-question-circle"></i>
	</button>
	
	<!-- PWA Installation -->
		<div id="pwa-install-prompt" class="pwa-prompt" style="display: none;">
		  <div class="pwa-prompt-content">
			<div class="pwa-prompt-icon">
			  <i class="fas fa-mobile-alt"></i>
			</div>
			<div class="pwa-prompt-text">
			  <h4>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?</h4>
			  <p>–î–æ–±–∞–≤—å—Ç–µ —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
			</div>
			<div class="pwa-prompt-actions">
			  <button class="btn btn-outline" onclick="hidePwaPrompt()">–ü–æ–∑–∂–µ</button>
			  <button class="btn btn-primary" onclick="installPwa()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
			</div>
		  </div>
		</div>

		<!-- Offline Indicator -->
		<div id="offline-indicator" class="offline-indicator" style="display: none;">
		  <div class="offline-content">
			<i class="fas fa-wifi-slash"></i>
			<span>–†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ</span>
		  </div>
		</div>
	<script src="modules/errorHandler.js"></script>
	//<script src="modules/tableRenderer.js"></script>
	<script src="modules/tests.js"></script>
	
    <script src="script.js"></script>
    <script>
  
		window.ErrorHandler = null;
		window.TableRenderer = null;
		window.TestRunner = null;	
		
	    let saveTimeout;
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
		let appData = {
			test: {
				subject: "",
				class: "",
				testDate: new Date().toISOString().split('T')[0],
				theme: "",
				goals: "",
				workType: "current",
				workFormat: "mixed",
				timeLimit: 45,
				totalStudents: 25,
				presentStudents: 23,
				absentReason: "",
				criteria: {
					5: { min: 18, max: 20 },
					4: { min: 15, max: 17 },
					3: { min: 10, max: 14 },
					2: { min: 0, max: 9 }
				},
				criteriaType: 'points',
				criteriaSystem: 'standard',
				customCriteria: [],
				criteriaCount: 4,
				criteriaScale: '2-5'
			},
			tasks: [],
			students: [],
			results: [],
			errors: [],
			psychologyFeatures: [],
			
			// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–£–ï–ú –ü–û–õ–ù–û–°–¢–¨–Æ
			templates: {
				loadedTemplates: [],
				lastTemplatePath: "",
				lastTemplateName: "", // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ –ø–æ–ª–µ
				availableSubjects: []
			}
		};
		
		// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –∏ –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤ —à–∫–æ–ª—ã
		const schoolData = {
			classes: [], // –ú–∞—Å—Å–∏–≤ –∫–ª–∞—Å—Å–æ–≤
			lastImportDate: null, // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
			schoolName: '' // –ù–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã
		};

		// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
		class SchoolClass {
			constructor(name, grade, teacher = '') {
				this.id = 'class_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
				this.name = name;
				this.grade = grade;
				this.teacher = teacher;
				this.students = [];
				this.createdAt = new Date().toISOString();
			}
		}

		// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—á–µ–Ω–∏–∫–∞ —à–∫–æ–ª—ã
		class SchoolStudent {
			constructor(lastName, firstName, middleName = '', id = '') {
				this.id = id || 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
				this.lastName = lastName;
				this.firstName = firstName;
				this.middleName = middleName;
				this.fullName = `${lastName} ${firstName} ${middleName}`.trim();
				this.classId = null;
				this.isPresent = true;
			}
		}
	
		
		// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		window.gradesChartInstance = null;
		window.complexityChartInstance = null;
		window.solvabilityChartInstance = null;
		window.literacyChartInstance = null;
		window.literacyRadarChartInstance = null;
		window.trendChartInstance = null;
		
        // –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        const complexityLevels = {
            1: { name: "–ë–∞–∑–æ–≤—ã–π/–†–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π", color: "#27ae60", desc: "–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤, –ø—Ä–∞–≤–∏–ª, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π" },
            2: { name: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ", color: "#3498db", desc: "–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏" },
            3: { name: "–ê–Ω–∞–ª–∏–∑/–°–∏–Ω—Ç–µ–∑", color: "#f39c12", desc: "–∞–Ω–∞–ª–∏–∑, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è" },
            4: { name: "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ", color: "#e74c3c", desc: "—Ä–µ—à–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è" }
        };

        // –¢–∏–ø—ã –æ—à–∏–±–æ–∫
        const errorTypes = {
            factual: { name: "–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏", color: "#e74c3c", desc: "–Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞—Ç—ã, –∏–º–µ–Ω–∞, —Ñ–æ—Ä–º—É–ª—ã" },
            conceptual: { name: "–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏", color: "#9b59b6", desc: "–Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–æ—Ä–∏–∏, –∑–∞–∫–æ–Ω–æ–≤, –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤" },
            application: { name: "–û—à–∏–±–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è", color: "#3498db", desc: "–Ω–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —Ä–µ—à–µ–Ω–∏—è" },
            calculation: { name: "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏", color: "#f39c12", desc: "–æ—à–∏–±–∫–∏ –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö" },
            logical: { name: "–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏", color: "#d35400", desc: "–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è—Ö" },
            attention: { name: "–û—à–∏–±–∫–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", color: "#16a085", desc: "–Ω–µ–≤–µ—Ä–Ω–æ –ø—Ä–æ—á–µ–ª —É—Å–ª–æ–≤–∏–µ, –ø—Ä–æ–ø—É—Å—Ç–∏–ª –≤–æ–ø—Ä–æ—Å" },
            technical: { name: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏", color: "#7f8c8d", desc: "–µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ" }
        };

        // –¢–∏–ø—ã —Ä–∞–±–æ—Ç
        const workTypes = {
            current: { name: "–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è", criteria: "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ" },
            milestone: { name: "–†—É–±–µ–∂–Ω–∞—è", criteria: "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ" },
            final: { name: "–ò—Ç–æ–≥–æ–≤–∞—è", criteria: "–∏—Ç–æ–≥–æ–≤—ã–µ" },
            oge: { name: "–û–ì–≠", criteria: "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ" },
            ege: { name: "–ï–ì–≠", criteria: "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ" },
            vpr: { name: "–í–ü–†", criteria: "—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ" },
            func_literacy: { name: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", criteria: "–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–Ω—ã–µ" },
            diagnostic: { name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è", criteria: "–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ" },
			psychology: { 
        name: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", 
			criteria: "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ" 
		}
        };

        // –£—Ä–æ–≤–Ω–∏ –í–ü–†
        const vprLevels = {
            1: { name: "–ë–∞–∑–æ–≤—ã–π", color: "#27ae60" },
            2: { name: "–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π", color: "#3498db" }
        };

        // –ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –í–ü–†
        const vprCompetencies = {
            text_work: "–†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º",
            calculations: "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏", 
            logic: "–õ–æ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ",
            graphics: "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å",
            data_work: "–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏"
        };

        // –í–∏–¥—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
        const functionalLiteracyTypes = {
            reading: { name: "–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#3498db" },
            math: { name: "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#e74c3c" },
            science: { name: "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–Ω–∞—É—á–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#9b59b6" },
            financial: { name: "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#27ae60" },
            global: { name: "–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏", color: "#f39c12" },
            digital: { name: "–¶–∏—Ñ—Ä–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#34495e" }
        };

        // –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
        const literacyContexts = {
            personal: "–õ–∏—á–Ω—ã–π",
            educational: "–£—á–µ–±–Ω—ã–π", 
            professional: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π",
            social: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π",
            global: "–ì–ª–æ–±–∞–ª—å–Ω—ã–π"
        };

		// ==================== PWA –§–£–ù–ö–¶–ò–ò ====================

		let deferredPrompt = null;
		let isPwaInstalled = false;

		// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É PWA
		function isPwaSupported() {
		  return 'serviceWorker' in navigator && 'PushManager' in window;
		}

		// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker
		function registerServiceWorker() {
		  if (!isPwaSupported()) {
			console.log('PWA –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
			return;
		  }
		  
		  navigator.serviceWorker.register('/service-worker.js')
			.then(registration => {
			  console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
			  
			  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
			  registration.addEventListener('updatefound', () => {
				const newWorker = registration.installing;
				console.log('New service worker found:', newWorker);
				
				newWorker.addEventListener('statechange', () => {
				  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
					showUpdateNotification();
				  }
				});
			  });
			})
			.catch(error => {
			  console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
			});
		}

		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
		function showUpdateNotification() {
		  if (confirm('–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–∏—Ç—å?')) {
			window.location.reload();
		  }
		}

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è beforeinstallprompt
		window.addEventListener('beforeinstallprompt', (e) => {
		  console.log('beforeinstallprompt fired');
		  
		  // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
		  e.preventDefault();
		  
		  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–∑–∂–µ
		  deferredPrompt = e;
		  
		  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏ —É–∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
		  if (!isPwaInstalled) {
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
			setTimeout(showPwaInstallPrompt, 5000);
		  }
		});

		// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏ PWA
		function checkIfPwaInstalled() {
		  // –î–ª—è iOS
		  if (window.navigator.standalone) {
			isPwaInstalled = true;
			return true;
		  }
		  
		  // –î–ª—è Android/–¥—Ä—É–≥–∏—Ö
		  if (window.matchMedia('(display-mode: standalone)').matches) {
			isPwaInstalled = true;
			return true;
		  }
		  
		  return false;
		}

		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–º–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
		function showPwaInstallPrompt() {
		  if (checkIfPwaInstalled()) {
			console.log('PWA —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
			return;
		  }
		  
		  if (!deferredPrompt) {
			console.log('–ù–µ—Ç deferredPrompt');
			return;
		  }
		  
		  const prompt = document.getElementById('pwa-install-prompt');
		  if (prompt) {
			prompt.style.display = 'block';
		  }
		}

		// –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–º–ø—Ç
		function hidePwaPrompt() {
		  const prompt = document.getElementById('pwa-install-prompt');
		  if (prompt) {
			prompt.style.display = 'none';
		  }
		}

		// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA
		function installPwa() {
		  hidePwaPrompt();
		  
		  if (!deferredPrompt) {
			alert('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
			return;
		  }
		  
		  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
		  deferredPrompt.prompt();
		  
		  // –ñ–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
		  deferredPrompt.userChoice.then((choiceResult) => {
			if (choiceResult.outcome === 'accepted') {
			  console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª PWA');
			  isPwaInstalled = true;
			  showNotification('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
			} else {
			  console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏');
			}
			
			// –û—á–∏—â–∞–µ–º deferredPrompt
			deferredPrompt = null;
		  });
		}

		// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–æ–º
		function setupOfflineDetection() {
		  const indicator = document.getElementById('offline-indicator');
		  
		  function updateOnlineStatus() {
			if (navigator.onLine) {
			  if (indicator) indicator.style.display = 'none';
			  console.log('–û–Ω–ª–∞–π–Ω');
			} else {
			  if (indicator) indicator.style.display = 'block';
			  console.log('–û—Ñ–ª–∞–π–Ω');
			  showNotification('–†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ', 'info');
			}
		  }
		  
		  window.addEventListener('online', updateOnlineStatus);
		  window.addEventListener('offline', updateOnlineStatus);
		  
		  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
		  updateOnlineStatus();
		}

		// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
		function setupBackgroundSync() {
		  if (!isPwaSupported()) return;
		  
		  navigator.serviceWorker.ready.then(registration => {
			// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
			registration.sync.register('sync-data')
			  .then(() => console.log('Background sync registered'))
			  .catch(err => console.log('Background sync registration failed:', err));
		  });
		}

		// –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
		function requestNotificationPermission() {
		  if (!('Notification' in window)) {
			console.log('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
			return;
		  }
		  
		  if (Notification.permission === 'granted') {
			console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã');
			return;
		  }
		  
		  if (Notification.permission !== 'denied') {
			Notification.requestPermission().then(permission => {
			  if (permission === 'granted') {
				console.log('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–æ');
				subscribeToPushNotifications();
			  }
			});
		  }
		}

		// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
		function subscribeToPushNotifications() {
		  if (!isPwaSupported()) return;
		  
		  navigator.serviceWorker.ready.then(registration => {
			registration.pushManager.subscribe({
			  userVisibleOnly: true,
			  applicationServerKey: urlBase64ToUint8Array('–í–ê–®_PUBLIC_VAPID_KEY')
			})
			.then(subscription => {
			  console.log('–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', subscription);
			  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å subscription –Ω–∞ —Å–µ—Ä–≤–µ—Ä
			})
			.catch(error => {
			  console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ push:', error);
			});
		  });
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è VAPID –∫–ª—é—á–∞
		function urlBase64ToUint8Array(base64String) {
		  const padding = '='.repeat((4 - base64String.length % 4) % 4);
		  const base64 = (base64String + padding)
			.replace(/-/g, '+')
			.replace(/_/g, '/');
		  
		  const rawData = window.atob(base64);
		  const outputArray = new Uint8Array(rawData.length);
		  
		  for (let i = 0; i < rawData.length; ++i) {
			outputArray[i] = rawData.charCodeAt(i);
		  }
		  
		  return outputArray;
		}

		// Mobile-only —Ñ—É–Ω–∫—Ü–∏–∏
		function setupMobileFeatures() {
		  // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
		  if ('vibrate' in navigator) {
			// –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
			const originalShowNotification = window.showNotification;
			window.showNotification = function(message, type) {
			  originalShowNotification.call(this, message, type);
			  
			  if (type === 'success') {
				navigator.vibrate(100);
			  }
			};
		  }
		  
		  // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∏–Ω–ø—É—Ç–∞—Ö –≤ iOS
		  document.addEventListener('touchstart', function(e) {
			if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
			  document.body.style.zoom = '100%';
			}
		  });
		  
		  // –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞ iOS
		  document.addEventListener('touchmove', function(e) {
			if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
			  e.preventDefault();
			}
		  }, { passive: false });
		}

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
		  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker
		  registerServiceWorker();
		  
		  // –ü—Ä–æ–≤–µ—Ä—è–µ–º PWA
		  checkIfPwaInstalled();
		  
		  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ñ–ª–∞–π–Ω-–¥–µ—Ç–µ–∫—Ü–∏—é
		  setupOfflineDetection();
		  
		  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
			setupMobileFeatures();
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
			document.body.classList.add('is-mobile');
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
			addMobileNavigation();
		  }
		  
		  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–º–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏ –¥–æ–ª–≥–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
		  setTimeout(showPwaInstallPrompt, 30000); // 30 —Å–µ–∫—É–Ω–¥

		  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∫–æ–Ω–æ–∫
		  setTimeout(checkPwaIcons, 3000);
		  
		  // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ)
		  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
			addPwaDebugButton();
		  }		  
		  
		  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		  setupHotkeys();
		  setupProgressiveSaving();
		  enhanceExportSection();
		  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
		const tourCompleted = localStorage.getItem('tourCompleted');
		if (!tourCompleted) {
			setTimeout(() => {
				if (confirm('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –∫—Ä–∞—Ç–∫–∏–π —Ç—É—Ä –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º —Å–∏—Å—Ç–µ–º—ã?')) {
					startTour();
				}
			}, 2000);
		}
		
		// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
		const savedAutoSave = localStorage.getItem('autoSaveEnabled');
		if (savedAutoSave !== null) {
			autoSaveEnabled = savedAutoSave === 'true';
		}
		});

		// –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
		function addMobileNavigation() {
		  const container = document.querySelector('.container');
		  if (!container) return;
		  
		  const navHTML = `
			<div class="mobile-nav" style="display: none;">
			  <button class="mobile-nav-btn" onclick="window.history.back()">
				<i class="fas fa-arrow-left"></i>
			  </button>
			  <button class="mobile-nav-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
				<i class="fas fa-arrow-up"></i>
			  </button>
			  <button class="mobile-nav-btn" onclick="showTutorial()">
				<i class="fas fa-question"></i>
			  </button>
			</div>
		  `;
		  
		  container.insertAdjacentHTML('afterend', navHTML);
		  
		  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
		  let lastScrollTop = 0;
		  window.addEventListener('scroll', function() {
			const nav = document.querySelector('.mobile-nav');
			if (!nav) return;
			
			const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
			
			if (scrollTop > 100) {
			  nav.style.display = 'flex';
			} else {
			  nav.style.display = 'none';
			}
			
			lastScrollTop = scrollTop;
		  });
		  
		  // –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
		  const style = document.createElement('style');
		  style.textContent = `
			.mobile-nav {
			  position: fixed;
			  bottom: 20px;
			  right: 20px;
			  display: flex;
			  flex-direction: column;
			  gap: 10px;
			  z-index: 9998;
			}
			
			.mobile-nav-btn {
			  width: 50px;
			  height: 50px;
			  border-radius: 50%;
			  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			  color: white;
			  border: none;
			  font-size: 18px;
			  display: flex;
			  align-items: center;
			  justify-content: center;
			  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			  cursor: pointer;
			}
			
			.is-mobile .container {
			  padding-bottom: 80px;
			}
		  `;
		  
		  document.head.appendChild(style);
		}

		// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
		window.registerServiceWorker = registerServiceWorker;
		window.installPwa = installPwa;
		window.hidePwaPrompt = hidePwaPrompt;
		window.showPwaInstallPrompt = showPwaInstallPrompt;

        // ==================== –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –†–ï–®–ï–ù–ò–Ø ====================
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
		function loadAppData() {
			const savedData = localStorage.getItem('testAnalyticsData');
			if (savedData) {
				const parsedData = JSON.parse(savedData);
				appData = parsedData;
				
				// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ templates —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
				if (!appData.templates) {
					appData.templates = {
						loadedTemplates: [],
						lastTemplatePath: "",
						lastTemplateName: "",
						availableSubjects: []
					};
				}
				
				// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è templates —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				appData.templates = {
					loadedTemplates: appData.templates.loadedTemplates || [],
					lastTemplatePath: appData.templates.lastTemplatePath || "",
					lastTemplateName: appData.templates.lastTemplateName || "",
					availableSubjects: appData.templates.availableSubjects || []
				};
			}
		}

		// –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		document.addEventListener('DOMContentLoaded', function() {
			//loadAppData();
			//renderAll();
		});
		
		// ==================== –†–ï–ñ–ò–ú –û–¢–õ–ê–î–ö–ò ====================

		let debugMode = false;

		function toggleDebugMode() {
			debugMode = !debugMode;
			
			if (debugMode) {
				// –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
				document.body.classList.add('debug-mode');
				console.log('üîß –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω');
				showNotification('üîß –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω', 'info');
				
				// –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏
				addDebugPanel();
			} else {
				// –í—ã–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
				document.body.classList.remove('debug-mode');
				console.log('üîß –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤—ã–∫–ª—é—á–µ–Ω');
				showNotification('üîß –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤—ã–∫–ª—é—á–µ–Ω', 'info');
				
				// –£–±–∏—Ä–∞–µ–º –ø–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏
				removeDebugPanel();
			}
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
			localStorage.setItem('debugMode', debugMode.toString());
		}

		function addDebugPanel() {
			const panel = document.createElement('div');
			panel.id = 'debugPanel';
			panel.style.cssText = `
				position: fixed;
				top: 10px;
				left: 10px;
				background: rgba(0, 0, 0, 0.85);
				color: #0f0;
				padding: 10px;
				border-radius: 5px;
				font-family: monospace;
				font-size: 11px;
				z-index: 10000;
				max-width: 300px;
				max-height: 200px;
				overflow: auto;
				border: 1px solid #0f0;
			`;
			
			panel.innerHTML = `
				<div style="margin-bottom: 5px; font-weight: bold;">üîß –ü–ê–ù–ï–õ–¨ –û–¢–õ–ê–î–ö–ò</div>
				<div id="debugInfo"></div>
				<div style="margin-top: 5px; border-top: 1px solid #0f0; padding-top: 5px;">
					<button onclick="runDebugTests()" style="background: #333; color: #0f0; border: 1px solid #0f0; padding: 2px 5px; font-size: 10px; cursor: pointer;">
						üß™ –¢–µ—Å—Ç—ã
					</button>
					<button onclick="clearDebugInfo()" style="background: #333; color: #0f0; border: 1px solid #0f0; padding: 2px 5px; font-size: 10px; cursor: pointer; margin-left: 5px;">
						üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
					</button>
				</div>
			`;
			
			document.body.appendChild(panel);
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
			debugInterval = setInterval(updateDebugInfo, 1000);
		}

		function removeDebugPanel() {
			const panel = document.getElementById('debugPanel');
			if (panel) {
				panel.remove();
			}
			
			if (debugInterval) {
				clearInterval(debugInterval);
			}
		}

		function updateDebugInfo() {
			const info = document.getElementById('debugInfo');
			if (!info) return;
			
			const dataSize = localStorage.getItem('testAnalyticsData')?.length || 0;
			const memory = performance.memory ? 
				`–ü–∞–º—è—Ç—å: ${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB` : 
				'–ü–∞–º—è—Ç—å: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
			
			info.innerHTML = `
				<div>–í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}</div>
				<div>–î–∞–Ω–Ω—ã–µ: ${(dataSize / 1024).toFixed(2)} –ö–ë</div>
				<div>${memory}</div>
				<div>–û—à–∏–±–∫–∏: ${window.errorCount || 0}</div>
				<div>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π: ${window.saveCount || 0}</div>
			`;
		}

		function runDebugTests() {
			console.log('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –æ—Ç–ª–∞–¥–∫–∏...');
			
			// –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
			try {
				localStorage.setItem('debug_test', 'test');
				localStorage.removeItem('debug_test');
				logDebug('‚úÖ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç');
			} catch (e) {
				logDebug('‚ùå localStorage –æ—à–∏–±–∫–∞: ' + e.message);
			}
			
			// –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
			logDebug(`üìä –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(appData).length} —Å–∏–º–≤–æ–ª–æ–≤`);
			logDebug(`üë• –£—á–∞—â–∏–µ—Å—è: ${appData.students?.length || 0}`);
			logDebug(`üìù –ó–∞–¥–∞–Ω–∏—è: ${appData.tasks?.length || 0}`);
			
			// –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
			const functions = ['saveData', 'showNotification', 'showModal'];
			functions.forEach(func => {
				if (typeof window[func] === 'function') {
					logDebug(`‚úÖ ${func} —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`);
				} else {
					logDebug(`‚ùå ${func} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`);
				}
			});
		}

		function logDebug(message) {
			console.log('üîß ' + message);
			const info = document.getElementById('debugInfo');
			if (info) {
				const div = document.createElement('div');
				div.textContent = '‚Ä¢ ' + message;
				info.appendChild(div);
				info.scrollTop = info.scrollHeight;
			}
		}

		function clearDebugInfo() {
			const info = document.getElementById('debugInfo');
			if (info) {
				info.innerHTML = '';
			}
		}
		
		// ==================== –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –¢–£–†/ONBOARDING ====================

		const tourSteps = [
			{
				title: "üéØ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
				content: "–≠—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü—Ä–æ–π–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–∏–π —Ç—É—Ä –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º.",
				target: null,
				position: "center"
			},
			{
				title: "üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–±–æ—Ç—ã",
				content: "–ù–∞—á–Ω–∏—Ç–µ —Å –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.",
				target: "#setup",
				position: "right"
			},
			{
				title: "üìù –¢–∞–∫—Å–æ–Ω–æ–º–∏—è –∑–∞–¥–∞–Ω–∏–π",
				content: "–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞–Ω–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è.",
				target: "#tasks",
				position: "right"
			},
			{
				title: "üë• –£—á–∞—â–∏–µ—Å—è",
				content: "–î–æ–±–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞.",
				target: "#students",
				position: "right"
			},
			{
				title: "üìä –í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
				content: "–í–≤–µ–¥–∏—Ç–µ –±–∞–ª–ª—ã –∑–∞ –∫–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è.",
				target: "#results",
				position: "right"
			},
			{
				title: "üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
				content: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –≤—ã—è–≤–ª—è–π—Ç–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.",
				target: "#analytics",
				position: "right"
			},
			{
				title: "üíæ –≠–∫—Å–ø–æ—Ä—Ç",
				content: "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç—ã –≤ —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, Excel, Word.",
				target: "#export",
				position: "right"
			},
			{
				title: "üéØ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è",
				content: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã:<br>‚Ä¢ Ctrl+S - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å<br>‚Ä¢ Ctrl+P - –ü–µ—á–∞—Ç—å<br>‚Ä¢ Ctrl+E - –≠–∫—Å–ø–æ—Ä—Ç",
				target: ".export-buttons",
				position: "bottom"
			},
			{
				title: "üöÄ –ì–æ—Ç–æ–≤–æ!",
				content: "–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã. –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—Ç—ã!",
				target: null,
				position: "center"
			}
		];

		let currentTourStep = 0;
		let tourActive = false;

		function startTour() {
			currentTourStep = 0;
			tourActive = true;
			showTourStep(0);
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
			const overlay = document.getElementById('tourOverlay');
			overlay.style.display = 'block';
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage, —á—Ç–æ —Ç—É—Ä –ø–æ–∫–∞–∑–∞–Ω
			localStorage.setItem('tourCompleted', 'true');
		}

		function showTourStep(stepIndex) {
			const step = tourSteps[stepIndex];
			const overlay = document.getElementById('tourOverlay');
			
			// –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
			document.querySelectorAll('.tour-highlight').forEach(el => {
				el.classList.remove('tour-highlight');
			});
			
			// –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥
			document.querySelectorAll('.tour-step').forEach(el => el.remove());
			
			// –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —à–∞–≥
			const tourStep = document.createElement('div');
			tourStep.className = 'tour-step';
			
			// –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º
			if (step.target && document.querySelector(step.target)) {
				const target = document.querySelector(step.target);
				target.classList.add('tour-highlight');
				
				const rect = target.getBoundingClientRect();
				
				switch(step.position) {
					case 'top':
						tourStep.style.top = (rect.top - tourStep.offsetHeight - 10) + 'px';
						tourStep.style.left = rect.left + 'px';
						break;
					case 'bottom':
						tourStep.style.top = (rect.bottom + 10) + 'px';
						tourStep.style.left = rect.left + 'px';
						break;
					case 'left':
						tourStep.style.top = rect.top + 'px';
						tourStep.style.left = (rect.left - tourStep.offsetWidth - 10) + 'px';
						break;
					case 'right':
						tourStep.style.top = rect.top + 'px';
						tourStep.style.left = (rect.right + 10) + 'px';
						break;
				}
			} else {
				// –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
				tourStep.style.top = '50%';
				tourStep.style.left = '50%';
				tourStep.style.transform = 'translate(-50%, -50%)';
			}
			
			// –°–æ–¥–µ—Ä–∂–∏–º–æ–µ
			tourStep.innerHTML = `
				<h3>${step.title}</h3>
				<p>${step.content}</p>
				<div class="tour-actions">
					<button class="btn btn-outline" onclick="prevTourStep()" ${stepIndex === 0 ? 'disabled' : ''}>
						‚Üê –ù–∞–∑–∞–¥
					</button>
					<div class="tour-counter">
						–®–∞–≥ ${stepIndex + 1} –∏–∑ ${tourSteps.length}
					</div>
					<button class="btn btn-primary" onclick="nextTourStep()">
						${stepIndex === tourSteps.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ ‚Üí'}
					</button>
				</div>
			`;
			
			overlay.appendChild(tourStep);
			
			// –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–∫–ª–∞–¥–∫—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
			if (step.target && step.target.startsWith('#')) {
				const tabId = step.target.substring(1);
				showTab(tabId);
			}
		}

		function nextTourStep() {
			if (currentTourStep < tourSteps.length - 1) {
				currentTourStep++;
				showTourStep(currentTourStep);
			} else {
				endTour();
			}
		}

		function prevTourStep() {
			if (currentTourStep > 0) {
				currentTourStep--;
				showTourStep(currentTourStep);
			}
		}

		function endTour() {
			tourActive = false;
			const overlay = document.getElementById('tourOverlay');
			overlay.style.display = 'none';
			
			// –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
			document.querySelectorAll('.tour-highlight').forEach(el => {
				el.classList.remove('tour-highlight');
			});
			
			// –£–¥–∞–ª—è–µ–º —à–∞–≥–∏
			document.querySelectorAll('.tour-step').forEach(el => el.remove());
			
			showNotification('üéì –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞—á–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞.', 'success');
		}

		// –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
		document.addEventListener('DOMContentLoaded', function() {
			const tourCompleted = localStorage.getItem('tourCompleted');
			const firstVisit = !localStorage.getItem('firstVisitTime');
			
			if (firstVisit) {
				localStorage.setItem('firstVisitTime', new Date().toISOString());
			}
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π –∏–ª–∏ –ø—Ä–æ—à–ª–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
			if (!tourCompleted || (firstVisit && !tourCompleted)) {
				setTimeout(() => {
					if (confirm('–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π?')) {
						startTour();
					} else {
						localStorage.setItem('tourCompleted', 'true');
					}
				}, 1000);
			}
		});		
		
		// ==================== –®–ê–ë–õ–û–ù–´ –û–¢–ß–ï–¢–û–í ====================

		const reportTemplates = {
			default: {
				name: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç—á–µ—Ç",
				sections: ['header', 'grades_distribution', 'task_analysis', 'student_performance', 'recommendations'],
				includeCharts: true,
				pageSize: 'A4',
				fontSize: '12pt',
				colorScheme: 'default'
			},
			minimal: {
				name: "–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π",
				sections: ['header', 'grades_distribution', 'recommendations'],
				includeCharts: false,
				pageSize: 'A4',
				fontSize: '11pt',
				colorScheme: 'grayscale'
			},
			detailed: {
				name: "–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
				sections: ['header', 'grades_distribution', 'task_analysis', 'student_performance', 
						  'error_analysis', 'taxonomy_analysis', 'recommendations', 'appendix'],
				includeCharts: true,
				pageSize: 'A4',
				fontSize: '10pt',
				colorScheme: 'color'
			},
			for_parents: {
				name: "–î–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π",
				sections: ['header', 'student_performance', 'personal_recommendations'],
				includeCharts: true,
				pageSize: 'A4',
				fontSize: '13pt',
				colorScheme: 'soft'
			},
			for_administration: {
				name: "–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏",
				sections: ['header', 'grades_distribution', 'class_comparison', 'kpi', 'summary'],
				includeCharts: true,
				pageSize: 'A4',
				fontSize: '11pt',
				colorScheme: 'professional'
			}
		};

		let currentReportTemplate = { ...reportTemplates.default };
		let customTemplates = JSON.parse(localStorage.getItem('reportTemplates') || '[]');

		function showReportTemplateManager() {
			const html = `
				<div style="max-width: 800px;">
					<h3>üé® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ –æ—Ç—á–µ—Ç–æ–≤</h3>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
						<!-- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã -->
						<div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
							<h4>üìã –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã</h4>
							<div style="max-height: 300px; overflow-y: auto;">
								${Object.entries(reportTemplates).map(([key, template]) => `
									<div class="template-item" onclick="loadReportTemplate('${key}')" 
										 style="padding: 10px; margin: 5px 0; background: white; border-radius: 5px; cursor: pointer; border: 2px solid ${currentReportTemplate.name === template.name ? '#3498db' : '#ddd'}">
										<strong>${template.name}</strong><br>
										<small style="color: #666;">
											${template.sections.length} —Å–µ–∫—Ü–∏–π ‚Ä¢ ${template.includeCharts ? '–° –≥—Ä–∞—Ñ–∏–∫–∞–º–∏' : '–ë–µ–∑ –≥—Ä–∞—Ñ–∏–∫–æ–≤'} ‚Ä¢ ${template.fontSize}
										</small>
									</div>
								`).join('')}
							</div>
						</div>
						
						<!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã -->
						<div style="background: #f0f8ff; padding: 20px; border-radius: 10px;">
							<h4>‚≠ê –ú–æ–∏ —à–∞–±–ª–æ–Ω—ã</h4>
							${customTemplates.length > 0 ? `
								<div style="max-height: 300px; overflow-y: auto;">
									${customTemplates.map((template, index) => `
										<div class="template-item" style="padding: 10px; margin: 5px 0; background: white; border-radius: 5px; border: 1px solid #ddd;">
											<div style="display: flex; justify-content: space-between; align-items: center;">
												<div>
													<strong>${template.name}</strong><br>
													<small style="color: #666;">
														${template.sections.length} —Å–µ–∫—Ü–∏–π ‚Ä¢ ${template.includeCharts ? '–° –≥—Ä–∞—Ñ–∏–∫–∞–º–∏' : '–ë–µ–∑ –≥—Ä–∞—Ñ–∏–∫–æ–≤'}
													</small>
												</div>
												<div>
													<button class="btn btn-sm btn-outline-primary" onclick="loadCustomTemplate(${index})">
														–ó–∞–≥—Ä—É–∑–∏—Ç—å
													</button>
													<button class="btn btn-sm btn-outline-danger" onclick="deleteCustomTemplate(${index})">
														üóëÔ∏è
													</button>
												</div>
											</div>
										</div>
									`).join('')}
								</div>
							` : '<p style="text-align: center; color: #666; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤</p>'}
							
							<button class="btn btn-success" onclick="createNewTemplate()" style="margin-top: 15px; width: 100%;">
								‚ú® –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω
							</button>
						</div>
					</div>
					
					<!-- –¢–µ–∫—É—â–∏–π —à–∞–±–ª–æ–Ω -->
					<div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 20px 0;">
						<h4>üéØ –¢–µ–∫—É—â–∏–π —à–∞–±–ª–æ–Ω: ${currentReportTemplate.name}</h4>
						<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
							<div>
								<strong>–°–µ–∫—Ü–∏–∏:</strong><br>
								<small>${currentReportTemplate.sections.join(', ')}</small>
							</div>
							<div>
								<strong>–ì—Ä–∞—Ñ–∏–∫–∏:</strong><br>
								<small>${currentReportTemplate.includeCharts ? '–í–∫–ª—é—á–µ–Ω—ã' : '–í—ã–∫–ª—é—á–µ–Ω—ã'}</small>
							</div>
							<div>
								<strong>–†–∞–∑–º–µ—Ä:</strong><br>
								<small>${currentReportTemplate.pageSize}</small>
							</div>
							<div>
								<strong>–®—Ä–∏—Ñ—Ç:</strong><br>
								<small>${currentReportTemplate.fontSize}</small>
							</div>
						</div>
					</div>
					
					<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
					<div style="display: flex; gap: 10px; margin-top: 20px;">
						<button class="btn btn-primary" onclick="applyCurrentTemplate()">
							–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –æ—Ç—á–µ—Ç—É
						</button>
						<button class="btn btn-outline-primary" onclick="saveAsCustomTemplate()">
							üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω
						</button>
						<button class="btn btn-outline" onclick="editCurrentTemplate()">
							‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
						</button>
					</div>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ –æ—Ç—á–µ—Ç–æ–≤', html);
		}

		function loadReportTemplate(templateKey) {
			currentReportTemplate = { ...reportTemplates[templateKey] };
			showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω: ${currentReportTemplate.name}`, 'success');
			showReportTemplateManager();
		}

		function loadCustomTemplate(index) {
			if (customTemplates[index]) {
				currentReportTemplate = { ...customTemplates[index] };
				showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —à–∞–±–ª–æ–Ω: ${currentReportTemplate.name}`, 'success');
				showReportTemplateManager();
			}
		}

		function createNewTemplate() {
			const html = `
				<div style="max-width: 600px;">
					<h3>‚ú® –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞</h3>
					
					<div class="form-group">
						<label>–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞:</label>
						<input type="text" id="templateName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π –æ—Ç—á–µ—Ç –¥–ª—è –ø–µ–¥—Å–æ–≤–µ—Ç–∞">
					</div>
					
					<div class="form-group">
						<label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è:</label>
						<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
							${[
								{id: 'header', name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ'},
								{id: 'grades_distribution', name: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫'},
								{id: 'task_analysis', name: '–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π'},
								{id: 'student_performance', name: '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —É—á–∞—â–∏—Ö—Å—è'},
								{id: 'error_analysis', name: '–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫'},
								{id: 'taxonomy_analysis', name: '–¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑'},
								{id: 'recommendations', name: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏'},
								{id: 'personal_recommendations', name: '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏'},
								{id: 'class_comparison', name: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤'},
								{id: 'kpi', name: '–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏'},
								{id: 'summary', name: '–ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞'},
								{id: 'appendix', name: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)'}
							].map(section => `
								<label style="display: block; margin: 5px 0;">
									<input type="checkbox" class="section-checkbox" value="${section.id}" checked>
									${section.name}
								</label>
							`).join('')}
						</div>
					</div>
					
					<div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
						<div class="form-group">
							<label>–í–∫–ª—é—á–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏:</label>
							<select id="includeCharts" class="form-control">
								<option value="true">–î–∞</option>
								<option value="false">–ù–µ—Ç</option>
							</select>
						</div>
						
						<div class="form-group">
							<label>–†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã:</label>
							<select id="pageSize" class="form-control">
								<option value="A4">A4</option>
								<option value="A3">A3</option>
								<option value="Letter">Letter</option>
							</select>
						</div>
						
						<div class="form-group">
							<label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞:</label>
							<select id="fontSize" class="form-control">
								<option value="10pt">10pt (–º–µ–ª–∫–∏–π)</option>
								<option value="11pt">11pt</option>
								<option value="12pt" selected>12pt (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)</option>
								<option value="13pt">13pt</option>
								<option value="14pt">14pt (–∫—Ä—É–ø–Ω—ã–π)</option>
							</select>
						</div>
						
						<div class="form-group">
							<label>–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:</label>
							<select id="colorScheme" class="form-control">
								<option value="default">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è</option>
								<option value="grayscale">–ß–µ—Ä–Ω–æ-–±–µ–ª–∞—è</option>
								<option value="soft">–ü–∞—Å—Ç–µ–ª—å–Ω–∞—è</option>
								<option value="professional">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è</option>
								<option value="color">–Ø—Ä–∫–∞—è</option>
							</select>
						</div>
					</div>
					
					<div style="margin-top: 20px;">
						<button class="btn btn-success" onclick="saveNewTemplate()">
							üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω
						</button>
						<button class="btn btn-outline" onclick="hideModal()">
							–û—Ç–º–µ–Ω–∞
						</button>
					</div>
				</div>
			`;
			
			showModal('–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞', html);
		}

		function saveNewTemplate() {
			const name = document.getElementById('templateName').value.trim();
			if (!name) {
				showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞', 'error');
				return;
			}
			
			const sections = Array.from(document.querySelectorAll('.section-checkbox:checked'))
				.map(cb => cb.value);
			
			if (sections.length === 0) {
				showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å–µ–∫—Ü–∏—é', 'error');
				return;
			}
			
			const newTemplate = {
				name: name,
				sections: sections,
				includeCharts: document.getElementById('includeCharts').value === 'true',
				pageSize: document.getElementById('pageSize').value,
				fontSize: document.getElementById('fontSize').value,
				colorScheme: document.getElementById('colorScheme').value,
				created: new Date().toISOString()
			};
			
			customTemplates.push(newTemplate);
			localStorage.setItem('reportTemplates', JSON.stringify(customTemplates));
			
			currentReportTemplate = { ...newTemplate };
			
			hideModal();
			showNotification(`–®–∞–±–ª–æ–Ω "${name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`, 'success');
			showReportTemplateManager();
		}

		function saveAsCustomTemplate() {
			const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞:', `–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ${currentReportTemplate.name}`);
			if (name) {
				const newTemplate = {
					...currentReportTemplate,
					name: name,
					created: new Date().toISOString()
				};
				
				customTemplates.push(newTemplate);
				localStorage.setItem('reportTemplates', JSON.stringify(customTemplates));
				
				showNotification(`–®–∞–±–ª–æ–Ω "${name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`, 'success');
				showReportTemplateManager();
			}
		}

		function deleteCustomTemplate(index) {
			if (confirm(`–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω "${customTemplates[index].name}"?`)) {
				customTemplates.splice(index, 1);
				localStorage.setItem('reportTemplates', JSON.stringify(customTemplates));
				showReportTemplateManager();
				showNotification('–®–∞–±–ª–æ–Ω —É–¥–∞–ª–µ–Ω', 'success');
			}
		}

		function applyCurrentTemplate() {
			// –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —à–∞–±–ª–æ–Ω–∞ –∫ —Ç–µ–∫—É—â–µ–º—É –æ—Ç—á–µ—Ç—É
			applyTemplateToReport(currentReportTemplate);
			hideModal();
			showNotification(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —à–∞–±–ª–æ–Ω–∞ "${currentReportTemplate.name}" –ø—Ä–∏–º–µ–Ω–µ–Ω—ã`, 'success');
		}

		function applyTemplateToReport(template) {
			// –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —à–∞–±–ª–æ–Ω–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
			console.log('–ü—Ä–∏–º–µ–Ω—è–µ–º —à–∞–±–ª–æ–Ω:', template);
			
			// –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥—É—Ç –º–µ–Ω—è—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—á–∞—Ç–∏/—ç–∫—Å–ø–æ—Ä—Ç–∞
			// –ù–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ–∫—Ü–∏–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª–µ–π –∏ —Ç.–¥.
		}

		// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —ç–∫—Å–ø–æ—Ä—Ç–∞
		function enhanceExportSection() {
			const exportSection = document.getElementById('export');
			if (!exportSection) return;
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏
			const templateButton = document.createElement('button');
			templateButton.className = 'btn btn-outline-info';
			templateButton.innerHTML = 'üé® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏';
			templateButton.onclick = showReportTemplateManager;
			templateButton.style.margin = '0 10px 10px 0';
			
			const exportButtons = exportSection.querySelector('.export-buttons');
			if (exportButtons) {
				exportButtons.insertBefore(templateButton, exportButtons.firstChild);
			}
		}		
		
		// ==================== –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò (–•–û–¢–ö–ï–ò) ====================

		const hotkeys = {
			'ctrl+s': function() { safeFunctions.saveData(); },
			'ctrl+shift+s': function() { safeFunctions.saveData(); },
			'ctrl+p': function() { 
				if (typeof printFullReport === 'function') {
					try { printFullReport(); } catch(e) { console.error(e); }
				}
			},
			'ctrl+e': function() { 
				if (typeof exportToExcel === 'function') {
					try { exportToExcel(); } catch(e) { console.error(e); }
				}
			},
			'ctrl+d': function() { 
				if (typeof exportToPDF === 'function') {
					try { exportToPDF(); } catch(e) { console.error(e); }
				}
			},
			'ctrl+o': function() { 
				if (typeof restoreBackupDialog === 'function') {
					try { restoreBackupDialog(); } catch(e) { console.error(e); }
				}
			},
			'ctrl+i': function() { 
				if (typeof showTemplateSelection === 'function') {
					try { showTemplateSelection(); } catch(e) { console.error(e); }
				}
			},
			'ctrl+n': function() { 
				if (typeof resetAllData === 'function') {
					if (confirm('–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–∞–±–æ—Ç—É? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.')) {
						try { resetAllData(); } catch(e) { console.error(e); }
					}
				}
			},
			'ctrl+1': function() { showTab('setup'); },
			'ctrl+2': function() { showTab('tasks'); },
			'ctrl+3': function() { showTab('students'); },
			'ctrl+4': function() { showTab('results'); },
			'ctrl+5': function() { showTab('analytics'); },
			'ctrl+6': function() { showTab('visualization'); },
			'ctrl+7': function() { showTab('recommendations'); },
			'ctrl+8': function() { showTab('export'); },
			'f1': function() { 
				if (typeof showHotkeyHelp === 'function') {
					try { showHotkeyHelp(); } catch(e) { console.error(e); }
				}
			},
			'esc': function() { 
				if (typeof hideModal === 'function') {
					try { hideModal(); } catch(e) { console.error(e); }
				}
			},
			'ctrl+?': function() { 
				if (typeof showHotkeyHelp === 'function') {
					try { showHotkeyHelp(); } catch(e) { console.error(e); }
				}
			},
			// –î–µ–±–∞–≥ –º–æ–¥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
			'ctrl+shift+d': function() {
				if (typeof toggleDebugMode === 'function') {
					try { toggleDebugMode(); } catch(e) { console.error(e); }
				} else {
					console.log('–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
				}
			}
		};

		let pressedKeys = new Set();

		function setupHotkeys() {
			document.addEventListener('keydown', (e) => {
				pressedKeys.add(e.key.toLowerCase());
				
				// –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
				let combo = [];
				if (e.ctrlKey || e.metaKey) combo.push('ctrl');
				if (e.shiftKey) combo.push('shift');
				if (e.altKey) combo.push('alt');
				combo.push(e.key.toLowerCase());
				
				const comboString = combo.join('+');
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
				if (hotkeys[comboString]) {
					e.preventDefault();
					hotkeys[comboString]();
					
					// –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
					showHotkeyFeedback(comboString);
				}
				
				// –î–µ–±–∞–≥ –º–æ–¥
				if (comboString === 'ctrl+shift+d') {
					toggleDebugMode();
				}
			});
			
			document.addEventListener('keyup', (e) => {
				pressedKeys.delete(e.key.toLowerCase());
			});
			
			// –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
			addHotkeyIndicator();
		}

		function showHotkeyFeedback(combo) {
			const feedback = document.createElement('div');
			feedback.className = 'hotkey-feedback';
			feedback.textContent = `‚úì ${combo}`;
			feedback.style.cssText = `
				position: fixed;
				bottom: 20px;
				left: 50%;
				transform: translateX(-50%);
				background: rgba(52, 152, 219, 0.9);
				color: white;
				padding: 10px 20px;
				border-radius: 20px;
				z-index: 10000;
				animation: fadeInOut 1.5s ease;
				font-weight: bold;
				box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			`;
			
			document.body.appendChild(feedback);
			
			setTimeout(() => {
				feedback.remove();
			}, 1500);
		}

		function showHotkeyHelp() {
			const html = `
				<div style="max-width: 700px;">
					<h3>üéÆ –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h3>
					<p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã:</p>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
						<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
							<h4>üìä –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
							<table style="width: 100%; font-size: 0.9em;">
								<tr><td><kbd>Ctrl</kbd> + <kbd>S</kbd></td><td>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>S</kbd></td><td>–ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>P</kbd></td><td>–ü–µ—á–∞—Ç—å –æ—Ç—á–µ—Ç–∞</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>E</kbd></td><td>–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>D</kbd></td><td>–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>O</kbd></td><td>–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>I</kbd></td><td>–ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>N</kbd></td><td>–ù–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞</td></tr>
								<tr><td><kbd>Esc</kbd></td><td>–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ</td></tr>
							</table>
						</div>
						
						<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
							<h4>üìë –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫</h4>
							<table style="width: 100%; font-size: 0.9em;">
								<tr><td><kbd>Ctrl</kbd> + <kbd>1</kbd></td><td>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>2</kbd></td><td>–ó–∞–¥–∞–Ω–∏—è</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>3</kbd></td><td>–£—á–∞—â–∏–µ—Å—è</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>4</kbd></td><td>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>5</kbd></td><td>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>6</kbd></td><td>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>7</kbd></td><td>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</td></tr>
								<tr><td><kbd>Ctrl</kbd> + <kbd>8</kbd></td><td>–≠–∫—Å–ø–æ—Ä—Ç</td></tr>
							</table>
						</div>
					</div>
					
					<div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üîß –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ</h4>
						<table style="width: 100%; font-size: 0.9em;">
							<tr><td><kbd>F1</kbd> –∏–ª–∏ <kbd>Ctrl</kbd> + <kbd>?</kbd></td><td>–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É</td></tr>
							<tr><td><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>D</kbd></td><td>–í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏</td></tr>
							<tr><td><kbd>Ctrl</kbd> + <kbd>R</kbd></td><td>–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</td></tr>
						</table>
					</div>
					
					<div style="margin-top: 20px; text-align: center;">
						<button class="btn btn-primary" onclick="printHotkeyCheatsheet()">
							üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å —à–ø–∞—Ä–≥–∞–ª–∫—É
						</button>
					</div>
				</div>
			`;
			
			showModal('–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏', html);
		}

		function addHotkeyIndicator() {
			const indicator = document.createElement('div');
			indicator.id = 'hotkeyIndicator';
			indicator.style.cssText = `
				position: fixed;
				bottom: 10px;
				right: 10px;
				background: rgba(52, 152, 219, 0.1);
				color: #3498db;
				padding: 5px 10px;
				border-radius: 5px;
				font-size: 11px;
				cursor: help;
				z-index: 9998;
				border: 1px dashed #3498db;
				transition: all 0.3s;
			`;
			indicator.innerHTML = 'üéÆ <kbd>F1</kbd> - –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏';
			indicator.title = '–ù–∞–∂–º–∏—Ç–µ F1 –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à';
			indicator.onclick = showHotkeyHelp;
			
			document.body.appendChild(indicator);
		}

		function printHotkeyCheatsheet() {
			const html = `
				<div style="padding: 20px; font-family: Arial, sans-serif;">
					<h2 style="text-align: center;">üéÆ –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –≥–æ—Ä—è—á–∏–º –∫–ª–∞–≤–∏—à–∞–º</h2>
					<h3>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
					<p style="color: #666; text-align: center;">–î–∞—Ç–∞: ${new Date().toLocaleDateString()}</p>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
						${Object.entries(hotkeys).map(([combo, func]) => `
							<div style="border-bottom: 1px solid #eee; padding: 10px 0;">
								<kbd style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; font-family: monospace;">${combo}</kbd>
								<span style="margin-left: 10px;">${getHotkeyDescription(func)}</span>
							</div>
						`).join('')}
					</div>
					
					<div style="margin-top: 40px; text-align: center; color: #999; font-size: 12px;">
						<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —à–ø–∞—Ä–≥–∞–ª–∫—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π</p>
					</div>
				</div>
			`;
			
			const printWindow = window.open('', '_blank');
			printWindow.document.write(`
				<html>
					<head>
						<title>–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –≥–æ—Ä—è—á–∏–º –∫–ª–∞–≤–∏—à–∞–º</title>
						<style>
							body { font-family: Arial, sans-serif; margin: 20px; }
							kbd { background: #f8f9fa; padding: 3px 8px; border-radius: 4px; font-family: monospace; }
							@media print { @page { size: A4; margin: 15mm; } }
						</style>
					</head>
					<body>${html}</body>
				</html>
			`);
			printWindow.document.close();
			printWindow.print();
		}

		function getHotkeyDescription(func) {
			const descriptions = {
				[saveAllData]: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ',
				[saveData]: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è',
				[printFullReport]: '–ü–µ—á–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞',
				[exportToExcel]: '–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel',
				[exportToPDF]: '–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF',
				[restoreBackupDialog]: '–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é',
				[showTemplateSelection]: '–ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞',
				[resetAllData]: '–ù–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞',
				[showHotkeyHelp]: '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É',
				[hideModal]: '–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ'
			};
			
			return descriptions[func] || '–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏';
		}		
		// ==================== –ü–†–û–ì–†–ï–°–°–ò–í–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï ====================

		let autoSaveEnabled = true;
		let lastSaveTime = null;
		let saveDebounceTimer = null;

		function setupProgressiveSaving() {
			// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞
			window.addEventListener('blur', () => {
				if (autoSaveEnabled && hasUnsavedChanges()) {
					saveData();
					showNotification('üìù –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞', 'info');
				}
			});
			
			// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –≤–∫–ª–∞–¥–∫–∏
			window.addEventListener('beforeunload', (e) => {
				if (hasUnsavedChanges()) {
					saveData(); // –ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
					
					// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
					e.preventDefault();
					e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –£–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?';
				}
			});
			
			// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
			setInterval(() => {
				if (autoSaveEnabled && hasUnsavedChanges()) {
					saveData();
					console.log('üìù –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º–µ—Ä—É');
				}
			}, 120000); // 2 –º–∏–Ω—É—Ç—ã
			
			// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å –¥–µ–±–∞—É–Ω—Å–æ–º
			document.addEventListener('input', debounceSave);
			document.addEventListener('change', debounceSave);
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
			addSaveStatusIndicator();
		}

		function debounceSave() {
			if (!autoSaveEnabled) return;
			
			clearTimeout(saveDebounceTimer);
			saveDebounceTimer = setTimeout(() => {
				if (hasUnsavedChanges()) {
					saveData();
					updateSaveStatus('saving');
					setTimeout(() => updateSaveStatus('saved'), 500);
				}
			}, 1000); // 1 —Å–µ–∫—É–Ω–¥–∞ –¥–µ–±–∞—É–Ω—Å–∞
		}

		function hasUnsavedChanges() {
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
			const currentState = JSON.stringify(appData);
			const lastSavedState = localStorage.getItem('lastSavedState');
			
			// –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
			if (!lastSavedState || currentState !== lastSavedState) {
				return true;
			}
			
			return false;
		}

		function saveData() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				if (!appData) {
					console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
					return false;
				}
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
				localStorage.setItem('testAnalyticsData', JSON.stringify(appData));
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
				localStorage.setItem('lastSavedState', JSON.stringify(appData));
				
				lastSaveTime = new Date();
				
				// –°—á–µ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
				window.saveCount = (window.saveCount || 0) + 1;
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
				updateSaveStatus('saved');
				
				console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', {
					–≤—Ä–µ–º—è: lastSaveTime.toLocaleTimeString(),
					—Ä–∞–∑–º–µ—Ä: JSON.stringify(appData).length,
					—É—á–∞—â–∏–µ—Å—è: appData.students?.length || 0,
					–∑–∞–¥–∞–Ω–∏—è: appData.tasks?.length || 0
				});
				
				// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç
				const lastBackup = localStorage.getItem('lastBackupTime');
				const fiveMinutesAgo = Date.now() - 5 * 60 * 1000;
				
				if (!lastBackup || parseInt(lastBackup) < fiveMinutesAgo) {
					createBackup();
					localStorage.setItem('lastBackupTime', Date.now().toString());
				}
				
				return true;
			} catch (error) {
				console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
				
				// –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º errorHandler.safeExecute
				if (window.errorHandler && typeof window.errorHandler.log === 'function') {
					window.errorHandler.log({
						type: 'SAVE_ERROR',
						message: error.message,
						data: { timestamp: new Date().toISOString() }
					});
				}
				
				updateSaveStatus('error');
				return false;
			}
		}

		function saveAllData() {
			// –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
			if (saveData()) {
				showNotification('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
				return true;
			} else {
				showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
				return false;
			}
		}

		function updateSaveStatus(status) {
			const indicator = document.getElementById('saveStatusIndicator');
			if (!indicator) return;
			
			const now = new Date();
			const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
			
			switch(status) {
				case 'saving':
					indicator.innerHTML = 'üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
					indicator.style.color = '#f39c12';
					break;
				case 'saved':
					indicator.innerHTML = `‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${timeStr}`;
					indicator.style.color = '#27ae60';
					break;
				case 'error':
					indicator.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
					indicator.style.color = '#e74c3c';
					break;
				case 'unsaved':
					indicator.innerHTML = '‚úèÔ∏è –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è';
					indicator.style.color = '#e67e22';
					break;
			}
			
			// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
			clearTimeout(indicator.hideTimer);
			if (status === 'saved') {
				indicator.hideTimer = setTimeout(() => {
					indicator.innerHTML = `üíæ ${timeStr}`;
					indicator.style.color = '#95a5a6';
				}, 3000);
			}
		}

		function addSaveStatusIndicator() {
			const indicator = document.createElement('div');
			indicator.id = 'saveStatusIndicator';
			indicator.style.cssText = `
				position: fixed;
				bottom: 10px;
				left: 10px;
				background: rgba(255, 255, 255, 0.9);
				padding: 5px 10px;
				border-radius: 5px;
				font-size: 11px;
				z-index: 9998;
				border: 1px solid #eee;
				box-shadow: 0 2px 5px rgba(0,0,0,0.1);
				cursor: help;
				transition: all 0.3s;
			`;
			indicator.title = '–°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\n–ù–∞–∂–º–∏—Ç–µ Ctrl+S –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
			indicator.onclick = () => {
				showSaveManagement();
			};
			
			document.body.appendChild(indicator);
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å
			updateSaveStatus('saved');
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
			setTimeout(() => {
				if (hasUnsavedChanges()) {
					updateSaveStatus('unsaved');
				}
			}, 1000);
		}

		function showSaveManagement() {
			const lastSave = localStorage.getItem('lastBackupTime');
			const lastSaveTime = lastSave ? new Date(parseInt(lastSave)).toLocaleString() : '–Ω–∏–∫–æ–≥–¥–∞';
			const unsavedChanges = hasUnsavedChanges();
			
			const html = `
				<div style="max-width: 500px;">
					<h3>üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìä –°—Ç–∞—Ç—É—Å</h4>
						<p><strong>–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</strong> ${autoSaveEnabled ? '‚úÖ –í–∫–ª—é—á–µ–Ω–æ' : '‚ùå –í—ã–∫–ª—é—á–µ–Ω–æ'}</p>
						<p><strong>–ù–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:</strong> ${unsavedChanges ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}</p>
						<p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</strong> ${lastSaveTime}</p>
						<p><strong>–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:</strong> ${(localStorage.getItem('testAnalyticsData')?.length || 0) / 1024} –ö–ë</p>
					</div>
					
					<div class="form-group">
						<label>
							<input type="checkbox" id="toggleAutoSave" ${autoSaveEnabled ? 'checked' : ''} onchange="toggleAutoSave()">
							–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
						</label>
						<small style="display: block; color: #666;">
							–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã –∏ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
						</small>
					</div>
					
					<div style="display: flex; gap: 10px; margin-top: 20px;">
						<button class="btn btn-success" onclick="forceSave()">
							üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–π—á–∞—Å
						</button>
						<button class="btn btn-warning" onclick="createBackup()">
							üìÇ –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
						</button>
						<button class="btn btn-outline" onclick="showBackupManager()">
							‚èÆÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ø–∏—è–º–∏
						</button>
					</div>
					
					<div style="margin-top: 20px; padding: 10px; background: #fff3cd; border-radius: 5px;">
						<small>
							üí° <strong>–°–æ–≤–µ—Ç:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <kbd>Ctrl+S</kbd> –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
						</small>
					</div>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º', html);
		}

		function toggleAutoSave() {
			autoSaveEnabled = document.getElementById('toggleAutoSave').checked;
			localStorage.setItem('autoSaveEnabled', autoSaveEnabled.toString());
			
			showNotification(
				autoSaveEnabled ? '‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ' : '‚è∏Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',
				autoSaveEnabled ? 'success' : 'warning'
			);
		}

		function forceSave() {
			if (saveAllData()) {
				updateSaveStatus('saved');
				hideModal();
			}
		}

		function showBackupManager() {
			const backups = Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.map(key => ({
					key,
					data: JSON.parse(localStorage.getItem(key)),
					date: new Date(key.replace('backup_', '').replace(/-/g, ':'))
				}))
				.sort((a, b) => b.date - a.date);
			
			let html = `
				<div style="max-width: 700px;">
					<h3>üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<p><strong>–í—Å–µ–≥–æ –∫–æ–ø–∏–π:</strong> ${backups.length}</p>
						<p><strong>–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ø–∏–π:</strong> –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</p>
						<p><strong>–•—Ä–∞–Ω–∏—Ç—Å—è –∫–æ–ø–∏–π:</strong> –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10</p>
					</div>
					
					<div style="max-height: 300px; overflow-y: auto;">
						<table style="width: 100%; font-size: 12px;">
							<thead>
								<tr>
									<th>–î–∞—Ç–∞</th>
									<th>–í–µ—Ä—Å–∏—è</th>
									<th>–ü—Ä–µ–¥–º–µ—Ç</th>
									<th>–ö–ª–∞—Å—Å</th>
									<th>–î–µ–π—Å—Ç–≤–∏—è</th>
								</tr>
							</thead>
							<tbody>
			`;
			
			backups.forEach((backup, index) => {
				const testData = backup.data?.data?.test || {};
				html += `
					<tr>
						<td>${backup.data.timestamp}</td>
						<td>${backup.data.version}</td>
						<td>${testData.subject || '‚Äî'}</td>
						<td>${testData.class || '‚Äî'}</td>
						<td>
							<button class="btn btn-sm btn-outline-primary" onclick="restoreBackup('${backup.key}')">
								–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
							</button>
							<button class="btn btn-sm btn-outline-danger" onclick="deleteBackup('${backup.key}')">
								–£–¥–∞–ª–∏—Ç—å
							</button>
						</td>
					</tr>
				`;
			});
			
			html += `
							</tbody>
						</table>
					</div>
					
					<div style="display: flex; gap: 10px; margin-top: 20px;">
						<button class="btn btn-danger" onclick="deleteAllBackups()">
							üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–ø–∏–∏
						</button>
						<button class="btn btn-outline" onclick="exportAllBackups()">
							üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∫–æ–ø–∏–π
						</button>
					</div>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏', html);
		}		
		// ==================== –¢–£–¢–û–†–ò–ê–õ ====================
		
		const tutorialSteps = [
		  {
			title: "üéØ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
			content: "–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö, –í–ü–†, –û–ì–≠, –ï–ì–≠ –∏ –¥—Ä—É–≥–∏—Ö —Ä–∞–±–æ—Ç.",
			target: ".header",
			position: "bottom"
		  },
		  {
			title: "üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–±–æ—Ç—ã",
			content: "–ù–∞—á–Ω–∏—Ç–µ —Å –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.",
			target: "[onclick=\"showTab('setup')\"]",
			position: "right"
		  },
		  {
			title: "üìù –¢–∞–∫—Å–æ–Ω–æ–º–∏—è –∑–∞–¥–∞–Ω–∏–π",
			content: "–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞–Ω–∏—è, —É–∫–∞–∂–∏—Ç–µ –∏—Ö —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è.",
			target: "[onclick=\"showTab('tasks')\"]",
			position: "right"
		  },
		  {
			title: "üë• –£—á–∞—â–∏–µ—Å—è",
			content: "–î–æ–±–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞.",
			target: "[onclick=\"showTab('students')\"]",
			position: "right"
		  },
		  {
			title: "üìà –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
			content: "–í–≤–µ–¥–∏—Ç–µ –±–∞–ª–ª—ã –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏.",
			target: "[onclick=\"showTab('results')\"]",
			position: "right"
		  },
		  {
			title: "üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è",
			content: "–°–º–æ—Ç—Ä–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫, —Ç–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É.",
			target: "[onclick=\"showTab('visualization')\"]",
			position: "right"
		  },
		  {
			title: "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏",
			content: "–ü–æ–ª—É—á–∞–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ.",
			target: "[onclick=\"showTab('recommendations')\"]",
			position: "right"
		  },
		  {
			title: "üíæ –≠–∫—Å–ø–æ—Ä—Ç",
			content: "–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –æ—Ç—á–µ—Ç—ã –≤ PDF, Excel, Word –∏–ª–∏ –ø–µ—á–∞—Ç–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º—ã.",
			target: "[onclick=\"showTab('export')\"]",
			position: "right"
		  },
		  {
			title: "‚úÖ –ì–æ—Ç–æ–≤–æ!",
			content: "–í—ã –ø—Ä–æ—à–ª–∏ –±–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É '?' –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–∞–∑–¥–µ–ª—É.",
			target: ".tutorial-helper",
			position: "left"
		  }
		];

		let currentTutorialStep = 0;
		let tutorialActive = false;

		function showTutorial() {
		  const overlay = document.getElementById('tutorial-overlay');
		  overlay.style.display = 'flex';
		  tutorialActive = true;
		  localStorage.setItem('tutorialCompleted', 'false');
		  currentTutorialStep = 0;
		  updateTutorialStep();
		}

		function hideTutorial() {
		  const overlay = document.getElementById('tutorial-overlay');
		  overlay.style.display = 'none';
		  tutorialActive = false;
		  removeHighlight();
		}

		function skipTutorial() {
		  localStorage.setItem('tutorialCompleted', 'true');
		  hideTutorial();
		  showNotification('–¢—É—Ç–æ—Ä–∏–∞–ª –ø—Ä–æ–ø—É—â–µ–Ω. –í—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "?"', 'info');
		}

		function nextTutorialStep() {
		  if (currentTutorialStep < tutorialSteps.length - 1) {
			currentTutorialStep++;
			updateTutorialStep();
		  } else {
			completeTutorial();
		  }
		}

		function prevTutorialStep() {
		  if (currentTutorialStep > 0) {
			currentTutorialStep--;
			updateTutorialStep();
		  }
		}

		function updateTutorialStep() {
		  const step = tutorialSteps[currentTutorialStep];
		  const container = document.getElementById('tutorial-container');
		  
		  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
		  document.getElementById('tutorial-step').textContent = `–®–∞–≥ ${currentTutorialStep + 1} –∏–∑ ${tutorialSteps.length}`;
		  document.getElementById('tutorial-content').innerHTML = `<h4>${step.title}</h4><p>${step.content}</p>`;
		  
		  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
		  const progressPercent = ((currentTutorialStep + 1) / tutorialSteps.length) * 100;
		  document.getElementById('tutorial-progress').style.width = `${progressPercent}%`;
		  
		  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
		  document.getElementById('prev-btn').disabled = currentTutorialStep === 0;
		  document.getElementById('next-btn').textContent = currentTutorialStep === tutorialSteps.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ ‚Üí';
		  
		  // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
		  if (step.target) {
			highlightElement(step.target, step.position);
			
			// –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É –µ—Å–ª–∏ –æ–Ω –≤–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
			const element = document.querySelector(step.target);
			if (element) {
			  element.scrollIntoView({ behavior: 'smooth', block: 'center' });
			}
		  }
		  
		  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
		  if (currentTutorialStep >= 1 && currentTutorialStep <= 7) {
			const tabNames = ['setup', 'tasks', 'students', 'results', 'analytics', 'visualization', 'recommendations', 'export'];
			const tabIndex = currentTutorialStep - 1;
			if (tabIndex >= 0 && tabIndex < tabNames.length) {
			  setTimeout(() => showTab(tabNames[tabIndex]), 300);
			}
		  }
		}

		function highlightElement(selector, position) {
		  removeHighlight();
		  
		  const element = document.querySelector(selector);
		  if (!element) return;
		  
		  const rect = element.getBoundingClientRect();
		  const highlight = document.createElement('div');
		  highlight.className = 'tutorial-highlight';
		  
		  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
		  const padding = 10;
		  highlight.style.left = `${rect.left - padding}px`;
		  highlight.style.top = `${rect.top - padding}px`;
		  highlight.style.width = `${rect.width + padding * 2}px`;
		  highlight.style.height = `${rect.height + padding * 2}px`;
		  
		  // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç—É—Ç–æ—Ä–∏–∞–ª–∞
		  const container = document.getElementById('tutorial-container');
		  container.style.position = 'absolute';
		  
		  switch(position) {
			case 'top':
			  container.style.top = `${Math.max(20, rect.top - container.offsetHeight - 20)}px`;
			  container.style.left = `${rect.left + rect.width / 2 - container.offsetWidth / 2}px`;
			  break;
			case 'bottom':
			  container.style.top = `${rect.bottom + 20}px`;
			  container.style.left = `${rect.left + rect.width / 2 - container.offsetWidth / 2}px`;
			  break;
			case 'left':
			  container.style.top = `${rect.top + rect.height / 2 - container.offsetHeight / 2}px`;
			  container.style.left = `${Math.max(20, rect.left - container.offsetWidth - 20)}px`;
			  break;
			case 'right':
			  container.style.top = `${rect.top + rect.height / 2 - container.offsetHeight / 2}px`;
			  container.style.left = `${rect.right + 20}px`;
			  break;
		  }
		  
		  document.body.appendChild(highlight);
		  
		  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —á—Ç–æ–±—ã –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ —ç–∫—Ä–∞–Ω
		  const containerRect = container.getBoundingClientRect();
		  if (containerRect.left < 20) container.style.left = '20px';
		  if (containerRect.top < 20) container.style.top = '20px';
		  if (containerRect.right > window.innerWidth - 20) {
			container.style.left = `${window.innerWidth - container.offsetWidth - 20}px`;
		  }
		  if (containerRect.bottom > window.innerHeight - 20) {
			container.style.top = `${window.innerHeight - container.offsetHeight - 20}px`;
		  }
		}

		function removeHighlight() {
		  const existing = document.querySelector('.tutorial-highlight');
		  if (existing) existing.remove();
		}

		function completeTutorial() {
		  localStorage.setItem('tutorialCompleted', 'true');
		  hideTutorial();
		  showNotification('üéâ –¢—É—Ç–æ—Ä–∏–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.', 'success');
		}

		// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª
		function checkFirstVisit() {
		  const tutorialCompleted = localStorage.getItem('tutorialCompleted');
		  if (!tutorialCompleted || tutorialCompleted === 'false') {
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
			setTimeout(() => {
			  if (confirm('–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –∫—Ä–∞—Ç–∫–∏–π —Ç—É—Ä –ø–æ —Å–∏—Å—Ç–µ–º–µ? –≠—Ç–æ –∑–∞–π–º–µ—Ç 2-3 –º–∏–Ω—É—Ç—ã.')) {
				showTutorial();
			  } else {
				localStorage.setItem('tutorialCompleted', 'true');
			  }
			}, 1000);
		  }
		}

		// –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
		function showContextHelp(section) {
		  const helpTopics = {
			setup: "–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã, –ø—Ä–µ–¥–º–µ—Ç, –∫–ª–∞—Å—Å –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.",
			tasks: "–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞–Ω–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∞–∫—Å–æ–Ω–æ–º–∏—é –ë–ª—É–º–∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.",
			students: "–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—â–∏—Ö—Å—è –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ —Ñ–∞–π–ª–∞. –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é.",
			results: "–í–≤–µ–¥–∏—Ç–µ –±–∞–ª–ª—ã —É—á–∞—â–∏—Ö—Å—è. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏ –∏ –≤—ã—è–≤–∏—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏.",
			analytics: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑.",
			visualization: "–°–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫.",
			recommendations: "–ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫.",
			export: "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—á–∞—Ç–∏."
		  };
		  
		  const topic = helpTopics[section];
		  if (topic) {
			showModal(`üí° –°–ø—Ä–∞–≤–∫–∞: ${section}`, `
			  <div style="padding: 20px;">
				<h3>${section.charAt(0).toUpperCase() + section.slice(1)}</h3>
				<p>${topic}</p>
				<div style="margin-top: 20px;">
				  <button class="btn btn-primary" onclick="showTutorial()">–ü—Ä–æ–π—Ç–∏ –ø–æ–ª–Ω—ã–π —Ç—É—Ç–æ—Ä–∏–∞–ª</button>
				</div>
			  </div>
			`);
		  }
		}

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
		  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–º–æ—â–∏
		  const helperBtn = document.getElementById('tutorial-helper');
		  if (helperBtn) {
			helperBtn.addEventListener('click', function() {
			  showModal('–ü–æ–º–æ—â—å –∏ –æ–±—É—á–µ–Ω–∏–µ', `
				<div style="text-align: center; padding: 20px;">
				  <div style="font-size: 4em; margin-bottom: 20px;">üéì</div>
				  <h3>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?</h3>
				  <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É:</p>
				  
				  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0;">
					<button class="btn btn-outline" onclick="showContextHelp('setup')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
					<button class="btn btn-outline" onclick="showContextHelp('tasks')">–ó–∞–¥–∞–Ω–∏—è</button>
					<button class="btn btn-outline" onclick="showContextHelp('students')">–£—á–∞—â–∏–µ—Å—è</button>
					<button class="btn btn-outline" onclick="showContextHelp('results')">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
					<button class="btn btn-outline" onclick="showContextHelp('analytics')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
					<button class="btn btn-outline" onclick="showContextHelp('visualization')">–ì—Ä–∞—Ñ–∏–∫–∏</button>
					<button class="btn btn-outline" onclick="showContextHelp('recommendations')">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
					<button class="btn btn-outline" onclick="showContextHelp('export')">–≠–∫—Å–ø–æ—Ä—Ç</button>
				  </div>
				  
				  <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
					<button class="btn btn-primary" onclick="showTutorial()">üéì –ü—Ä–æ–π—Ç–∏ –ø–æ–ª–Ω—ã–π —Ç—É—Ç–æ—Ä–∏–∞–ª</button>
					<button class="btn" onclick="hideModal()" style="margin-left: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
				  </div>
				</div>
			  `);
			});
		  }
		  
		  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç
		  checkFirstVisit();
		});		
		
		// ============ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ì–ò–ë–†–ò–î–ù–û–ì–û –°–ö–ê–ù–ï–†–ê ============

		// 1. –ö–ª–∞—Å—Å TemplateStorage (–¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–º –±–ª–æ–∫–æ–º)
		class TemplateStorage {
			constructor() {
				this.dbName = 'TestMakerTemplatesDB';
				this.storeName = 'templates';
				this.version = 1;
				this.db = null;
			}

			async init() {
				return new Promise((resolve, reject) => {
					const request = indexedDB.open(this.dbName, this.version);
					
					request.onupgradeneeded = (e) => {
						const db = e.target.result;
						if (!db.objectStoreNames.contains(this.storeName)) {
							const store = db.createObjectStore(this.storeName, { keyPath: 'fullPath' });
							store.createIndex('subject', 'subject', { unique: false });
							store.createIndex('workType', 'workType', { unique: false });
							store.createIndex('class', 'class', { unique: false });
						}
					};
					
					request.onsuccess = (e) => {
						this.db = e.target.result;
						console.log('‚úÖ TemplateStorage –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
						resolve();
					};
					
					request.onerror = (e) => reject(e.target.error);
				});
			}

			async saveTemplate(templateData) {
				return new Promise((resolve, reject) => {
					if (!this.db) {
						reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
						return;
					}
					
					const transaction = this.db.transaction([this.storeName], 'readwrite');
					const store = transaction.objectStore(this.storeName);
					
					const template = {
						fullPath: templateData.fullPath,
						name: templateData.name,
						subject: templateData.subject,
						class: templateData.class,
						workType: templateData.workType,
						theme: templateData.theme,
						data: templateData.data,
						lastModified: templateData.lastModified || Date.now(),
						taskCount: templateData.taskCount,
						addedDate: Date.now()
					};
					
					const request = store.put(template);
					request.onsuccess = () => resolve();
					request.onerror = (e) => reject(e.target.error);
				});
			}

			async getAllTemplates() {
				return new Promise((resolve, reject) => {
					if (!this.db) {
						reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
						return;
					}
					
					const transaction = this.db.transaction([this.storeName], 'readonly');
					const store = transaction.objectStore(this.storeName);
					const request = store.getAll();
					
					request.onsuccess = (e) => resolve(e.target.result || []);
					request.onerror = (e) => reject(e.target.error);
				});
			}

			async deleteTemplate(fullPath) {
				return new Promise((resolve, reject) => {
					if (!this.db) {
						reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
						return;
					}
					
					const transaction = this.db.transaction([this.storeName], 'readwrite');
					const store = transaction.objectStore(this.storeName);
					const request = store.delete(fullPath);
					
					request.onsuccess = () => resolve();
					request.onerror = (e) => reject(e.target.error);
				});
			}

			async clearAll() {
				return new Promise((resolve, reject) => {
					if (!this.db) {
						reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
						return;
					}
					
					const transaction = this.db.transaction([this.storeName], 'readwrite');
					const store = transaction.objectStore(this.storeName);
					const request = store.clear();
					
					request.onsuccess = () => resolve();
					request.onerror = (e) => reject(e.target.error);
				});
			}
		}

		// 2. –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π BackgroundTemplateScanner (–±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ UI)
		class BackgroundTemplateScanner {
			constructor() {
				this.storage = new TemplateStorage();
				this.directoryHandle = null;
				this.isWatching = false;
				this.watchInterval = 30000; // 30 —Å–µ–∫—É–Ω–¥
				this.watchTimer = null;
				this.cachedTemplates = new Map();
				
				this.config = {
					autoScan: true,
					notifyOnChanges: true,
					deepScan: true
				};
				
				this.state = {
					lastScanTime: null,
					scanning: false
				};
			}

			async initialize() {
				try {
					await this.storage.init();
					await this.loadCachedTemplates();
					this.loadConfig();
					console.log('‚úÖ –°–∫–∞–Ω–µ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
					return true;
				} catch (error) {
					console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∫–∞–Ω–µ—Ä–∞:', error);
					return false;
				}
			}

			async selectFolder() {
				try {
					if ('showDirectoryPicker' in window) {
						this.directoryHandle = await window.showDirectoryPicker({
							id: 'templateFolder',
							mode: 'read'
						});
						
						localStorage.setItem('templateFolderName', this.directoryHandle.name);
						localStorage.setItem('hasTemplateFolderAccess', 'true');
						
						await this.scanNow();
						
						if (this.config.autoScan) {
							this.startWatching();
						}
						
						showNotification('‚úÖ –ü–∞–ø–∫–∞ –≤—ã–±—Ä–∞–Ω–∞ –∏ –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞', 'success');
						return true;
					} else {
						// Fallback
						showNotification('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', 'warning');
						return false;
					}
				} catch (error) {
					if (error.name !== 'AbortError') {
						showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
					}
					return false;
				}
			}

			async scanNow() {
				if (this.state.scanning || !this.directoryHandle) return;
				
				this.state.scanning = true;
				
				try {
					const changes = await this.performScan();
					this.state.lastScanTime = Date.now();
					
					if (changes.added.length > 0 || changes.updated.length > 0 || changes.removed.length > 0) {
						let message = '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è: ';
						const parts = [];
						if (changes.added.length) parts.push(`+${changes.added.length}`);
						if (changes.updated.length) parts.push(`‚Üª${changes.updated.length}`);
						if (changes.removed.length) parts.push(`-${changes.removed.length}`);
						
						if (this.config.notifyOnChanges) {
							showNotification(message + parts.join(', '), 'info');
						}
					}
					
					return changes;
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
					showNotification(`–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
				} finally {
					this.state.scanning = false;
				}
			}

			async performScan() {
				const changes = { added: [], updated: [], removed: [], errors: [] };
				const currentFiles = new Map();
				
				const scanDir = async (dirHandle, path = '') => {
					for await (const [name, handle] of dirHandle.entries()) {
						const fullPath = path ? `${path}/${name}` : name;
						
						if (handle.kind === 'file' && name.endsWith('.json')) {
							try {
								const file = await handle.getFile();
								const content = await this.readAndParseTemplate(file, fullPath);
								if (content) {
									currentFiles.set(fullPath, {
										handle, file, content,
										lastModified: file.lastModified
									});
								}
							} catch (error) {
								changes.errors.push({ path: fullPath, error: error.message });
							}
						} else if (handle.kind === 'directory' && this.config.deepScan) {
							await scanDir(handle, fullPath);
						}
					}
				};
				
				await scanDir(this.directoryHandle);
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
				for (const [fullPath, fileData] of currentFiles.entries()) {
					const cached = this.cachedTemplates.get(fullPath);
					
					if (!cached) {
						await this.saveTemplateToCache(fullPath, fileData);
						changes.added.push(fileData.content.metadata);
					} else if (fileData.lastModified > cached.lastModified) {
						await this.saveTemplateToCache(fullPath, fileData);
						changes.updated.push(fileData.content.metadata);
					}
				}
				
				// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ
				for (const [fullPath, cached] of this.cachedTemplates.entries()) {
					if (!currentFiles.has(fullPath)) {
						await this.storage.deleteTemplate(fullPath);
						this.cachedTemplates.delete(fullPath);
						changes.removed.push(cached);
					}
				}
				
				return changes;
			}

			async readAndParseTemplate(file, fullPath) {
				try {
					const text = await file.text();
					const cleaned = cleanJSON(text);
					const data = JSON.parse(cleaned);
					
					if (!data.test || !data.tasks) {
						throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —à–∞–±–ª–æ–Ω–∞');
					}
					
					return {
						metadata: {
							name: file.name,
							fullPath: fullPath,
							subject: data.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω',
							class: data.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω',
							workType: data.test.workType || 'current',
							theme: data.test.theme || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
							taskCount: data.tasks.length,
							lastModified: file.lastModified
						},
						data: data
					};
				} catch (error) {
					console.error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ${file.name}:`, error);
					return null;
				}
			}

			async saveTemplateToCache(fullPath, fileData) {
				const template = {
					fullPath: fullPath,
					name: fileData.file.name,
					subject: fileData.content.metadata.subject,
					class: fileData.content.metadata.class,
					workType: fileData.content.metadata.workType,
					theme: fileData.content.metadata.theme,
					data: fileData.content.data,
					lastModified: fileData.lastModified,
					taskCount: fileData.content.metadata.taskCount,
					addedDate: Date.now()
				};
				
				await this.storage.saveTemplate(template);
				this.cachedTemplates.set(fullPath, template);
			}

			async loadCachedTemplates() {
				try {
					const templates = await this.storage.getAllTemplates();
					this.cachedTemplates.clear();
					templates.forEach(t => this.cachedTemplates.set(t.fullPath, t));
					
					// –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
					window.templateFilesData = templates.map(t => ({
						file: { name: t.name },
						data: t.data,
						workType: t.workType,
						subject: t.subject,
						class: t.class,
						taskCount: t.taskCount,
						date: t.data.test?.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
					}));
					
					return templates.length;
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—ç—à–∞:', error);
					return 0;
				}
			}

			loadConfig() {
				const saved = localStorage.getItem('templateScannerConfig');
				if (saved) {
					this.config = { ...this.config, ...JSON.parse(saved) };
				}
			}

			saveConfig() {
				localStorage.setItem('templateScannerConfig', JSON.stringify(this.config));
			}

			startWatching() {
				if (this.isWatching) return;
				
				this.isWatching = true;
				this.watchTimer = setInterval(() => {
					if (!this.state.scanning) {
						this.scanNow();
					}
				}, this.watchInterval);
				
				document.addEventListener('visibilitychange', () => {
					if (!document.hidden && !this.state.scanning) {
						setTimeout(() => this.scanNow(), 1000);
					}
				});
			}

			stopWatching() {
				if (!this.isWatching) return;
				
				this.isWatching = false;
				if (this.watchTimer) {
					clearInterval(this.watchTimer);
					this.watchTimer = null;
				}
				
				document.removeEventListener('visibilitychange', this.handleVisibilityChange);
			}

			toggleWatching() {
				if (this.isWatching) {
					this.stopWatching();
					showNotification('‚è∏Ô∏è –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'info');
				} else {
					this.startWatching();
					showNotification('üëÅÔ∏è –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ', 'success');
				}
			}

			getCachedTemplatesArray() {
				return Array.from(this.cachedTemplates.values()).map(t => ({
					file: { name: t.name },
					data: t.data,
					workType: t.workType,
					subject: t.subject,
					class: t.class,
					taskCount: t.taskCount,
					date: t.data.test?.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
				}));
			}

			getStats() {
				return {
					cached: this.cachedTemplates.size,
					lastScan: this.state.lastScanTime,
					isWatching: this.isWatching,
					directory: this.directoryHandle?.name || '–ù–µ –≤—ã–±—Ä–∞–Ω–∞'
				};
			}
		}

		// 3. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–∫–∞–Ω–µ—Ä–∞
		let templateScanner = null;

		// 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		function initTemplateScanner() {
			templateScanner = new BackgroundTemplateScanner();
			templateScanner.initialize().then(success => {
				if (success) {
					console.log('üéØ –°–∫–∞–Ω–µ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
					
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ —Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–∞ –ø–∞–ø–∫–∞
					const folderName = localStorage.getItem('templateFolderName');
					if (folderName) {
						console.log(`üìÅ –†–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –ø–∞–ø–∫–∞: ${folderName}`);
					}
				}
			});
		}		
		
		function scanTemplateFolder() {
			// –ï—Å–ª–∏ —Å–∫–∞–Ω–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
			if (templateScanner) {
				templateScanner.selectFolder();
			} else {
				// Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
				const input = document.createElement('input');
				input.type = 'file';
				input.webkitdirectory = true;
				input.accept = '.json';
				
				input.onchange = function(e) {
					const files = Array.from(e.target.files);
					const jsonFiles = files.filter(file => file.name.endsWith('.json'));
					
					if (jsonFiles.length === 0) {
						showNotification('–í –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ –Ω–µ—Ç JSON —Ñ–∞–π–ª–æ–≤', 'error');
						return;
					}
					
					showTemplateSelection(jsonFiles);
				};
				
				input.click();
			}
		}



		// 6. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º showTemplateSelection –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º
		function showTemplateSelection(files = null) {
			console.log('üìÑ showTemplateSelection –≤—ã–∑–≤–∞–Ω–∞ —Å files:', files);
			
			// –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –∏ –µ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
			if (!files && window.templateFilesData && window.templateFilesData.length > 0) {
				files = window.templateFilesData;
				console.log('üìÇ –ò—Å–ø–æ–ª—å–∑—É—é window.templateFilesData:', files.length, '—Ñ–∞–π–ª–æ–≤');
			}
			
			// –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥–∞–Ω—ã
			if (files && Array.isArray(files)) {
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
				window.templateFilesData = files;
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
				showTemplateSelectionModal(files);
			} else {
				// –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
				showTemplateSelectionEmpty();
			}
		}
		
		// –í—ã–Ω–æ—Å–∏–º –ª–æ–≥–∏–∫—É –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
		function showTemplateSelectionModal(files) {
			console.log('üñºÔ∏è showTemplateSelectionModal –≤—ã–∑–≤–∞–Ω–∞ —Å', files.length, '—Ñ–∞–π–ª–∞–º–∏');
			
			if (!files || !Array.isArray(files)) {
				console.error('‚ùå –û—à–∏–±–∫–∞: files –Ω–µ –º–∞—Å—Å–∏–≤ –∏–ª–∏ undefined');
				showNotification('–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
				return;
			}
			
			let html = `
				<div style="max-width: 800px;">
					<h3>üìÅ –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ —Ä–∞–±–æ—Ç—ã</h3>
					<p>–î–æ—Å—Ç—É–ø–Ω–æ —à–∞–±–ª–æ–Ω–æ–≤: <strong>${files.length}</strong></p>
					
					<div style="margin: 20px 0;">
						<label><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong></label>
						<select id="templateWorkType" class="form-control" onchange="filterTemplatesByType()">
							<option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
			`;
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ workTypes
			if (typeof workTypes !== 'undefined' && workTypes) {
				Object.keys(workTypes).forEach(type => {
					html += `<option value="${type}">${workTypes[type].name}</option>`;
				});
			} else {
				console.warn('‚ö†Ô∏è workTypes –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫');
			}
			
			html += `
						</select>
					</div>
					
					<div id="templatesContainer" style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
						<div style="text-align: center; padding: 40px; color: #666;">
							–ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤...
						</div>
					</div>
					
					<div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
						<small>
							üìç –ò—Å—Ç–æ—á–Ω–∏–∫: –°–µ—Ä–≤–µ—Ä —Å–∞–π—Ç–∞
							${serverTemplateScanner && serverTemplateScanner.templateFolder ? 
								`(–ø–∞–ø–∫–∞: ${serverTemplateScanner.templateFolder})` : ''}
						</small>
					</div>
				</div>
			`;
			
			showModal('–ò–º–ø–æ—Ä—Ç –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤', html);
			
			// –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
			let filesData = [];
			let filesProcessed = 0;
			
			// –ï—Å–ª–∏ —Ñ–∞–π–ª—ã —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–∫–∞–∫ –≤ —Å–ª—É—á–∞–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤)
			if (files[0] && files[0].data) {
				console.log('üìÅ –§–∞–π–ª—ã —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –ø—Ä–µ–æ–±—Ä–∞–∑—É—é —Ñ–æ—Ä–º–∞—Ç...');
				
				files.forEach(file => {
					try {
						if (file.data && file.data.test && file.data.tasks) {
							filesData.push({
								file: file.file || { name: 'unknown.json' },
								data: file.data,
								workType: file.data.test.workType || file.workType || 'current',
								subject: file.data.test.subject || file.subject || '–ù–µ —É–∫–∞–∑–∞–Ω',
								class: file.data.test.class || file.class || '–ù–µ —É–∫–∞–∑–∞–Ω',
								taskCount: file.data.tasks.length || file.taskCount || 0,
								date: file.data.test.testDate || file.date || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
							});
						}
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:', error);
					}
				});
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
				window.templateFilesData = filesData;
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã
				if (typeof renderTemplatesList === 'function') {
					renderTemplatesList(filesData);
				} else {
					console.error('‚ùå –§—É–Ω–∫—Ü–∏—è renderTemplatesList –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
					document.getElementById('templatesContainer').innerHTML = 
						'<p style="color: #dc3545; text-align: center;">–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
				}
				
				return;
			}
			
			// –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è File –æ–±—ä–µ–∫—Ç–æ–≤ (–ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã)
			files.forEach(file => {
				const reader = new FileReader();
				reader.onload = function(e) {
					try {
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é cleanJSON –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
						const cleanedContent = window.cleanJSON ? 
							window.cleanJSON(e.target.result) : e.target.result;
						const data = JSON.parse(cleanedContent);
						
						if (data.test && data.tasks) {
							filesData.push({
								file: file,
								data: data,
								workType: data.test.workType || 'current',
								subject: data.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω',
								class: data.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω',
								taskCount: data.tasks.length,
								date: data.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
							});
						}
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', file.name, error);
						
						if (files.length === 1) {
							showNotification(`–û—à–∏–±–∫–∞ –≤ —Ñ–∞–π–ª–µ ${file.name}: ${error.message}`, 'error');
						}
					}
					
					filesProcessed++;
					
					// –ö–æ–≥–¥–∞ –≤—Å–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
					if (filesProcessed === files.length) {
						if (filesData.length === 0) {
							document.getElementById('templatesContainer').innerHTML = 
								'<p style="color: #dc3545; text-align: center; padding: 20px;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤.</p>';
							return;
						}
						
						// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
						window.templateFilesData = filesData;
						
						// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã
						if (typeof renderTemplatesList === 'function') {
							renderTemplatesList(filesData);
						} else {
							document.getElementById('templatesContainer').innerHTML = 
								'<p style="color: #dc3545; text-align: center;">–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
						}
					}
				};
				
				reader.onerror = function() {
					console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', file.name);
					filesProcessed++;
				};
				
				reader.readAsText(file);
			});
		}


		// 7. –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∏–∑ –∫—ç—à–∞
		function showTemplateSelectionWithCache() {
			const templates = templateScanner.getCachedTemplatesArray();
			const stats = templateScanner.getStats();
			
			let html = `
				<div style="max-width: 800px;">
					<h3>üìÅ –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ —Ä–∞–±–æ—Ç—ã</h3>
					<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
						<div>
							<p style="margin: 0;">–î–æ—Å—Ç—É–ø–Ω–æ —à–∞–±–ª–æ–Ω–æ–≤: <strong>${templates.length}</strong></p>
							<small style="color: #666;">
								${stats.lastScan ? `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(stats.lastScan).toLocaleTimeString()}` : ''}
								${stats.directory !== '–ù–µ –≤—ã–±—Ä–∞–Ω–∞' ? ` | –ü–∞–ø–∫–∞: ${stats.directory}` : ''}
							</small>
						</div>
						<div>
							<button class="btn btn-sm btn-outline-info" onclick="templateScanner.scanNow()" style="margin-right: 5px;">
								üîÑ –û–±–Ω–æ–≤–∏—Ç—å
							</button>
							<button class="btn btn-sm ${stats.isWatching ? 'btn-warning' : 'btn-success'}" 
									onclick="templateScanner.toggleWatching()">
								${stats.isWatching ? '‚è∏Ô∏è –ü–∞—É–∑–∞' : '‚ñ∂Ô∏è –ù–∞–±–ª—é–¥–∞—Ç—å'}
							</button>
						</div>
					</div>
					
					<div style="margin: 20px 0;">
						<label><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong></label>
						<select id="templateWorkType" class="form-control" onchange="filterTemplatesByType()">
							<option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
			`;
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø—ã —Ä–∞–±–æ—Ç
			Object.keys(workTypes).forEach(type => {
				html += `<option value="${type}">${workTypes[type].name}</option>`;
			});
			
			html += `
						</select>
					</div>
					
					<div id="templatesContainer" style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
						<div style="text-align: center; padding: 20px; color: #666;">
							–ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∏–∑ –∫—ç—à–∞...
						</div>
					</div>
					
					<div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
						<small>
							üîÑ –®–∞–±–ª–æ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫—ç—à–∞. 
							<button onclick="showFolderManagement()" class="btn btn-sm btn-outline-secondary" style="margin-left: 5px;">
								–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ø–∫–æ–π
							</button>
						</small>
					</div>
				</div>
			`;
			
			showModal('–ò–º–ø–æ—Ä—Ç –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤', html);
			
			// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
			window.templateFilesData = templates;
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∞–±–ª–æ–Ω—ã —á–µ—Ä–µ–∑ 100–º—Å (—á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è)
			setTimeout(() => {
				renderTemplatesList(templates);
			}, 100);
		}

		// 8. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
		function showTemplateSelectionEmpty() {
			const html = `
				<div style="max-width: 600px; text-align: center; padding: 40px 20px;">
					<div style="font-size: 4em; margin-bottom: 20px;">üìÅ</div>
					<h3>–®–∞–±–ª–æ–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</h3>
					<p style="color: #666; margin-bottom: 30px;">
						–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤
					</p>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">
						<button class="btn btn-primary" onclick="scanLocalFolder()" 
								style="padding: 15px; font-size: 1.1em;">
							üíª –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞
						</button>
						<button class="btn btn-success" onclick="scanServerFolder()" 
								style="padding: 15px; font-size: 1.1em;">
							üåê –°–µ—Ä–≤–µ—Ä —Å–∞–π—Ç–∞
						</button>
					</div>
					
					<div style="color: #666; font-size: 0.9em;">
						<small>
							üí° –î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É "templates" 
							–≤ –∫–æ—Ä–Ω–µ —Å–∞–π—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ JSON —Ñ–∞–π–ª—ã
						</small>
					</div>
				</div>
			`;
			
			showModal('–ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤', html);
		}

		// 9. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–ø–∫–æ–π
		function showFolderManagement() {
			const stats = templateScanner.getStats();
			
			const html = `
				<div style="max-width: 500px;">
					<h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ø–∫–æ–π —à–∞–±–ª–æ–Ω–æ–≤</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
						<p><strong>–®–∞–±–ª–æ–Ω–æ–≤ –≤ –∫—ç—à–µ:</strong> ${stats.cached}</p>
						<p><strong>–ü–∞–ø–∫–∞:</strong> ${stats.directory}</p>
						<p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> ${stats.lastScan ? new Date(stats.lastScan).toLocaleString() : '–µ—â–µ –Ω–µ –±—ã–ª–æ'}</p>
						<p><strong>–ê–≤—Ç–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> ${stats.isWatching ? '‚úÖ –í–∫–ª—é—á–µ–Ω–æ' : '‚ùå –í—ã–∫–ª—é—á–µ–Ω–æ'}</p>
					</div>
					
					<div style="margin: 20px 0;">
						<h4>–î–µ–π—Å—Ç–≤–∏—è</h4>
						<div style="display: flex; flex-direction: column; gap: 10px;">
							<button class="btn btn-info" onclick="templateScanner.scanNow(); hideModal();">
								üîÑ –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–π—á–∞—Å
							</button>
							
							<button class="btn ${stats.isWatching ? 'btn-warning' : 'btn-success'}" 
									onclick="templateScanner.toggleWatching(); hideModal();">
								${stats.isWatching ? '‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ' : '‚ñ∂Ô∏è –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ'}
							</button>
							
							<button class="btn btn-primary" onclick="templateScanner.selectFolder(); hideModal();">
								üìÅ –°–º–µ–Ω–∏—Ç—å –ø–∞–ø–∫—É
							</button>
							
							${stats.cached > 0 ? `
								<button class="btn btn-outline-danger" onclick="clearTemplateCache()" style="margin-top: 10px;">
									üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —à–∞–±–ª–æ–Ω–æ–≤
								</button>
							` : ''}
						</div>
					</div>
					
					<div style="margin-top: 20px; padding: 10px; background: #fff3cd; border-radius: 5px;">
						<small>
							üí° –ê–≤—Ç–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞–ø–∫—É –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥<br>
							–∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –æ –Ω–æ–≤—ã—Ö, –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏–ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞—Ö
						</small>
					</div>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ø–∫–æ–π —à–∞–±–ª–æ–Ω–æ–≤', html);
		}

		// 10. –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
		function clearTemplateCache() {
			if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —à–∞–±–ª–æ–Ω–æ–≤?\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã, –Ω–æ –Ω–µ –∑–∞—Ç—Ä–æ–Ω–µ—Ç —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ.')) {
				if (templateScanner && templateScanner.storage) {
					templateScanner.storage.clearAll().then(() => {
						templateScanner.cachedTemplates.clear();
						showNotification('‚úÖ –ö—ç—à —à–∞–±–ª–æ–Ω–æ–≤ –æ—á–∏—â–µ–Ω', 'success');
						hideModal();
					}).catch(error => {
						showNotification(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞: ${error.message}`, 'error');
					});
				}
			}
		}
		
		let inputListenersInitialized = false;
		
		// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
		function setupInputListeners() {
			if (inputListenersInitialized) return;

			// –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ–¥–∏–Ω —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç
			// –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
			document.addEventListener('input', function(e) {
				if (e.target.matches('input, select, textarea')) {
					scheduleAutoSave();
				}
			});
			
			document.addEventListener('change', function(e) {
				if (e.target.matches('input, select, textarea')) {
					scheduleAutoSave();
				}
			});
			
			document.addEventListener('click', function(e) {
				if (e.target.matches('input[type="radio"], input[type="checkbox"]')) {
					scheduleAutoSave();
				}
			});

			inputListenersInitialized = true;
			console.log('‚úÖ –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –≤–≤–æ–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–æ–¥–∏–Ω —Ä–∞–∑)');
		}

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			setupInputListeners();
			loadAllData();
			setupTabNavigation();
			
			// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
			if (tabState.currentTab) {
				const tabButton = document.querySelector(`[data-tab="${tabState.currentTab}"]`);
				if (tabButton) {
					tabButton.click();
				}
			}
		});

		// 11. –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∑–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		// –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –±–ª–æ–∫ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
		document.addEventListener('DOMContentLoaded', function() {
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∫–∞–Ω–µ—Ä
			initTemplateScanner();
			
			// –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
			enhanceTemplateImportBlock();
		});

		// 12. –£–ª—É—á—à–∞–µ–º –±–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ —à–∞–±–ª–æ–Ω–æ–≤
		function enhanceTemplateImportBlock() {
			// –ù–∞—Ö–æ–¥–∏–º –±–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
			const importBlock = document.querySelector('div[style*="background: #d6eaf8"]');
			if (!importBlock) return;
			
			// –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
			setTimeout(() => {
				const enhancedHTML = `
					<div style="display: flex; gap: 10px; margin-top: 15px;">
						<button class="btn btn-sm btn-outline-primary" onclick="showTemplateSelection()" style="flex: 1;">
							üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —à–∞–±–ª–æ–Ω—ã
						</button>
						<button class="btn btn-sm btn-outline-info" onclick="showFolderManagement()" style="flex: 1;">
							‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
						</button>
					</div>
					<div id="templateScannerStatus" style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.7); border-radius: 5px; font-size: 0.85em;">
						<small>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</small>
					</div>
				`;
				
				importBlock.insertAdjacentHTML('beforeend', enhancedHTML);
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
				updateTemplateScannerStatus();
				setInterval(updateTemplateScannerStatus, 10000);
			}, 1000);
		}

		// 13. –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ UI
		function updateTemplateScannerStatus() {
			const statusEl = document.getElementById('templateScannerStatus');
			if (!statusEl || !templateScanner) return;
			
			const stats = templateScanner.getStats();
			const cachedCount = stats.cached;
			
			let statusHTML = '';
			
			if (stats.directory !== '–ù–µ –≤—ã–±—Ä–∞–Ω–∞') {
				statusHTML = `
					<span style="color: #27ae60;">‚úÖ –ü–∞–ø–∫–∞ –≤—ã–±—Ä–∞–Ω–∞</span> | 
					<strong>${cachedCount}</strong> —à–∞–±–ª–æ–Ω–æ–≤ |
					${stats.isWatching ? 'üëÅÔ∏è –ê–≤—Ç–æ' : '‚è∏Ô∏è –†—É—á–Ω–æ–π'}
				`;
			} else if (cachedCount > 0) {
				statusHTML = `
					<span style="color: #3498db;">üìÇ –ö—ç—à: ${cachedCount} —à–∞–±–ª–æ–Ω–æ–≤</span> |
					<button onclick="templateScanner.selectFolder()" class="btn btn-xs btn-link" style="padding: 0; vertical-align: baseline;">
						–í—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É
					</button>
				`;
			} else {
				statusHTML = '<span style="color: #e74c3c;">‚ùå –ü–∞–ø–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</span>';
			}
			
			statusEl.innerHTML = `<small>${statusHTML}</small>`;
		}

		// 14. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º renderTemplatesList –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
		// –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
		function renderTemplatesList(filesData) {
			window.filteredTemplateFiles = filesData;
			const container = document.getElementById('templatesContainer');
			if (!container) {
				console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä templatesContainer –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			}
			
			if (!filesData || filesData.length === 0) {
				container.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">–®–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
				return;
			}
			
			let html = '<div class="list-group">';
			
			filesData.forEach((file, index) => {
				const workTypeName = workTypes && workTypes[file.workType] ? 
					workTypes[file.workType].name : file.workType || '–ù–µ —É–∫–∞–∑–∞–Ω';
				
				html += `
					<a href="#" class="list-group-item list-group-item-action template-item" 
					   data-index="${index}"
					   style="margin-bottom: 8px; border-radius: 5px; cursor: pointer;">
						<div style="display: flex; justify-content: space-between; align-items: center;">
							<div style="flex: 1;">
								<h6 style="margin: 0; color: #2c3e50;">
									${file.file.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}
								</h6>
								<div style="margin-top: 5px; font-size: 0.9em; color: #7f8c8d;">
									<span class="badge bg-primary">${workTypeName}</span>
									<span class="badge bg-secondary">${file.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
									<span class="badge bg-info">${file.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
									<span class="badge bg-success">${file.taskCount} –∑–∞–¥–∞–Ω–∏–π</span>
								</div>
								${file.date && file.date !== '–ù–µ —É–∫–∞–∑–∞–Ω–æ' ? 
									`<small style="display: block; margin-top: 5px; color: #95a5a6;">üìÖ ${file.date}</small>` : ''}
							</div>
							<button class="btn btn-sm btn-outline-primary select-template-btn"
									data-index="${index}"
									style="margin-left: 10px;">
								–í—ã–±—Ä–∞—Ç—å
							</button>
						</div>
					</a>
				`;
			});
			
			html += '</div>';
			container.innerHTML = html;
			
			// –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
			const templateItems = container.querySelectorAll('.template-item, .select-template-btn');
			templateItems.forEach(element => {
				element.addEventListener('click', function(e) {
					e.preventDefault();
					e.stopPropagation();
					
					// –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–µ–∫—Å –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
					const index = this.getAttribute('data-index');
					console.log('üîç –í—ã–±—Ä–∞–Ω —à–∞–±–ª–æ–Ω —Å –∏–Ω–¥–µ–∫—Å–æ–º:', index, '–∏–∑', filesData.length);
					
					if (index !== null && index !== undefined) {
						selectTemplate(parseInt(index));
					} else {
						console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–¥–µ–∫—Å —à–∞–±–ª–æ–Ω–∞');
					}
				});
			});
		}
		function selectTemplate(index) {
			console.log('üéØ selectTemplate –≤—ã–∑–≤–∞–Ω —Å –∏–Ω–¥–µ–∫—Å–æ–º:', index);
			
			// –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
			const dataSource = window.filteredTemplateFiles && window.filteredTemplateFiles.length > 0 ?
				window.filteredTemplateFiles : window.templateFilesData;
			
			if (!dataSource || !Array.isArray(dataSource)) {
				console.error('‚ùå –î–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
				showNotification('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'error');
				return;
			}
			
			if (index < 0 || index >= dataSource.length) {
				console.error('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å:', index, '–¥–ª–∏–Ω–∞ –º–∞—Å—Å–∏–≤–∞:', dataSource.length);
				showNotification('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞', 'error');
				return;
			}
			
			const selectedTemplate = dataSource[index];
			console.log('üìÑ –í—ã–±—Ä–∞–Ω —à–∞–±–ª–æ–Ω:', selectedTemplate.file.name);
			
			// –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
			if (typeof closeModal === 'function') {
				closeModal();
			}
			
			try {
				// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º—É
				console.log('üìã –î–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:', selectedTemplate.data);
				
				// 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ–æ—Ä–º—É
				if (selectedTemplate.data && selectedTemplate.data.test) {
					const testData = selectedTemplate.data.test;
					
					// –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
					const fields = {
						'subjectSelect': testData.subject,
						'classSelect': testData.class,
						'workTypeSelect': testData.workType,
						'themeInput': testData.theme,
						'testDate': testData.testDate
					};
					
					Object.entries(fields).forEach(([fieldId, value]) => {
						if (value) {
							const element = document.getElementById(fieldId);
							if (element) {
								element.value = value;
								// –¢—Ä–∏–≥–≥–µ—Ä–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
								if (element.onchange) {
									element.onchange();
								} else if (typeof $(element).trigger === 'function') {
									$(element).trigger('change');
								}
							}
						}
					});
					
					console.log('‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã');
				}
				
				// 2. –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
				const taskContainer = document.getElementById('taskContainer');
				if (taskContainer) {
					taskContainer.innerHTML = '';
					console.log('üóëÔ∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–¥–∞–Ω–∏–π –æ—á–∏—â–µ–Ω');
				}
				
				// 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
				if (selectedTemplate.data && selectedTemplate.data.tasks && Array.isArray(selectedTemplate.data.tasks)) {
					const tasks = selectedTemplate.data.tasks;
					console.log(`üìù –ó–∞–≥—Ä—É–∂–∞–µ–º ${tasks.length} –∑–∞–¥–∞–Ω–∏–π`);
					
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
					if (typeof addNewTask === 'function') {
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
						tasks.forEach((task, taskIndex) => {
							// –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
							addNewTask();
							
							// –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
							const taskElements = document.querySelectorAll('.task-item');
							const lastTask = taskElements[taskElements.length - 1];
							
							if (lastTask) {
								// –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –∑–∞–¥–∞–Ω–∏—è
								const textarea = lastTask.querySelector('textarea');
								if (textarea && task.text) {
									textarea.value = task.text;
								}
								
								// –ó–∞–ø–æ–ª–Ω—è–µ–º –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
								if (task.answer) {
									const answerInput = lastTask.querySelector('.task-answer');
									if (answerInput) answerInput.value = task.answer;
								}
								
								if (task.maxScore) {
									const scoreInput = lastTask.querySelector('.task-score');
									if (scoreInput) scoreInput.value = task.maxScore;
								}
							}
						});
					} else {
						// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: —Å–æ–∑–¥–∞–µ–º –∑–∞–¥–∞–Ω–∏—è –≤—Ä—É—á–Ω—É—é
						tasks.forEach((task, taskIndex) => {
							const taskNumber = taskIndex + 1;
							console.log(`üìù –ó–∞–¥–∞–Ω–∏–µ ${taskNumber}:`, task.text?.substring(0, 50) + '...');
							
							// –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∑–∞–¥–∞–Ω–∏—è
							const taskHtml = `
								<div class="task-item card mb-3" data-task-index="${taskNumber}">
									<div class="card-header">
										<h5 class="mb-0">–ó–∞–¥–∞–Ω–∏–µ ${taskNumber}</h5>
									</div>
									<div class="card-body">
										<div class="mb-3">
											<label class="form-label">–¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è:</label>
											<textarea class="form-control task-text" rows="3">${task.text || ''}</textarea>
										</div>
										${task.answer ? `
										<div class="mb-3">
											<label class="form-label">–û—Ç–≤–µ—Ç:</label>
											<input type="text" class="form-control task-answer" value="${task.answer}">
										</div>
										` : ''}
										${task.maxScore ? `
										<div class="mb-3">
											<label class="form-label">–ë–∞–ª–ª—ã:</label>
											<input type="number" class="form-control task-score" value="${task.maxScore}">
										</div>
										` : ''}
									</div>
								</div>
							`;
							
							if (taskContainer) {
								taskContainer.insertAdjacentHTML('beforeend', taskHtml);
							}
						});
					}
					
					console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${tasks.length} –∑–∞–¥–∞–Ω–∏–π`);
				}
				
				// 4. –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–¥–∞–Ω–∏–π –µ—Å–ª–∏ —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –µ—Å—Ç—å
				if (typeof updateTaskCounter === 'function') {
					updateTaskCounter();
				} else if (typeof updateTotalTasks === 'function') {
					updateTotalTasks();
				} else {
					// –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Ä—É—á–Ω—É—é
					const taskCount = selectedTemplate.data?.tasks?.length || 0;
					const counterElement = document.getElementById('taskCounter');
					if (counterElement) {
						counterElement.textContent = taskCount;
					}
				}
				
				// 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
				showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω: "${selectedTemplate.file.name}" (${selectedTemplate.data?.tasks?.length || 0} –∑–∞–¥–∞–Ω–∏–π)`, 'success');
				
			} catch (error) {
				console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞:', error);
				showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞: ${error.message}`, 'error');
			}
		}

		// ============ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –í–ê–®–ò–ú –ö–û–î–û–ú ============


		class ServerTemplateScanner {
			constructor(baseUrl = '') {
				this.baseUrl = baseUrl || window.location.origin;
				this.templates = new Map();
				this.isScanning = false;
				this.templateFolder = 'templates';
				this.lastScanTime = null;
			}

			async scanServerFolder() {
				this.isScanning = true;
				console.log('üîç –ù–∞—á–∏–Ω–∞—é —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ø–∞–ø–∫–∏...');
				
				try {
					// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
					let fileList = [];
					
					// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
					try {
						fileList = await this.getTemplateList();
						console.log('üìã –ü–æ–ª—É—á–µ–Ω —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤:', fileList);
					} catch (error) {
						console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã');
					}
					
					// –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π, –ø—Ä–æ–±—É–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
					if (!fileList || fileList.length === 0) {
						fileList = await this.scanViaDirectoryListing();
					}
					
					// –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –ø—É—Å—Ç–æ, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
					if (!fileList || fileList.length === 0) {
						console.log('–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø—É—Å—Ç, –ø—Ä–æ–±—É—é –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∏–º–µ–Ω–∞');
						return await this.scanKnownFiles();
					}
					
					// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã
					const templates = [];
					let loadedCount = 0;
					
					for (const fileName of fileList) {
						if (fileName.endsWith('.json')) {
							try {
								console.log(`‚¨áÔ∏è –ó–∞–≥—Ä—É–∂–∞—é —Ñ–∞–π–ª: ${fileName}`);
								const template = await this.loadTemplateFile(fileName);
								if (template) {
									templates.push(template);
									loadedCount++;
								}
							} catch (error) {
								console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${fileName}:`, error.message);
							}
						}
					}
					
					console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${loadedCount} –∏–∑ ${fileList.length} —Ñ–∞–π–ª–æ–≤`);
					
					this.templates = new Map(templates.map(t => [t.name, t]));
					this.lastScanTime = Date.now();
					return templates;
					
				} catch (error) {
					console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:', error);
					throw error;
				} finally {
					this.isScanning = false;
				}
			}

			async getTemplateList() {
				// –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞ templates.json
				try {
					const response = await fetch('/templates/templates.json');
					if (response.ok) {
						const data = await response.json();
						return data.files || [];
					}
				} catch (error) {
					console.log('–§–∞–π–ª templates.json –Ω–µ –Ω–∞–π–¥–µ–Ω');
				}
				
				// –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ index —Ñ–∞–π–ª
				try {
					const response = await fetch('/templates/index.json');
					if (response.ok) {
						const data = await response.json();
						return data.files || [];
					}
				} catch (error) {
					console.log('–§–∞–π–ª index.json –Ω–µ –Ω–∞–π–¥–µ–Ω');
				}
				
				return null;
			}

			async scanViaDirectoryListing() {
				console.log('–ü—Ä–æ–±—É—é –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é');
				
				try {
					const response = await fetch(`/${this.templateFolder}/`);
					
					if (response.ok && response.headers.get('content-type')?.includes('text/html')) {
						const html = await response.text();
						const files = this.parseDirectoryListing(html);
						console.log('–ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:', files.length);
						return files;
					}
					
				} catch (error) {
					console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:', error.message);
				}
				
				return [];
			}

			async scanKnownFiles() {
				console.log('–ü—Ä–æ–±—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã —à–∞–±–ª–æ–Ω–æ–≤');
				
				const knownFiles = [
					'oge_rus.json', 'ege.json', 'vpr.json', 'diagnostika.json',
					'math.json', 'russian.json', 'physics.json',
					'test1.json', 'test2.json', 'template.json',
					'—à–∞–±–ª–æ–Ω1.json', '—à–∞–±–ª–æ–Ω2.json','oge_inf.json', 'oge*.json'
				];
				
				const templates = [];
				
				for (const fileName of knownFiles) {
					try {
						const template = await this.loadTemplateFile(fileName);
						if (template) {
							templates.push(template);
							console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω: ${fileName}`);
						}
					} catch (error) {
						// –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
					}
				}
				
				console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤: ${templates.length}`);
				return templates;
			}

			async loadTemplateFile(fileName) {
				try {
					const response = await fetch(`/${this.templateFolder}/${fileName}`);
					
					if (!response.ok) {
						throw new Error(`–§–∞–π–ª ${fileName} –Ω–µ –Ω–∞–π–¥–µ–Ω (${response.status})`);
					}
					
					const text = await response.text();
					
					// –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à—É —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é cleanJSON
					const cleaned = window.cleanJSON ? window.cleanJSON(text) : text;
					
					let data;
					try {
						data = JSON.parse(cleaned);
					} catch (error) {
						throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${error.message}`);
					}
					
					// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
					return {
						name: fileName,
						data: data,
						subject: data.test?.subject || '–ù–µ —É–∫–∞–∑–∞–Ω',
						class: data.test?.class || '–ù–µ —É–∫–∞–∑–∞–Ω',
						workType: data.test?.workType || 'current',
						theme: data.test?.theme || fileName.replace('.json', ''),
						taskCount: data.tasks?.length || 0,
						lastModified: Date.now()
					};
				} catch (error) {
					console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${fileName}:`, error);
					throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ
				}
			}

			parseDirectoryListing(html) {
				const files = [];
				
				try {
					// –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ —Å—Å—ã–ª–æ–∫
					const linkRegex = /<a\s+(?:[^>]*?\s+)?href="([^"]*\.json)"/gi;
					let match;
					
					while ((match = linkRegex.exec(html)) !== null) {
						const fileName = match[1];
						if (!fileName.includes('?') && !fileName.includes('#')) {
							files.push(fileName);
						}
					}
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:', error);
				}
				
				return files;
			}

			getTemplates() {
				return Array.from(this.templates.values());
			}

			getStats() {
				return {
					total: this.templates.size,
					folder: this.templateFolder,
					lastScan: this.lastScanTime,
					serverUrl: this.baseUrl
				};
			}
		}

		// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–∫–∞–Ω–µ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞
		let serverTemplateScanner = null;

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞–Ω–µ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞
		function initServerTemplateScanner() {
			serverTemplateScanner = new ServerTemplateScanner();
			
			// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–∞–ø–æ–∫
			const possibleFolders = [
				'templates', 'template', 'json', 'data', 'tests',
				'—à–∞–±–ª–æ–Ω—ã', '—à–∞–±–ª–æ–Ω', 'test_templates'
			];
			
			// –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å autodiscovery –ø–∞–ø–∫–∏
			serverTemplateScanner.templateFolder = possibleFolders[0];
		}

		// –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
		function scanTemplateFolder() {
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä: –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä
			showScanSourceSelection();
		}

		// –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
		function showScanSourceSelection() {
			const html = `
				<div style="max-width: 600px;">
					<h3>üìÅ –û—Ç–∫—É–¥–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω—ã?</h3>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
						<!-- –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ -->
						<div style="text-align: center; padding: 25px; background: #e8f4fc; border-radius: 10px; cursor: pointer;"
							 onclick="scanLocalFolder()">
							<div style="font-size: 3em; margin-bottom: 15px;">üíª</div>
							<h4>–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞</h4>
							<p style="color: #666; font-size: 0.9em;">
								–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
							</p>
							<div style="margin-top: 15px;">
								<button class="btn btn-primary">–í—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É</button>
							</div>
						</div>
						
						<!-- –°–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–∞–ø–∫–∞ -->
						<div style="text-align: center; padding: 25px; background: #f0f8e8; border-radius: 10px; cursor: pointer;"
							 onclick="scanServerFolder()">
							<div style="font-size: 3em; margin-bottom: 15px;">üåê</div>
							<h4>–°–µ—Ä–≤–µ—Ä —Å–∞–π—Ç–∞</h4>
							<p style="color: #666; font-size: 0.9em;">
								–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å —Å–∞–π—Ç–∞
							</p>
							<div style="margin-top: 15px;">
								<button class="btn btn-success">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
							</div>
						</div>
					</div>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
						<h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è</h4>
						<p style="margin: 0; font-size: 0.9em;">
							<strong>–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞</strong> - –¥–ª—è –≤–∞—à–∏—Ö –ª–∏—á–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤<br>
							<strong>–°–µ—Ä–≤–µ—Ä —Å–∞–π—Ç–∞</strong> - –¥–ª—è –æ–±—â–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤ DeepSeek
						</p>
					</div>
				</div>
			`;
			
			showModal('–í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤', html);
		}

		// –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–∏ (—Å—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
		function scanLocalFolder() {
			hideModal();
			
			if (window.templateScanner && typeof window.templateScanner.selectFolder === 'function') {
				window.templateScanner.selectFolder();
			} else {
				// Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
				const input = document.createElement('input');
				input.type = 'file';
				input.webkitdirectory = true;
				input.accept = '.json';
				
				input.onchange = function(e) {
					const files = Array.from(e.target.files);
					const jsonFiles = files.filter(file => file.name.endsWith('.json'));
					
					if (jsonFiles.length === 0) {
						showNotification('–í –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ –Ω–µ—Ç JSON —Ñ–∞–π–ª–æ–≤', 'error');
						return;
					}
					
					showTemplateSelection(jsonFiles);
				};
				
				input.click();
			}
		}

		// –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ø–∞–ø–∫–∏
		async function scanServerFolder() {
			console.log('üìÇ –í—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è scanServerFolder');
			
			showNotification('‚è≥ –°–∫–∞–Ω–∏—Ä—É—é –ø–∞–ø–∫—É templates –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ...', 'info');
			
			try {
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∫–∞–Ω–µ—Ä –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				if (!serverTemplateScanner) {
					const initialized = initServerTemplateScanner();
					if (!initialized) {
						throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∞–Ω–µ—Ä');
					}
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∫–∞–Ω–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
				if (!serverTemplateScanner || typeof serverTemplateScanner.scanServerFolder !== 'function') {
					throw new Error('–°–∫–∞–Ω–µ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
				}
				
				console.log('üîç –ù–∞—á–∏–Ω–∞—é —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...');
				
				// –°–∫–∞–Ω–∏—Ä—É–µ–º
				const templates = await serverTemplateScanner.scanServerFolder();
				
				console.log(`üìä –ù–∞–π–¥–µ–Ω–æ —à–∞–±–ª–æ–Ω–æ–≤: ${templates.length}`);
				
				if (templates.length === 0) {
					showNotification('‚ùå –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã JSON —à–∞–±–ª–æ–Ω—ã', 'error');
					showServerFolderSetupGuide();
					return;
				}
				
				// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è showTemplateSelection
				const templateFiles = templates.map(t => ({
					file: { 
						name: t.name,
						// –î–æ–±–∞–≤–ª—è–µ–º –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
						lastModified: t.lastModified || Date.now(),
						size: JSON.stringify(t.data).length
					},
					data: t.data,
					workType: t.workType,
					subject: t.subject,
					class: t.class,
					taskCount: t.taskCount,
					date: '–° —Å–µ—Ä–≤–µ—Ä–∞'
				}));
				
				console.log('üìÅ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:', templateFiles);
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∞–±–ª–æ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—è —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
				showTemplateSelection(templateFiles);
				
				showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${templates.length} —à–∞–±–ª–æ–Ω–æ–≤`, 'success');
				
			} catch (error) {
				console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:', error);
				showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
				showServerFolderSetupGuide();
			}
		}


		// –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–∞–ø–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
		function showServerFolderSetupGuide() {
			const html = `
				<div style="max-width: 700px;">
					<h3>üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–ø–∫–∏ —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</h3>
					
					<div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
						<h4>üìÅ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:</h4>
						<ul>
							<li>–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É <code>templates</code> –≤ –∫–æ—Ä–Ω–µ –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞</li>
							<li>–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤ –Ω–µ–π JSON —Ñ–∞–π–ª—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏</li>
							<li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω</li>
						</ul>
					</div>
					
					<div style="background: #e8f4fc; padding: 20px; border-radius: 10px; margin: 20px 0;">
						<h4>üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:</h4>
						<pre style="background: white; padding: 15px; border-radius: 5px; overflow: auto;">
		–≤–∞—à-—Å–∞–π—Ç.—Ä—É/
		‚îú‚îÄ‚îÄ index.html
		‚îú‚îÄ‚îÄ templates/           ‚Üê –°–æ–∑–¥–∞–π—Ç–µ —ç—Ç—É –ø–∞–ø–∫—É
		‚îÇ   ‚îú‚îÄ‚îÄ og–µ.json        ‚Üê –®–∞–±–ª–æ–Ω –û–ì–≠
		‚îÇ   ‚îú‚îÄ‚îÄ –µg–µ.json        ‚Üê –®–∞–±–ª–æ–Ω –ï–ì–≠
		‚îÇ   ‚îú‚îÄ‚îÄ vpr.json        ‚Üê –®–∞–±–ª–æ–Ω –í–ü–†
		‚îÇ   ‚îî‚îÄ‚îÄ ...             ‚Üê –î—Ä—É–≥–∏–µ —à–∞–±–ª–æ–Ω—ã
		‚îî‚îÄ‚îÄ ...</pre>
					</div>
					
					<div style="background: #d4edda; padding: 20px; border-radius: 10px; margin: 20px 0;">
						<h4>‚úÖ –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞:</h4>
						<pre style="background: white; padding: 15px; border-radius: 5px; overflow: auto;">
		{
		  "test": {
			"subject": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
			"class": "9",
			"workType": "oge",
			"theme": "–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è"
		  },
		  "tasks": [
			{
			  "type": "multiple_choice",
			  "description": "–£–ø—Ä–æ—Å—Ç–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ...",
			  "level": "medium",
			  "maxScore": 2
			}
		  ]
		}</pre>
					</div>
					
					<div style="margin-top: 30px; text-align: center;">
						<button class="btn btn-primary" onclick="scanServerFolder()">
							üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
						</button>
						<button class="btn btn-secondary" onclick="hideModal()">
							–ó–∞–∫—Ä—ã—Ç—å
						</button>
					</div>
				</div>
			`;
			
			showModal('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤', html);
		}

		// ============ –ê–í–¢–û–û–ë–ù–ê–í–õ–ï–ù–ò–ï –° –°–ï–†–í–ï–†–ê ============

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
		class ServerTemplateWatcher {
			constructor() {
				this.interval = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
				this.timer = null;
				this.lastCheck = null;
				this.lastVersions = new Map();
			}
			
			startWatching() {
				if (this.timer) return;
				
				this.timer = setInterval(async () => {
					await this.checkForUpdates();
				}, this.interval);
				
				console.log('üëÅÔ∏è –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏ –∑–∞–ø—É—â–µ–Ω–æ');
			}
			
			stopWatching() {
				if (this.timer) {
					clearInterval(this.timer);
					this.timer = null;
				}
			}
			
			async checkForUpdates() {
				if (!serverTemplateScanner) return;
				
				try {
					const currentTemplates = serverTemplateScanner.getTemplates();
					const newTemplates = await serverTemplateScanner.scanServerFolder();
					
					// –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏–∏
					const changes = this.detectChanges(currentTemplates, newTemplates);
					
					if (changes.hasChanges) {
						this.notifyChanges(changes);
					}
					
					this.lastCheck = Date.now();
					
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:', error);
				}
			}
			
			detectChanges(current, fresh) {
				const changes = {
					hasChanges: false,
					added: [],
					updated: [],
					removed: []
				};
				
				const currentMap = new Map(current.map(t => [t.name, t]));
				const freshMap = new Map(fresh.map(t => [t.name, t]));
				
				// –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
				for (const [name, template] of freshMap) {
					if (!currentMap.has(name)) {
						changes.added.push(template);
					}
				}
				
				// –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
				for (const [name, template] of currentMap) {
					if (!freshMap.has(name)) {
						changes.removed.push(template);
					}
				}
				
				changes.hasChanges = changes.added.length > 0 || changes.removed.length > 0;
				
				return changes;
			}
			
			notifyChanges(changes) {
				if (!changes.hasChanges) return;
				
				let message = '–û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã: ';
				const parts = [];
				
				if (changes.added.length) parts.push(`+${changes.added.length}`);
				if (changes.removed.length) parts.push(`-${changes.removed.length}`);
				
				showNotification(message + parts.join(', '), 'info');
				
				// –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
				if (document.getElementById('templatesContainer')) {
					setTimeout(() => scanServerFolder(), 2000);
				}
			}
		}

		// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –≤–æ—Ç—á–µ—Ä
		let serverTemplateWatcher = null;

		function updateTemplateImportBlock() {
			// –ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ
			const importBlock = document.querySelector('div[style*="background: #d6eaf8"]');
			
			if (importBlock) {
				// –û–±–Ω–æ–≤–ª—è–µ–º HTML
				importBlock.innerHTML = `
					<div style="font-size: 3em; margin-bottom: 10px;">üéØ</div>
					<h4>–ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–æ–≤ DeepSeek</h4>
					<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —Ä–∞–±–æ—Ç</p>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
						<button class="btn btn-primary" onclick="scanLocalFolder()" style="padding: 12px;">
							üíª –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞
						</button>
						<button class="btn btn-success" onclick="scanServerFolder()" style="padding: 12px;">
							üåê –°–µ—Ä–≤–µ—Ä —Å–∞–π—Ç–∞
						</button>
					</div>
					
					<small style="display: block; margin-top: 10px; color: #666;">
						–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: –û–ì–≠, –ï–ì–≠, –í–ü–†, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
					</small>
					
					${hasLastTemplate ? `
					<div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">
						<small>–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–±–ª–æ–Ω: <strong>${appData.templates.lastTemplateName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong></small>
						<button class="btn btn-sm btn-outline-primary" onclick="importLastTemplate()" style="margin-left: 10px;">
							–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç
						</button>
					</div>
					` : ''}
					
					<!-- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ -->
					<div id="serverTemplateStatus" style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.8); border-radius: 6px; font-size: 0.85em;">
						<small>–°–µ—Ä–≤–µ—Ä: –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω</small>
					</div>
				`;
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
				checkServerTemplatesAvailability();
			}
		}

		// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
		async function checkServerTemplatesAvailability() {
			const statusEl = document.getElementById('serverTemplateStatus');
			if (!statusEl) return;
			
			try {
				initServerTemplateScanner();
				
				// –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
				const testFiles = ['templates/manifest.json', 'templates/test.json'];
				let available = false;
				
				for (const file of testFiles) {
					try {
						const response = await fetch(file);
						if (response.ok) {
							available = true;
							break;
						}
					} catch (e) {
						// –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
					}
				}
				
				if (available) {
					statusEl.innerHTML = `
						<small>
							<span style="color: #27ae60;">‚úÖ –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã</span><br>
							<button onclick="scanServerFolder()" class="btn btn-xs btn-link" style="padding: 0;">
								–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–π—á–∞—Å
							</button>
						</small>
					`;
				} else {
					statusEl.innerHTML = `
						<small>
							<span style="color: #e74c3c;">‚ùå –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</span><br>
							<button onclick="showServerFolderSetupGuide()" class="btn btn-xs btn-link" style="padding: 0;">
								–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
							</button>
						</small>
					`;
				}
				
			} catch (error) {
				statusEl.innerHTML = `
					<small style="color: #f39c12;">
						‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
					</small>
				`;
			}
		}

		// ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============

		document.addEventListener('DOMContentLoaded', function() {
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∫–∞–Ω–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞
			initServerTemplateScanner();
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
			updateTemplateImportBlock();
			
			// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
			setTimeout(checkServerTemplatesAvailability, 1000);
			
			// –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Ç—á–µ—Ä (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
			serverTemplateWatcher = new ServerTemplateWatcher();
			
			// –ú–æ–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
			if (confirm('–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —à–∞–±–ª–æ–Ω–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞?')) {
				serverTemplateWatcher.startWatching();
			}
		});
		// –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –≤ –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
		window.filteredTemplateFiles = [];
		function filterTemplatesByType() {
			const select = document.getElementById('templateWorkType');
			const selectedType = select.value;
			
			if (!window.templateFilesData) {
				console.error('‚ùå templateFilesData –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
				return;
			}
			
			let filteredFiles;
			
			if (selectedType === 'all') {
				filteredFiles = window.templateFilesData;
			} else {
				filteredFiles = window.templateFilesData.filter(file => 
					file.workType === selectedType
				);
			}
			
			console.log('üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –≤—ã–±—Ä–∞–Ω–æ', filteredFiles.length, '–∏–∑', window.templateFilesData.length);
			
			// –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
			window.filteredTemplateFiles = filteredFiles;
			
			// –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫
			if (typeof renderTemplatesList === 'function') {
				renderTemplatesList(filteredFiles);
			}
		}


		function loadTemplateData(templateData) {
			console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞ –≤ —Ñ–æ—Ä–º—É:', templateData);
			
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —à–∞–±–ª–æ–Ω–∞
				if (!templateData || !templateData.test || !templateData.tasks) {
					throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞');
				}
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–µ
				if (templateData.test) {
					// –ü—Ä–µ–¥–º–µ—Ç
					if (templateData.test.subject) {
						const subjectSelect = document.getElementById('subjectSelect');
						if (subjectSelect) {
							subjectSelect.value = templateData.test.subject;
							if (subjectSelect.onchange) subjectSelect.onchange();
						}
					}
					
					// –ö–ª–∞—Å—Å
					if (templateData.test.class) {
						const classSelect = document.getElementById('classSelect');
						if (classSelect) classSelect.value = templateData.test.class;
					}
					
					// –¢–∏–ø —Ä–∞–±–æ—Ç—ã
					if (templateData.test.workType) {
						const workTypeSelect = document.getElementById('workTypeSelect');
						if (workTypeSelect) workTypeSelect.value = templateData.test.workType;
					}
					
					// –¢–µ–º–∞
					if (templateData.test.theme) {
						const themeInput = document.getElementById('themeInput');
						if (themeInput) themeInput.value = templateData.test.theme;
					}
					
					// –î–∞—Ç–∞
					if (templateData.test.testDate) {
						const dateInput = document.getElementById('testDate');
						if (dateInput) dateInput.value = templateData.test.testDate;
					}
				}
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
				if (templateData.tasks && Array.isArray(templateData.tasks)) {
					// –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞–Ω–∏—è
					const taskContainer = document.getElementById('taskContainer');
					if (taskContainer) {
						taskContainer.innerHTML = '';
					}
					
					// –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ
					templateData.tasks.forEach((task, index) => {
						addTaskToForm(task);
					});
					
					console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${templateData.tasks.length} –∑–∞–¥–∞–Ω–∏–π`);
				}
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–¥–∞–Ω–∏–π
				updateTaskCounter();
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
				if (typeof showNotification === 'function') {
					showNotification(`–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω: ${templateData.tasks?.length || 0} –∑–∞–¥–∞–Ω–∏–π`, 'success');
				}
				
			} catch (error) {
				console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞:', error);
				if (typeof showNotification === 'function') {
					showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞: ${error.message}`, 'error');
				}
			}
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º—É
		function addTaskToForm(taskData) {
			// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π
			const taskContainer = document.getElementById('taskContainer');
			const currentTasks = taskContainer ? taskContainer.querySelectorAll('.task-item') : [];
			const taskNumber = currentTasks.length + 1;
			
			// –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∑–∞–¥–∞–Ω–∏—è
			const taskId = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
			
			// –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∑–∞–¥–∞–Ω–∏—è
			const taskHtml = `
				<div class="task-item card mb-3" id="${taskId}" data-task-id="${taskId}">
					<div class="card-header d-flex justify-content-between align-items-center">
						<h5 class="mb-0">–ó–∞–¥–∞–Ω–∏–µ ${taskNumber}</h5>
						<button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteTask('${taskId}')">
							<i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
						</button>
					</div>
					<div class="card-body">
						<!-- –¢–∏–ø –∑–∞–¥–∞–Ω–∏—è -->
						<div class="row mb-3">
							<div class="col-md-6">
								<label class="form-label">–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è:</label>
								<select class="form-control task-type" onchange="updateTaskType(this, '${taskId}')">
									<option value="standard" ${taskData.type === 'standard' ? 'selected' : ''}>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ</option>
									<option value="multiple" ${taskData.type === 'multiple' ? 'selected' : ''}>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä</option>
									<option value="matching" ${taskData.type === 'matching' ? 'selected' : ''}>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
									<option value="open" ${taskData.type === 'open' ? 'selected' : ''}>–û—Ç–∫—Ä—ã—Ç—ã–π –æ—Ç–≤–µ—Ç</option>
								</select>
							</div>
							<div class="col-md-3">
								<label class="form-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
								<select class="form-control task-level">
									${Object.entries(complexityLevels).map(([level, data]) => 
										`<option value="${level}" ${taskData.level == level ? 'selected' : ''}>
											${level} - ${data.name}
										</option>`
									).join('')}
								</select>
							</div>
							<div class="col-md-3">
								<label class="form-label">–ú–∞–∫—Å. –±–∞–ª–ª:</label>
								<input type="number" class="form-control task-max-score" min="1" max="10" 
									   value="${taskData.maxScore || 1}">
							</div>
						</div>
						
						<!-- –¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è -->
						<div class="mb-3">
							<label class="form-label">–¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è:</label>
							<textarea class="form-control task-text" rows="3" 
									  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è...">${taskData.text || ''}</textarea>
						</div>
						
						<!-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç -->
						<div class="mb-3">
							<label class="form-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</label>
							<input type="text" class="form-control task-answer" 
								   value="${taskData.answer || ''}" 
								   placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç...">
						</div>
						
						<!-- –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
						<div class="mb-3">
							<label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è (–¥–ª—è —É—á–∏—Ç–µ–ª—è):</label>
							<textarea class="form-control task-description" rows="2"
									  placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ—è—Å–Ω–µ–Ω–∏—è, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è...">${taskData.description || ''}</textarea>
						</div>
						
						<!-- –ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ (–¥–ª—è –í–ü–†/–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏) -->
						${appData.test.workType === 'vpr' || appData.test.workType === 'func_literacy' ? `
							<div class="mb-3">
								<label class="form-label">–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è:</label>
								<select class="form-control task-competency">
									<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—é</option>
									${Object.entries(appData.test.workType === 'vpr' ? vprCompetencies : functionalLiteracyTypes).map(([key, value]) => 
										`<option value="${key}" ${taskData.competency === key ? 'selected' : ''}>
											${typeof value === 'object' ? value.name : value}
										</option>`
									).join('')}
								</select>
							</div>
						` : ''}
					</div>
				</div>
			`;
			
			// –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
			if (taskContainer) {
				taskContainer.insertAdjacentHTML('beforeend', taskHtml);
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞–Ω–∏–µ –≤ appData.tasks
				const taskObj = {
					id: taskId,
					number: taskNumber,
					text: taskData.text || '',
					answer: taskData.answer || '',
					maxScore: parseInt(taskData.maxScore) || 1,
					level: parseInt(taskData.level) || 1,
					type: taskData.type || 'standard',
					description: taskData.description || '',
					competency: taskData.competency || '',
					errors: taskData.errors || []
				};
				
				appData.tasks.push(taskObj);
				
				// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
				robustSyncData();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
				updateTaskCounter();
				
				return taskId;
			}
			
			return null;
		}

		// –ù–∞–¥–µ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
		function robustSyncData() {
			// 1. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —É –≤—Å–µ—Ö –∑–∞–¥–∞—á –µ—Å—Ç—å ID
			appData.tasks.forEach((task, i) => {
				if (!task.id) task.id = `task_${Date.now()}_${i}`;
			});

			// 2. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —É –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å ID (–µ—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–π–¥–µ—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)
			// –ü–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ–º —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏, –ø–æ—ç—Ç–æ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø–æ –¥–ª–∏–Ω–µ

			// 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ (–µ—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ)
			if (appData.results.length > appData.students.length) {
				appData.results = appData.results.slice(0, appData.students.length);
			}

			// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
			while (appData.results.length < appData.students.length) {
				// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –Ω—É–ª–µ–π –¥–ª–∏–Ω–æ–π —Ä–∞–≤–Ω–æ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–¥–∞—á
				appData.results.push(new Array(appData.tasks.length).fill(0));
			}

			// 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ (–∑–∞–¥–∞—á) –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			appData.results = appData.results.map(studentScores => {
				// –ï—Å–ª–∏ –æ—Ü–µ–Ω–æ–∫ –º–µ–Ω—å—à–µ —á–µ–º –∑–∞–¥–∞—á -> –¥–æ–±–∞–≤–ª—è–µ–º 0
				if (studentScores.length < appData.tasks.length) {
					const diff = appData.tasks.length - studentScores.length;
					return [...studentScores, ...new Array(diff).fill(0)];
				}
				// –ï—Å–ª–∏ –æ—Ü–µ–Ω–æ–∫ –±–æ–ª—å—à–µ —á–µ–º –∑–∞–¥–∞—á -> –æ–±—Ä–µ–∑–∞–µ–º –ª–∏—à–Ω–∏–µ
				else if (studentScores.length > appData.tasks.length) {
					return studentScores.slice(0, appData.tasks.length);
				}
				return studentScores;
			});
			
			// 5. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —á–∏—Å–ª–∞–º (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö "5")
			appData.results = appData.results.map(row => 
				row.map(val => parseInt(val) || 0)
			);

			console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
		}
		

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML-—Å–∏–º–≤–æ–ª–æ–≤
		function escapeHtml(text) {
			if (!text) return '';
			
			// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
			text = String(text);
			
			return text
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;")
				.replace(/\n/g, "<br>") // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
				.replace(/\t/g, "&nbsp;&nbsp;&nbsp;&nbsp;"); // –¢–∞–±—É–ª—è—Ü–∏—è
		}
		
		function previewTemplate(index) {
			const template = window.templateFilesData[index];
			if (!template) return;
			
			// –ò–°–ü–†–ê–í–õ–Ø–ï–ú: –∏—Å–ø–æ–ª—å–∑—É–µ–º let –≤–º–µ—Å—Ç–æ const
			let html = `
				<div style="max-width: 700px; max-height: 500px; overflow-y: auto;">
					<h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: ${escapeHtml(template.data.test.theme || '–®–∞–±–ª–æ–Ω')}</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${escapeHtml(template.subject)}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${escapeHtml(template.class)}</p>
						<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${escapeHtml(workTypes[template.workType]?.name || template.workType)}</p>
						<p><strong>–¢–µ–º–∞:</strong> ${escapeHtml(template.data.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}</p>
						<p><strong>–¶–µ–ª–∏:</strong> ${escapeHtml(template.data.test.goals || '–ù–µ —É–∫–∞–∑–∞–Ω—ã')}</p>
						<p><strong>–î–∞—Ç–∞:</strong> ${escapeHtml(template.date)}</p>
					</div>
					
					<div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìù –ó–∞–¥–∞–Ω–∏—è (${template.taskCount})</h4>
						<table class="table" style="font-size: 0.9em;">
							<thead>
								<tr>
									<th>#</th>
									<th>–¢–∏–ø</th>
									<th>–£—Ä–æ–≤–µ–Ω—å</th>
									<th>–ú–∞–∫—Å. –±–∞–ª–ª</th>
									<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
								</tr>
							</thead>
							<tbody>
			`;
			
			template.data.tasks.forEach((task, i) => {
				const levelName = complexityLevels[task.level]?.name || task.level;
				const safeDescription = escapeHtml(task.description || '');
				
				html += `
					<tr>
						<td>${i + 1}</td>
						<td>${escapeHtml(task.type)}</td>
						<td><span style="padding: 2px 6px; border-radius: 4px; background: ${complexityLevels[task.level]?.color || '#ccc'}; color: white;">${escapeHtml(levelName)}</span></td>
						<td>${task.maxScore}</td>
						<td style="max-width: 300px; word-wrap: break-word;">${safeDescription}</td>
					</tr>
				`;
			});
			
			html += `
							</tbody>
						</table>
					</div>
					
					<div style="text-align: center; margin-top: 20px;">
						<button class="btn btn-success" onclick="useThisTemplate(${index}); hideModal()">
							‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω
						</button>
					</div>
				</div>
			`;
			
			showModal('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞', html);
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ JSON –æ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
		function cleanJSON(jsonString) {
			if (!jsonString) return '';
			
			// 1. –£–±–∏—Ä–∞–µ–º BOM
			if (jsonString.charCodeAt(0) === 0xFEFF) {
				jsonString = jsonString.slice(1);
			}
			
			// 2. –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ Unicode —Å–∏–º–≤–æ–ª—ã
			const replacements = {
				'\u2013': '-',  // –î–ª–∏–Ω–Ω–æ–µ —Ç–∏—Ä–µ
				'\u2014': '-',  // –¢–∏—Ä–µ
				'\u2018': "'",  // –õ–µ–≤–∞—è –∫–∞–≤—ã—á–∫–∞
				'\u2019': "'",  // –ü—Ä–∞–≤–∞—è –∫–∞–≤—ã—á–∫–∞  
				'\u201C': '"',  // –õ–µ–≤–∞—è –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞
				'\u201D': '"',  // –ü—Ä–∞–≤–∞—è –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞
				'\u00A0': ' ',  // –ù–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª
				'\u2026': '...', // –ú–Ω–æ–≥–æ—Ç–æ—á–∏–µ
				'\u00AB': '"',  // –õ–µ–≤–∞—è —É–≥–ª–æ–≤–∞—è –∫–∞–≤—ã—á–∫–∞
				'\u00BB': '"',  // –ü—Ä–∞–≤–∞—è —É–≥–ª–æ–≤–∞—è –∫–∞–≤—ã—á–∫–∞
				'\u201E': '"',  // –ù–∏–∂–Ω—è—è –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞
				'\u201A': "'",  // –ù–∏–∂–Ω—è—è –æ–¥–∏–Ω–∞—Ä–Ω–∞—è –∫–∞–≤—ã—á–∫–∞
			};
			
			Object.keys(replacements).forEach(key => {
				const regex = new RegExp(key, 'g');
				jsonString = jsonString.replace(regex, replacements[key]);
			});
			
			// 3. –£–±–∏—Ä–∞–µ–º –Ω–µ–ø–µ—á–∞—Ç–∞–µ–º—ã–µ —Å–∏–º–≤–æ–ª—ã (–∫—Ä–æ–º–µ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤)
			jsonString = jsonString.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g, '');
			
			// 4. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
			jsonString = jsonString.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
			
			// 5. –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ (–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ!)
			jsonString = jsonString.replace(/`/g, '\\`');
			
			return jsonString;
		}
		
		
		function showTemplateConfirmation(template) {
			const html = `
				<div style="max-width: 600px;">
					<h3>üì• –ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>${template.data.test.theme || '–®–∞–±–ª–æ–Ω —Ä–∞–±–æ—Ç—ã'}</h4>
						<p><strong>üìö –ü—Ä–µ–¥–º–µ—Ç:</strong> ${template.subject}</p>
						<p><strong>üè´ –ö–ª–∞—Å—Å:</strong> ${template.class}</p>
						<p><strong>üìã –¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[template.workType]?.name || template.workType}</p>
						<p><strong>üìù –ó–∞–¥–∞–Ω–∏–π:</strong> ${template.taskCount}</p>
						<p><strong>üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> ${template.date}</p>
					</div>
					
					<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
						<h4>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h4>
						<p>–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞.</p>
						<p>–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞.</p>
					</div>
					
					<div class="form-group">
						<label>
							<input type="checkbox" id="keepStudents" checked>
							–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è
						</label>
						<small style="display: block; color: #666; margin-left: 20px;">
							–ò–º–µ–Ω–∞ —É—á–∞—â–∏—Ö—Å—è –Ω–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã, —Ç–æ–ª—å–∫–æ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
						</small>
					</div>
					
					<div class="form-group">
						<label>
							<input type="checkbox" id="keepSettings" checked>
							–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞—Å—Å–∞ –∏ –¥–∞—Ç—ã
						</label>
						<small style="display: block; color: #666; margin-left: 20px;">
							–¢–µ–∫—É—â–∏–µ –∫–ª–∞—Å—Å –∏ –¥–∞—Ç–∞ —Ç–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
						</small>
					</div>
				</div>
				
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn btn-secondary" onclick="previewTemplate(${window.templateFilesData.findIndex(t => t === template)})">
						üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
					</button>
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="useTemplate('${encodeURIComponent(JSON.stringify(template.data))}', '${template.file.name}')">
						–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
					</button>
				</div>
			`;
			
			showModal('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ —à–∞–±–ª–æ–Ω–∞', html);
		}
		function addBootstrapStyles() {
			if (!document.getElementById('bootstrap-mini')) {
				const style = document.createElement('style');
				style.id = 'bootstrap-mini';
				style.textContent = `
					.btn {
						display: inline-block;
						font-weight: 400;
						text-align: center;
						white-space: nowrap;
						vertical-align: middle;
						user-select: none;
						border: 1px solid transparent;
						padding: 0.375rem 0.75rem;
						font-size: 1rem;
						line-height: 1.5;
						border-radius: 0.25rem;
						transition: all 0.15s ease-in-out;
						cursor: pointer;
					}
					.btn-success {
						color: #fff;
						background-color: #28a745;
						border-color: #28a745;
					}
					.btn-danger {
						color: #fff;
						background-color: #dc3545;
						border-color: #dc3545;
					}
					.btn-primary {
						color: #fff;
						background-color: #007bff;
						border-color: #007bff;
					}
					.btn-info {
						color: #fff;
						background-color: #17a2b8;
						border-color: #17a2b8;
					}
					.btn-secondary {
						color: #fff;
						background-color: #6c757d;
						border-color: #6c757d;
					}
					.btn-outline-success {
						color: #28a745;
						background-color: transparent;
						border-color: #28a745;
					}
					.btn-outline-danger {
						color: #dc3545;
						background-color: transparent;
						border-color: #dc3545;
					}
					.btn-outline-secondary {
						color: #6c757d;
						background-color: transparent;
						border-color: #6c757d;
					}
					.btn-outline-info {
						color: #17a2b8;
						background-color: transparent;
						border-color: #17a2b8;
					}
					.btn-outline-warning {
						color: #ffc107;
						background-color: transparent;
						border-color: #ffc107;
					}
					.btn-sm {
						padding: 0.25rem 0.5rem;
						font-size: 0.875rem;
						line-height: 1.5;
						border-radius: 0.2rem;
					}
					.btn:hover {
						opacity: 0.8;
					}
					.btn:disabled {
						opacity: 0.65;
						cursor: not-allowed;
					}
					.btn-group {
						position: relative;
						display: inline-flex;
						vertical-align: middle;
					}
					.btn-group > .btn {
						position: relative;
						flex: 1 1 auto;
					}
					.btn-group > .btn:not(:last-child) {
						border-top-right-radius: 0;
						border-bottom-right-radius: 0;
					}
					.btn-group > .btn:not(:first-child) {
						border-top-left-radius: 0;
						border-bottom-left-radius: 0;
						margin-left: -1px;
					}
					.badge {
						display: inline-block;
						padding: 0.25em 0.4em;
						font-size: 75%;
						font-weight: 700;
						line-height: 1;
						text-align: center;
						white-space: nowrap;
						vertical-align: baseline;
						border-radius: 0.25rem;
					}
					.badge-success {
						color: #fff;
						background-color: #28a745;
					}
					.badge-warning {
						color: #212529;
						background-color: #ffc107;
					}
					.badge-secondary {
						color: #fff;
						background-color: #6c757d;
					}
					.badge-light {
						color: #212529;
						background-color: #f8f9fa;
					}
					.form-control {
						display: block;
						width: 100%;
						padding: 0.375rem 0.75rem;
						font-size: 1rem;
						line-height: 1.5;
						color: #495057;
						background-color: #fff;
						background-clip: padding-box;
						border: 1px solid #ced4da;
						border-radius: 0.25rem;
						transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
					}
					.form-control-sm {
						padding: 0.25rem 0.5rem;
						font-size: 0.875rem;
						line-height: 1.5;
						border-radius: 0.2rem;
					}
					.form-control:focus {
						color: #495057;
						background-color: #fff;
						border-color: #80bdff;
						outline: 0;
						box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
					}
					.card {
						position: relative;
						display: flex;
						flex-direction: column;
						min-width: 0;
						word-wrap: break-word;
						background-color: #fff;
						background-clip: border-box;
						border: 1px solid rgba(0, 0, 0, 0.125);
						border-radius: 0.25rem;
					}
					.card-header {
						padding: 0.75rem 1.25rem;
						margin-bottom: 0;
						background-color: rgba(0, 0, 0, 0.03);
						border-bottom: 1px solid rgba(0, 0, 0, 0.125);
					}
					.card-header:first-child {
						border-radius: calc(0.25rem - 1px) calc(0.25rem - 1px) 0 0;
					}
					.card-body {
						flex: 1 1 auto;
						padding: 1.25rem;
					}
					.table {
						width: 100%;
						margin-bottom: 1rem;
						color: #212529;
						border-collapse: collapse;
					}
					.table th,
					.table td {
						padding: 0.75rem;
						vertical-align: top;
						border-top: 1px solid #dee2e6;
					}
					.table thead th {
						vertical-align: bottom;
						border-bottom: 2px solid #dee2e6;
					}
					.table-hover tbody tr:hover {
						color: #212529;
						background-color: rgba(0, 0, 0, 0.075);
					}
					.table-sm th,
					.table-sm td {
						padding: 0.3rem;
					}
					.table-responsive {
						display: block;
						width: 100%;
						overflow-x: auto;
						-webkit-overflow-scrolling: touch;
					}
					.bg-primary {
						background-color: #007bff !important;
					}
					.bg-light {
						background-color: #f8f9fa !important;
					}
					.text-white {
						color: #fff !important;
					}
					.text-muted {
						color: #6c757d !important;
					}
					.alert {
						position: relative;
						padding: 0.75rem 1.25rem;
						margin-bottom: 1rem;
						border: 1px solid transparent;
						border-radius: 0.25rem;
					}
					.alert-info {
						color: #0c5460;
						background-color: #d1ecf1;
						border-color: #bee5eb;
					}
					.progress {
						display: flex;
						height: 1rem;
						overflow: hidden;
						font-size: 0.75rem;
						background-color: #e9ecef;
						border-radius: 0.25rem;
					}
					.progress-bar {
						display: flex;
						flex-direction: column;
						justify-content: center;
						color: #fff;
						text-align: center;
						white-space: nowrap;
						background-color: #007bff;
						transition: width 0.6s ease;
					}
					.bg-success {
						background-color: #28a745 !important;
					}
					.bg-warning {
						background-color: #ffc107 !important;
					}
					.bg-secondary {
						background-color: #6c757d !important;
					}
					.mb-0 { margin-bottom: 0 !important; }
					.mb-2 { margin-bottom: 0.5rem !important; }
					.mb-3 { margin-bottom: 1rem !important; }
					.mb-4 { margin-bottom: 1.5rem !important; }
					.mt-2 { margin-top: 0.5rem !important; }
					.mr-2 { margin-right: 0.5rem !important; }
					.p-2 { padding: 0.5rem !important; }
					.d-flex { display: flex !important; }
					.justify-content-between { justify-content: space-between !important; }
					.align-items-center { align-items: center !important; }
					.align-middle { vertical-align: middle !important; }
					.small { font-size: 80%; }
				`;
				document.head.appendChild(style);
			}
		}
		function useTemplate(encodedData, fileName) {
			try {
				const templateData = JSON.parse(decodeURIComponent(encodedData));
				const keepStudents = document.getElementById('keepStudents')?.checked;
				const keepSettings = document.getElementById('keepSettings')?.checked;
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
				const currentStudents = [...appData.students];
				const currentResults = [...appData.results];
				const currentSettings = { 
					class: appData.test.class, 
					testDate: appData.test.testDate 
				};
				
				// –ó–∞–º–µ–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
				appData.test = { ...templateData.test };
				appData.tasks = [...templateData.tasks];
				
				// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				if (keepSettings) {
					appData.test.class = currentSettings.class;
					appData.test.testDate = currentSettings.testDate;
				}
				
				// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—á–∞—â–∏—Ö—Å—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				if (keepStudents && currentStudents.length > 0) {
					appData.students = currentStudents;
					appData.results = currentResults.map(studentResults => 
						new Array(appData.tasks.length).fill(0)
					);
				} else {
					appData.students = templateData.students || [];
					appData.results = templateData.results || [];
				}
				
				// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã
				robustSyncData();
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∞–±–ª–æ–Ω–µ
				appData.templates.lastTemplatePath = fileName;
				appData.templates.lastTemplateName = templateData.test.theme;
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º
				saveData();
				renderAll();
				hideModal();
				
				showNotification(`‚úÖ –®–∞–±–ª–æ–Ω "${templateData.test.theme}" —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!`, 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —à–∞–±–ª–æ–Ω–∞:', error);
				showNotification('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —à–∞–±–ª–æ–Ω–∞: ' + error.message, 'error');
			}
		}

		function useThisTemplate(index) {
			const template = window.templateFilesData[index];
			if (template) {
				useTemplate(encodeURIComponent(JSON.stringify(template.data)), template.file.name);
			}
		}		
		
		function getWorkTypeIcon(workType) {
			const icons = {
				current: 'üìù',
				milestone: 'üìä',
				final: 'üèÜ',
				oge: 'üìò',
				ege: 'üìï',
				vpr: 'üìó',
				func_literacy: 'üß†',
				diagnostic: 'üîç',
				psychology: 'üß†'
			};
			return icons[workType] || 'üìÑ';
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —à–∞–±–ª–æ–Ω–∞
		function importLastTemplate() {
			if (appData.templates.lastTemplatePath) {
				// –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –∏ –∑–∞–≥—Ä—É–∑–∫—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
				showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
			} else {
				showNotification('–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–±–ª–æ–Ω–µ', 'warning');
			}
		}		
		// ==================== –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö ====================

		// –°–æ–∑–¥–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π
		const safeFunctions = {
			saveData: function() {
				try {
					return saveData.apply(this, arguments);
				} catch (error) {
					console.error('–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π saveData:', error);
					return false;
				}
			},
			
			createBackup: function() {
				try {
					return createBackup.apply(this, arguments);
				} catch (error) {
					console.error('–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π createBackup:', error);
					return null;
				}
			},
			
			showNotification: function(message, type = 'info') {
				try {
					// –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
					if (typeof window.showNotification === 'function') {
						return window.showNotification(message, type);
					}
					
					// –§–æ–ª–ª–±—ç–∫
					console.log(`[${type.toUpperCase()}] ${message}`);
					alert(message);
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –≤ showNotification:', error);
				}
			},
			
			// –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
		};

		// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function makeSafe() {
			Object.keys(safeFunctions).forEach(funcName => {
				if (typeof window[funcName] === 'function') {
					const original = window[funcName];
					window[funcName] = function() {
						try {
							return original.apply(this, arguments);
						} catch (error) {
							console.error(`–û—à–∏–±–∫–∞ –≤ ${funcName}:`, error);
							
							// –ü—Ä–æ–±—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é –≤–µ—Ä—Å–∏—é
							if (safeFunctions[funcName]) {
								return safeFunctions[funcName].apply(this, arguments);
							}
							
							return null;
						}
					};
				}
			});
		}

		// –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			makeSafe();
		});		
		// ==================== –ó–ê–©–ò–¢–ê –û–¢ –û–®–ò–ë–û–ö –í –í–´–ß–ò–°–õ–ï–ù–ò–Ø–• ====================
		function safeCalculateGrade(totalScore) {
			try {
				if (typeof totalScore !== 'number' || isNaN(totalScore)) {
					return 2;
				}
				
				if (!appData.test || !appData.test.criteria) {
					return 2;
				}
				
				// –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –æ—Ü–µ–Ω–∫—É
				for (let grade of [5, 4, 3, 2]) {
					const criteria = appData.test.criteria[grade];
					if (criteria && 
						typeof criteria.min === 'number' && 
						typeof criteria.max === 'number' &&
						totalScore >= criteria.min && 
						totalScore <= criteria.max) {
						return grade;
					}
				}
				
				return 2; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –æ—Ü–µ–Ω–∫–∏:', error);
				return 2;
			}
		}

		function safeCalculatePercentage(score, max) {
			try {
				if (typeof score !== 'number' || isNaN(score) || 
					typeof max !== 'number' || isNaN(max) || max <= 0) {
					return 0;
				}
				
				const percentage = (score / max) * 100;
				return Math.min(Math.max(percentage, 0), 100); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0-100%
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞:', error);
				return 0;
			}
		}

		function safeArrayReduce(arr, callback, initialValue) {
			try {
				if (!Array.isArray(arr) || arr.length === 0) {
					return initialValue || 0;
				}
				
				return arr.reduce(callback, initialValue);
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –≤ reduce:', error);
				return initialValue || 0;
			}
		}

        // 1. –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï –ò –†–ï–ó–ï–†–í–ù–û–ï –ö–û–ü–ò–†–û–í–ê–ù–ò–ï

        function scheduleAutoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveData();
                createBackup();
                showNotification('–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            }, 2000);
        }

		function createBackup() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
				if (!appData || Object.keys(appData).length === 0) {
					console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
					return null;
				}
				
				const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
				const backupKey = `backup_${timestamp}`;
				
				const backup = {
					data: JSON.parse(JSON.stringify(appData)), // –ì–ª—É–±–æ–∫–∞—è –∫–æ–ø–∏—è
					timestamp: new Date().toLocaleString(),
					version: '1.0',
					metadata: {
						subject: appData.test?.subject || '–ù–µ —É–∫–∞–∑–∞–Ω',
						class: appData.test?.class || '–ù–µ —É–∫–∞–∑–∞–Ω',
						workType: appData.test?.workType || 'current',
						studentsCount: appData.students?.length || 0,
						tasksCount: appData.tasks?.length || 0
					}
				};
				
				localStorage.setItem(backupKey, JSON.stringify(backup));
				
				console.log(`üìÇ –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: ${backupKey}`, backup.metadata);
				
				// –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
				cleanupOldBackups(10);
				
				return backupKey;
			} catch (error) {
				console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', error);
				
				// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
				if (window.logError) {
					window.logError(error, { context: 'createBackup' });
				}
				
				return null;
			}
		}

		function cleanupOldBackups(maxBackups = 10) {
			try {
				const backupKeys = Object.keys(localStorage)
					.filter(key => key.startsWith('backup_'))
					.sort(); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–µ)
				
				// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏
				if (backupKeys.length > maxBackups) {
					const keysToDelete = backupKeys.slice(0, backupKeys.length - maxBackups);
					keysToDelete.forEach(key => {
						localStorage.removeItem(key);
						console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: ${key}`);
					});
				}
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π:', error);
			}
		}

        function restoreBackupDialog() {
            const backups = Object.keys(localStorage)
                .filter(key => key.startsWith('backup_'))
                .map(key => ({
                    key,
                    data: JSON.parse(localStorage.getItem(key)),
                    date: new Date(key.replace('backup_', '').replace(/-/g, ':'))
                }))
                .sort((a, b) => b.date - a.date);
            
            if (backups.length === 0) {
                alert('–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            let html = '<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:</h3>';
            backups.forEach((backup, index) => {
                html += `
                    <div class="backup-item" onclick="restoreBackup('${backup.key}')">
                        <strong>${backup.data.timestamp}</strong><br>
                        <small>${backup.data.data.test.subject} - ${backup.data.data.test.class}</small>
                    </div>
                `;
            });
            
            showModal('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏', html);
        }

        function restoreBackup(backupKey) {
            const backup = JSON.parse(localStorage.getItem(backupKey));
            if (backup && confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç—É —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                appData = backup.data;
                saveData();
                renderAll();
                hideModal();
                showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'success');
            }
        }

        // 2. –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showModal(title, content) {
            const modalOverlay = document.getElementById('modalOverlay');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <h2>${title}</h2>
                ${content}
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            modalOverlay.classList.add('show');
        }

        function hideModal() {
            document.getElementById('modalOverlay').classList.remove('show');
        }
		
		function renderVisualizationSection() {
			const container = document.getElementById('visualizationContainer');
			if (!container) {
				console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä visualizationContainer –Ω–µ –Ω–∞–π–¥–µ–Ω!');
				return;
			}
			
			console.log('–û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏...');
			
			container.innerHTML = `
				<div style="margin-bottom: 30px;">
					<h2 style="margin-bottom: 20px;">üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
						<button class="btn" onclick="updateVisualization()" style="margin-right: 10px;">
							üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
						</button>
						<button class="btn" onclick="exportCharts()" style="margin-right: 10px;">
							üì• –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤
						</button>
						<button class="btn" onclick="debugCharts()">
							üêõ –û—Ç–ª–∞–¥–∫–∞
						</button>
					</div>
					
					<div class="charts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
						<!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ -->
						<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
							<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
								üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
							</h3>
							<div style="position: relative; height: 300px;">
								<canvas id="gradesChart"></canvas>
							</div>
							<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
								–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—á–∞—â–∏—Ö—Å—è –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –æ—Ü–µ–Ω–∫–∞–º
							</p>
						</div>
						
						<!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π -->
						<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
							<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
								üìà –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π
							</h3>
							<div style="position: relative; height: 300px;">
								<canvas id="solvabilityChart"></canvas>
							</div>
							<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
								–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
							</p>
						</div>
						
						<!-- –ì—Ä–∞—Ñ–∏–∫ —Å–≤—è–∑–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ -->
						<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
							<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
								üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å
							</h3>
							<div style="position: relative; height: 300px;">
								<canvas id="complexityChart"></canvas>
							</div>
							<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
								–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
							</p>
						</div>
					</div>
					
					<!-- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 30px;">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
						</h3>
						<div id="heatmapContainer"></div>
					</div>
				</div>
			`;
			
			console.log('Canvas —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏...');
			
			// –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ DOM
			setTimeout(() => {
				updateVisualization();
				console.log('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
			}, 200);
		}		
        // 3. –ì–†–£–ü–ü–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò –° –û–¶–ï–ù–ö–ê–ú–ò
        function showBulkEditScores() {
            const html = `
                <div class="form-group">
                    <label>–î–µ–π—Å—Ç–≤–∏–µ:</label>
                    <select id="bulkAction">
                        <option value="set">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</option>
                        <option value="add">–î–æ–±–∞–≤–∏—Ç—å –±–∞–ª–ª—ã</option>
                        <option value="multiply">–£–º–Ω–æ–∂–∏—Ç—å –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</option>
                        <option value="round">–û–∫—Ä—É–≥–ª–∏—Ç—å –æ—Ü–µ–Ω–∫–∏</option>
                    </select>
                </div>
                
                <div class="form-group" id="bulkValueContainer">
                    <label>–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                    <input type="number" id="bulkValue" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label>–î–ª—è –∑–∞–¥–∞–Ω–∏–π:</label>
                    <select id="bulkTasks" multiple style="height: 100px;">
                        ${appData.tasks.map((task, index) => 
                            `<option value="${index}" selected>${index + 1}. ${task.type} (–º–∞–∫—Å: ${task.maxScore})</option>`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–î–ª—è —É—á–∞—â–∏—Ö—Å—è:</label>
                    <select id="bulkStudents" multiple style="height: 100px;">
                        ${appData.students.map((student, index) => 
                            `<option value="${index}" selected>${student}</option>`
                        ).join('')}
                    </select>
                </div>
                
                <button class="btn btn-warning" onclick="applyBulkEdit()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button class="btn" onclick="previewBulkEdit()">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            `;
            
            showModal('–ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫', html);
        }

        function applyBulkEdit() {
            const action = document.getElementById('bulkAction').value;
            const value = parseFloat(document.getElementById('bulkValue').value);
            const selectedTasks = Array.from(document.getElementById('bulkTasks').selectedOptions).map(opt => parseInt(opt.value));
            const selectedStudents = Array.from(document.getElementById('bulkStudents').selectedOptions).map(opt => parseInt(opt.value));
            
            let changes = 0;
            
            selectedStudents.forEach(studentIndex => {
                selectedTasks.forEach(taskIndex => {
                    const oldValue = appData.results[studentIndex][taskIndex];
                    let newValue = oldValue;
                    const maxScore = appData.tasks[taskIndex].maxScore;
                    
                    switch(action) {
                        case 'set':
                            newValue = Math.min(value, maxScore);
                            break;
                        case 'add':
                            newValue = Math.min(oldValue + value, maxScore);
                            break;
                        case 'multiply':
                            newValue = Math.min(oldValue * value, maxScore);
                            break;
                        case 'round':
                            newValue = Math.round(oldValue);
                            break;
                    }
                    
                    if (newValue !== oldValue) {
                        appData.results[studentIndex][taskIndex] = Math.max(0, newValue);
                        changes++;
                    }
                });
            });
            
            saveData();
            renderResults();
            hideModal();
            showNotification(`–ò–∑–º–µ–Ω–µ–Ω–æ ${changes} –æ—Ü–µ–Ω–æ–∫`, 'success');
        }

        // 4. –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ò –¢–†–ï–ù–î–´
        function saveHistoricalData() {
            const snapshot = {
                timestamp: new Date().toISOString(),
                data: JSON.parse(JSON.stringify(appData)),
                summary: generateWorkSummary()
            };
            
            const history = JSON.parse(localStorage.getItem('workHistory') || '[]');
            history.push(snapshot);
            localStorage.setItem('workHistory', JSON.stringify(history.slice(-50)));
        }
		
		// ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ê–ú–ò ====================

		function saveCriteriaSettings() {
			saveData();
			showNotification("–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
		}

		function loadDefaultCriteria() {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			appData.test.criteria = {
				1: { min: 0, max: Math.round(maxPossible * 0.49) },
				2: { min: Math.round(maxPossible * 0.5), max: Math.round(maxPossible * 0.69) },
				3: { min: Math.round(maxPossible * 0.7), max: Math.round(maxPossible * 0.84) },
				4: { min: Math.round(maxPossible * 0.85), max: maxPossible }
			};
			
			renderCriteriaSettings();
			showNotification("–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏", "success");
		}

		function generateAutoCriteria() {
			const type = appData.test.criteriaType || 'points';
			const count = appData.test.criteriaCount || 4;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			if (type === 'percentage') {
				const step = 100 / count;
				for (let i = 1; i <= count; i++) {
					appData.test.criteria[i] = {
						min: Math.round((i-1) * step),
						max: Math.round(i * step)
					};
				}
				appData.test.criteria[count].max = 100;
			} else {
				const step = maxPossible / count;
				for (let i = 1; i <= count; i++) {
					appData.test.criteria[i] = {
						min: Math.round((i-1) * step),
						max: Math.round(i * step)
					};
				}
				appData.test.criteria[count].max = maxPossible;
			}
			
			renderCriteriaSettings();
			showNotification("–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏", "success");
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
		function getGradeDisplay(gradeValue) {
			console.log('getGradeDisplay called with:', gradeValue, typeof gradeValue);
			
			// –ï—Å–ª–∏ gradeValue - —Å—Ç—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ customCriteria.name), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
			if (typeof gradeValue === 'string') {
				return gradeValue;
			}
			
			// –ï—Å–ª–∏ gradeValue - —á–∏—Å–ª–æ
			const numericGrade = Number(gradeValue);
			const system = appData.test.criteriaSystem;
			
			// –î–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –µ—Å–ª–∏ grade - —á–∏—Å–ª–æ, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
			if (system === 'custom' && appData.test.customCriteria) {
				const criterion = appData.test.customCriteria[numericGrade - 1];
				if (criterion && criterion.name) {
					return criterion.name;
				}
			}
			
			// –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
			const gradeDescriptions = {
				'1': '1 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)',
				'2': '2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)',
				'3': '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)',
				'4': '4 (–•–æ—Ä–æ—à–æ)',
				'5': '5 (–û—Ç–ª–∏—á–Ω–æ)',
				'6': '6 (–•–æ—Ä–æ—à–æ)',
				'7': '7 (–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ)',
				'8': '8 (–û—Ç–ª–∏—á–Ω–æ)',
				'9': '9 (–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ)',
				'10': '10 (–ë–µ–∑—É–ø—Ä–µ—á–Ω–æ)'
			};
			
			const displayValue = gradeDescriptions[String(numericGrade)] || String(numericGrade);
			console.log('Display value:', displayValue);
			return displayValue;
		}

		// 1. –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ò
		function deleteError(errorIndex) {
			if (errorIndex >= 0 && errorIndex < appData.errors.length) {
				const error = appData.errors[errorIndex];
				const studentName = appData.students[error.studentIndex] || `–£—á–∞—â–∏–π—Å—è ${error.studentIndex + 1}`;
				const taskNumber = error.taskIndex + 1;
				
				if (confirm(`–£–¥–∞–ª–∏—Ç—å –æ—à–∏–±–∫—É?\n\n–£—á–∞—â–∏–π—Å—è: ${studentName}\n–ó–∞–¥–∞–Ω–∏–µ: ${taskNumber}\n–¢–∏–ø: ${errorTypes[error.type]?.name || error.type}`)) {
					appData.errors.splice(errorIndex, 1);
					saveData();
					renderResults();
					showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
				}
			}
		}

		// 2. –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –û–®–ò–ë–ö–ò
		function editError(errorIndex) {
			if (errorIndex >= 0 && errorIndex < appData.errors.length) {
				const error = appData.errors[errorIndex];
				
				const html = `
					<h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏</h3>
					
					<div class="form-group">
						<label>–£—á–∞—â–∏–π—Å—è:</label>
						<select id="editErrorStudent">
							${appData.students.map((student, index) => 
								`<option value="${index}" ${index === error.studentIndex ? 'selected' : ''}>
									${student}
								</option>`
							).join('')}
						</select>
					</div>
					
					<div class="form-group">
						<label>–ó–∞–¥–∞–Ω–∏–µ:</label>
						<select id="editErrorTask">
							${appData.tasks.map((task, index) => 
								`<option value="${index}" ${index === error.taskIndex ? 'selected' : ''}>
									${index + 1}. ${task.type}
								</option>`
							).join('')}
						</select>
					</div>
					
					<div class="form-group">
						<label>–¢–∏–ø –æ—à–∏–±–∫–∏:</label>
						<select id="editErrorType">
							${Object.entries(errorTypes).map(([key, data]) => 
								`<option value="${key}" ${key === error.type ? 'selected' : ''}>
									${data.name}
								</option>`
							).join('')}
						</select>
					</div>
					
					<div class="form-group">
						<label>–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:</label>
						<textarea id="editErrorDescription" rows="3">${error.description || ''}</textarea>
					</div>
					
					<div class="form-group">
						<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π:</label>
						<input type="number" id="editErrorCount" min="1" value="${error.count || 1}">
					</div>
				`;
				
				showModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏', html + `
					<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
						<button class="btn btn-danger" onclick="deleteError(${errorIndex}); hideModal()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
						<button class="btn" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
						<button class="btn btn-success" onclick="saveEditedError(${errorIndex})">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
					</div>
				`);
			}
		}

		// 3. –°–û–•–†–ê–ù–ï–ù–ò–ï –û–¢–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ù–û–ô –û–®–ò–ë–ö–ò
		function saveEditedError(errorIndex) {
			const studentIndex = parseInt(document.getElementById('editErrorStudent').value);
			const taskIndex = parseInt(document.getElementById('editErrorTask').value);
			const type = document.getElementById('editErrorType').value;
			const description = document.getElementById('editErrorDescription').value;
			const count = parseInt(document.getElementById('editErrorCount').value) || 1;
			
			if (!description.trim()) {
				showNotification("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏!", "error");
				return;
			}
			
			appData.errors[errorIndex] = {
				studentIndex,
				taskIndex,
				type,
				description,
				count
			};
			
			saveData();
			renderResults();
			hideModal();
			showNotification("–û—à–∏–±–∫–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞", "success");
		}

		// 4. –ú–ê–°–°–û–í–û–ï –£–î–ê–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö
		function showBulkDeleteErrors() {
			if (appData.errors.length === 0) {
				showNotification("–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è", "info");
				return;
			}
			
			let html = `
				<h3>üóëÔ∏è –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫</h3>
				<p>–í—ã–±–µ—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:</p>
				
				<div style="max-height: 400px; overflow-y: auto; margin: 15px 0;">
					<table style="width: 100%; font-size: 12px;">
						<thead>
							<tr>
								<th><input type="checkbox" id="selectAllErrors" onclick="toggleAllErrors()"></th>
								<th>‚Ññ</th>
								<th>–£—á–∞—â–∏–π—Å—è</th>
								<th>–ó–∞–¥–∞–Ω–∏–µ</th>
								<th>–¢–∏–ø –æ—à–∏–±–∫–∏</th>
								<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
							</tr>
						</thead>
						<tbody>
			`;
			
			appData.errors.forEach((error, index) => {
				const studentName = appData.students[error.studentIndex] || `–£—á. ${error.studentIndex + 1}`;
				const taskInfo = appData.tasks[error.taskIndex] ? `‚Ññ${error.taskIndex + 1}` : '–ó–∞–¥–∞–Ω–∏–µ';
				const errorType = errorTypes[error.type]?.name || error.type;
				
				html += `
					<tr>
						<td><input type="checkbox" class="error-checkbox" value="${index}"></td>
						<td>${index + 1}</td>
						<td>${studentName}</td>
						<td>${taskInfo}</td>
						<td><span class="error-type error-${error.type}">${errorType}</span></td>
						<td>${error.description || ''}</td>
					</tr>
				`;
			});
			
			html += `
						</tbody>
					</table>
				</div>
				
				<div style="margin-top: 15px;">
					<p>–í—ã–±—Ä–∞–Ω–æ: <span id="selectedCount">0</span> –∏–∑ ${appData.errors.length} –æ—à–∏–±–æ–∫</p>
				</div>
				
				<div class="form-group">
					<label>–§–∏–ª—å—Ç—Ä –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞:</label>
					<div style="display: flex; gap: 10px; flex-wrap: wrap;">
						<button class="btn btn-sm" onclick="selectByType('calculation')">–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ</button>
						<button class="btn btn-sm" onclick="selectByType('conceptual')">–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ</button>
						<button class="btn btn-sm" onclick="selectByType('attention')">–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
						<button class="btn btn-sm" onclick="selectAllErrors()">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
						<button class="btn btn-sm" onclick="deselectAllErrors()">–°–Ω—è—Ç—å –≤—Å–µ</button>
					</div>
				</div>
				
				<div class="form-group">
					<label>–£–¥–∞–ª–∏—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è —É—á–∞—â–µ–≥–æ—Å—è:</label>
					<select id="filterStudent" onchange="selectByStudent()">
						<option value="">–í—Å–µ —É—á–∞—â–∏–µ—Å—è</option>
						${appData.students.map((student, index) => 
							`<option value="${index}">${student}</option>`
						).join('')}
					</select>
				</div>
			`;
			
			showModal('–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-danger" onclick="deleteSelectedErrors()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
				</div>
			`);
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
			document.querySelectorAll('.error-checkbox').forEach(checkbox => {
				checkbox.addEventListener('change', updateSelectedCount);
			});
		}

		// 5. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ú–ê–°–°–û–í–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø
		function toggleAllErrors() {
			const selectAll = document.getElementById('selectAllErrors');
			const checkboxes = document.querySelectorAll('.error-checkbox');
			
			checkboxes.forEach(checkbox => {
				checkbox.checked = selectAll.checked;
			});
			
			updateSelectedCount();
		}

		function selectAllErrors() {
			document.querySelectorAll('.error-checkbox').forEach(checkbox => {
				checkbox.checked = true;
			});
			document.getElementById('selectAllErrors').checked = true;
			updateSelectedCount();
		}

		function deselectAllErrors() {
			document.querySelectorAll('.error-checkbox').forEach(checkbox => {
				checkbox.checked = false;
			});
			document.getElementById('selectAllErrors').checked = false;
			updateSelectedCount();
		}

		function selectByType(errorType) {
			appData.errors.forEach((error, index) => {
				if (error.type === errorType) {
					const checkbox = document.querySelector(`.error-checkbox[value="${index}"]`);
					if (checkbox) checkbox.checked = true;
				}
			});
			updateSelectedCount();
		}

		function selectByStudent() {
			const studentIndex = parseInt(document.getElementById('filterStudent').value);
			
			if (isNaN(studentIndex)) {
				selectAllErrors();
				return;
			}
			
			// –°–Ω–∞—á–∞–ª–∞ —Å–Ω–∏–º–∞–µ–º –≤—Å–µ
			deselectAllErrors();
			
			// –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
			appData.errors.forEach((error, index) => {
				if (error.studentIndex === studentIndex) {
					const checkbox = document.querySelector(`.error-checkbox[value="${index}"]`);
					if (checkbox) checkbox.checked = true;
				}
			});
			
			updateSelectedCount();
		}

		function updateSelectedCount() {
			const selected = document.querySelectorAll('.error-checkbox:checked').length;
			document.getElementById('selectedCount').textContent = selected;
		}

		function deleteSelectedErrors() {
			const checkboxes = document.querySelectorAll('.error-checkbox:checked');
			const indexesToDelete = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
			
			if (indexesToDelete.length === 0) {
				showNotification("–ù–µ –≤—ã–±—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏", "warning");
				return;
			}
			
			const count = indexesToDelete.length;
			if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${count} –æ—à–∏–±–æ–∫? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
				return;
			}
			
			// –£–¥–∞–ª—è–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (—á—Ç–æ–±—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–µ —Å–¥–≤–∏–≥–∞–ª–∏—Å—å)
			indexesToDelete.forEach(index => {
				appData.errors.splice(index, 1);
			});
			
			saveData();
			renderResults();
			hideModal();
			showNotification(`–£–¥–∞–ª–µ–Ω–æ ${count} –æ—à–∏–±–æ–∫`, "success");
		}

		// 6. –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–• –û–®–ò–ë–û–ö –£–ß–ê–©–ï–ì–û–°–Ø
		function deleteAllStudentErrors(studentIndex) {
			const studentName = appData.students[studentIndex];
			const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
			
			if (studentErrors.length === 0) {
				showNotification(`–£ —É—á–∞—â–µ–≥–æ—Å—è ${studentName} –Ω–µ—Ç –æ—à–∏–±–æ–∫`, "info");
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è ${studentName}? (${studentErrors.length} –æ—à–∏–±–æ–∫)`)) {
				appData.errors = appData.errors.filter(e => e.studentIndex !== studentIndex);
				saveData();
				renderResults();
				showNotification(`–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è ${studentName}`, "success");
			}
		}

		// 7. –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–• –û–®–ò–ë–û–ö –ü–û –¢–ò–ü–£
		function deleteAllErrorsByType(errorType) {
			const typeName = errorTypes[errorType]?.name || errorType;
			const typeErrors = appData.errors.filter(e => e.type === errorType);
			
			if (typeErrors.length === 0) {
				showNotification(`–ù–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "${typeName}"`, "info");
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "${typeName}"? (${typeErrors.length} –æ—à–∏–±–æ–∫)`)) {
				appData.errors = appData.errors.filter(e => e.type !== errorType);
				saveData();
				renderResults();
				showNotification(`–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "${typeName}"`, "success");
			}
		}

		// 8. –ú–ï–ù–Æ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ê–ú–ò
		function showErrorsManagement() {
			let html = `
				<h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏</h3>
				
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üë§ –ü–æ —É—á–∞—â–∏–º—Å—è</h4>
						<select id="studentForErrors" onchange="updateStudentErrorsInfo()" style="width: 100%; margin-bottom: 10px;">
							<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—â–µ–≥–æ—Å—è</option>
							${appData.students.map((student, index) => 
								`<option value="${index}">${student}</option>`
							).join('')}
						</select>
						<div id="studentErrorsInfo" style="min-height: 60px;"></div>
						<button class="btn btn-danger btn-sm" onclick="deleteAllStudentErrors(parseInt(document.getElementById('studentForErrors').value))" disabled id="deleteStudentErrorsBtn">
							üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
						</button>
					</div>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üìä –ü–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫</h4>
						<select id="errorTypeFilter" onchange="updateTypeErrorsInfo()" style="width: 100%; margin-bottom: 10px;">
							<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—à–∏–±–∫–∏</option>
							${Object.entries(errorTypes).map(([key, data]) => 
								`<option value="${key}">${data.name}</option>`
							).join('')}
						</select>
						<div id="typeErrorsInfo" style="min-height: 60px;"></div>
						<button class="btn btn-danger btn-sm" onclick="deleteAllErrorsByType(document.getElementById('errorTypeFilter').value)" disabled id="deleteTypeErrorsBtn">
							üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
						</button>
					</div>
				</div>
				
				<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫</h4>
					<p>–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${appData.errors.length}</p>
					<p>–£—á–∞—â–∏—Ö—Å—è —Å –æ—à–∏–±–∫–∞–º–∏: ${new Set(appData.errors.map(e => e.studentIndex)).size}</p>
					<p>–ó–∞–¥–∞–Ω–∏–π —Å –æ—à–∏–±–∫–∞–º–∏: ${new Set(appData.errors.map(e => e.taskIndex)).size}</p>
				</div>
				
				<div style="margin-top: 20px;">
					<button class="btn btn-warning" onclick="showBulkDeleteErrors()">
						üóëÔ∏è –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
					</button>
					<button class="btn btn-danger" onclick="deleteAllErrors()" style="margin-left: 10px;">
						‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
					</button>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏', html + `
				<div style="margin-top: 20px;">
					<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
				</div>
			`);
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
			updateStudentErrorsInfo();
			updateTypeErrorsInfo();
		}

		function updateStudentErrorsInfo() {
			const studentIndex = parseInt(document.getElementById('studentForErrors').value);
			const infoDiv = document.getElementById('studentErrorsInfo');
			const deleteBtn = document.getElementById('deleteStudentErrorsBtn');
			
			if (isNaN(studentIndex)) {
				infoDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—â–µ–≥–æ—Å—è</p>';
				deleteBtn.disabled = true;
				return;
			}
			
			const studentName = appData.students[studentIndex];
			const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
			
			if (studentErrors.length === 0) {
				infoDiv.innerHTML = `<p>–£ —É—á–∞—â–µ–≥–æ—Å—è <strong>${studentName}</strong> –Ω–µ—Ç –æ—à–∏–±–æ–∫</p>`;
				deleteBtn.disabled = true;
			} else {
				const errorTypesCount = {};
				studentErrors.forEach(error => {
					errorTypesCount[error.type] = (errorTypesCount[error.type] || 0) + 1;
				});
				
				const typesList = Object.entries(errorTypesCount)
					.map(([type, count]) => `${errorTypes[type]?.name}: ${count}`)
					.join(', ');
				
				infoDiv.innerHTML = `
					<p>–£—á–∞—â–∏–π—Å—è: <strong>${studentName}</strong></p>
					<p>–û—à–∏–±–æ–∫: ${studentErrors.length}</p>
					<small>${typesList}</small>
				`;
				deleteBtn.disabled = false;
			}
		}

		function updateTypeErrorsInfo() {
			const errorType = document.getElementById('errorTypeFilter').value;
			const infoDiv = document.getElementById('typeErrorsInfo');
			const deleteBtn = document.getElementById('deleteTypeErrorsBtn');
			
			if (!errorType) {
				infoDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—à–∏–±–∫–∏</p>';
				deleteBtn.disabled = true;
				return;
			}
			
			const typeName = errorTypes[errorType]?.name || errorType;
			const typeErrors = appData.errors.filter(e => e.type === errorType);
			
			if (typeErrors.length === 0) {
				infoDiv.innerHTML = `<p>–ù–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ <strong>${typeName}</strong></p>`;
				deleteBtn.disabled = true;
			} else {
				const studentsWithErrors = new Set(typeErrors.map(e => e.studentIndex)).size;
				
				infoDiv.innerHTML = `
					<p>–¢–∏–ø –æ—à–∏–±–∫–∏: <strong>${typeName}</strong></p>
					<p>–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${typeErrors.length}</p>
					<p>–£—á–∞—â–∏—Ö—Å—è —Å —Ç–∞–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏: ${studentsWithErrors}</p>
				`;
				deleteBtn.disabled = false;
			}
		}

		// 9. –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–• –û–®–ò–ë–û–ö
		function deleteAllErrors() {
			if (appData.errors.length === 0) {
				showNotification("–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è", "info");
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –í–°–ï –æ—à–∏–±–∫–∏? (${appData.errors.length} –æ—à–∏–±–æ–∫)\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
				appData.errors = [];
				saveData();
				renderResults();
				hideModal();
				showNotification("–í—Å–µ –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω—ã", "success");
			}
		}

		// 10. –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø renderResults() –° –ö–ù–û–ü–ö–ê–ú–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø
		function renderResults() {
			const container = document.getElementById('resultsContainer');
			container.innerHTML = '';
			
			// –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏
			const errorControls = document.createElement('div');
			errorControls.style.marginBottom = '20px';
			errorControls.style.padding = '15px';
			errorControls.style.background = '#f8f9fa';
			errorControls.style.borderRadius = '8px';
			errorControls.innerHTML = `
				<h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏</h4>
				<div style="display: flex; gap: 10px; flex-wrap: wrap;">
					<button class="btn btn-success" onclick="showErrorsManagement()">
						üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏
					</button>
					<button class="btn btn-warning" onclick="showBulkDeleteErrors()">
						üóëÔ∏è –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
					</button>
					<button class="btn" onclick="exportErrorsToCSV()">
						üì• –≠–∫—Å–ø–æ—Ä—Ç –æ—à–∏–±–æ–∫
					</button>
					${appData.errors.length > 0 ? `
						<button class="btn btn-danger" onclick="deleteAllErrors()">
							‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
						</button>
					` : ''}
				</div>
				<p style="margin-top: 10px; color: #666; font-size: 13px;">
					–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${appData.errors.length} | 
					–£—á–∞—â–∏—Ö—Å—è —Å –æ—à–∏–±–∫–∞–º–∏: ${new Set(appData.errors.map(e => e.studentIndex)).size}
				</p>
			`;
			
			container.appendChild(errorControls);
				
			if (appData.results.length === 0) {
				for (let i = 0; i < appData.test.presentStudents; i++) {
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
			}
			
			let html = '<div class="table-container"><table>';
			
			html += '<thead><tr><th>–£—á–∞—â–∏–π—Å—è</th>';
			for (let i = 0; i < appData.tasks.length; i++) {
				const task = appData.tasks[i];
				html += `<th title="–£—Ä. ${task.level}: ${task.type}">${i+1}</th>`;
			}
			html += '<th>‚àë</th><th>–û—Ü–µ–Ω–∫–∞</th><th>–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
			
			appData.students.forEach((student, studentIndex) => {
				const scores = appData.results[studentIndex] || [];
				const totalScore = scores.reduce((sum, score) => sum + score, 0);
				const grade = calculateGrade(totalScore);
				console.log(`Student ${studentIndex}: totalScore=${totalScore}, grade=${grade}`);
				const gradeClass = typeof grade === 'string' ? grade.replace(/\s+/g, '-').toLowerCase() : `grade-${grade}`;
				const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
				
				html += `<tr>
					<td><strong>${student}</strong></td>`;
				
				for (let taskIndex = 0; taskIndex < appData.tasks.length; taskIndex++) {
					const maxScore = appData.tasks[taskIndex].maxScore;
					const score = scores[taskIndex] || 0;
					const percentage = (score / maxScore) * 100;
					const heatmapClass = `heatmap-${Math.floor(percentage / 20) * 20}`;
					
					html += `<td class="heatmap-cell ${heatmapClass}">
						<input type="number" min="0" max="${maxScore}" value="${score}" 
							   style="width: 50px; text-align: center; border: none; background: transparent;"
							   onchange="updateResult(${studentIndex}, ${taskIndex}, parseInt(this.value))">
					</td>`;
				}
				
				html += `<td><strong>${totalScore}</strong></td>`;
				//	<td class="grade-${grade}"><strong>${grade}</strong></td>`;
				//html += `<td class="grade-${grade}"><strong>${getGradeDisplay(grade)}</strong></td>`; //–¥–æ–±–∞–≤–∏–ª —Ç—É—Ç –¥–ª—è —Ç–µ—Å—Ç–∞
				html += `<td class="${gradeClass}"><strong>${getGradeDisplay(grade)}</strong><small style="display: block; font-size: 10px; color: #666;">${totalScore} –±–∞–ª–ª–æ–≤</small></td>`;
				// –ö–æ–ª–æ–Ω–∫–∞ —Å –æ—à–∏–±–∫–∞–º–∏
				html += `<td><small>`;
				if (studentErrors.length > 0) {
					studentErrors.forEach((error, errorIndex) => {
						html += `
							<span class="error-type error-${error.type}" 
								  title="${error.description || errorTypes[error.type].desc}"
								  onclick="editError(${appData.errors.indexOf(error)})"
								  style="cursor: pointer; margin: 2px; display: inline-block;">
								${errorTypes[error.type].name}
								<small style="font-size: 9px;">[${error.taskIndex + 1}]</small>
							</span>
						`;
					});
				} else {
					html += '‚Äî';
				}
				html += `</small></td>`;
				
				// –ö–æ–ª–æ–Ω–∫–∞ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏
				html += `<td>
					<button class="btn btn-sm" onclick="showStudentErrors(${studentIndex})" title="–û—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è">
						üìä
					</button>
					${studentErrors.length > 0 ? `
						<button class="btn btn-sm btn-danger" onclick="deleteAllStudentErrors(${studentIndex})" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏">
							üóëÔ∏è
						</button>
					` : ''}
				</td></tr>`;
			});
			
			html += '</tbody></table></div>';
			
			// –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫
			html += `
				<div class="chart-container">
					<h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h3>
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
						<div>
							<div class="form-group">
								<label>–£—á–∞—â–∏–π—Å—è:</label>
								<select id="errorStudent">
									${appData.students.map((student, index) => 
										`<option value="${index}">${student}</option>`
									).join('')}
								</select>
							</div>
							<div class="form-group">
								<label>–ó–∞–¥–∞–Ω–∏–µ:</label>
								<select id="errorTask">
									${appData.tasks.map((task, index) => 
										`<option value="${index}">${index + 1}. ${task.type}</option>`
									).join('')}
								</select>
							</div>
						</div>
						<div>
							<div class="form-group">
								<label>–¢–∏–ø –æ—à–∏–±–∫–∏:</label>
								<select id="errorType">
									${Object.entries(errorTypes).map(([key, data]) => 
										`<option value="${key}">${data.name}</option>`
									).join('')}
								</select>
							</div>
							<div class="form-group">
								<label>–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:</label>
								<input type="text" id="errorDescription" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏...">
							</div>
						</div>
					</div>
					<button class="btn btn-warning" onclick="addError()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É</button>
					<button class="btn" onclick="showQuickErrorAdd()" style="margin-left: 10px;">‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</button>
				</div>
			`;
			
			container.innerHTML += html;
		}
		
		function generateCriteriaSummary() {
			const type = appData.test.criteriaType;
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üéØ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h4>';
			
			if (type === 'percentage') {
				html += '<p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è</p>';
				html += '<table style="width: 100%; font-size: 11pt;">';
				html += '<tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>';
				
				for (let i = 1; i <= count; i++) {
					const criteria = appData.test.criteria[i];
					const customInfo = appData.test.customCriteria[i-1];
					const levelName = system === 'custom' && customInfo ? customInfo.name : 
									system === 'standard' ? (i === 1 ? '2' : i+1) :
									system === 'five_point' ? i :
									system === 'ten_point' ? i : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
					
					html += `<tr>
						<td><strong>${levelName}</strong></td>
						<td>${criteria?.min || 0}% - ${criteria?.max || 0}%</td>
						<td>${customInfo?.description || ''}</td>
					</tr>`;
				}
				
				html += '</table>';
			} else if (type === 'points') {
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				html += `<p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –ë–∞–ª–ª—å–Ω–∞—è (–º–∞–∫—Å–∏–º—É–º: ${maxPossible} –±–∞–ª–ª–æ–≤)</p>`;
				html += '<table style="width: 100%; font-size: 11pt;">';
				html += '<tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>';
				
				for (let i = 1; i <= count; i++) {
					const criteria = appData.test.criteria[i];
					const customInfo = appData.test.customCriteria[i-1];
					const levelName = system === 'custom' && customInfo ? customInfo.name : 
									system === 'standard' ? (i === 1 ? '2' : i+1) :
									system === 'five_point' ? i :
									system === 'ten_point' ? i : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
					
					const minPercent = maxPossible > 0 ? Math.round((criteria?.min || 0) / maxPossible * 100) : 0;
					const maxPercent = maxPossible > 0 ? Math.round((criteria?.max || 0) / maxPossible * 100) : 0;
					
					html += `<tr>
						<td><strong>${levelName}</strong></td>
						<td>${criteria?.min || 0} - ${criteria?.max || 0} –±–∞–ª–ª–æ–≤</td>
						<td>${minPercent}% - ${maxPercent}%</td>
						<td>${customInfo?.description || ''}</td>
					</tr>`;
				}
				
				html += '</table>';
			} else if (type === 'custom') {
				html += '<p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —à–∫–∞–ª–∞</p>';
				html += '<table style="width: 100%; font-size: 11pt;">';
				html += '<tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–¶–≤–µ—Ç</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>';
				
				appData.test.customCriteria.forEach((criterion, index) => {
					html += `<tr>
						<td><strong>${criterion.name}</strong></td>
						<td>${criterion.min} - ${criterion.max} ${criterion.type === 'percentage' ? '%' : '–±–∞–ª–ª–æ–≤'}</td>
						<td><div style="width: 20px; height: 20px; background: ${criterion.color}; border: 1px solid #ccc;"></div></td>
						<td>${criterion.description}</td>
					</tr>`;
				});
				
				html += '</table>';
			}
			
			html += '</div>';
			return html;
		}		
		
		// 11. –ü–†–û–°–ú–û–¢–† –û–®–ò–ë–û–ö –£–ß–ê–©–ï–ì–û–°–Ø
		function showStudentErrors(studentIndex) {
			const studentName = appData.students[studentIndex];
			const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
			
			if (studentErrors.length === 0) {
				showNotification(`–£ —É—á–∞—â–µ–≥–æ—Å—è ${studentName} –Ω–µ—Ç –æ—à–∏–±–æ–∫`, "info");
				return;
			}
			
			let html = `
				<h3>üìä –û—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è: ${studentName}</h3>
				<p>–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${studentErrors.length}</p>
				
				<div style="max-height: 400px; overflow-y: auto; margin: 15px 0;">
					<table style="width: 100%; font-size: 12px;">
						<thead>
							<tr>
								<th>‚Ññ</th>
								<th>–ó–∞–¥–∞–Ω–∏–µ</th>
								<th>–¢–∏–ø –æ—à–∏–±–∫–∏</th>
								<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
								<th>–î–µ–π—Å—Ç–≤–∏—è</th>
							</tr>
						</thead>
						<tbody>
			`;
			
			studentErrors.forEach((error, index) => {
				const taskInfo = appData.tasks[error.taskIndex] ? 
					`‚Ññ${error.taskIndex + 1}. ${appData.tasks[error.taskIndex].type}` : 
					`–ó–∞–¥–∞–Ω–∏–µ ${error.taskIndex + 1}`;
				const errorType = errorTypes[error.type]?.name || error.type;
				const globalErrorIndex = appData.errors.indexOf(error);
				
				html += `
					<tr>
						<td>${index + 1}</td>
						<td>${taskInfo}</td>
						<td><span class="error-type error-${error.type}">${errorType}</span></td>
						<td>${error.description || '‚Äî'}</td>
						<td>
							<button class="btn btn-sm" onclick="editError(${globalErrorIndex})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
								‚úèÔ∏è
							</button>
							<button class="btn btn-sm btn-danger" onclick="deleteError(${globalErrorIndex})" title="–£–¥–∞–ª–∏—Ç—å">
								üóëÔ∏è
							</button>
						</td>
					</tr>
				`;
			});
			
			html += `
						</tbody>
					</table>
				</div>
				
				<div style="margin-top: 20px;">
					<button class="btn btn-danger" onclick="deleteAllStudentErrors(${studentIndex})">
						üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è
					</button>
					<button class="btn" onclick="hideModal()" style="margin-left: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
				</div>
			`;
			
			showModal(`–û—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è: ${studentName}`, html);
		}

		// 12. –ë–´–°–¢–†–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö
		function showQuickErrorAdd() {
			const html = `
				<h3>‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫</h3>
				<p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—â–∏—Ö—Å—è –∏ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫</p>
				
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
					<div>
						<h4>üë• –£—á–∞—â–∏–µ—Å—è:</h4>
						<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
							${appData.students.map((student, index) => `
								<label style="display: block; margin: 5px 0;">
									<input type="checkbox" class="quick-student" value="${index}">
									${student}
								</label>
							`).join('')}
						</div>
						<button class="btn btn-sm" onclick="selectAllQuickStudents()" style="margin-top: 5px;">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö</button>
					</div>
					
					<div>
						<h4>üìù –ó–∞–¥–∞–Ω–∏—è:</h4>
						<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
							${appData.tasks.map((task, index) => `
								<label style="display: block; margin: 5px 0;">
									<input type="checkbox" class="quick-task" value="${index}">
									${index + 1}. ${task.type}
								</label>
							`).join('')}
						</div>
						<button class="btn btn-sm" onclick="selectAllQuickTasks()" style="margin-top: 5px;">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
					</div>
				</div>
				
				<div class="form-group">
					<label>–¢–∏–ø –æ—à–∏–±–∫–∏:</label>
					<select id="quickErrorType">
						${Object.entries(errorTypes).map(([key, data]) => 
							`<option value="${key}">${data.name}</option>`
						).join('')}
					</select>
				</div>
				
				<div class="form-group">
					<label>–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:</label>
					<input type="text" id="quickErrorDescription" placeholder="–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫...">
				</div>
			`;
			
			showModal('–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="addQuickErrors()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏</button>
				</div>
			`);
		}

		function selectAllQuickStudents() {
			document.querySelectorAll('.quick-student').forEach(cb => cb.checked = true);
		}

		function selectAllQuickTasks() {
			document.querySelectorAll('.quick-task').forEach(cb => cb.checked = true);
		}

		function addQuickErrors() {
			const selectedStudents = Array.from(document.querySelectorAll('.quick-student:checked'))
				.map(cb => parseInt(cb.value));
			const selectedTasks = Array.from(document.querySelectorAll('.quick-task:checked'))
				.map(cb => parseInt(cb.value));
			const type = document.getElementById('quickErrorType').value;
			const description = document.getElementById('quickErrorDescription').value;
			
			if (selectedStudents.length === 0 || selectedTasks.length === 0) {
				showNotification("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è –∏ –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ", "error");
				return;
			}
			
			if (!description.trim()) {
				showNotification("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏", "error");
				return;
			}
			
			let addedCount = 0;
			
			selectedStudents.forEach(studentIndex => {
				selectedTasks.forEach(taskIndex => {
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –æ—à–∏–±–∫–∏
					const exists = appData.errors.some(e => 
						e.studentIndex === studentIndex && 
						e.taskIndex === taskIndex && 
						e.type === type
					);
					
					if (!exists) {
						appData.errors.push({
							studentIndex,
							taskIndex,
							type,
							description,
							count: 1
						});
						addedCount++;
					}
				});
			});
			
			saveData();
			renderResults();
			hideModal();
			showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} –æ—à–∏–±–æ–∫`, "success");
		}

		// 13. –≠–ö–°–ü–û–†–¢ –û–®–ò–ë–û–ö –í CSV
		function exportErrorsToCSV() {
			if (appData.errors.length === 0) {
				showNotification("–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞", "info");
				return;
			}
			
			let csvContent = "–£—á–∞—â–∏–π—Å—è;–ó–∞–¥–∞–Ω–∏–µ;–¢–∏–ø –æ—à–∏–±–∫–∏;–û–ø–∏—Å–∞–Ω–∏–µ;–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ\n";
			
			appData.errors.forEach(error => {
				const studentName = appData.students[error.studentIndex] || `–£—á. ${error.studentIndex + 1}`;
				const taskInfo = appData.tasks[error.taskIndex] ? 
					`‚Ññ${error.taskIndex + 1}. ${appData.tasks[error.taskIndex].type}` : 
					`–ó–∞–¥–∞–Ω–∏–µ ${error.taskIndex + 1}`;
				const errorType = errorTypes[error.type]?.name || error.type;
				const description = error.description || '';
				const count = error.count || 1;
				
				// –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π –∏ –∫–∞–≤—ã—á–∫–∏
				const safeDescription = description.replace(/;/g, ',').replace(/"/g, "'");
				
				csvContent += `"${studentName}";"${taskInfo}";"${errorType}";"${safeDescription}";${count}\n`;
			});
			
			const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
			const url = URL.createObjectURL(blob);
			const link = document.createElement('a');
			link.href = url;
			link.download = `–æ—à–∏–±–∫–∏_${appData.test.subject || '–ø—Ä–µ–¥–º–µ—Ç'}_${new Date().toISOString().slice(0, 10)}.csv`;
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			URL.revokeObjectURL(url);
			
			showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${appData.errors.length} –æ—à–∏–±–æ–∫ –≤ CSV`, "success");
		}

		// 14. –û–ë–ù–û–í–ò–¢–¨ –°–¢–ò–õ–ò CSS –î–õ–Ø –ö–ù–û–ü–û–ö
		const additionalStyles = `
			.btn-sm {
				padding: 4px 8px !important;
				font-size: 12px !important;
			}
			
			.error-type {
				cursor: pointer !important;
				transition: opacity 0.2s !important;
			}
			
			.error-type:hover {
				opacity: 0.8 !important;
				transform: translateY(-1px) !important;
			}
			
			.error-management-panel {
				background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
				border-radius: 10px !important;
				padding: 15px !important;
				margin-bottom: 20px !important;
				border-left: 4px solid #3498db !important;
			}
		`;

		// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤ head
		const styleSheet = document.createElement("style");
		styleSheet.type = "text/css";
		styleSheet.innerText = additionalStyles;
		document.head.appendChild(styleSheet);		
		
		
        function generateWorkSummary() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            
            return {
                subject: appData.test.subject,
                class: appData.test.class,
                theme: appData.test.theme,
                date: appData.test.testDate,
                avgScore: totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length,
                successRate: (grades.filter(grade => grade >= 3).length / grades.length * 100),
                qualityRate: (grades.filter(grade => grade >= 4).length / grades.length * 100),
                totalStudents: appData.students.length
            };
        }

        function showComparativeAnalysis() {
            const history = JSON.parse(localStorage.getItem('workHistory') || '[]')
                .filter(item => item.data.test.subject === appData.test.subject && item.data.test.class === appData.test.class)
                .sort((a, b) => new Date(a.data.test.testDate) - new Date(b.data.test.testDate));
            
            if (history.length < 2) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞');
                return;
            }
            
            const currentSummary = generateWorkSummary();
            const previousSummary = history[history.length - 2].summary;
            
            const html = `
                <div class="comparative-grid">
                    <div class="comparative-card">
                        <h4>üìä –î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∞–ª–ª–∞</h4>
                        <div class="comparative-value ${currentSummary.avgScore > previousSummary.avgScore ? 'positive' : 'negative'}">
                            ${currentSummary.avgScore.toFixed(1)} 
                            <span class="trend">${currentSummary.avgScore > previousSummary.avgScore ? '‚Üó' : '‚Üò'}</span>
                        </div>
                        <div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.avgScore.toFixed(1)}</div>
                        <div class="comparative-diff ${currentSummary.avgScore > previousSummary.avgScore ? 'positive' : 'negative'}">
                            ${(currentSummary.avgScore - previousSummary.avgScore).toFixed(1)}
                        </div>
                    </div>
                    
                    <div class="comparative-card">
                        <h4>üéØ –î–∏–Ω–∞–º–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h4>
                        <div class="comparative-value ${currentSummary.successRate > previousSummary.successRate ? 'positive' : 'negative'}">
                            ${currentSummary.successRate.toFixed(1)}%
                            <span class="trend">${currentSummary.successRate > previousSummary.successRate ? '‚Üó' : '‚Üò'}</span>
                        </div>
                        <div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.successRate.toFixed(1)}%</div>
                        <div class="comparative-diff ${currentSummary.successRate > previousSummary.successRate ? 'positive' : 'negative'}">
                            ${(currentSummary.successRate - previousSummary.successRate).toFixed(1)}%
                        </div>
                    </div>
                    
                    <div class="comparative-card">
                        <h4>‚≠ê –î–∏–Ω–∞–º–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞</h4>
                        <div class="comparative-value ${currentSummary.qualityRate > previousSummary.qualityRate ? 'positive' : 'negative'}">
                            ${currentSummary.qualityRate.toFixed(1)}%
                            <span class="trend">${currentSummary.qualityRate > previousSummary.qualityRate ? '‚Üó' : '‚Üò'}</span>
                        </div>
                        <div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.qualityRate.toFixed(1)}%</div>
                        <div class="comparative-diff ${currentSummary.qualityRate > previousSummary.qualityRate ? 'positive' : 'negative'}">
                            ${(currentSummary.qualityRate - previousSummary.qualityRate).toFixed(1)}%
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="trendChart" height="200"></canvas>
                </div>
            `;
            
            showModal('–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑', html);
            
            setTimeout(() => initTrendChart(history), 100);
        }

        function initTrendChart(history) {
            if (window.trendChartInstance) {
                window.trendChartInstance.destroy();
            }
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            const labels = history.map(item => new Date(item.data.test.testDate).toLocaleDateString());
            const avgScores = history.map(item => item.summary.avgScore);
            const successRates = history.map(item => item.summary.successRate);
            
            window.trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª',
                            data: avgScores,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å %',
                            data: successRates,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                    }
                }
            });
        }

        // 5. –†–ê–°–®–ò–†–ï–ù–ù–´–ô –≠–ö–°–ü–û–†–¢
        function exportToExcel() {
            try {
                const wb = XLSX.utils.book_new();
                
                // –õ–∏—Å—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                const resultsData = [
                    ['–£—á–∞—â–∏–π—Å—è', ...appData.tasks.map((t, i) => `–ó–∞–¥–∞–Ω–∏–µ ${i+1}`), '–°—É–º–º–∞', '–û—Ü–µ–Ω–∫–∞']
                ];
                
                appData.students.forEach((student, index) => {
                    const scores = appData.results[index];
                    const total = scores.reduce((sum, score) => sum + score, 0);
                    const grade = calculateGrade(total);
                    resultsData.push([student, ...scores, total, grade]);
                });
                
                const wsResults = XLSX.utils.aoa_to_sheet(resultsData);
                XLSX.utils.book_append_sheet(wb, wsResults, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã');
                
                // –õ–∏—Å—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º
                const analysisData = [
                    ['–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å', '–ó–Ω–∞—á–µ–Ω–∏–µ'],
                    ['–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', calculateAverageScore()],
                    ['–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å', calculateSuccessRate() + '%'],
                    ['–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π', calculateQualityRate() + '%'],
                    ['–°–û–£', calculateSou() + '%']
                ];
                
                const wsAnalysis = XLSX.utils.aoa_to_sheet(analysisData);
                XLSX.utils.book_append_sheet(wb, wsAnalysis, '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞');
                
                XLSX.writeFile(wb, `–∞–Ω–∞–ª–∏–∑_${appData.test.subject}_${appData.test.class}_${new Date().toLocaleDateString()}.xlsx`);
                showNotification('Excel —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ Excel: ' + error.message, 'error');
            }
        }

		// –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - —Å–æ–∑–¥–∞–Ω–∏–µ PDF —á–µ—Ä–µ–∑ canvas
		function exportToPDFCanvas() {
			try {
				// –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
				const tempDiv = document.createElement('div');
				tempDiv.style.cssText = `
					position: fixed;
					left: -10000px;
					top: -10000px;
					width: 210mm;
					padding: 20mm;
					background: white;
					font-family: Arial, sans-serif;
					font-size: 12pt;
					line-height: 1.4;
				`;
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è PDF
				tempDiv.innerHTML = generatePDFContent();
				document.body.appendChild(tempDiv);
				
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º html2canvas –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
				html2canvas(tempDiv).then(canvas => {
					const imgData = canvas.toDataURL('image/png');
					const { jsPDF } = window.jspdf;
					const pdf = new jsPDF('p', 'mm', 'a4');
					
					const imgWidth = 210;
					const pageHeight = 295;
					const imgHeight = canvas.height * imgWidth / canvas.width;
					let heightLeft = imgHeight;
					let position = 0;
					
					pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
					heightLeft -= pageHeight;
					
					while (heightLeft >= 0) {
						position = heightLeft - imgHeight;
						pdf.addPage();
						pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
						heightLeft -= pageHeight;
					}
					
					pdf.save(`–æ—Ç—á–µ—Ç_${appData.test.subject}_${new Date().toLocaleDateString()}.pdf`);
					document.body.removeChild(tempDiv);
					showNotification('PDF —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
				});
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF: ' + error.message, 'error');
			}
		}

		function generatePDFContent() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
			
			const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
			grades.forEach(grade => gradeCounts[grade]++);
			
			return `
				<div style="text-align: center; margin-bottom: 20px;">
					<h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
					<h2>${appData.test.subject}, ${appData.test.class}</h2>
					<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme}</p>
					<p><strong>–î–∞—Ç–∞:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
				</div>
				
				<div style="margin-bottom: 20px;">
					<h3>–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
					<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
						<div style="background: #667eea; color: white; padding: 15px; border-radius: 8px; text-align: center;">
							<div style="font-size: 1.6em; font-weight: bold;">${avgScore.toFixed(1)}</div>
							<div>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
						</div>
						<div style="background: #764ba2; color: white; padding: 15px; border-radius: 8px; text-align: center;">
							<div style="font-size: 1.6em; font-weight: bold;">${successRate.toFixed(1)}%</div>
							<div>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
						</div>
					</div>
				</div>
				
				<div style="margin-bottom: 20px;">
					<h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h3>
					<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #27ae60;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[5]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 5</div>
						</div>
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #3498db;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[4]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 4</div>
						</div>
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #f39c12;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[3]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 3</div>
						</div>
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #e74c3c;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[2]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 2</div>
						</div>
					</div>
				</div>
				
				<div style="margin-bottom: 20px;">
					<h3>–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</h3>
					<div style="background: #e8f4fc; padding: 15px; border-radius: 6px; border-left: 4px solid #3498db;">
						${generateKeyConclusionsText()}
					</div>
				</div>
				
				<div style="text-align: center; color: #7f8c8d; font-size: 10pt; margin-top: 30px;">
					<p>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()}</p>
					<p>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
				</div>
			`;
		}

		// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pdfmake (–µ—Å–ª–∏ jsPDF –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–æ—Ö–æ)
		function exportToPDFWithPDFMake() {
			// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è pdfmake
			if (typeof pdfMake === 'undefined') {
				showNotification('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ pdfmake –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞', 'error');
				return;
			}
			
			try {
				const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
				const grades = totalScores.map(score => calculateGrade(score));
				const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
				const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
				const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
				
				const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
				grades.forEach(grade => gradeCounts[grade]++);
				
				// –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
				const taskAnalysis = appData.tasks.map((task, index) => {
					const completion = calculateTaskCompletion(index);
					let zone = '';
					if (completion >= 90) zone = '–û—Ç–ª–∏—á–Ω–∞—è';
					else if (completion >= 60) zone = '–ó–µ–ª–µ–Ω–∞—è';
					else if (completion >= 30) zone = '–ñ–µ–ª—Ç–∞—è';
					else zone = '–ö—Ä–∞—Å–Ω–∞—è';
					
					return [
						(index + 1).toString(),
						task.type,
						`${task.level}. ${complexityLevels[task.level].name}`,
						`${completion.toFixed(1)}%`,
						zone
					];
				});
				
				const documentDefinition = {
					content: [
						{
							text: '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ',
							style: 'header'
						},
						{
							text: `${appData.test.subject}, ${appData.test.class}`,
							style: 'subheader'
						},
						{
							text: `–¢–µ–º–∞: ${appData.test.theme}`,
							style: 'normal'
						},
						{
							text: `–î–∞—Ç–∞: ${new Date(appData.test.testDate).toLocaleDateString()}`,
							style: 'normal'
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:',
							style: 'sectionHeader'
						},
						{
							ul: [
								`–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${avgScore.toFixed(1)}`,
								`–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å: ${successRate.toFixed(1)}%`,
								`–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π: ${qualityRate.toFixed(1)}%`,
								`–û—Ü–µ–Ω–∫–∞ 5: ${gradeCounts[5]} —É—á–∞—â–∏—Ö—Å—è`,
								`–û—Ü–µ–Ω–∫–∞ 4: ${gradeCounts[4]} —É—á–∞—â–∏—Ö—Å—è`, 
								`–û—Ü–µ–Ω–∫–∞ 3: ${gradeCounts[3]} —É—á–∞—â–∏—Ö—Å—è`,
								`–û—Ü–µ–Ω–∫–∞ 2: ${gradeCounts[2]} —É—á–∞—â–∏—Ö—Å—è`
							],
							style: 'list'
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π:',
							style: 'sectionHeader'
						},
						{
							table: {
								headerRows: 1,
								widths: [15, '*', 40, 40, 40],
								body: [
									[
										{text: '‚Ññ', style: 'tableHeader'},
										{text: '–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è', style: 'tableHeader'},
										{text: '–£—Ä–æ–≤–µ–Ω—å', style: 'tableHeader'},
										{text: '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', style: 'tableHeader'},
										{text: '–ó–æ–Ω–∞', style: 'tableHeader'}
									],
									...taskAnalysis
								]
							}
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:',
							style: 'sectionHeader'
						},
						{
							text: generateKeyConclusionsText(),
							style: 'conclusions'
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:',
							style: 'sectionHeader'
						},
						{
							ul: [
								'–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏',
								'–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è',
								'–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º',
								'–ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ä–∞–±–æ—Ç—ã',
								'–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏'
							],
							style: 'list'
						}
					],
					styles: {
						header: {
							fontSize: 18,
							bold: true,
							alignment: 'center',
							margin: [0, 0, 0, 10]
						},
						subheader: {
							fontSize: 14,
							bold: true,
							alignment: 'center',
							margin: [0, 0, 0, 10]
						},
						sectionHeader: {
							fontSize: 12,
							bold: true,
							margin: [0, 10, 0, 5]
						},
						normal: {
							fontSize: 10,
							margin: [0, 2, 0, 2]
						},
						list: {
							fontSize: 10,
							margin: [0, 5, 0, 5]
						},
						conclusions: {
							fontSize: 10,
							margin: [0, 5, 0, 5],
							lineHeight: 1.3
						},
						tableHeader: {
							bold: true,
							fontSize: 8,
							fillColor: '#34495e',
							color: 'white'
						},
						spacer: {
							margin: [0, 10, 0, 0]
						}
					},
					defaultStyle: {
						font: 'Helvetica'
					}
				};
				
				pdfMake.createPdf(documentDefinition).download(`–æ—Ç—á–µ—Ç_${appData.test.subject}_${new Date().toLocaleDateString()}.pdf`);
				showNotification('PDF —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF: ' + error.message, 'error');
			}
		}


        function exportToPDF() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ jsPDF –∑–∞–≥—Ä—É–∂–µ–Ω
				if (typeof jspdf === 'undefined') {
					showNotification('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ jsPDF –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'error');
					return;
				}

				const { jsPDF } = window.jspdf;
				const doc = new jsPDF();
				
				// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
				doc.setFont('helvetica');
				
				// –ó–∞–≥–æ–ª–æ–≤–æ–∫
				doc.setFontSize(16);
				doc.text(`–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: ${appData.test.subject}, ${appData.test.class}`, 20, 20);
				doc.setFontSize(12);
				doc.text(`–¢–µ–º–∞: ${appData.test.theme}`, 20, 30);
				doc.text(`–î–∞—Ç–∞: ${new Date(appData.test.testDate).toLocaleDateString()}`, 20, 37);
				
				// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
				let y = 50;
				doc.setFontSize(14);
				doc.text('–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:', 20, y);
				y += 10;
				
				doc.setFontSize(10);
				
				// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
				const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
				const grades = totalScores.map(score => calculateGrade(score));
				const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
				const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
				const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
				
				doc.text(`‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${avgScore.toFixed(1)}`, 25, y); y += 7;
				doc.text(`‚Ä¢ –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å: ${successRate.toFixed(1)}%`, 25, y); y += 7;
				doc.text(`‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π: ${qualityRate.toFixed(1)}%`, 25, y); y += 7;
				
				// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
				const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
				grades.forEach(grade => gradeCounts[grade]++);
				
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 5: ${gradeCounts[5]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 4: ${gradeCounts[4]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 3: ${gradeCounts[3]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 2: ${gradeCounts[2]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
				if (y > 250) {
					doc.addPage();
					y = 20;
				}
				
				// –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π
				doc.setFontSize(14);
				doc.text('–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π:', 20, y);
				y += 10;
				
				doc.setFontSize(8); // –£–º–µ–Ω—å—à–∞–µ–º —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
				
				// –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
				doc.text('‚Ññ', 25, y);
				doc.text('–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è', 35, y);
				doc.text('–£—Ä–æ–≤–µ–Ω—å', 100, y);
				doc.text('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', 140, y);
				doc.text('–ó–æ–Ω–∞', 180, y);
				
				y += 5;
				doc.line(20, y, 190, y);
				y += 5;
				
				// –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏–π
				appData.tasks.forEach((task, index) => {
					if (y > 270) {
						doc.addPage();
						y = 20;
						// –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
						doc.setFontSize(8);
						doc.text('‚Ññ', 25, y);
						doc.text('–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è', 35, y);
						doc.text('–£—Ä–æ–≤–µ–Ω—å', 100, y);
						doc.text('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', 140, y);
						doc.text('–ó–æ–Ω–∞', 180, y);
						y += 5;
						doc.line(20, y, 190, y);
						y += 5;
					}
					
					const completion = calculateTaskCompletion(index);
					let zone = '';
					if (completion >= 90) zone = '–û—Ç–ª–∏—á–Ω–∞—è';
					else if (completion >= 60) zone = '–ó–µ–ª–µ–Ω–∞—è';
					else if (completion >= 30) zone = '–ñ–µ–ª—Ç–∞—è';
					else zone = '–ö—Ä–∞—Å–Ω–∞—è';
					
					doc.text(`${index + 1}`, 25, y);
					
					// –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
					let taskType = task.type;
					if (taskType.length > 25) {
						taskType = taskType.substring(0, 22) + '...';
					}
					doc.text(taskType, 35, y);
					
					doc.text(`${task.level}. ${complexityLevels[task.level].name}`, 100, y);
					doc.text(`${completion.toFixed(1)}%`, 140, y);
					doc.text(zone, 180, y);
					
					y += 6;
				});
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
				doc.addPage();
				y = 20;
				
				doc.setFontSize(14);
				doc.text('–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:', 20, y);
				y += 15;
				
				doc.setFontSize(10);
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—ã–≤–æ–¥—ã
				const conclusions = generateKeyConclusionsText();
				const conclusionLines = doc.splitTextToSize(conclusions, 170);
				conclusionLines.forEach(line => {
					if (y > 270) {
						doc.addPage();
						y = 20;
					}
					doc.text(line, 20, y);
					y += 7;
				});
				
				y += 10;
				
				// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
				doc.setFontSize(12);
				doc.text('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:', 20, y);
				y += 10;
				
				doc.setFontSize(10);
				const recommendations = [
					'‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏',
					'‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏',
					'‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è',
					'‚Ä¢ –ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö',
					'‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏'
				];
				
				recommendations.forEach(rec => {
					if (y > 270) {
						doc.addPage();
						y = 20;
					}
					doc.text(rec, 25, y);
					y += 7;
				});
				
				// –§—É—Ç–µ—Ä
				doc.setFontSize(8);
				doc.text(`–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()}`, 20, 280);
				doc.text('–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', 120, 280);
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
				doc.save(`–æ—Ç—á–µ—Ç_${appData.test.subject}_${new Date().toLocaleDateString()}.pdf`);
				showNotification('PDF —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF: ' + error.message, 'error');
			}
		}

        // 2. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø showSmartRecommendations
		function showSmartRecommendations() {
			const recommendations = generateSmartRecommendations();
			
			let html = '<h3>ü§ñ –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>';
			
			if (recommendations.length === 0) {
				html += '<div class="recommendation-card"><p>‚úÖ –í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –Ω–æ—Ä–º–µ. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!</p></div>';
			} else {
				recommendations.forEach(rec => {
					html += `
						<div class="smart-recommendation recommendation-${rec.type}">
							<strong>${rec.title}</strong>
							<p>${rec.message}</p>
							<small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${getActionDescription(rec.action)}</small>
						</div>
					`;
				});
			}
			
			document.getElementById('smartRecommendationsContainer').innerHTML = html;
		}

        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø generateSmartRecommendations
		function generateSmartRecommendations() {
			const analysis = analyzePerformancePatterns();
			const totalErrors = appData.errors.length;
			
			// –ü–†–û–í–ï–†–Ø–ï–ú, –ï–°–¢–¨ –õ–ò –û–®–ò–ë–ö–ò
			let recommendations = [];
			
			// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–æ–Ω
			if (analysis.lowCompletionTasks && analysis.lowCompletionTasks.length > 0) {
				recommendations.push({
					type: 'critical',
					title: '–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è',
					message: `–ó–∞–¥–∞–Ω–∏—è ${analysis.lowCompletionTasks.map(t => t.index + 1).join(', ')} —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ < 50%)`,
					action: 'review_content'
				});
			}
			
			// –ê–Ω–∞–ª–∏–∑ –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞
			if (analysis.atRiskStudents && analysis.atRiskStudents.length > 0) {
				recommendations.push({
					type: 'warning',
					title: '–ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–∞',
					message: `${analysis.atRiskStudents.length} —É—á–∞—â–∏—Ö—Å—è —Ç—Ä–µ–±—É—é—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞`,
					action: 'individual_work'
				});
			}
			
			// –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ (–¢–ï–ü–ï–†–¨ –° –ü–†–û–í–ï–†–ö–û–ô)
			if (analysis.commonErrors && analysis.commonErrors.length > 0 && totalErrors > 0) {
				const topError = analysis.commonErrors[0];
				const percentage = Math.round((topError.count / totalErrors) * 100);
				
				recommendations.push({
					type: 'info',
					title: '–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏',
					message: `–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç ${errorTypes[topError.type]?.name?.toLowerCase() || topError.type} (${topError.count} —Å–ª—É—á–∞–µ–≤, ${percentage}% –≤—Å–µ—Ö –æ—à–∏–±–æ–∫)`,
					action: 'error_analysis'
				});
			}
			
			return recommendations;
		}

        // 3. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø analyzePerformancePatterns
		function analyzePerformancePatterns() {
			const result = {
				lowCompletionTasks: [],
				atRiskStudents: [],
				commonErrors: []
			};
			
			// –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π —Å –Ω–∏–∑–∫–æ–π —Ä–µ—à–∞–µ–º–æ—Å—Ç—å—é
			if (appData.tasks && appData.tasks.length > 0) {
				result.lowCompletionTasks = appData.tasks
					.map((task, index) => ({ 
						task, 
						index, 
						completion: calculateTaskCompletion(index) 
					}))
					.filter(t => t.completion < 50)
					.slice(0, 3);
			}
			
			// –ê–Ω–∞–ª–∏–∑ —É—á–∞—â–∏—Ö—Å—è –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞
			if (appData.results && appData.results.length > 0) {
				const totalScores = appData.results.map(scores => 
					scores.reduce((sum, score) => sum + score, 0)
				);
				
				result.atRiskStudents = appData.students
					.map((student, index) => ({ 
						student, 
						index, 
						score: totalScores[index] 
					}))
					.filter(s => s.score < appData.test.criteria[3].min)
					.slice(0, 5);
			}
			
			// –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ (–° –ó–ê–©–ò–¢–û–ô –û–¢ –ü–£–°–¢–û–ì–û –ú–ê–°–°–ò–í–ê)
			if (appData.errors && appData.errors.length > 0) {
				const errorStats = {};
				
				appData.errors.forEach(error => {
					if (error && error.type) {
						errorStats[error.type] = (errorStats[error.type] || 0) + 1;
					}
				});
				
				result.commonErrors = Object.entries(errorStats)
					.sort(([,a], [,b]) => b - a)
					.slice(0, 2)
					.map(([type, count]) => ({ type, count }));
			}
			
			return result;
		}


		// –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –§–£–ù–ö–¶–ò–Æ –î–õ–Ø –ë–ï–ó–û–ü–ê–°–ù–û–ì–û –î–û–°–¢–£–ü–ê –ö –î–ê–ù–ù–´–ú
		function safeGet(object, path, defaultValue = null) {
			try {
				const value = path.split('.').reduce((obj, key) => 
					obj && obj[key] !== undefined ? obj[key] : undefined, 
					object
				);
				return value !== undefined ? value : defaultValue;
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:', error);
				return defaultValue;
			}
		}

		// –ü–ï–†–ï–ü–ò–®–ï–ú –ù–ï–ö–û–¢–û–†–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò –° –ó–ê–©–ò–¢–û–ô:
        function getActionDescription(action) {
            const actions = {
                'review_content': '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞',
                'individual_work': '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —É—á–∞—â–∏–º–∏—Å—è',
                'error_analysis': '–ê–Ω–∞–ª–∏–∑ –∏ —Ä–∞–∑–±–æ—Ä —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫'
            };
            return actions[action] || action;
        }

        // 7. –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–ê–¶–ò–Ø
        function initAdvancedSearch() {
            const html = `
                <div class="search-filters">
                    <div class="form-group">
                        <label>–ü–æ–∏—Å–∫ –ø–æ —É—á–∞—â–∏–º—Å—è:</label>
                        <input type="text" id="studentSearch" placeholder="–§–∞–º–∏–ª–∏—è –∏–ª–∏ –∏–º—è..." onkeyup="filterStudents()">
                    </div>
                    
                    <div class="form-group">
                        <label>–û—Ü–µ–Ω–∫–∞:</label>
                        <select id="gradeFilter" onchange="filterStudents()">
                            <option value="">–í—Å–µ –æ—Ü–µ–Ω–∫–∏</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–£—Ä–æ–≤–µ–Ω—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                        <select id="performanceFilter" onchange="filterStudents()">
                            <option value="">–í—Å–µ</option>
                            <option value="high">–í—ã—Å–æ–∫–∏–π (&gt;80%)</option>
                            <option value="medium">–°—Ä–µ–¥–Ω–∏–π (50-80%)</option>
                            <option value="low">–ù–∏–∑–∫–∏–π (&lt;50%)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–∏–ø—ã –æ—à–∏–±–æ–∫:</label>
                        <select id="errorFilter" onchange="filterStudents()">
                            <option value="">–í—Å–µ</option>
                            ${Object.entries(errorTypes).map(([key, data]) => 
                                `<option value="${key}">${data.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
                
                <div id="filteredResults" style="max-height: 400px; overflow-y: auto;"></div>
            `;
            
            showModal('–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫', html);
            filterStudents();
        }

        function filterStudents() {
            const searchText = document.getElementById('studentSearch').value.toLowerCase();
            const gradeFilter = document.getElementById('gradeFilter').value;
            const performanceFilter = document.getElementById('performanceFilter').value;
            const errorFilter = document.getElementById('errorFilter').value;
            
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            
            const filtered = appData.students
                .map((student, index) => {
                    const totalScore = appData.results[index].reduce((sum, score) => sum + score, 0);
                    const grade = calculateGrade(totalScore);
                    const percentage = (totalScore / maxPossible) * 100;
                    const studentErrors = appData.errors.filter(e => e.studentIndex === index);
                    
                    return { student, index, totalScore, grade, percentage, studentErrors };
                })
                .filter(data => {
                    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–∫—Å—Ç—É
                    if (searchText && !data.student.toLowerCase().includes(searchText)) return false;
                    
                    // –§–∏–ª—å—Ç—Ä –ø–æ –æ—Ü–µ–Ω–∫–µ
                    if (gradeFilter && data.grade != gradeFilter) return false;
                    
                    // –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    if (performanceFilter === 'high' && data.percentage < 80) return false;
                    if (performanceFilter === 'medium' && (data.percentage < 50 || data.percentage >= 80)) return false;
                    if (performanceFilter === 'low' && data.percentage >= 50) return false;
                    
                    // –§–∏–ª—å—Ç—Ä –ø–æ –æ—à–∏–±–∫–∞–º
                    if (errorFilter && !data.studentErrors.some(e => e.type === errorFilter)) return false;
                    
                    return true;
                });
            
            displayFilteredResults(filtered);
        }

        function displayFilteredResults(filtered) {
            const container = document.getElementById('filteredResults');
            
            if (filtered.length === 0) {
                container.innerHTML = '<p>–£—á–∞—â–∏–µ—Å—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }
            
            let html = '<table style="width: 100%;"><thead><tr><th>–£—á–∞—â–∏–π—Å—è</th><th>–ë–∞–ª–ª—ã</th><th>–û—Ü–µ–Ω–∫–∞</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–û—à–∏–±–∫–∏</th></tr></thead><tbody>';
            
            filtered.forEach(data => {
                html += `
                    <tr>
                        <td><strong>${data.student}</strong></td>
                        <td>${data.totalScore}</td>
                        <td class="grade-${data.grade}">${data.grade}</td>
                        <td>${data.percentage.toFixed(1)}%</td>
                        <td>${data.studentErrors.length > 0 ? 
                            data.studentErrors.map(e => `<span class="error-type error-${e.type}">${errorTypes[e.type].name}</span>`).join(' ') : 
                            '‚Äî'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // 8. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –í–ù–ï–®–ù–ò–ú–ò –°–ò–°–¢–ï–ú–ê–ú–ò
        function exportForEJournal() {
            const data = {
                subject: appData.test.subject,
                class: appData.test.class,
                workTheme: appData.test.theme,
                workDate: appData.test.testDate,
                results: appData.students.map((student, index) => ({
                    student: student,
                    score: appData.results[index].reduce((sum, score) => sum + score, 0),
                    grade: calculateGrade(appData.results[index].reduce((sum, score) => sum + score, 0)),
                    comment: generateStudentComment(index)
                }))
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π_–¥–Ω–µ–≤–Ω–∏–∫_${appData.test.subject}_${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('–î–∞–Ω–Ω—ã–µ –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–Ω–µ–≤–Ω–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        function generateStudentComment(studentIndex) {
            const totalScore = appData.results[studentIndex].reduce((sum, score) => sum + score, 0);
            const grade = calculateGrade(totalScore);
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            const percentage = (totalScore / maxPossible) * 100;
            
            if (percentage >= 80) return '–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            if (percentage >= 60) return '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            if (percentage >= 40) return '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            return '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞';
        }

        // ==================== –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ ====================


        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
			document.querySelectorAll('.tab-content').forEach(tab => {
				tab.classList.remove('active');
			});
			
			// –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
			document.querySelectorAll('.tab-btn').forEach(btn => {
				btn.classList.remove('active');
			});
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
			document.getElementById(tabName).classList.add('active');
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
			event.target.classList.add('active');
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
			if (tabName === 'analytics') {
				updateAnalytics();
			} else if (tabName === 'visualization') {
				updateVisualization();
			} else if (tabName === 'recommendations') {
				updateRecommendations();
			} else if (tabName === 'export') {
				updateReportPreview();
			}
			
        }
		function useTemplate(encodedData, fileName) {
			try {
				const templateData = JSON.parse(decodeURIComponent(encodedData));
				const keepStudents = document.getElementById('keepStudents')?.checked;
				const keepSettings = document.getElementById('keepSettings')?.checked;
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
				const currentStudents = [...appData.students];
				const currentResults = [...appData.results];
				const currentSettings = { 
					class: appData.test.class, 
					testDate: appData.test.testDate 
				};
				
				// –ó–∞–º–µ–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
				appData.test = { ...templateData.test };
				appData.tasks = [...templateData.tasks];
				
				// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				if (keepSettings) {
					appData.test.class = currentSettings.class;
					appData.test.testDate = currentSettings.testDate;
				}
				
				// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—á–∞—â–∏—Ö—Å—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				if (keepStudents && currentStudents.length > 0) {
					appData.students = currentStudents;
					appData.results = currentResults.map(studentResults => 
						new Array(appData.tasks.length).fill(0)
					);
				} else {
					appData.students = templateData.students || [];
					appData.results = templateData.results || [];
				}
				
				// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã
				robustSyncData();
				
				// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ templates —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
				if (!appData.templates) {
					appData.templates = {
						loadedTemplates: [],
						lastTemplatePath: "",
						lastTemplateName: "",
						availableSubjects: []
					};
				}
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∞–±–ª–æ–Ω–µ
				appData.templates.lastTemplatePath = fileName;
				appData.templates.lastTemplateName = templateData.test.theme || "–®–∞–±–ª–æ–Ω –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º
				saveData();
				renderAll();
				hideModal();
				
				showNotification(`‚úÖ –®–∞–±–ª–æ–Ω "${templateData.test.theme || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}" —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!`, 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —à–∞–±–ª–æ–Ω–∞:', error);
				showNotification('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —à–∞–±–ª–æ–Ω–∞: ' + error.message, 'error');
			}
		}
		
		// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —à–∞–±–ª–æ–Ω–∞
		function hasLastTemplate() {
			return appData.templates && 
				   appData.templates.lastTemplatePath && 
				   appData.templates.lastTemplatePath.trim() !== "";
		}

		// –ü–æ–ª—É—á–∏—Ç—å –∏–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —à–∞–±–ª–æ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ
		function getLastTemplateName() {
			if (appData.templates && appData.templates.lastTemplateName) {
				return appData.templates.lastTemplateName;
			}
			return "";
		}

		
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
		function saveData() {
			// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ templates —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
			if (!appData.templates) {
				appData.templates = {
					loadedTemplates: [],
					lastTemplatePath: "",
					lastTemplateName: "",
					availableSubjects: []
				};
			}
			localStorage.setItem('testAnalyticsData', JSON.stringify(appData));
			return window.ErrorHandler.safeExecute(() => {
				localStorage.setItem('testAnalyticsData', JSON.stringify(appData));
				console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
			}, 'saveData');
		}

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadData() {
			try {
				const saved = localStorage.getItem('testAnalyticsData');
				if (saved) {
					const parsed = JSON.parse(saved);
					
					// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å
					appData = {
						...appData, // –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
						...parsed,  // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
						test: {
							...appData.test, // –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
							...parsed.test   // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
						}
					};
					
					// –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç
					if (!appData.test.criteriaType) appData.test.criteriaType = 'points';
					if (!appData.test.criteriaSystem) appData.test.criteriaSystem = 'standard';
					if (!appData.test.customCriteria) appData.test.customCriteria = [];
					if (!appData.test.criteriaCount) appData.test.criteriaCount = 4;
					if (!appData.test.criteriaScale) appData.test.criteriaScale = '2-5';
					if (!appData.psychologyFeatures) appData.psychologyFeatures = [];
					
					console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
				}
			} catch (error) {
				//console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
				return window.ErrorHandler.safeExecute(() => {
					const saved = localStorage.getItem('testAnalyticsData');
					if (saved) {
					  appData = JSON.parse(saved);
					  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
					}
				}, 'loadData');
			}
		}

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã
        function updateWorkType() {
            appData.test.workType = document.getElementById('workType').value;
            updateCriteriaForWorkType();
            appData.tasks = [];
            saveData();
            renderAll();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç
        function updateCriteriaForWorkType() {
            const criteria = appData.test.criteria;
			const workType = appData.test.workType;
            
            switch(appData.test.workType) {
                case 'oge':
                    criteria[5] = { min: 22, max: 32 };
                    criteria[4] = { min: 15, max: 21 };
                    criteria[3] = { min: 8, max: 14 };
                    criteria[2] = { min: 0, max: 7 };
                    break;
                case 'ege':
                    criteria[5] = { min: 27, max: 31 };
                    criteria[4] = { min: 20, max: 26 };
                    criteria[3] = { min: 12, max: 19 };
                    criteria[2] = { min: 0, max: 11 };
                    break;
                case 'vpr':
                    criteria[5] = { min: 18, max: 20 };
                    criteria[4] = { min: 15, max: 17 };
                    criteria[3] = { min: 10, max: 14 };
                    criteria[2] = { min: 0, max: 9 };
                    break;
                case 'func_literacy':
                    criteria[5] = { min: 90, max: 100 };
                    criteria[4] = { min: 75, max: 89 };
                    criteria[3] = { min: 50, max: 74 };
                    criteria[2] = { min: 0, max: 49 };
                    break;
				case 'psychology':
					// –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —à–∫–∞–ª—ã
					appData.test.criteriaScale = 'points'; // –∏–ª–∏ 'percentage', 'levels'
					appData.test.criteriaSystem = 'custom'; // –∏–ª–∏ 'standard'
					
					// –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
					if (!appData.test.psychologySettings) {
						appData.test.psychologySettings = {
							scaleType: '1-5', // '1-5', '1-10', 'percentage', 'levels'
							levels: [
								{ name: "–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å", min: 0, max: 25, color: "#e74c3c" },
								{ name: "–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å", min: 26, max: 50, color: "#f39c12" },
								{ name: "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ", min: 51, max: 75, color: "#3498db" },
								{ name: "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å", min: 76, max: 100, color: "#27ae60" }
							],
							usePercentages: true,
							customLabels: {
								2: "–ù–∏–∑–∫–∏–π",
								3: "–°—Ä–µ–¥–Ω–∏–π", 
								4: "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ",
								5: "–í—ã—Å–æ–∫–∏–π"
							}
						};
					}
					break;
                default:
                    break;
            }
            
            renderTestSettings();
        }

		function renderPsychologyCriteria() {
			return `
				<h3 class="section-title">üéØ –®–∫–∞–ª–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è (–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è)</h3>
				
				<div class="form-group">
					<label>–¢–∏–ø —à–∫–∞–ª—ã:</label>
					<select id="psychologyScaleType" onchange="updatePsychologyScale()">
						<option value="1-5">–ë–∞–ª–ª—ã 1-5</option>
						<option value="1-10">–ë–∞–ª–ª—ã 1-10</option>
						<option value="percentage">–ü—Ä–æ—Ü–µ–Ω—Ç—ã (%)</option>
						<option value="levels">–£—Ä–æ–≤–Ω–∏ (–Ω–∏–∑–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π/–≤—ã—Å–æ–∫–∏–π)</option>
						<option value="stens">–°—Ç–µ–Ω—ã (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 10)</option>
						<option value="t-scores">–¢-–±–∞–ª–ª—ã</option>
						<option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è —à–∫–∞–ª–∞</option>
					</select>
				</div>
				
				<div id="psychologyCriteriaContainer">
					<!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ -->
				</div>
				
				<div class="form-group">
					<label>–ú–µ—Ç–æ–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏:</label>
					<select id="interpretationMethod">
						<option value="normative">–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–æ–π)</option>
						<option value="ipsative">–ò–ø—Å–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–∞–º–∏–º —Å–æ–±–æ–π)</option>
						<option value="criterion">–ö—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏)</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å):</label>
					<input type="text" id="normGroup" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–¥—Ä–æ—Å—Ç–∫–∏ 14-16 –ª–µ—Ç, n=150">
				</div>
			`;
		}

		function updatePsychologyScale() {
			const scaleType = document.getElementById('psychologyScaleType').value;
			let html = '';
			
			switch(scaleType) {
				case '1-5':
					html = `
						<div class="criteria-grid">
							${[1,2,3,4,5].map(level => `
								<div class="criteria-item">
									<label>–£—Ä–æ–≤–µ–Ω—å ${level}:</label>
									<input type="number" id="psychologyMin${level}" placeholder="–ú–∏–Ω" value="${(level-1)*20}">
									<input type="number" id="psychologyMax${level}" placeholder="–ú–∞–∫—Å" value="${level*20}">
									<input type="text" id="psychologyLabel${level}" placeholder="–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è" 
										   value="${['–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π', '–ù–∏–∑–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–í—ã—Å–æ–∫–∏–π', '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π'][level-1]}">
								</div>
							`).join('')}
						</div>
					`;
					break;
					
				case 'percentage':
					html = `
						<div class="criteria-grid">
							<div class="criteria-item">
								<label>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π (&lt;10%):</label>
								<input type="number" max="100" value="10" readonly>
							</div>
							<div class="criteria-item">
								<label>–ù–∏–∑–∫–∏–π (10-25%):</label>
								<input type="number" max="100" value="10" min="0">
								<input type="number" max="100" value="25" min="0">
							</div>
							<div class="criteria-item">
								<label>–°—Ä–µ–¥–Ω–∏–π (25-75%):</label>
								<input type="number" max="100" value="25" min="0">
								<input type="number" max="100" value="75" min="0">
							</div>
							<div class="criteria-item">
								<label>–í—ã—Å–æ–∫–∏–π (&gt;75%):</label>
								<input type="number" max="100" value="75" readonly>
							</div>
						</div>
					`;
					break;
					
				case 'levels':
					html = `
						<div class="criteria-grid">
							<div class="criteria-item">
								<label>üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å:</label>
								<input type="number" placeholder="–ú–∏–Ω %" value="0">
								<input type="number" placeholder="–ú–∞–∫—Å %" value="30">
							</div>
							<div class="criteria-item">
								<label>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:</label>
								<input type="number" placeholder="–ú–∏–Ω %" value="31">
								<input type="number" placeholder="–ú–∞–∫—Å %" value="70">
							</div>
							<div class="criteria-item">
								<label>üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å:</label>
								<input type="number" placeholder="–ú–∏–Ω %" value="71">
								<input type="number" placeholder="–ú–∞–∫—Å %" value="100">
							</div>
						</div>
					`;
					break;
					
				case 'stens':
					html = `
						<p><strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —à–∫–∞–ª–∞ —Å—Ç–µ–Ω–æ–≤ (1-10):</strong></p>
						<div class="criteria-grid">
							${[1,2,3,4,5,6,7,8,9,10].map(sten => `
								<div class="criteria-item">
									<label>–°—Ç–µ–Ω ${sten}:</label>
									<input type="number" value="${(sten-1)*10}" readonly>
									<input type="number" value="${sten*10}" readonly>
									<small>${getStenInterpretation(sten)}</small>
								</div>
							`).join('')}
						</div>
					`;
					break;
			}
			
			document.getElementById('psychologyCriteriaContainer').innerHTML = html;
		}

		function updatePsychologyAnalysis() {
			let html = '<h3 class="section-title">üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>';
			
			// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculatePsychologyAverage()}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateStandardDeviation()}œÉ</div>
						<div class="stat-label">–°—Ç–∞–Ω–¥. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculatePsychologyReliability()}</div>
						<div class="stat-label">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${identifyExtremeScores().length}</div>
						<div class="stat-label">–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</div>
					</div>
				</div>
			`;
			
			// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
			html += generatePsychologyLevelsDistribution();
			
			// –ü—Ä–æ—Ñ–∏–ª—å –≥—Ä—É–ø–ø—ã
			html += generateGroupProfile();
			
			// –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
			html += generateIndividualProfiles();
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
			html += generatePsychologyRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		function generatePsychologyLevelsDistribution() {
			const levels = appData.test.psychologySettings?.levels || [
				{ name: "–ù–∏–∑–∫–∏–π", min: 0, max: 40, color: "#e74c3c" },
				{ name: "–°—Ä–µ–¥–Ω–∏–π", min: 41, max: 70, color: "#f39c12" },
				{ name: "–í—ã—Å–æ–∫–∏–π", min: 71, max: 100, color: "#27ae60" }
			];
			
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			const levelCounts = {};
			levels.forEach(level => {
				levelCounts[level.name] = totalScores.filter(score => 
					score >= level.min && score <= level.max
				).length;
			});
			
			let html = '<h4>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(levelCounts).forEach(([name, count]) => {
				const level = levels.find(l => l.name === name);
				const percentage = (count / totalScores.length) * 100;
				
				html += `
					<div class="kpi-card" style="border-left-color: ${level.color}">
						<div class="kpi-value">${count}</div>
						<div class="kpi-label">${name}</div>
						<small>${percentage.toFixed(1)}% –≥—Ä—É–ø–ø—ã</small>
					</div>
				`;
			});
			
			html += '</div>';
			
			return html;
		}

		function updatePsychologyVisualization() {
			let html = `
				<div class="chart-row">
					<div class="chart-container" style="height: 400px;">
						<h3>üìà –ü—Ä–æ—Ñ–∏–ª—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≥—Ä—É–ø–ø—ã</h3>
						<canvas id="psychologyProfileChart"></canvas>
						<div class="chart-legend">
							<div class="legend-item">
								<div class="legend-color" style="background-color: #c0392b"></div>
								<span>–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π (&lt;30%)</span>
							</div>
							<div class="legend-item">
								<div class="legend-color" style="background-color: #f39c12"></div>
								<span>–°—Ä–µ–¥–Ω–∏–π (50-70%)</span>
							</div>
							<div class="legend-item">
								<div class="legend-color" style="background-color: #27ae60"></div>
								<span>–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π (&gt;85%)</span>
							</div>
						</div>
					</div>
					
					<div class="chart-container" style="height: 400px;">
						<h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥—Ä—É–ø–ø—ã</h3>
						<canvas id="normDistributionChart"></canvas>
						<div class="chart-legend">
							<div class="legend-item">
								<div class="legend-color" style="background-color: rgba(52, 152, 219, 0.7)"></div>
								<span>–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</span>
							</div>
							<div class="legend-item">
								<div class="legend-color" style="background-color: rgba(231, 76, 60, 0.8)"></div>
								<span>–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</span>
							</div>
						</div>
					</div>
				</div>
				
				<div class="chart-container" style="height: 500px;">
					<h3>üéØ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π (—Ç–æ–ø-3 –∏ –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)</h3>
					<canvas id="psychologyRadarChart"></canvas>
					<small>–°–ø–ª–æ—à–Ω—ã–µ –ª–∏–Ω–∏–∏ - –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–µ - –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</small>
				</div>
				
				<div class="chart-container">
					<h3>üë• –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Ä–∞–∑–≤–∏—Ç–∏—è</h3>
					<div id="individualProfiles" style="max-height: 400px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 8px;">
						<!-- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
					</div>
				</div>
			`;
			
			document.getElementById('specializedCharts').innerHTML = html;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ HTML
			setTimeout(() => {
				initPsychologyCharts();
				updateIndividualProfiles();
			}, 100);
		}

		function updateIndividualProfiles() {
			const container = document.getElementById('individualProfiles');
			if (!container) return;
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ –±–∞–ª–ª—ã
			const totalScores = appData.results.map((scores, index) => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				const percentage = (total / maxPossible) * 100;
				
				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
				const levels = appData.test.psychologySettings?.levels || [];
				let levelName = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
				let levelColor = '#7f8c8d';
				
				for (let level of levels) {
					if (percentage >= level.min && percentage <= level.max) {
						levelName = level.name;
						levelColor = level.color;
						break;
					}
				}
				
				// –ù–∞—Ö–æ–¥–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
				const features = (appData.psychologyFeatures || []).filter(f => f.studentIndex === index);
				
				return {
					name: appData.students[index],
					percentage: percentage,
					levelName: levelName,
					levelColor: levelColor,
					features: features
				};
			});
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
			totalScores.sort((a, b) => b.percentage - a.percentage);
			
			let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">';
			
			totalScores.forEach(student => {
				html += `
					<div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 4px solid ${student.levelColor};">
						<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
							<strong>${student.name}</strong>
							<span style="background: ${student.levelColor}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px;">
								${student.levelName}
							</span>
						</div>
						
						<div style="margin: 10px 0;">
							<div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
								<span>–û–±—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å:</span>
								<strong>${student.percentage.toFixed(1)}%</strong>
							</div>
							<div style="height: 8px; background: #ecf0f1; border-radius: 4px; margin-top: 5px; overflow: hidden;">
								<div style="height: 100%; width: ${student.percentage}%; background: ${student.levelColor}; border-radius: 4px;"></div>
							</div>
						</div>
						
						${student.features.length > 0 ? `
							<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
								<small style="color: #666; display: block; margin-bottom: 5px;">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</small>
								${student.features.map(feature => `
									<span style="display: inline-block; background: #e8f4fc; color: #3498db; font-size: 11px; padding: 2px 6px; border-radius: 10px; margin: 2px;">
										${feature.name}
									</span>
								`).join('')}
							</div>
						` : ''}
					</div>
				`;
			});
			
			html += '</div>';
			container.innerHTML = html;
		}

		function initPsychologyCharts() {
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
			if (window.psychologyProfileChartInstance) {
				window.psychologyProfileChartInstance.destroy();
			}
			if (window.normDistributionChartInstance) {
				window.normDistributionChartInstance.destroy();
			}
			if (window.radarChartInstance) {
				window.radarChartInstance.destroy();
			}
			
			// 1. –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ñ–∏–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
			const profileCtx = document.getElementById('psychologyProfileChart').getContext('2d');
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º
			const dimensions = appData.test.psychologySettings?.dimensions || [
				{ id: 'dim1', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 1' },
				{ id: 'dim2', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 2' },
				{ id: 'dim3', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 3' },
				{ id: 'dim4', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 4' }
			];
			
			const dimensionAverages = dimensions.map(dimension => {
				// –ù–∞—Ö–æ–¥–∏–º –∑–∞–¥–∞–Ω–∏—è —ç—Ç–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è
				const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
				if (dimensionTasks.length === 0) return 0;
				
				let totalScore = 0;
				let totalMax = 0;
				
				dimensionTasks.forEach(task => {
					const taskIndex = appData.tasks.indexOf(task);
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					totalScore += actualTotal;
					totalMax += maxScore * appData.results.length;
				});
				
				return totalMax > 0 ? (totalScore / totalMax) * 100 : 0;
			});
			
			// –¶–≤–µ—Ç–∞ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏–π
			const dimensionColors = [
				'rgba(255, 99, 132, 0.8)',
				'rgba(54, 162, 235, 0.8)',
				'rgba(255, 206, 86, 0.8)',
				'rgba(75, 192, 192, 0.8)',
				'rgba(153, 102, 255, 0.8)'
			];
			
			window.psychologyProfileChartInstance = new Chart(profileCtx, {
				type: 'bar',
				data: {
					labels: dimensions.map(d => d.name),
					datasets: [{
						label: '–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –≥—Ä—É–ø–ø—ã (%)',
						data: dimensionAverages,
						backgroundColor: dimensionColors.slice(0, dimensions.length),
						borderColor: dimensionColors.slice(0, dimensions.length).map(color => color.replace('0.8', '1')),
						borderWidth: 2,
						borderRadius: 6,
						barPercentage: 0.6
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: true,
					plugins: {
						legend: {
							display: true,
							position: 'top'
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									const dimension = dimensions[context.dataIndex];
									const value = context.raw;
									let interpretation = '';
									
									if (value < 30) interpretation = ' (–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π)';
									else if (value < 50) interpretation = ' (–ù–∏–∑–∫–∏–π)';
									else if (value < 70) interpretation = ' (–°—Ä–µ–¥–Ω–∏–π)';
									else if (value < 85) interpretation = ' (–í—ã—Å–æ–∫–∏–π)';
									else interpretation = ' (–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π)';
									
									return `${dimension.name}: ${value.toFixed(1)}%${interpretation}`;
								},
								afterLabel: function(context) {
									const dimension = dimensions[context.dataIndex];
									return dimension.description || '';
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							max: 100,
							title: {
								display: true,
								text: '–£—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è (%)',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								callback: function(value) {
									return value + '%';
								},
								font: {
									size: 12
								}
							},
							grid: {
								color: function(context) {
									const value = context.tick.value;
									if (value === 30 || value === 50 || value === 70 || value === 85) {
										return 'rgba(0, 0, 0, 0.3)';
									}
									return 'rgba(0, 0, 0, 0.1)';
								},
								lineWidth: function(context) {
									const value = context.tick.value;
									if (value === 30 || value === 50 || value === 70 || value === 85) {
										return 2;
									}
									return 1;
								}
							}
						},
						x: {
							title: {
								display: true,
								text: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								font: {
									size: 12
								}
							}
						}
					},
					animation: {
						duration: 1000,
						easing: 'easeOutQuart'
					}
				}
			});
			
			// 2. –ì—Ä–∞—Ñ–∏–∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
			const normCtx = document.getElementById('normDistributionChart').getContext('2d');
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ –±–∞–ª–ª—ã –≤—Å–µ—Ö —É—á–∞—â–∏—Ö—Å—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			// –°–æ–∑–¥–∞–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É
			const bins = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
			const histogramData = new Array(bins.length - 1).fill(0);
			
			totalScores.forEach(score => {
				for (let i = 0; i < bins.length - 1; i++) {
					if (score >= bins[i] && score < bins[i + 1]) {
						histogramData[i]++;
						break;
					}
				}
			});
			
			// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
			const mean = totalScores.reduce((a, b) => a + b, 0) / totalScores.length;
			const std = Math.sqrt(totalScores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / totalScores.length);
			
			const normalDistribution = bins.map(bin => {
				return totalScores.length * 0.1 * (1 / (std * Math.sqrt(2 * Math.PI))) * 
					   Math.exp(-0.5 * Math.pow((bin - mean) / std, 2));
			});
			
			window.normDistributionChartInstance = new Chart(normCtx, {
				type: 'bar',
				data: {
					labels: ['0-10%', '10-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-70%', '70-80%', '80-90%', '90-100%'],
					datasets: [
						{
							label: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã',
							data: histogramData,
							backgroundColor: 'rgba(52, 152, 219, 0.7)',
							borderColor: 'rgba(52, 152, 219, 1)',
							borderWidth: 1,
							borderRadius: 4
						},
						{
							label: '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ',
							data: normalDistribution,
							type: 'line',
							fill: false,
							borderColor: 'rgba(231, 76, 60, 0.8)',
							borderWidth: 3,
							pointRadius: 0,
							tension: 0.4
						}
					]
				},
				options: {
					responsive: true,
					maintainAspectRatio: true,
					plugins: {
						legend: {
							display: true,
							position: 'top'
						},
						tooltip: {
							callbacks: {
								title: function(context) {
									return `–î–∏–∞–ø–∞–∑–æ–Ω: ${context[0].label}`;
								},
								label: function(context) {
									if (context.datasetIndex === 0) {
										const count = context.raw;
										const percentage = (count / totalScores.length) * 100;
										return `–£—á–∞—â–∏—Ö—Å—è: ${count} (${percentage.toFixed(1)}%)`;
									} else {
										return `–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: ${context.raw.toFixed(2)}`;
									}
								}
							}
						},
						annotation: {
							annotations: {
								meanLine: {
									type: 'line',
									yMin: 0,
									yMax: Math.max(...histogramData) * 1.1,
									xMin: mean / 10,
									xMax: mean / 10,
									borderColor: 'rgba(46, 204, 113, 0.8)',
									borderWidth: 2,
									borderDash: [5, 5],
									label: {
										display: true,
										content: `–°—Ä–µ–¥–Ω–µ–µ: ${mean.toFixed(1)}%`,
										position: 'center',
										backgroundColor: 'rgba(46, 204, 113, 0.8)',
										color: 'white',
										font: {
											size: 12,
											weight: 'bold'
										}
									}
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							title: {
								display: true,
								text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								font: {
									size: 12
								}
							}
						},
						x: {
							title: {
								display: true,
								text: '–£—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è (%)',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								font: {
									size: 12
								}
							}
						}
					}
				}
			});
			
			// 3. –†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–ª—è —Ç–æ–ø-3 –∏ –Ω–∏–∑–∫–∏—Ö —É—á–∞—â–∏—Ö—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç radarChart)
			const radarCanvas = document.getElementById('psychologyRadarChart');
			if (radarCanvas) {
				const radarCtx = radarCanvas.getContext('2d');
				
				// –í—ã–±–∏—Ä–∞–µ–º 3 –ª—É—á—à–∏—Ö –∏ 3 —Ö—É–¥—à–∏—Ö —É—á–∞—â–∏—Ö—Å—è
				const studentScores = totalScores.map((score, index) => ({
					name: appData.students[index],
					score: score,
					index: index
				}));
				
				studentScores.sort((a, b) => b.score - a.score);
				const topStudents = studentScores.slice(0, 3);
				const bottomStudents = studentScores.slice(-3);
				
				// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è
				const radarLabels = dimensions.map(d => d.name);
				
				const topStudentData = topStudents.map(student => {
					return dimensions.map(dimension => {
						const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
						if (dimensionTasks.length === 0) return 0;
						
						let studentScore = 0;
						let maxScore = 0;
						
						dimensionTasks.forEach(task => {
							const taskIndex = appData.tasks.indexOf(task);
							studentScore += appData.results[student.index][taskIndex] || 0;
							maxScore += task.maxScore;
						});
						
						return maxScore > 0 ? (studentScore / maxScore) * 100 : 0;
					});
				});
				
				const bottomStudentData = bottomStudents.map(student => {
					return dimensions.map(dimension => {
						const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
						if (dimensionTasks.length === 0) return 0;
						
						let studentScore = 0;
						let maxScore = 0;
						
						dimensionTasks.forEach(task => {
							const taskIndex = appData.tasks.indexOf(task);
							studentScore += appData.results[student.index][taskIndex] || 0;
							maxScore += task.maxScore;
						});
						
						return maxScore > 0 ? (studentScore / maxScore) * 100 : 0;
					});
				});
				
				const radarDatasets = [
					...topStudentData.map((data, i) => ({
						label: `–¢–æ–ø ${i+1}: ${topStudents[i].name}`,
						data: data,
						backgroundColor: `rgba(39, 174, 96, ${0.2 + i * 0.1})`,
						borderColor: `rgba(39, 174, 96, ${0.8})`,
						pointBackgroundColor: `rgba(39, 174, 96, 1)`,
						pointBorderColor: '#fff',
						pointHoverRadius: 8,
						borderWidth: 2
					})),
					...bottomStudentData.map((data, i) => ({
						label: `–ù–∏–∑–∫–∏–π ${i+1}: ${bottomStudents[i].name}`,
						data: data,
						backgroundColor: `rgba(231, 76, 60, ${0.2 + i * 0.1})`,
						borderColor: `rgba(231, 76, 60, ${0.8})`,
						pointBackgroundColor: `rgba(231, 76, 60, 1)`,
						pointBorderColor: '#fff',
						pointHoverRadius: 8,
						borderWidth: 2,
						borderDash: [5, 5]
					}))
				];
				
				window.radarChartInstance = new Chart(radarCtx, {
					type: 'radar',
					data: {
						labels: radarLabels,
						datasets: radarDatasets
					},
					options: {
						responsive: true,
						maintainAspectRatio: true,
						plugins: {
							legend: {
								position: 'top',
								labels: {
									font: {
										size: 11
									}
								}
							},
							tooltip: {
								callbacks: {
									label: function(context) {
										return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
									}
								}
							}
						},
						scales: {
							r: {
								beginAtZero: true,
								max: 100,
								ticks: {
									callback: function(value) {
										return value + '%';
									},
									stepSize: 20
								},
								pointLabels: {
									font: {
										size: 11
									}
								}
							}
						}
					}
				});
			}
			
			// 4. –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
			window.addEventListener('resize', function() {
				if (window.psychologyProfileChartInstance) {
					window.psychologyProfileChartInstance.resize();
				}
				if (window.normDistributionChartInstance) {
					window.normDistributionChartInstance.resize();
				}
				if (window.radarChartInstance) {
					window.radarChartInstance.resize();
				}
			});
		}

		function generatePsychologyRecommendations() {
			return `
				<div class="recommendation-card">
					<h4>üí° –ü—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
					
					<p><strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong></p>
					<ul>
						<li>–£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</li>
						<li>–°–æ–æ—Ç–Ω–æ—Å–∏—Ç—å —Å –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º–∏ –Ω–æ—Ä–º–∞–º–∏</li>
						<li>–£—á–∏—Ç—ã–≤–∞—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω–æ-–∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</li>
						<li>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å–µ —Å –¥—Ä—É–≥–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</li>
					</ul>
					
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong></p>
					<ul>
						<li>–î–ª—è —É—á–∞—â–∏—Ö—Å—è —Å –Ω–∏–∑–∫–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</li>
						<li>–î–ª—è –≥—Ä—É–ø–ø—ã: —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∑–∞–Ω—è—Ç–∏—è</li>
						<li>–î–ª—è –ø–µ–¥–∞–≥–æ–≥–æ–≤: –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
						<li>–î–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–µ—Å–µ–¥—ã</li>
					</ul>
				</div>
			`;
		}

		function generatePsychologyReport() {
			return `
				<div class="section">
					<h3>üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ</h3>
					
					<div class="recommendation-card">
						<p><strong>–¶–µ–ª—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:</strong> ${appData.test.goals || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ú–µ—Ç–æ–¥–∏–∫–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
						<p><strong>–í—ã–±–æ—Ä–∫–∞:</strong> ${appData.students.length} —á–µ–ª–æ–≤–µ–∫, ${appData.test.class}</p>
					</div>
					
					<h4>–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:</h4>
					${generatePsychologyConclusions()}
					
					<h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
					${generateDetailedPsychologyRecommendations()}
				</div>
			`;
		}
		
		function calculatePsychologyGrade(totalScore) {
			const settings = appData.test.psychologySettings;
			if (!settings) return calculateGrade(totalScore); // fallback
			
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (totalScore / maxPossible) * 100;
			
			switch(settings.scaleType) {
				case '1-5':
					for (let i = 1; i <= 5; i++) {
						if (percentage >= settings[`min${i}`] && percentage <= settings[`max${i}`]) {
							return i;
						}
					}
					break;
					
				case 'percentage':
					if (percentage < 25) return '–ù–∏–∑–∫–∏–π';
					if (percentage < 50) return '–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ';
					if (percentage < 75) return '–°—Ä–µ–¥–Ω–∏–π';
					if (percentage < 90) return '–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ';
					return '–í—ã—Å–æ–∫–∏–π';
					
				case 'levels':
					const levels = settings.levels || [];
					for (let level of levels) {
						if (percentage >= level.min && percentage <= level.max) {
							return level.name;
						}
					}
					break;
			}
			
			return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
		}		

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadSampleData() {
            const workType = document.getElementById('workType').value;
            
            if (workType === 'vpr') {
                loadVPRSample();
            } else if (workType === 'func_literacy') {
                loadLiteracySample();
            } else if (workType === 'oge') {
                loadOGESample();
            } else if (workType === 'psychology') {
                loadPsychologySample();
			} else if (workType === 'ege') {
                loadEGESample();
            } else {
                loadStandardSample();
            }
        }
		
		function loadPsychologySample() {
			appData = {
				test: {
					subject: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è",
					class: "10–ê",
					testDate: new Date().toISOString().split('T')[0],
					theme: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ (—Ç–µ—Å—Ç MSCEIT)",
					goals: "–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Ä–∞–∑–≤–∏—Ç–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –ø–æ 4 –≤–µ—Ç–≤—è–º: –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π, –ø–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
					workType: "psychology",
					workFormat: "test",
					timeLimit: 40,
					totalStudents: 25,
					presentStudents: 22,
					absentReason: "3 —É—á–∞—â–∏—Ö—Å—è - —É—á–∞—Å—Ç–∏–µ –≤ –æ–ª–∏–º–ø–∏–∞–¥–µ",
					criteria: {
						5: { min: 85, max: 100, label: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π" },
						4: { min: 70, max: 84, label: "–í—ã—Å–æ–∫–∏–π" },
						3: { min: 50, max: 69, label: "–°—Ä–µ–¥–Ω–∏–π" },
						2: { min: 30, max: 49, label: "–ù–∏–∑–∫–∏–π" },
						1: { min: 0, max: 29, label: "–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π" }
					},
					psychologySettings: {
						scaleType: '1-5',
						usePercentages: true,
						interpretationMethod: "normative",
						normGroup: "–ü–æ–¥—Ä–æ—Å—Ç–∫–∏ 15-17 –ª–µ—Ç, n=500",
						reliability: 0.87,
						validity: "–°–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–∞—è –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–Ω–∞—è",
						levels: [
							{ 
								id: 1, 
								name: "–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π", 
								min: 0, 
								max: 29, 
								color: "#c0392b",
								interpretation: "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ –±–∞–∑–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤",
								recommendation: "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞"
							},
							{ 
								id: 2, 
								name: "–ù–∏–∑–∫–∏–π", 
								min: 30, 
								max: 49, 
								color: "#e74c3c",
								interpretation: "–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω–æ–π —Å—Ñ–µ—Ä–µ",
								recommendation: "–ì—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è"
							},
							{ 
								id: 3, 
								name: "–°—Ä–µ–¥–Ω–∏–π", 
								min: 50, 
								max: 69, 
								color: "#f39c12",
								interpretation: "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ",
								recommendation: "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ –∑–∞–Ω—è—Ç–∏—è"
							},
							{ 
								id: 4, 
								name: "–í—ã—Å–æ–∫–∏–π", 
								min: 70, 
								max: 84, 
								color: "#3498db",
								interpretation: "–•–æ—Ä–æ—à–æ —Ä–∞–∑–≤–∏—Ç—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
								recommendation: "–†–∞–∑–≤–∏—Ç–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤"
							},
							{ 
								id: 5, 
								name: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π", 
								min: 85, 
								max: 100, 
								color: "#27ae60",
								interpretation: "–í—ã–¥–∞—é—â–∏–µ—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
								recommendation: "–ü—Ä–æ—Ñ–∏–ª—å–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ"
							}
						],
						dimensions: [
							{
								id: "perception",
								name: "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ç–æ—á–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —ç–º–æ—Ü–∏–∏"
							},
							{
								id: "use",
								name: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º—ã—à–ª–µ–Ω–∏—è"
							},
							{
								id: "understanding",
								name: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –∏ –∏—Ö –ø–µ—Ä–µ—Ö–æ–¥—ã"
							},
							{
								id: "management",
								name: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏—è–º–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π"
							}
						],
						reportSections: [
							"–û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –≤—ã–±–æ—Ä–∫–∏",
							"–ü—Ä–æ—Ñ–∏–ª—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞",
							"–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–æ–π",
							"–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏",
							"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"
						]
					}
				},
				tasks: [
					{ 
						type: "–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π –ø–æ —Ñ–æ—Ç–æ", 
						maxScore: 10, 
						level: 1, 
						knowledge: "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "perception",
						subscale: "–õ–∏—Ü–µ–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è",
						number: 1 
					},
					{ 
						type: "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–º–æ—Ü–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏", 
						maxScore: 8, 
						level: 2, 
						knowledge: "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "perception",
						subscale: "–≠–º–æ—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ",
						number: 2 
					},
					{ 
						type: "–≠–º–æ—Ü–∏–∏ –∏ —Ü–≤–µ—Ç–∞", 
						maxScore: 6, 
						level: 1, 
						knowledge: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "use",
						subscale: "–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏",
						number: 3 
					},
					{ 
						type: "–≠–º–æ—Ü–∏–∏ –∏ —Ä–µ—à–µ–Ω–∏—è", 
						maxScore: 12, 
						level: 3, 
						knowledge: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "use",
						subscale: "–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π",
						number: 4 
					},
					{ 
						type: "–°–ª–æ–∂–Ω—ã–µ —ç–º–æ—Ü–∏–∏", 
						maxScore: 15, 
						level: 3, 
						knowledge: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "understanding",
						subscale: "–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è",
						number: 5 
					},
					{ 
						type: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã", 
						maxScore: 10, 
						level: 4, 
						knowledge: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "understanding",
						subscale: "–î–∏–Ω–∞–º–∏–∫–∞",
						number: 6 
					},
					{ 
						type: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–Ω–µ–≤–æ–º", 
						maxScore: 12, 
						level: 2, 
						knowledge: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
						dimension: "management",
						subscale: "–†–µ–≥—É–ª—è—Ü–∏—è",
						number: 7 
					},
					{ 
						type: "–≠–º–ø–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç", 
						maxScore: 17, 
						level: 4, 
						knowledge: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
						dimension: "management",
						subscale: "–≠–º–ø–∞—Ç–∏—è",
						number: 8 
					}
				],
				students: [
					"–ò–≤–∞–Ω–æ–≤–∞ –ê–Ω–Ω–∞", "–ü–µ—Ç—Ä–æ–≤ –ú–∞–∫—Å–∏–º", "–°–∏–¥–æ—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",
					"–ö–æ–∑–ª–æ–≤ –ê—Ä—Ç–µ–º", "–ù–∏–∫–æ–ª–∞–µ–≤–∞ –°–æ—Ñ–∏—è", "–§–µ–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π",
					"–ú–æ—Ä–æ–∑–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è", "–í–æ–ª–∫–æ–≤ –ö–∏—Ä–∏–ª–ª", "–õ–µ–±–µ–¥–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è",
					"–°–µ–º–µ–Ω–æ–≤ –ò–ª—å—è", "–ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ú–∞—Ä–∏—è", "–ü–∞–≤–ª–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
					"–û—Ä–ª–æ–≤–∞ –î–∞—Ä—å—è", "–ñ—É–∫–æ–≤ –ù–∏–∫–∏—Ç–∞", "–¢–∏—Ö–æ–Ω–æ–≤–∞ –ï–ª–µ–Ω–∞",
					"–ë–µ–ª–æ–≤ –†–æ–º–∞–Ω", "–ì—Ä–æ–º–æ–≤–∞ –ê–ª–∏—Å–∞", "–õ–∞—Ä–∏–Ω –ú–∏—Ö–∞–∏–ª",
					"–ï—Ñ–∏–º–æ–≤–∞ –ü–æ–ª–∏–Ω–∞", "–°–æ—Ä–æ–∫–∏–Ω –ò–≤–∞–Ω", "–î–∞–Ω–∏–ª–æ–≤–∞ –û–ª—å–≥–∞",
					"–ö–æ–º–∞—Ä–æ–≤ –ì–µ–æ—Ä–≥–∏–π"
				],
				results: [
					// –ò–≤–∞–Ω–æ–≤–∞ –ê–Ω–Ω–∞
					[8, 6, 4, 9, 12, 8, 9, 14],
					// –ü–µ—Ç—Ä–æ–≤ –ú–∞–∫—Å–∏–º
					[6, 5, 3, 7, 8, 6, 7, 10],
					// –°–∏–¥–æ—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞
					[9, 7, 5, 10, 14, 9, 11, 16],
					// –ö–æ–∑–ª–æ–≤ –ê—Ä—Ç–µ–º
					[7, 5, 4, 8, 10, 7, 8, 12],
					// –ù–∏–∫–æ–ª–∞–µ–≤–∞ –°–æ—Ñ–∏—è
					[5, 4, 2, 6, 7, 5, 6, 9],
					// –§–µ–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π
					[10, 8, 6, 12, 15, 10, 12, 17],
					// –ú–æ—Ä–æ–∑–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è
					[8, 6, 5, 9, 13, 8, 10, 15],
					// –í–æ–ª–∫–æ–≤ –ö–∏—Ä–∏–ª–ª
					[4, 3, 2, 5, 6, 4, 5, 8],
					// –õ–µ–±–µ–¥–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è
					[7, 6, 4, 8, 11, 7, 9, 13],
					// –°–µ–º–µ–Ω–æ–≤ –ò–ª—å—è
					[9, 7, 5, 11, 14, 9, 11, 16],
					// –ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ú–∞—Ä–∏—è
					[6, 5, 3, 7, 9, 6, 7, 11],
					// –ü–∞–≤–ª–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
					[8, 6, 4, 9, 12, 8, 10, 14],
					// –û—Ä–ª–æ–≤–∞ –î–∞—Ä—å—è
					[5, 4, 2, 6, 8, 5, 6, 9],
					// –ñ—É–∫–æ–≤ –ù–∏–∫–∏—Ç–∞
					[10, 8, 6, 12, 15, 10, 12, 17],
					// –¢–∏—Ö–æ–Ω–æ–≤–∞ –ï–ª–µ–Ω–∞
					[7, 5, 4, 8, 11, 7, 9, 13],
					// –ë–µ–ª–æ–≤ –†–æ–º–∞–Ω
					[8, 6, 5, 9, 13, 8, 10, 15],
					// –ì—Ä–æ–º–æ–≤–∞ –ê–ª–∏—Å–∞
					[6, 5, 3, 7, 10, 6, 8, 12],
					// –õ–∞—Ä–∏–Ω –ú–∏—Ö–∞–∏–ª
					[9, 7, 5, 10, 14, 9, 11, 16],
					// –ï—Ñ–∏–º–æ–≤–∞ –ü–æ–ª–∏–Ω–∞
					[4, 3, 2, 5, 7, 4, 5, 8],
					// –°–æ—Ä–æ–∫–∏–Ω –ò–≤–∞–Ω
					[8, 6, 4, 9, 12, 8, 9, 14],
					// –î–∞–Ω–∏–ª–æ–≤–∞ –û–ª—å–≥–∞
					[7, 5, 4, 8, 11, 7, 9, 13],
					// –ö–æ–º–∞—Ä–æ–≤ –ì–µ–æ—Ä–≥–∏–π
					[6, 5, 3, 7, 9, 6, 7, 11]
				],
				errors: []
			};
			
			// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫/–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π
			generatePsychologyFeatures();
			
			saveData();
			renderAll();
			showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è.", "success");
		}

		function generatePsychologyFeatures() {
			const features = [
				{ type: "perception_bias", name: "–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏", color: "#9b59b6" },
				{ type: "emotional_avoidance", name: "–ò–∑–±–µ–≥–∞–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π", color: "#e67e22" },
				{ type: "overcontrol", name: "–ß—Ä–µ–∑–º–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —ç–º–æ—Ü–∏–π", color: "#3498db" },
				{ type: "empathy_deficit", name: "–î–µ—Ñ–∏—Ü–∏—Ç —ç–º–ø–∞—Ç–∏–∏", color: "#e74c3c" },
				{ type: "emotional_awareness", name: "–í—ã—Å–æ–∫–∞—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç—å", color: "#27ae60" },
				{ type: "stress_tolerance", name: "–í—ã—Å–æ–∫–∞—è —Å—Ç—Ä–µ—Å—Å–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", color: "#2ecc71" }
			];
			
			appData.psychologyFeatures = [];
			
			features.forEach(feature => {
				const randomStudents = [];
				const count = Math.floor(Math.random() * 4) + 2; // 2-5 —É—á–∞—â–∏—Ö—Å—è
				
				for (let i = 0; i < count; i++) {
					const studentIndex = Math.floor(Math.random() * appData.students.length);
					if (!randomStudents.includes(studentIndex)) {
						randomStudents.push(studentIndex);
						
						appData.psychologyFeatures.push({
							studentIndex: studentIndex,
							type: feature.type,
							name: feature.name,
							severity: Math.floor(Math.random() * 3) + 1, // 1-3
							description: `–ü—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–∏—è—Ö ${getRandomTasks()}`,
							recommendation: getFeatureRecommendation(feature.type)
						});
					}
				}
			});
		}

		function getRandomTasks() {
			const tasks = [];
			const count = Math.floor(Math.random() * 3) + 1;
			for (let i = 0; i < count; i++) {
				tasks.push(Math.floor(Math.random() * appData.tasks.length) + 1);
			}
			return tasks.join(', ');
		}

		function getFeatureRecommendation(featureType) {
			const recommendations = {
				"perception_bias": "–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è",
				"emotional_avoidance": "–≠–∫—Å–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è",
				"overcontrol": "–¢—Ä–µ–Ω–∏–Ω–≥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç–∫—Å–ø—Ä–µ—Å—Å–∏–∏",
				"empathy_deficit": "–¢—Ä–µ–Ω–∏–Ω–≥ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–º–ø–∞—Ç–∏–∏",
				"emotional_awareness": "–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤",
				"stress_tolerance": "–û–±—É—á–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∞–º —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏"
			};
			return recommendations[featureType] || "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è";
		}

        function loadStandardSample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "5–ê",
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–î—Ä–æ–±–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã",
                    goals: "1. –°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –¥—Ä–æ–±–µ–π\n2. –£–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π\n3. –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –æ—Ç —á–∏—Å–ª–∞\n4. –†–µ—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã",
                    workType: "current",
                    workFormat: "mixed",
                    timeLimit: 45,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 22, max: 24 },
                        4: { min: 18, max: 21 },
                        3: { min: 12, max: 17 },
                        2: { min: 0, max: 11 }
                    }
                },
                tasks: [
                    { type: "–°–ª–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 3, level: 1, knowledge: "–ø—Ä–∞–≤–∏–ª–∞ —Å–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–±–µ–π" },
                    { type: "–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 2, level: 1, knowledge: "–ø—Ä–∞–≤–∏–ª–∞ –≤—ã—á–∏—Ç–∞–Ω–∏—è –¥—Ä–æ–±–µ–π" },
                    { type: "–£–º–Ω–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 4, level: 2, knowledge: "—É–º–Ω–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π" },
                    { type: "–î–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 3, level: 2, knowledge: "–¥–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π" },
                    { type: "–ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —á–∏—Å–ª–∞", maxScore: 2, level: 2, knowledge: "–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤" },
                    { type: "–ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —á–∏—Å–ª–∞ –ø–æ %", maxScore: 3, level: 3, knowledge: "–æ–±—Ä–∞—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã" },
                    { type: "–ó–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã", maxScore: 4, level: 3, knowledge: "—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏" },
                    { type: "–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏", maxScore: 3, level: 4, knowledge: "–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏" }
                ],
                students: [
                    "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π", "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π",
                    "–ö–æ–∑–ª–æ–≤–∞ –ê–Ω–Ω–∞", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò–≤–∞–Ω", "–§–µ–¥–æ—Ä–æ–≤–∞ –ï–ª–µ–Ω–∞",
                    "–ú–æ—Ä–æ–∑–æ–≤ –ü–∞–≤–µ–ª", "–í–∞—Å–Ω–µ—Ü–æ–≤–∞ –û–ª—å–≥–∞", "–õ–µ–±–µ–¥–µ–≤ –°–µ—Ä–≥–µ–π",
                    "–°–µ–º–µ–Ω–æ–≤–∞ –ò—Ä–∏–Ω–∞", "–ö—É–∑–Ω–µ—Ü–æ–≤ –ê–Ω–¥—Ä–µ–π", "–ü–∞–≤–ª–æ–≤–∞ –ù–∞—Ç–∞–ª—å—è",
                    "–û—Ä–ª–æ–≤ –ú–∞–∫—Å–∏–º", "–ñ—É–∫–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è", "–¢–∏—Ö–æ–Ω–æ–≤ –ê—Ä—Ç–µ–º",
                    "–ë–µ–ª–æ–≤–∞ –°–æ—Ñ–∏—è", "–ì—Ä–æ–º–æ–≤ –ö–∏—Ä–∏–ª–ª", "–õ–∞—Ä–∏–Ω–∞ –î–∞—Ä—å—è",
                    "–ï—Ñ–∏–º–æ–≤ –†–æ–º–∞–Ω", "–°–æ—Ä–æ–∫–∏–Ω–∞ –ê–ª–∏—Å–∞", "–î–∞–Ω–∏–ª–æ–≤ –ú–∞—Ä–∫",
                    "–ö–æ–º–∞—Ä–æ–≤–∞ –ü–æ–ª–∏–Ω–∞", "–ù–æ–≤–∏–∫–æ–≤ –ì–ª–µ–±"
                ],
                results: [
                    [3, 2, 4, 3, 2, 3, 4, 3],
                    [2, 1, 3, 2, 2, 2, 3, 2],
                    [3, 2, 4, 3, 1, 3, 4, 3],
                    [1, 1, 2, 1, 1, 1, 2, 1],
                    [3, 2, 3, 3, 2, 3, 3, 3],
                    [2, 2, 3, 2, 2, 2, 3, 2],
                    [3, 1, 4, 3, 2, 3, 4, 3],
                    [2, 2, 3, 2, 1, 2, 3, 2],
                    [3, 2, 4, 3, 2, 3, 4, 3],
                    [1, 1, 2, 1, 1, 1, 2, 1],
                    [3, 2, 3, 3, 2, 3, 3, 3],
                    [2, 2, 3, 2, 2, 2, 3, 2],
                    [3, 2, 4, 3, 2, 3, 4, 2],
                    [2, 2, 3, 2, 2, 2, 3, 1],
                    [3, 1, 4, 3, 1, 3, 3, 2],
                    [2, 2, 3, 2, 2, 2, 2, 1],
                    [3, 2, 3, 3, 2, 2, 3, 2],
                    [2, 1, 3, 2, 1, 2, 2, 1],
                    [3, 2, 4, 3, 2, 3, 3, 2],
                    [2, 2, 3, 2, 2, 2, 3, 1],
                    [3, 1, 3, 3, 1, 2, 2, 1],
                    [2, 2, 2, 2, 2, 1, 2, 0],
                    [1, 1, 2, 1, 1, 1, 1, 0]
                ],
                errors: []
            };
            
            generateSampleErrors();
            
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω! –ú–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤.", "success");
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ (VPR, Literacy, OGE, EGE) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        function loadVPRSample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "5–ê",
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–í–ü–† –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ",
                    goals: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π —É—á–∞—â–∏—Ö—Å—è",
                    workType: "vpr",
                    workFormat: "test",
                    timeLimit: 45,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 18, max: 20 },
                        4: { min: 15, max: 17 },
                        3: { min: 10, max: 14 },
                        2: { min: 0, max: 9 }
                    }
                },
                tasks: [
                    { type: "–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è", maxScore: 1, level: 1, knowledge: "–≤—ã—á–∏—Å–ª–µ–Ω–∏—è", competence: "calculations", vprLevel: 1, number: 1 },
                    { type: "–¢–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞", maxScore: 1, level: 1, knowledge: "—Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á", competence: "text_work", vprLevel: 1, number: 2 },
                    { type: "–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 1, level: 1, knowledge: "–≥–µ–æ–º–µ—Ç—Ä–∏—è", competence: "graphics", vprLevel: 1, number: 3 },
                    { type: "–†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π", maxScore: 2, level: 2, knowledge: "–∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö", competence: "data_work", vprLevel: 2, number: 4 },
                    { type: "–õ–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 2, level: 2, knowledge: "–ª–æ–≥–∏–∫–∞", competence: "logic", vprLevel: 2, number: 5 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [1, 1, 1, 2, 2],
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 2, 1],
                    [0, 1, 1, 1, 0],
                    [1, 1, 0, 1, 1]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –í–ü–† –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        function loadLiteracySample() {
            appData = {
                test: {
                    subject: "–ú–µ–∂–ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è",
                    class: "6–ê", 
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏",
                    goals: "–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏",
                    workType: "func_literacy",
                    workFormat: "mixed",
                    timeLimit: 60,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 90, max: 100 },
                        4: { min: 75, max: 89 },
                        3: { min: 50, max: 74 },
                        2: { min: 0, max: 49 }
                    }
                },
                tasks: [
                    { type: "–ß—Ç–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏", maxScore: 2, level: 1, knowledge: "–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞", literacyType: "reading", skill: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π", context: "personal", number: 1 },
                    { type: "–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞", maxScore: 3, level: 2, knowledge: "—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", literacyType: "financial", skill: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤", context: "personal", number: 2 },
                    { type: "–ê–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞", maxScore: 2, level: 2, knowledge: "—Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏", literacyType: "math", skill: "–ß—Ç–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤", context: "social", number: 3 },
                    { type: "–û—Ü–µ–Ω–∫–∞ –Ω–æ–≤–æ—Å—Ç–∏", maxScore: 3, level: 3, knowledge: "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", literacyType: "digital", skill: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", context: "global", number: 4 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [2, 3, 2, 3],
                    [2, 2, 1, 2],
                    [1, 3, 2, 2],
                    [1, 1, 1, 1],
                    [2, 2, 2, 2]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        function loadOGESample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "9–ê", 
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–ü—Ä–æ–±–Ω—ã–π –û–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ",
                    goals: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏",
                    workType: "oge",
                    workFormat: "mixed",
                    timeLimit: 235,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 22, max: 32 },
                        4: { min: 15, max: 21 },
                        3: { min: 8, max: 14 },
                        2: { min: 0, max: 7 }
                    }
                },
                tasks: [
                    { type: "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π", maxScore: 1, level: 1, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.1", pu: "–í—ã—á–∏—Å–ª–µ–Ω–∏—è", answerType: "short", number: 1 },
                    { type: "–£—Ä–∞–≤–Ω–µ–Ω–∏—è", maxScore: 1, level: 1, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.2", pu: "–†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π", answerType: "short", number: 2 },
                    { type: "–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 1, level: 2, knowledge: "–≥–µ–æ–º–µ—Ç—Ä–∏—è", kes: "2.1", pu: "–†–µ—à–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á", answerType: "short", number: 3 },
                    { type: "–¢–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞", maxScore: 2, level: 2, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.3", pu: "–†–µ—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á", answerType: "detailed", number: 4 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [1, 1, 1, 2],
                    [1, 1, 0, 1],
                    [1, 1, 1, 2],
                    [0, 1, 1, 1],
                    [1, 1, 1, 1]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –û–ì–≠ –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        function loadEGESample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "11–ê", 
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–ü—Ä–æ–±–Ω—ã–π –ï–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ (–ø—Ä–æ—Ñ–∏–ª—å)",
                    goals: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –µ–¥–∏–Ω–æ–º—É –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É",
                    workType: "ege",
                    workFormat: "mixed",
                    timeLimit: 235,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 27, max: 31 },
                        4: { min: 20, max: 26 },
                        3: { min: 12, max: 19 },
                        2: { min: 0, max: 11 }
                    }
                },
                tasks: [
                    { type: "–ü—Ä–æ—Å—Ç–µ–π—à–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è", maxScore: 1, level: 1, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.1", pu: "–†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π", answerType: "short", number: 1 },
                    { type: "–°—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—è", maxScore: 1, level: 2, knowledge: "–≥–µ–æ–º–µ—Ç—Ä–∏—è", kes: "2.1", pu: "–†–µ—à–µ–Ω–∏–µ —Å—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á", answerType: "short", number: 2 },
                    { type: "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 2, level: 3, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.4", pu: "–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –∑–∞–¥–∞—á", answerType: "detailed", number: 3 },
                    { type: "–ó–∞–¥–∞—á–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º", maxScore: 4, level: 4, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.5", pu: "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π", answerType: "detailed", number: 4 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [1, 1, 2, 3],
                    [1, 1, 1, 1],
                    [1, 1, 2, 2],
                    [0, 1, 1, 0],
                    [1, 0, 1, 1]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ï–ì–≠ –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ –æ—à–∏–±–æ–∫
        function generateSampleErrors() {
            const errorDistribution = {
                factual: 2,
                conceptual: 4,
                application: 3,
                calculation: 6,
                logical: 3,
                attention: 5,
                technical: 2
            };
            
            appData.errors = [];
            Object.keys(errorDistribution).forEach(errorType => {
                for (let i = 0; i < errorDistribution[errorType]; i++) {
                    const randomTask = Math.floor(Math.random() * appData.tasks.length);
                    const randomStudent = Math.floor(Math.random() * appData.students.length);
                    
                    appData.errors.push({
                        studentIndex: randomStudent,
                        taskIndex: randomTask,
                        type: errorType,
                        description: `–ü—Ä–∏–º–µ—Ä ${errorTypes[errorType].name.toLowerCase()} –≤ –∑–∞–¥–∞–Ω–∏–∏ ${randomTask + 1}`,
                        count: Math.floor(Math.random() * 3) + 1
                    });
                }
            });
        }
		function validateGradeCalculation() {
			console.log('=== VALIDATION ===');
			console.log('Test data:', appData.test);
			console.log('Tasks:', appData.tasks);
			
			// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
			const testScores = [0, 10, 50, 75, 90, 100];
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			
			console.log('\nTest calculations:');
			testScores.forEach(score => {
				const grade = calculateGrade(score);
				console.log(`${score} –±–∞–ª–ª–æ–≤ ‚Üí ${grade} (${getGradeDisplay(grade)})`);
			});
		}
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Å—Ç–∞
		function saveTestSettings() {
			console.log('=== –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê–°–¢–†–û–ï–ö –¢–ï–°–¢–ê ===');
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
			appData.test.subject = document.getElementById('subject').value;
			appData.test.class = document.getElementById('class').value;
			appData.test.testDate = document.getElementById('testDate').value;
			appData.test.theme = document.getElementById('testTheme').value;
			appData.test.goals = document.getElementById('testGoals').value;
			appData.test.workType = document.getElementById('workType').value;
			appData.test.workFormat = document.getElementById('workFormat').value;
			appData.test.timeLimit = parseInt(document.getElementById('timeLimit').value);
			appData.test.totalStudents = parseInt(document.getElementById('totalStudents').value);
			appData.test.presentStudents = parseInt(document.getElementById('presentStudents').value);
			appData.test.absentReason = document.getElementById('absentReason').value;
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
			appData.test.criteriaType = document.getElementById('criteriaType').value;
			appData.test.criteriaSystem = document.getElementById('criteriaSystem').value;
			
			let criteriaCount = parseInt(document.getElementById('criteriaCount').value) || 4;
			
			// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–∫—Å–∏—Ä—É–µ–º 4 —É—Ä–æ–≤–Ω—è
			if (appData.test.criteriaSystem === 'standard') {
				criteriaCount = 4;
			}
			
			appData.test.criteriaCount = criteriaCount;
			
			console.log('–¢–∏–ø –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤:', appData.test.criteriaType);
			console.log('–°–∏—Å—Ç–µ–º–∞:', appData.test.criteriaSystem);
			console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π:', criteriaCount);
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
			const newStudentCount = parseInt(document.getElementById('presentStudents').value);
			const currentStudentCount = appData.students.length;
			
			if (newStudentCount !== currentStudentCount) {
				setStudentsCount(newStudentCount);
			}
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
			appData.test.criteria = {}; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ
			
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			console.log('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:', maxPossible);
			
			for (let i = 1; i <= criteriaCount; i++) {
				const minElement = document.getElementById(`criteria${i}min`);
				const maxElement = document.getElementById(`criteria${i}max`);
				
				if (minElement && maxElement) {
					const minValue = parseInt(minElement.value) || 0;
					const maxValue = parseInt(maxElement.value) || 0;
					
					// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –µ—Å–ª–∏ min > max
					if (minValue > maxValue) {
						appData.test.criteria[i] = {
							min: maxValue,
							max: minValue
						};
						console.log(`–ö—Ä–∏—Ç–µ—Ä–∏–π ${i}: —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω (${maxValue}-${minValue})`);
					} else {
						appData.test.criteria[i] = {
							min: minValue,
							max: maxValue
						};
						console.log(`–ö—Ä–∏—Ç–µ—Ä–∏–π ${i}: ${minValue}-${maxValue}`);
					}
				} else {
					// –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–∑–¥–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
					console.warn(`–ü–æ–ª—è –¥–ª—è –∫—Ä–∏—Ç–µ—Ä–∏—è ${i} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! –°–æ–∑–¥–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.`);
					
					if (appData.test.criteriaType === 'percentage') {
						const step = 100 / criteriaCount;
						appData.test.criteria[i] = {
							min: Math.round((i - 1) * step),
							max: Math.round(i * step)
						};
					} else {
						const step = maxPossible / criteriaCount;
						appData.test.criteria[i] = {
							min: Math.round((i - 1) * step),
							max: Math.round(i * step)
						};
					}
				}
			}
			
			console.log('–ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:', appData.test.criteria);
			
			saveData();
			renderAll();
			showNotification("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
			debugCriteria();
		}

        // –†–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
        function renderAll() {
            renderTestSettings();
            renderTasks();
			
            renderStudents();
            renderResults();
			renderCriteriaSettings(); // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É
        }

        // –†–µ–Ω–¥–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Å—Ç–∞
        function renderTestSettings() {
			try {
				// –ë–µ–∑–æ–ø–∞—Å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				safeSetValue('subject', appData.test.subject);
				safeSetValue('class', appData.test.class);
				safeSetValue('testDate', appData.test.testDate);
				safeSetValue('testTheme', appData.test.theme);
				safeSetValue('testGoals', appData.test.goals);
				safeSetValue('workType', appData.test.workType);
				safeSetValue('workFormat', appData.test.workFormat);
				safeSetValue('timeLimit', appData.test.timeLimit);
				safeSetValue('totalStudents', appData.test.totalStudents);
				safeSetValue('presentStudents', appData.test.presentStudents);
				safeSetValue('absentReason', appData.test.absentReason);
				
				// –ö—Ä–∏—Ç–µ—Ä–∏–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π
				if (appData.test.criteria) {
					safeSetValue('criteria5min', appData.test.criteria[5]?.min || 0);
					safeSetValue('criteria5max', appData.test.criteria[5]?.max || 0);
					safeSetValue('criteria4min', appData.test.criteria[4]?.min || 0);
					safeSetValue('criteria4max', appData.test.criteria[4]?.max || 0);
					safeSetValue('criteria3min', appData.test.criteria[3]?.min || 0);
					safeSetValue('criteria3max', appData.test.criteria[3]?.max || 0);
					safeSetValue('criteria2min', appData.test.criteria[2]?.min || 0);
					safeSetValue('criteria2max', appData.test.criteria[2]?.max || 0);
				}
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≤ renderTestSettings:', error);
			}
        }

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
		function safeSetValue(elementId, value) {
			try {
				const element = document.getElementById(elementId);
				if (element) {
					element.value = value || '';
				}
			} catch (error) {
				console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ ${elementId}:`, error);
			}
		}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–¥–∞–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function getDefaultTaskCount() {
            switch(appData.test.workType) {
                case 'oge': return 15;
                case 'ege': return 19;
                case 'vpr': return 12;
                case 'func_literacy': return 8;
                default: return 8;
            }
        }

        // –†–µ–Ω–¥–µ—Ä –∑–∞–¥–∞–Ω–∏–π —Å —Ç–∞–∫—Å–æ–Ω–æ–º–∏–µ–π
		function renderTasks() {
			const container = document.getElementById('tasksContainer');
			if (!container) return;
			
			let html = `
				<div id="tasksList" style="margin-bottom: 20px;">
					<h3 style="display: flex; justify-content: space-between; align-items: center;">
						üìù –ó–∞–¥–∞–Ω–∏—è
						<button class="btn btn-info" onclick="showTasksMenu()">
							üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏
						</button>
						<button class="btn btn-success" onclick="addNewTask()">
							Ôºã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
						</button>
					</h3>
					<div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
						<small>üìå –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∑–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞</small>
					</div>
			`;
			
			if (appData.tasks.length === 0) {
				html += `
					<div style="text-align: center; padding: 40px; color: #666;">
						<div style="font-size: 3em;">üìù</div>
						<p>–ó–∞–¥–∞–Ω–∏—è –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
						<button class="btn btn-primary" onclick="addNewTask()">
							–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
						</button>
					</div>
				`;
			} else {
				appData.tasks.forEach((task, index) => {
					const levelName = complexityLevels[task.level]?.name || `–£—Ä–æ–≤–µ–Ω—å ${task.level}`;
					const levelColor = complexityLevels[task.level]?.color || '#ccc';
					
					// –ó–Ω–∞—á–µ–Ω–∏—è —Å fallback
					const codeKES = task.codeKES || '';
					const codePU = task.codePU || '';
					const contentElement = task.contentElement || '';
					const answerType = task.answerType || '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç';
					const description = task.description || '';
					const competency = task.competency || '';
					
					html += `
						<div class="task-card" data-index="${index}" 
							 style="background: white; border: 1px solid #dee2e6; border-radius: 8px; margin-bottom: 15px; cursor: move;"
							 draggable="true"
							 ondragstart="dragTaskStart(event, ${index})"
							 ondragover="dragTaskOver(event)"
							 ondrop="dropTask(event, ${index})">
							
							<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–æ–º–µ—Ä–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
							<div class="task-header" 
								 style="background: #f8f9fa; padding: 12px 15px; border-bottom: 1px solid #dee2e6; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
								<div style="display: flex; align-items: center; gap: 10px;">
									<span style="background: #6c757d; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
										${index + 1}
									</span>
									<h5 style="margin: 0; cursor: move;">
										–ó–∞–¥–∞–Ω–∏–µ ${index + 1}
										<small style="color: #6c757d; margin-left: 5px;">(–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ)</small>
									</h5>
								</div>
								<div>
									<button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removeTask(${index})" 
											style="margin-left: 5px;">
										üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
									</button>
								</div>
							</div>
							
							<!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–¥–∞–Ω–∏—è -->
							<div class="task-body" style="padding: 20px;">
								<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
									
									<!-- –¢–∏–ø –∑–∞–¥–∞–Ω–∏—è -->
									<div class="form-group">
										<label><strong>–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è:</strong></label>
										<select class="form-control" 
												value="${task.type || '–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞'}"
												onchange="updateTaskField(${index}, 'type', this.value)">
											<option value="–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞" ${task.type === '–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞' ? 'selected' : ''}>
												–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
											</option>
											<option value="–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç" ${task.type === '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç' ? 'selected' : ''}>
												–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
											</option>
											<option value="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç" ${task.type === '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç' ? 'selected' : ''}>
												–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç
											</option>
											<option value="–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ" ${task.type === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ' ? 'selected' : ''}>
												–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
											</option>
											<option value="–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ" ${task.type === '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ' ? 'selected' : ''}>
												–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
											</option>
										</select>
									</div>
									
									<!-- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª -->
									<div class="form-group">
										<label><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</strong></label>
										<input type="number" class="form-control" 
											   value="${task.maxScore || 1}" 
											   min="0" max="100"
											   onchange="updateTaskField(${index}, 'maxScore', parseInt(this.value) || 1)">
									</div>
									
									<!-- –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
									<div class="form-group">
										<label><strong>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</strong></label>
										<select class="form-control" 
												onchange="updateTaskField(${index}, 'level', parseInt(this.value) || 1)">
											${Object.entries(complexityLevels).map(([key, level]) => `
												<option value="${key}" ${task.level == key ? 'selected' : ''}
														style="color: ${level.color};">
													${key}. ${level.name}
												</option>
											`).join('')}
										</select>
										<small style="color: ${levelColor};">
											${levelName} ‚Äì ${complexityLevels[task.level]?.desc || ''}
										</small>
									</div>
									
									<!-- –¢–∏–ø –æ—Ç–≤–µ—Ç–∞ -->
									<div class="form-group">
										<label><strong>–¢–∏–ø –æ—Ç–≤–µ—Ç–∞:</strong></label>
										<select class="form-control" 
												onchange="updateTaskField(${index}, 'answerType', this.value)">
											<option value="–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç" ${answerType === '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç' ? 'selected' : ''}>
												–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
											</option>
											<option value="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç" ${answerType === '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç' ? 'selected' : ''}>
												–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç
											</option>
											<option value="–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞" ${answerType === '–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞' ? 'selected' : ''}>
												–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
											</option>
											<option value="–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ" ${answerType === '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ' ? 'selected' : ''}>
												–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
											</option>
										</select>
									</div>
									
									<!-- –ö–æ–¥ –ö–≠–° -->
									<div class="form-group">
										<label><strong>–ö–æ–¥ –ö–≠–°:</strong></label>
										<input type="text" class="form-control" 
											   value="${codeKES}" 
											   placeholder="–ü—Ä–∏–º–µ—Ä: 1.2.3"
											   onchange="updateTaskField(${index}, 'codeKES', this.value)">
									</div>
									
									<!-- –ö–æ–¥ –ü–£ -->
									<div class="form-group">
										<label><strong>–ö–æ–¥ –ü–£:</strong></label>
										<input type="text" class="form-control" 
											   value="${codePU}" 
											   placeholder="–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ —É–º–µ–Ω–∏–µ"
											   onchange="updateTaskField(${index}, 'codePU', this.value)">
									</div>
									
									<!-- –≠–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è -->
									<div class="form-group">
										<label><strong>–≠–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:</strong></label>
										<input type="text" class="form-control" 
											   value="${contentElement}" 
											   placeholder="–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–¥–∞–Ω–∏–µ"
											   onchange="updateTaskField(${index}, 'contentElement', this.value)">
									</div>
									
									<!-- –ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è -->
									<div class="form-group">
										<label><strong>–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è:</strong></label>
										<input type="text" class="form-control" 
											   value="${competency}" 
											   placeholder="text_work, calculations, logic –∏ —Ç.–¥."
											   onchange="updateTaskField(${index}, 'competency', this.value)">
										<small style="color: #666;">
											text_work, calculations, logic, graphics, data_work
										</small>
									</div>
									
								</div>
								
								<!-- –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è -->
								<div class="form-group">
									<label><strong>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:</strong></label>
									<textarea class="form-control" rows="3"
											  placeholder="–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —É—á–∞—â–∏—Ö—Å—è..."
											  onchange="updateTaskField(${index}, 'description', this.value)"
											  style="width: 100%;">${description}</textarea>
								</div>
								
								<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
								<div style="display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
									<button class="btn btn-sm btn-outline-primary" 
											onclick="duplicateTask(${index})">
										üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
									</button>
									<button class="btn btn-sm btn-outline-secondary" 
											onclick="moveTaskUp(${index})" ${index === 0 ? 'disabled' : ''}>
										‚¨ÜÔ∏è –í–≤–µ—Ä—Ö
									</button>
									<button class="btn btn-sm btn-outline-secondary" 
											onclick="moveTaskDown(${index})" ${index === appData.tasks.length - 1 ? 'disabled' : ''}>
										‚¨áÔ∏è –í–Ω–∏–∑
									</button>
								</div>
							</div>
						</div>
					`;
				});
			}
			
			html += `</div>`;
			
			// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
			if (appData.tasks.length > 0) {
				const totalScore = appData.tasks.reduce((sum, task) => sum + (task.maxScore || 0), 0);
				const levelDistribution = appData.tasks.reduce((acc, task) => {
					acc[task.level] = (acc[task.level] || 0) + 1;
					return acc;
				}, {});
				
				html += `
					<div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-top: 20px;">
						<h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π</h5>
						<div style="display: flex; gap: 20px; flex-wrap: wrap;">
							<div>
								<strong>–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π:</strong> ${appData.tasks.length}
							</div>
							<div>
								<strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</strong> ${totalScore}
							</div>
							<div>
								<strong>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º:</strong>
								${Object.entries(levelDistribution).map(([level, count]) => {
									const levelInfo = complexityLevels[level];
									return `<span style="margin-left: 10px; color: ${levelInfo?.color || '#666'}">${level}: ${count}</span>`;
								}).join('')}
							</div>
						</div>
					</div>
				`;
			}
			
			container.innerHTML = html;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º drag-and-drop –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
			initTaskDragAndDrop();
		}
		// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è drag-and-drop
		let draggedTaskIndex = null;

		// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
		function addNewTask() {
			const newTask = {
				id: 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9), // –î–æ–±–∞–≤–ª—è–µ–º ID
				type: "–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞",
				maxScore: 1,
				level: 1,
				description: "",
				competency: "text_work",
				errorTypes: [],
				codeKES: "1.1.1",
				codePU: "–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ —É–º–µ–Ω–∏–µ",
				contentElement: "",
				answerType: "–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç"
			};
			
			appData.tasks.push(newTask);
			saveData();
			renderTasks();
			renderResults(); // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			
			showNotification('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ', 'success');
			
			// –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é
			setTimeout(() => {
				const taskCards = document.querySelectorAll('.task-card');
				if (taskCards.length > 0) {
					taskCards[taskCards.length - 1].scrollIntoView({ behavior: 'smooth', block: 'center' });
				}
			}, 100);
		}

		// –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
		function removeTask(index) {
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ ${index + 1}? –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —ç—Ç–æ–º—É –∑–∞–¥–∞–Ω–∏—é —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
				// –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞–Ω–∏–µ
				appData.tasks.splice(index, 1);
				
				// –£–¥–∞–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–æ–ª–±–µ—Ü –∏–∑ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
				appData.results.forEach(studentResults => {
					if (index < studentResults.length) {
						studentResults.splice(index, 1);
					}
				});
				
				saveData();
				renderAll(); // –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
				showNotification('üóëÔ∏è –ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'info');
			}
		}

		// –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
		function duplicateTask(index) {
			const originalTask = appData.tasks[index];
			const duplicatedTask = JSON.parse(JSON.stringify(originalTask));
			
			appData.tasks.splice(index + 1, 0, duplicatedTask);
			
			// –î–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			appData.results.forEach(studentResults => {
				studentResults.splice(index + 1, 0, 0);
			});
			
			saveData();
			renderAll();
			showNotification('üìã –ó–∞–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–æ', 'success');
		}

		// –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –≤–≤–µ—Ä—Ö
		function moveTaskUp(index) {
			if (index > 0) {
				// –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –∑–∞–¥–∞–Ω–∏—è
				[appData.tasks[index], appData.tasks[index - 1]] = 
				[appData.tasks[index - 1], appData.tasks[index]];
				
				// –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ —Å—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
				appData.results.forEach(studentResults => {
					if (index < studentResults.length && index - 1 < studentResults.length) {
						[studentResults[index], studentResults[index - 1]] = 
						[studentResults[index - 1], studentResults[index]];
					}
				});
				
				saveData();
				renderTasks();
				renderResults();
			}
		}

		// –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –≤–Ω–∏–∑
		function moveTaskDown(index) {
			if (index < appData.tasks.length - 1) {
				// –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –∑–∞–¥–∞–Ω–∏—è
				[appData.tasks[index], appData.tasks[index + 1]] = 
				[appData.tasks[index + 1], appData.tasks[index]];
				
				// –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ —Å—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
				appData.results.forEach(studentResults => {
					if (index < studentResults.length && index + 1 < studentResults.length) {
						[studentResults[index], studentResults[index + 1]] = 
						[studentResults[index + 1], studentResults[index]];
					}
				});
				
				saveData();
				renderTasks();
				renderResults();
			}
		}

		// –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –∑–∞–¥–∞–Ω–∏—è
		function updateTaskField(index, field, value) {
			if (index >= 0 && index < appData.tasks.length) {
				appData.tasks[index][field] = value;
				saveData();
				
				// –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª, –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
				if (field === 'maxScore') {
					renderResults(); // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
				}
			}
		}

		// Drag-and-drop —Ñ—É–Ω–∫—Ü–∏–∏
		function dragTaskStart(event, index) {
			draggedTaskIndex = index;
			event.dataTransfer.setData('text/plain', index);
			event.currentTarget.style.opacity = '0.4';
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
			event.currentTarget.classList.add('dragging');
		}

		function dragTaskOver(event) {
			event.preventDefault();
			event.dataTransfer.dropEffect = 'move';
			
			// –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
			const taskCard = event.currentTarget.closest('.task-card');
			if (taskCard && !taskCard.classList.contains('dragging')) {
				taskCard.style.borderColor = '#3498db';
				taskCard.style.boxShadow = '0 0 10px rgba(52, 152, 219, 0.3)';
			}
		}

		function dropTask(event, targetIndex) {
			event.preventDefault();
			
			if (draggedTaskIndex === null || draggedTaskIndex === targetIndex) {
				resetDragStyles();
				return;
			}
			
			// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏
			resetDragStyles();
			
			// –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∑–∞–¥–∞–Ω–∏–µ
			const movedTask = appData.tasks[draggedTaskIndex];
			
			// –£–¥–∞–ª—è–µ–º –∏–∑ —Å—Ç–∞—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –≤ –Ω–æ–≤—É—é
			appData.tasks.splice(draggedTaskIndex, 1);
			appData.tasks.splice(targetIndex, 0, movedTask);
			
			// –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
			appData.results.forEach(studentResults => {
				if (draggedTaskIndex < studentResults.length && targetIndex < studentResults.length) {
					const movedScore = studentResults[draggedTaskIndex];
					studentResults.splice(draggedTaskIndex, 1);
					studentResults.splice(targetIndex, 0, movedScore);
				}
			});
			
			saveData();
			renderTasks();
			renderResults();
			
			showNotification('‚ÜîÔ∏è –ü–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞–Ω–∏–π –∏–∑–º–µ–Ω–µ–Ω', 'info');
			
			draggedTaskIndex = null;
		}

		function resetDragStyles() {
			// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏ drag-and-drop
			document.querySelectorAll('.task-card').forEach(card => {
				card.style.opacity = '1';
				card.style.borderColor = '';
				card.style.boxShadow = '';
				card.classList.remove('dragging');
			});
		}

		function initTaskDragAndDrop() {
			// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ drag-and-drop
			document.querySelectorAll('.task-card').forEach(card => {
				card.addEventListener('dragend', resetDragStyles);
				card.addEventListener('dragleave', function(e) {
					if (!this.classList.contains('dragging')) {
						this.style.borderColor = '';
						this.style.boxShadow = '';
					}
				});
			});
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π (–±—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥)
		function addMultipleTasks() {
			const html = `
				<div style="max-width: 600px;">
					<h3>üìù –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<p><strong>–§–æ—Ä–º–∞—Ç:</strong> –¢–∏–ø|–ú–∞–∫—Å. –±–∞–ª–ª|–£—Ä–æ–≤–µ–Ω—å|–û–ø–∏—Å–∞–Ω–∏–µ</p>
						<p><strong>–ü—Ä–∏–º–µ—Ä:</strong> –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞|1|1|–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</p>
					</div>
					
					<div class="form-group">
						<label>–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞–Ω–∏—è (–∫–∞–∂–¥–æ–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
						<textarea id="multipleTasksInput" 
								  class="form-control" 
								  rows="10" 
								  placeholder="–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞|1|1|–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
		–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç|2|2|–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ
		–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç|5|3|–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ—á–∏–Ω–µ–Ω–∏–µ"></textarea>
					</div>
					
					<div style="margin-top: 15px;">
						<button class="btn btn-primary" onclick="parseMultipleTasks()">
							–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è
						</button>
						<button class="btn btn-secondary" onclick="hideModal()">
							–û—Ç–º–µ–Ω–∞
						</button>
					</div>
				</div>
			`;
			
			showModal('–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π', html);
		}

		function parseMultipleTasks() {
			const input = document.getElementById('multipleTasksInput').value;
			if (!input.trim()) {
				showNotification('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ', 'warning');
				return;
			}
			
			const lines = input.split('\n').filter(line => line.trim());
			let addedCount = 0;
			
			lines.forEach(line => {
				const parts = line.split('|').map(part => part.trim());
				if (parts.length >= 4) {
					const newTask = {
						type: parts[0] || "–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞",
						maxScore: parseInt(parts[1]) || 1,
						level: parseInt(parts[2]) || 1,
						description: parts[3] || "",
						competency: parts[4] || "text_work",
						errorTypes: [],
						codeKES: parts[5] || "1.1.1",
						codePU: parts[6] || "–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ —É–º–µ–Ω–∏–µ",
						contentElement: parts[7] || "",
						answerType: parts[8] || "–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç"
					};
					
					appData.tasks.push(newTask);
					addedCount++;
				}
			});
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			if (addedCount > 0) {
				appData.results.forEach(studentResults => {
					for (let i = 0; i < addedCount; i++) {
						studentResults.push(0);
					}
				});
				
				saveData();
				renderAll();
				hideModal();
				showNotification(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} –∑–∞–¥–∞–Ω–∏–π`, 'success');
			} else {
				showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.', 'error');
			}
		}
		
		function showTasksMenu() {
			const html = `
				<div style="padding: 20px;">
					<h3>üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏</h3>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
						<button class="btn btn-success" onclick="addNewTask()" style="padding: 15px;">
							Ôºã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
						</button>
						
						<button class="btn btn-primary" onclick="addMultipleTasks()" style="padding: 15px;">
							üìã –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
						</button>
						
						<button class="btn btn-warning" onclick="fixMissingTaskFields()" style="padding: 15px;">
							üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—è
						</button>
						
						<button class="btn btn-info" onclick="reorderTasksByLevel()" style="padding: 15px;">
							üîÑ –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É—Ä–æ–≤–Ω—é
						</button>
					</div>
					
					${appData.tasks.length > 0 ? `
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h5>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h5>
						<button class="btn btn-sm btn-outline-danger" onclick="if(confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞–¥–∞–Ω–∏—è?')) { clearAllTasks(); }">
							üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
						</button>
						<small style="display: block; margin-top: 10px; color: #666;">
							–ó–∞–¥–∞–Ω–∏–π: ${appData.tasks.length}, –ú–∞–∫—Å. –±–∞–ª–ª–æ–≤: ${appData.tasks.reduce((sum, t) => sum + (t.maxScore || 0), 0)}
						</small>
					</div>
					` : ''}
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏', html);
		}

		function reorderTasksByLevel() {
			// –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
			const tasksWithIndex = appData.tasks.map((task, index) => ({ task, index }));
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É—Ä–æ–≤–Ω—é
			tasksWithIndex.sort((a, b) => (a.task.level || 1) - (b.task.level || 1));
			
			// –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
			appData.tasks = tasksWithIndex.map(item => item.task);
			
			// –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			const newResults = appData.results.map(studentResults => {
				const newStudentResults = [];
				tasksWithIndex.forEach(item => {
					if (item.index < studentResults.length) {
						newStudentResults.push(studentResults[item.index]);
					}
				});
				return newStudentResults;
			});
			
			appData.results = newResults;
			
			saveData();
			renderAll();
			showNotification('üìä –ó–∞–¥–∞–Ω–∏—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏', 'success');
		}

		function clearAllTasks() {
			if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞–¥–∞–Ω–∏—è? –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
				appData.tasks = [];
				appData.results = appData.results.map(() => []);
				saveData();
				renderAll();
				showNotification('üóëÔ∏è –í—Å–µ –∑–∞–¥–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã', 'info');
			}
		}		
		
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
        function updateTask(index, field, value) {
            appData.tasks[index][field] = value;
            saveData();
            scheduleAutoSave();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
        function addTask() {
            const newTask = {
                type: `–ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ ${appData.tasks.length + 1}`,
                maxScore: 1,
                level: 1,
                knowledge: "",
                number: appData.tasks.length + 1
            };
            
            if (appData.test.workType === 'vpr') {
                newTask.competence = 'calculations';
                newTask.vprLevel = 1;
            } else if (appData.test.workType === 'func_literacy') {
                newTask.literacyType = 'reading';
                newTask.skill = '';
                newTask.context = 'personal';
            } else if (appData.test.workType === 'oge' || appData.test.workType === 'ege') {
                newTask.kes = '';
                newTask.pu = '';
                newTask.answerType = 'short';
            }
            
            appData.tasks.push(newTask);
            
            appData.results.forEach(studentResults => {
                studentResults.push(0);
            });
            
            saveData();
            renderTasks();
            renderResults();
            showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ${newTask.number}`, "success");
        }
		
		// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
		function ensureFunctionsExist() {
			const requiredFunctions = [
				'selectClass',
				'addWholeClassToTestingFromCard',
				'showQRForClass',
				'deleteClass',
				'addSelectedToTesting',
				'addWholeClassToTesting',
				'toggleAllStudents',
				'addSingleStudent',
				'renderClassStudents',
				'importSchoolFile'
			];
			
			const missingFunctions = [];
			
			requiredFunctions.forEach(funcName => {
				if (typeof window[funcName] !== 'function') {
					missingFunctions.push(funcName);
				}
			});
			
			if (missingFunctions.length > 0) {
				console.error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:', missingFunctions);
				showNotification(`–û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏: ${missingFunctions.join(', ')}`, 'error');
				return false;
			}
			
			return true;
		}

		// –í—ã–∑—ã–≤–∞–π—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			if (ensureFunctionsExist()) {
				console.log('–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞–º–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
			}
		});	

		// 1. –í—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞
		window.selectClass = function(classId) {
			console.log('selectClass –≤—ã–∑–≤–∞–Ω–∞ —Å classId:', classId);
			console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞—Å—Å—ã:', schoolData.classes.map(c => ({id: c.id, name: `${c.grade}${c.name}`})));
			
			const schoolClass = schoolData.classes.find(c => {
				console.log('–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º:', c.id, '—Å', classId, '—Ä–µ–∑—É–ª—å—Ç–∞—Ç:', c.id === classId);
				return c.id === classId || c.id.toString() === classId.toString();
			});
			
			if (!schoolClass) {
				console.error('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ò—â–µ–º –ø–æ:', classId);
				console.error('–¢–∏–ø classId:', typeof classId);
				console.error('–í—Å–µ –∫–ª–∞—Å—Å—ã:', schoolData.classes);
				showNotification('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
				return;
			}
			
			const selector = document.getElementById('classSelector');
			if (selector) {
				selector.value = classId;
				console.log('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–ª–∞—Å—Å –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ:', classId);
				
				if (typeof renderClassStudents === 'function') {
					renderClassStudents();
				}
			}
		};


		// 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞
		window.addWholeClassToTestingFromCard = function(classId) {
			console.log('addWholeClassToTestingFromCard –≤—ã–∑–≤–∞–Ω–∞ —Å classId:', classId);
			console.log('–ü–æ–∏—Å–∫ –∫–ª–∞—Å—Å–∞ –≤:', schoolData.classes.map(c => c.id));
			
			// –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∫–ª–∞—Å—Å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
			let schoolClass = schoolData.classes.find(c => c.id === classId);
			
			if (!schoolClass) {
				// –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É
				schoolClass = schoolData.classes.find(c => c.id.toString() === classId.toString());
			}
			
			if (!schoolClass) {
				// –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —á–∏—Å–ª–æ–≤–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
				const classIdNum = parseFloat(classId);
				if (!isNaN(classIdNum)) {
					schoolClass = schoolData.classes.find(c => parseFloat(c.id) === classIdNum);
				}
			}
			
			if (!schoolClass) {
				console.error('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫:', classId);
				console.error('–¢–∏–ø classId:', typeof classId);
				console.error('–í—Å–µ –∫–ª–∞—Å—Å—ã:', schoolData.classes);
				showNotification('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
				return;
			}
			
			console.log('–ö–ª–∞—Å—Å –Ω–∞–π–¥–µ–Ω:', schoolClass);
			
			if (confirm(`–î–æ–±–∞–≤–∏—Ç—å –≤–µ—Å—å –∫–ª–∞—Å—Å ${schoolClass.grade}${schoolClass.name} (${schoolClass.students.length} —É—á–µ–Ω–∏–∫–æ–≤) –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é?`)) {
				let addedCount = 0;
				
				schoolClass.students.forEach(student => {
					const studentExists = appData.students.some(s => {
						const existingName = s.toLowerCase();
						const newName = `${student.lastName} ${student.firstName}`.toLowerCase();
						return existingName.includes(newName) || newName.includes(existingName);
					});
					
					if (!studentExists) {
						appData.students.push(`${student.lastName} ${student.firstName} ${student.middleName || ''}`.trim());
						appData.results.push(new Array(appData.tasks.length).fill(0));
						addedCount++;
						console.log('–î–æ–±–∞–≤–ª–µ–Ω —É—á–µ–Ω–∏–∫:', student.lastName, student.firstName);
					}
				});
				
				if (addedCount > 0) {
					appData.test.presentStudents = appData.students.length;
					if (document.getElementById('presentStudents')) {
						document.getElementById('presentStudents').value = appData.students.length;
					}
					
					saveData();
					
					if (typeof renderStudents === 'function') {
						renderStudents();
					}
					if (typeof renderResults === 'function') {
						renderResults();
					}
					
					showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} —É—á–µ–Ω–∏–∫–æ–≤ –∏–∑ –∫–ª–∞—Å—Å–∞ ${schoolClass.grade}${schoolClass.name}`, 'success');
					
					const currentClassId = document.getElementById('classSelector')?.value;
					if (currentClassId === classId && typeof renderClassStudents === 'function') {
						renderClassStudents();
					}
				} else {
					showNotification('–í—Å–µ —É—á–µ–Ω–∏–∫–∏ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
				}
			}
		};

		// 3. –ü–æ–∫–∞–∑ QR-–∫–æ–¥–∞
		window.showQRForClass = function(classId) {
			console.log('showQRForClass –≤—ã–∑–≤–∞–Ω–∞ —Å classId:', classId);
			
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) {
				console.error('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω:', classId);
				showNotification('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
				return;
			}
			
			// –í—Ä–µ–º–µ–Ω–Ω–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∞—Å—Å–µ
			const studentList = schoolClass.students
				.map(s => `${s.lastName} ${s.firstName} ${s.middleName || ''}`.trim())
				.join('\n');
			
			const message = `–ö–ª–∞—Å—Å: ${schoolClass.grade}${schoolClass.name}\n` +
						   `–£—á–µ–Ω–∏–∫–æ–≤: ${schoolClass.students.length}\n\n` +
						   `–°–ø–∏—Å–æ–∫:\n${studentList}`;
			
			alert(message);
			showNotification(`–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ ${schoolClass.grade}${schoolClass.name} –ø–æ–∫–∞–∑–∞–Ω–∞`, 'info');
		};

		// 4. –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
		window.deleteClass = function(classId) {
			console.log('deleteClass –≤—ã–∑–≤–∞–Ω–∞ —Å classId:', classId);
			
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) {
				console.error('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω:', classId);
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å ${schoolClass.grade}${schoolClass.name}? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–± —É—á–µ–Ω–∏–∫–∞—Ö –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
				const index = schoolData.classes.findIndex(c => c.id === classId);
				if (index !== -1) {
					schoolData.classes.splice(index, 1);
					localStorage.setItem('schoolData', JSON.stringify(schoolData));
					
					if (typeof renderClassManager === 'function') {
						renderClassManager();
						showNotification('–ö–ª–∞—Å—Å —É–¥–∞–ª–µ–Ω', 'success');
					} else {
						console.error('renderClassManager –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
					}
				}
			}
		};
		
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
        function removeTask(taskIndex) {
            if (appData.tasks.length <= 1) {
                showNotification("–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ!", "error");
                return;
            }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ ‚Ññ${taskIndex + 1}?`)) {
                appData.tasks.splice(taskIndex, 1);
                
                appData.tasks.forEach((task, index) => {
                    task.number = index + 1;
                });
                
                appData.results.forEach(studentResults => {
                    studentResults.splice(taskIndex, 1);
                });
                
                appData.errors = appData.errors.filter(error => error.taskIndex !== taskIndex);
                appData.errors.forEach(error => {
                    if (error.taskIndex > taskIndex) {
                        error.taskIndex--;
                    }
                });
                
                saveData();
                renderTasks();
                renderResults();
                showNotification("–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!", "success");
            }
        }

        function removeLastTask() {
            if (appData.tasks.length > 0) {
                removeTask(appData.tasks.length - 1);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
        function saveTasks() {
            saveData();
            showNotification("–ó–∞–¥–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
        }

        // –†–µ–Ω–¥–µ—Ä —É—á–∞—â–∏—Ö—Å—è
		// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
		// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
		let dragStartIndex = null;
		let isDragging = false;

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π Bootstrap
		function addBootstrapMinimalStyles() {
			if (!document.getElementById('bootstrap-minimal-styles')) {
				const style = document.createElement('style');
				style.id = 'bootstrap-minimal-styles';
				style.textContent = `
					/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
					.btn {
						display: inline-block;
						font-weight: 400;
						text-align: center;
						white-space: nowrap;
						vertical-align: middle;
						user-select: none;
						border: 1px solid transparent;
						padding: 0.375rem 0.75rem;
						font-size: 1rem;
						line-height: 1.5;
						border-radius: 0.25rem;
						transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
						cursor: pointer;
					}
					
					/* –†–∞–∑–º–µ—Ä—ã –∫–Ω–æ–ø–æ–∫ */
					.btn-sm {
						padding: 0.25rem 0.5rem;
						font-size: 0.875rem;
						line-height: 1.5;
						border-radius: 0.2rem;
					}
					
					/* –¶–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ */
					.btn-success {
						color: #fff;
						background-color: #28a745;
						border-color: #28a745;
					}
					
					.btn-danger {
						color: #fff;
						background-color: #dc3545;
						border-color: #dc3545;
					}
					
					.btn-primary {
						color: #fff;
						background-color: #007bff;
						border-color: #007bff;
					}
					
					.btn-info {
						color: #fff;
						background-color: #17a2b8;
						border-color: #17a2b8;
					}
					
					.btn-secondary {
						color: #fff;
						background-color: #6c757d;
						border-color: #6c757d;
					}
					
					.btn-warning {
						color: #212529;
						background-color: #ffc107;
						border-color: #ffc107;
					}
					
					/* Outline —Å—Ç–∏–ª–∏ */
					.btn-outline-success {
						color: #28a745;
						background-color: transparent;
						background-image: none;
						border-color: #28a745;
					}
					
					.btn-outline-danger {
						color: #dc3545;
						background-color: transparent;
						background-image: none;
						border-color: #dc3545;
					}
					
					.btn-outline-primary {
						color: #007bff;
						background-color: transparent;
						background-image: none;
						border-color: #007bff;
					}
					
					.btn-outline-info {
						color: #17a2b8;
						background-color: transparent;
						background-image: none;
						border-color: #17a2b8;
					}
					
					.btn-outline-secondary {
						color: #6c757d;
						background-color: transparent;
						background-image: none;
						border-color: #6c757d;
					}
					
					.btn-outline-warning {
						color: #ffc107;
						background-color: transparent;
						background-image: none;
						border-color: #ffc107;
					}
					
					/* Hover —ç—Ñ—Ñ–µ–∫—Ç—ã */
					.btn:hover {
						color: #fff;
						text-decoration: none;
						opacity: 0.9;
					}
					
					.btn-outline-success:hover {
						color: #fff;
						background-color: #28a745;
						border-color: #28a745;
					}
					
					.btn-outline-danger:hover {
						color: #fff;
						background-color: #dc3545;
						border-color: #dc3545;
					}
					
					.btn-outline-primary:hover {
						color: #fff;
						background-color: #007bff;
						border-color: #007bff;
					}
					
					.btn-outline-info:hover {
						color: #fff;
						background-color: #17a2b8;
						border-color: #17a2b8;
					}
					
					.btn-outline-secondary:hover {
						color: #fff;
						background-color: #6c757d;
						border-color: #6c757d;
					}
					
					.btn-outline-warning:hover {
						color: #212529;
						background-color: #ffc107;
						border-color: #ffc107;
					}
					
					/* Disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
					.btn:disabled,
					.btn.disabled {
						opacity: 0.65;
						cursor: not-allowed;
					}
					
					/* –ì—Ä—É–ø–ø—ã –∫–Ω–æ–ø–æ–∫ */
					.btn-group {
						position: relative;
						display: inline-flex;
						vertical-align: middle;
					}
					
					.btn-group > .btn {
						position: relative;
						flex: 1 1 auto;
					}
					
					.btn-group > .btn:not(:last-child) {
						border-top-right-radius: 0;
						border-bottom-right-radius: 0;
					}
					
					.btn-group > .btn:not(:first-child) {
						border-top-left-radius: 0;
						border-bottom-left-radius: 0;
						margin-left: -1px;
					}
					
					/* Form controls */
					.form-control {
						display: block;
						width: 100%;
						padding: 0.375rem 0.75rem;
						font-size: 1rem;
						line-height: 1.5;
						color: #495057;
						background-color: #fff;
						background-clip: padding-box;
						border: 1px solid #ced4da;
						border-radius: 0.25rem;
						transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
					}
					
					.form-control-sm {
						padding: 0.25rem 0.5rem;
						font-size: 0.875rem;
						line-height: 1.5;
						border-radius: 0.2rem;
					}
					
					.form-control:focus {
						color: #495057;
						background-color: #fff;
						border-color: #80bdff;
						outline: 0;
						box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
					}
					
					/* Badge */
					.badge {
						display: inline-block;
						padding: 0.25em 0.4em;
						font-size: 75%;
						font-weight: 700;
						line-height: 1;
						text-align: center;
						white-space: nowrap;
						vertical-align: baseline;
						border-radius: 0.25rem;
					}
					
					.badge-success {
						color: #fff;
						background-color: #28a745;
					}
					
					.badge-warning {
						color: #212529;
						background-color: #ffc107;
					}
					
					.badge-secondary {
						color: #fff;
						background-color: #6c757d;
					}
					
					.badge-info {
						color: #fff;
						background-color: #17a2b8;
					}
					
					.badge-light {
						color: #212529;
						background-color: #f8f9fa;
					}
					
					/* Progress bar */
					.progress {
						display: flex;
						height: 1rem;
						overflow: hidden;
						font-size: 0.75rem;
						background-color: #e9ecef;
						border-radius: 0.25rem;
					}
					
					.progress-bar {
						display: flex;
						flex-direction: column;
						justify-content: center;
						color: #fff;
						text-align: center;
						white-space: nowrap;
						background-color: #007bff;
						transition: width 0.6s ease;
					}
					
					.bg-success {
						background-color: #28a745 !important;
					}
					
					.bg-warning {
						background-color: #ffc107 !important;
					}
					
					.bg-secondary {
						background-color: #6c757d !important;
					}
					
					.bg-info {
						background-color: #17a2b8 !important;
					}
					
					.bg-light {
						background-color: #f8f9fa !important;
					}
					
					/* Text colors */
					.text-white {
						color: #fff !important;
					}
					
					.text-muted {
						color: #6c757d !important;
					}
					
					/* Spacing utilities */
					.mb-0 { margin-bottom: 0 !important; }
					.mb-2 { margin-bottom: 0.5rem !important; }
					.mb-3 { margin-bottom: 1rem !important; }
					.mb-4 { margin-bottom: 1.5rem !important; }
					.mt-2 { margin-top: 0.5rem !important; }
					.mr-2 { margin-right: 0.5rem !important; }
					
					/* Flex utilities */
					.d-flex { display: flex !important; }
					.flex-wrap { flex-wrap: wrap !important; }
					.justify-content-between { justify-content: space-between !important; }
					.align-items-center { align-items: center !important; }
					.align-middle { vertical-align: middle !important; }
					
					/* Small text */
					.small { font-size: 80%; }
					
					/* Responsive */
					@media (max-width: 768px) {
						.d-sm-flex { display: flex !important; }
						.flex-sm-wrap { flex-wrap: wrap !important; }
					}
				`;
				document.head.appendChild(style);
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
		let isClassManagerView = false;

		function toggleViewMode() {
			isClassManagerView = !isClassManagerView;
			
			const studentsContainer = document.getElementById('studentsContainer');
			const classManagerContainer = document.getElementById('classManagerContainer');
			const viewModeText = document.getElementById('viewModeText');
			
			if (isClassManagerView) {
				studentsContainer.style.display = 'none';
				classManagerContainer.style.display = 'block';
				viewModeText.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö';
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã
				loadSchoolData();
				
				// –†–µ–Ω–¥–µ—Ä–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä –∫–ª–∞—Å—Å–æ–≤
				renderClassManager();
				
				// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
				setTimeout(() => {
					const classesGrid = document.getElementById('classesGrid');
					if (classesGrid) {
						classesGrid.addEventListener('click', handleClassAction);
					}
				}, 100);
				
			} else {
				studentsContainer.style.display = 'block';
				classManagerContainer.style.display = 'none';
				viewModeText.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–ª–∞—Å—Å–∞–º–∏';
				renderStudents();
			}
		}
		
		function renderStudents() {
			const container = document.getElementById('studentsContainer');
			container.innerHTML = '';
			
			// –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö
			if (appData.students.length === 0) {
				for (let i = 0; i < appData.test.presentStudents; i++) {
					appData.students.push(`–£—á–∞—â–∏–π—Å—è ${i + 1}`);
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
			}
			
			// –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã
			const controlsDiv = document.createElement('div');
			controlsDiv.style.cssText = `
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 20px;
				border-radius: 12px;
				margin-bottom: 20px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			`;

			controlsDiv.innerHTML = `
				<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
					<h4 style="color: white; margin: 0;">
						<span style="margin-right: 10px;">üë•</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —É—á–∞—â–∏—Ö—Å—è
					</h4>
					<span style="background: rgba(255,255,255,0.2); color: white; font-size: 14px; padding: 4px 8px; border-radius: 12px;">
						${appData.students.length} —É—á–∞—â–∏—Ö—Å—è
					</span>					
				</div>
				
				<div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; align-items: center;">
					<div style="display: flex; gap: 5px;">
						<button class="btn btn-success" onclick="addStudent()" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è" style="display: flex; align-items: center; gap: 5px;">
							<span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å
						</button>
						<button class="btn btn-outline-success" onclick="addMultipleStudents(5)" style="display: flex; align-items: center; gap: 5px; color: white; border-color: white;">
							<span>üë•</span> +5
						</button>
					</div>
					
					<div style="display: flex; gap: 5px;">
						<button class="btn btn-danger" onclick="removeLastStudent()" title="–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è" style="display: flex; align-items: center; gap: 5px;">
							<span>‚ûñ</span> –£–¥–∞–ª–∏—Ç—å
						</button>
						<button class="btn btn-outline-danger" onclick="clearStudents()" style="display: flex; align-items: center; gap: 5px; color: white; border-color: white;">
							<span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
						</button>
					</div>
					
					<button class="btn btn-primary" onclick="showQuickSetDialog()" style="display: flex; align-items: center; gap: 5px;">
						<span>üéØ</span> –ó–∞–¥–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
					</button>
					
					<button class="btn btn-info" onclick="showMassImportDialog()" style="display: flex; align-items: center; gap: 5px;">
						<span>üìù</span> –ò–º–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞
					</button>
					
					<button class="btn btn-secondary" onclick="exportStudentsList()" title="–≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –≤ CSV" style="display: flex; align-items: center; gap: 5px;">
						<span>üì§</span> –≠–∫—Å–ø–æ—Ä—Ç
					</button>
					
					<div style="position: relative; flex-grow: 1; max-width: 300px;">
						<input type="text" id="studentSearch" placeholder="–ü–æ–∏—Å–∫ —É—á–∞—â–∏—Ö—Å—è..." 
							   oninput="filterStudents()" class="form-control" style="padding-left: 35px;">
						<span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999;">üîç</span>
					</div>
				</div>
				
				<div>
					<small style="color: rgba(255,255,255,0.8);">
						<span>‚ÑπÔ∏è</span> 
						–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞. 
						${appData.test.totalStudents ? `–í—Å–µ–≥–æ –ø–æ —Å–ø–∏—Å–∫—É: ${appData.test.totalStudents}` : ''}
					</small>
				</div>
			`;
			container.appendChild(controlsDiv);
			
			// –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
			const tableWrapper = document.createElement('div');
			tableWrapper.className = 'students-table-wrapper';
			tableWrapper.style.cssText = 'background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow: hidden; margin-bottom: 20px;';
			
			const table = document.createElement('table');
			table.className = 'students-table';
			table.id = 'studentsTable';
			table.style.cssText = 'width: 100%; border-collapse: collapse;';
			
			// –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
			const thead = document.createElement('thead');
			thead.innerHTML = `
				<tr style="background: #f8f9fa;">
					<th style="width: 40px; padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">‚Ññ</th>
					<th style="width: 50px; padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;"></th>
					<th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">–§–ò–û —É—á–∞—â–µ–≥–æ—Å—è</th>
					<th style="width: 100px; padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">–°—Ç–∞—Ç—É—Å</th>
					<th style="width: 200px; padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">–î–µ–π—Å—Ç–≤–∏—è</th>
				</tr>
			`;
			table.appendChild(thead);
			
			// –¢–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ã
			const tbody = document.createElement('tbody');
			tbody.id = 'studentsTableBody';
			
			appData.students.forEach((student, index) => {
				const row = document.createElement('tr');
				row.id = `student-row-${index}`;
				row.draggable = true;
				row.dataset.index = index;
				row.style.cssText = 'transition: background-color 0.2s;';
				
				// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
				row.addEventListener('dragstart', handleDragStart);
				row.addEventListener('dragover', handleDragOver);
				row.addEventListener('drop', handleDrop);
				row.addEventListener('dragend', handleDragEnd);
				
				// –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–∞
				const studentResults = appData.results[index] || [];
				const completedTasks = studentResults.filter(score => score > 0).length;
				const totalTasks = appData.tasks.length;
				const progressPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
				
				row.innerHTML = `
					<td style="text-align: center; padding: 12px 15px; border-bottom: 1px solid #e9ecef;">
						<span style="font-weight: 600; color: #495057;">${index + 1}</span>
					</td>
					<td class="drag-handle" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞" style="cursor: grab; color: #adb5bd; text-align: center; padding: 12px 15px; border-bottom: 1px solid #e9ecef; user-select: none;">
						<span>‚ÜïÔ∏è</span>
					</td>
					<td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">
						<div style="display: flex; flex-direction: column; gap: 5px;">
							<input type="text" 
								   value="${student}" 
								   class="form-control form-control-sm"
								   data-index="${index}"
								   onchange="updateStudent(${index}, this.value)"
								   placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û"
								   style="border: 1px solid #ced4da; transition: all 0.3s;">
							<div style="display: flex; align-items: center; gap: 10px; font-size: 12px;">
								<div style="flex-grow: 1; height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
									<div style="height: 100%; background: linear-gradient(90deg, #28a745, #20c997); width: ${progressPercentage}%; transition: width 0.3s;"></div>
								</div>
								<small>${completedTasks}/${totalTasks}</small>
							</div>
						</div>
					</td>
					<td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">
						<span style="display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; background: ${progressPercentage === 100 ? '#d4edda' : progressPercentage > 0 ? '#fff3cd' : '#e9ecef'}; color: ${progressPercentage === 100 ? '#155724' : progressPercentage > 0 ? '#856404' : '#495057'}">
							${progressPercentage === 100 ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : progressPercentage > 0 ? '–ß–∞—Å—Ç–∏—á–Ω–æ' : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
						</span>
					</td>
					<td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">
						<div style="display: flex; gap: 5px; flex-wrap: nowrap;">
							<button class="btn btn-sm" onclick="duplicateStudent(${index})" title="–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å" style="padding: 2px 8px; font-size: 12px; background: #e7f5ff; color: #0066cc; border: 1px solid #b3d7ff;">
								<span>üìã</span>
							</button>
							<button class="btn btn-sm" onclick="editStudentInModal(${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" style="padding: 2px 8px; font-size: 12px; background: #fff8e6; color: #cc8800; border: 1px solid #ffdd99;">
								<span>‚úèÔ∏è</span>
							</button>
							<button class="btn btn-sm" onclick="removeStudent(${index})" title="–£–¥–∞–ª–∏—Ç—å" style="padding: 2px 8px; font-size: 12px; background: #ffe6e6; color: #cc0000; border: 1px solid #ff9999;">
								<span>üóëÔ∏è</span>
							</button>
							<button class="btn btn-sm" onclick="moveStudentUp(${index})" ${index === 0 ? 'disabled' : ''} title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–≤–µ—Ä—Ö" style="padding: 2px 8px; font-size: 12px; background: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; ${index === 0 ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
								<span>‚¨ÜÔ∏è</span>
							</button>
							<button class="btn btn-sm" onclick="moveStudentDown(${index})" ${index === appData.students.length - 1 ? 'disabled' : ''} title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–Ω–∏–∑" style="padding: 2px 8px; font-size: 12px; background: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; ${index === appData.students.length - 1 ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
								<span>‚¨áÔ∏è</span>
							</button>
						</div>
					</td>
				`;
				
				row.addEventListener('mouseenter', () => {
					row.style.backgroundColor = '#f8f9fa';
				});
				row.addEventListener('mouseleave', () => {
					row.style.backgroundColor = '';
				});
				
				tbody.appendChild(row);
			});
			
			table.appendChild(tbody);
			tableWrapper.appendChild(table);
			container.appendChild(tableWrapper);
			
			// –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–µ—Å–ª–∏ –º–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)
			if (appData.students.length > 20) {
				const paginationDiv = document.createElement('div');
				paginationDiv.style.cssText = 'text-align: center; padding: 10px; color: #6c757d; font-size: 14px;';
				paginationDiv.innerHTML = `
					<small>
						–ü–æ–∫–∞–∑–∞–Ω–æ ${appData.students.length} —É—á–∞—â–∏—Ö—Å—è. 
						–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
					</small>
				`;
				container.appendChild(paginationDiv);
			}
			
			// –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
			const quickActionsDiv = document.createElement('div');
			quickActionsDiv.style.cssText = 'background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;';
			quickActionsDiv.innerHTML = `
				<div style="margin-bottom: 10px;">
					<h6 style="margin: 0;"><span style="margin-right: 8px;">‚ö°</span> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
				</div>
				<div style="display: flex; flex-wrap: wrap; gap: 10px;">
					<button class="btn btn-outline-success btn-sm" onclick="generateDefaultNames()" style="display: flex; align-items: center; gap: 5px;">
						<span>üé≤</span> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞
					</button>
					<button class="btn btn-outline-warning btn-sm" onclick="sortStudentsAlphabetically()" style="display: flex; align-items: center; gap: 5px;">
						<span>üî§</span> –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
					</button>
					<button class="btn btn-outline-info btn-sm" onclick="randomizeOrder()" style="display: flex; align-items: center; gap: 5px;">
						<span>üéØ</span> –ü–µ—Ä–µ–º–µ—à–∞—Ç—å
					</button>
					<button class="btn btn-outline-secondary btn-sm" onclick="saveStudents()" style="display: flex; align-items: center; gap: 5px;">
						<span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫
					</button>
				</div>
			`;
			container.appendChild(quickActionsDiv);
		}
		
		// –ü–ï–†–ï–ú–ï–°–¢–ò–¢–ï –≠–¢–ò –§–£–ù–ö–¶–ò–ò –í –ù–ê–ß–ê–õ–û –§–ê–ô–õ–ê, –ø–µ—Ä–µ–¥ renderClassManager()

		// ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–õ–ê–°–°–û–í ====================

		// –í—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
		function selectClass(classId) {
			const selector = document.getElementById('classSelector');
			if (selector) {
				selector.value = classId;
				renderClassStudents();
			}
		}

		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ ID
		function addWholeClassToTestingFromCard(classId) {
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			if (!confirm(`–î–æ–±–∞–≤–∏—Ç—å –≤–µ—Å—å –∫–ª–∞—Å—Å ${schoolClass.grade}${schoolClass.name} (${schoolClass.students.length} —É—á–µ–Ω–∏–∫–æ–≤) –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é?`)) {
				return;
			}
			
			let addedCount = 0;
			schoolClass.students.forEach(student => {
				if (!appData.students.some(s => 
					s.includes(student.lastName) && s.includes(student.firstName))) {
					
					appData.students.push(`${student.lastName} ${student.firstName} ${student.middleName || ''}`.trim());
					appData.results.push(new Array(appData.tasks.length).fill(0));
					addedCount++;
				}
			});
			
			if (addedCount > 0) {
				appData.test.presentStudents = appData.students.length;
				if (document.getElementById('presentStudents')) {
					document.getElementById('presentStudents').value = appData.students.length;
				}
				
				saveData();
				renderStudents();
				renderResults();
				
				showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} —É—á–µ–Ω–∏–∫–æ–≤ –∏–∑ –∫–ª–∞—Å—Å–∞ ${schoolClass.grade}${schoolClass.name}`, 'success');
				
				if (document.getElementById('classSelector').value === classId) {
					renderClassStudents();
				}
			} else {
				showNotification('–í—Å–µ —É—á–µ–Ω–∏–∫–∏ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
			}
		}

		// –ü–æ–∫–∞–∑ QR-–∫–æ–¥–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞
		function showQRForClass(classId) {
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			// –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –∫–ª–∞—Å—Å–∞
			const classData = {
				classId: schoolClass.id,
				className: `${schoolClass.grade}${schoolClass.name}`,
				students: schoolClass.students.map(s => ({
					lastName: s.lastName,
					firstName: s.firstName,
					middleName: s.middleName
				})),
				timestamp: new Date().toISOString()
			};
			
			const dataStr = JSON.stringify(classData);
			const dataUrl = `data:application/json;charset=utf-8,${encodeURIComponent(dataStr)}`;
			
			// –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å QR-–∫–æ–¥–æ–º
			const modal = document.createElement('div');
			modal.className = 'modal fade';
			modal.id = 'qrModal';
			modal.innerHTML = `
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">QR-–∫–æ–¥ –∫–ª–∞—Å—Å–∞ ${schoolClass.grade}${schoolClass.name}</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body text-center">
							<div id="qrCodeContainer" class="mb-3"></div>
							<p class="text-muted small">
								–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–∞
							</p>
							<div class="d-grid gap-2">
								<button class="btn btn-outline-primary" onclick="downloadQRCode()">
									<i class="fas fa-download me-2"></i>–°–∫–∞—á–∞—Ç—å QR-–∫–æ–¥
								</button>
								<button class="btn btn-outline-secondary" onclick="shareClassData('${classId}')">
									<i class="fas fa-share-alt me-2"></i>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è
								</button>
							</div>
						</div>
					</div>
				</div>
			`;
			
			document.body.appendChild(modal);
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Bootstrap
			const modalInstance = new bootstrap.Modal(modal);
			modalInstance.show();
			
			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –ø–æ—Å–ª–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
			setTimeout(() => {
				if (typeof QRCode !== 'undefined') {
					QRCode.toCanvas(document.getElementById('qrCodeContainer'), dataUrl, {
						width: 200,
						margin: 2,
						color: {
							dark: '#000000',
							light: '#FFFFFF'
						}
					}, function(error) {
						if (error) {
							console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞:', error);
							showNotification('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞', 'error');
						}
					});
				} else {
					document.getElementById('qrCodeContainer').innerHTML = `
						<div class="alert alert-warning">
							<i class="fas fa-exclamation-triangle me-2"></i>
							–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ QR-–∫–æ–¥–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
						</div>
					`;
				}
			}, 100);
			
			// –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
			modal.addEventListener('hidden.bs.modal', function() {
				modal.remove();
			});
		}

		// –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
		function deleteClass(classId) {
			if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–ª–∞—Å—Å? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–± —É—á–µ–Ω–∏–∫–∞—Ö –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
				return;
			}
			
			const index = schoolData.classes.findIndex(c => c.id === classId);
			if (index !== -1) {
				schoolData.classes.splice(index, 1);
				localStorage.setItem('schoolData', JSON.stringify(schoolData));
				
				// –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
				if (typeof renderClassManager === 'function') {
					renderClassManager();
				}
				
				showNotification('–ö–ª–∞—Å—Å —É–¥–∞–ª–µ–Ω', 'success');
			}
		}

		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
		function addSelectedToTesting() {
			const classId = document.getElementById('classSelector').value;
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			const selectedStudents = Array.from(document.querySelectorAll('.student-checkbox:checked'))
				.map(cb => cb.value);
			
			if (selectedStudents.length === 0) {
				showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —É—á–µ–Ω–∏–∫–∞!', 'warning');
				return;
			}
			
			let addedCount = 0;
			selectedStudents.forEach(studentId => {
				const student = schoolClass.students.find(s => s.id === studentId);
				if (student && !appData.students.some(s => 
					s.includes(student.lastName) && s.includes(student.firstName))) {
					
					// –î–æ–±–∞–≤–ª—è–µ–º –≤ appData
					appData.students.push(`${student.lastName} ${student.firstName} ${student.middleName || ''}`.trim());
					appData.results.push(new Array(appData.tasks.length).fill(0));
					addedCount++;
				}
			});
			
			if (addedCount > 0) {
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö
				appData.test.presentStudents = appData.students.length;
				if (document.getElementById('presentStudents')) {
					document.getElementById('presentStudents').value = appData.students.length;
				}
				
				saveData();
				
				if (typeof renderStudents === 'function') {
					renderStudents();
				}
				if (typeof renderResults === 'function') {
					renderResults();
				}
				
				showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} —É—á–µ–Ω–∏–∫–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é`, 'success');
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∫–ª–∞—Å—Å–∞
				if (typeof renderClassStudents === 'function') {
					renderClassStudents();
				}
			}
		}

		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞
		function addWholeClassToTesting() {
			const classId = document.getElementById('classSelector').value;
			if (classId) {
				addWholeClassToTestingFromCard(classId);
			}
		}

		// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
		function toggleAllStudents(checked) {
			document.querySelectorAll('.student-checkbox:not(:disabled)').forEach(checkbox => {
				checkbox.checked = checked;
			});
		}

		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
		function addSingleStudent(studentId) {
			const classId = document.getElementById('classSelector').value;
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			const student = schoolClass.students.find(s => s.id === studentId);
			if (!student) return;
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ
			if (appData.students.some(s => 
				s.includes(student.lastName) && s.includes(student.firstName))) {
				showNotification('–≠—Ç–æ—Ç —É—á–µ–Ω–∏–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'warning');
				return;
			}
			
			appData.students.push(`${student.lastName} ${student.firstName} ${student.middleName || ''}`.trim());
			appData.results.push(new Array(appData.tasks.length).fill(0));
			
			appData.test.presentStudents = appData.students.length;
			if (document.getElementById('presentStudents')) {
				document.getElementById('presentStudents').value = appData.students.length;
			}
			
			saveData();
			
			if (typeof renderStudents === 'function') {
				renderStudents();
			}
			if (typeof renderResults === 'function') {
				renderResults();
			}
			
			showNotification(`–£—á–µ–Ω–∏–∫ ${student.lastName} ${student.firstName} –¥–æ–±–∞–≤–ª–µ–Ω`, 'success');
			
			if (typeof renderClassStudents === 'function') {
				renderClassStudents();
			}
		}

		// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞
		function downloadQRCode() {
			const canvas = document.querySelector('#qrModal canvas');
			if (!canvas) return;
			
			const link = document.createElement('a');
			link.download = `qr-code-–∫–ª–∞—Å—Å-${new Date().toISOString().slice(0, 10)}.png`;
			link.href = canvas.toDataURL('image/png');
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			
			showNotification('QR-–∫–æ–¥ —Å–∫–∞—á–∞–Ω', 'success');
		}

		// –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞
		function shareClassData(classId) {
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			const shareText = `–ö–ª–∞—Å—Å: ${schoolClass.grade}${schoolClass.name}\n` +
							 `–£—á–µ–Ω–∏–∫–æ–≤: ${schoolClass.students.length}\n` +
							 `–°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤:\n` +
							 schoolClass.students.map(s => 
								 `- ${s.lastName} ${s.firstName} ${s.middleName || ''}`
							 ).join('\n');
			
			if (navigator.share) {
				navigator.share({
					title: `–ö–ª–∞—Å—Å ${schoolClass.grade}${schoolClass.name}`,
					text: shareText,
					url: window.location.href
				}).catch(console.error);
			} else {
				// –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
				navigator.clipboard.writeText(shareText)
					.then(() => showNotification('–°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success'))
					.catch(() => {
						// Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
						const textarea = document.createElement('textarea');
						textarea.value = shareText;
						document.body.appendChild(textarea);
						textarea.select();
						document.execCommand('copy');
						document.body.removeChild(textarea);
						showNotification('–°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
					});
			}
		}		
		
		// —Ç—É—Ç –¥–æ–±–∞–≤–∏–ª
		document.addEventListener('DOMContentLoaded', function() {
			console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...');
			
			// –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
			setTimeout(function() {
				console.log('–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...');
				
				// –ü–†–û–í–ï–†–ö–ê BOOTSTRAP
				console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º Bootstrap...');
				console.log('window.bootstrap:', window.bootstrap);
				
				if (typeof bootstrap === 'undefined') {
					console.error('‚ùå Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
					
					// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
					console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º jQuery (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):', typeof $ === 'undefined' ? '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω' : '–ó–∞–≥—Ä—É–∂–µ–Ω');
					console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º Popper:', typeof Popper === 'undefined' ? '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω' : '–ó–∞–≥—Ä—É–∂–µ–Ω');
					
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ DOM —ç–ª–µ–º–µ–Ω—Ç—ã Bootstrap
					const bootstrapElements = document.querySelectorAll('[data-bs-toggle]');
					console.log(`–ù–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å data-bs-toggle: ${bootstrapElements.length}`);
					
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
					const errorMessage = 'Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. ' +
									   '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
					showNotification(errorMessage, 'error');
					
					// –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
					const reloadBtn = document.createElement('button');
					reloadBtn.className = 'btn btn-sm btn-warning ms-2';
					reloadBtn.textContent = '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å';
					reloadBtn.onclick = function() {
						location.reload();
					};
					
					// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è)
					setTimeout(() => {
						const alert = document.querySelector('.alert-danger .btn-close');
						if (alert && alert.parentNode) {
							alert.parentNode.insertBefore(reloadBtn, alert);
						}
					}, 100);
					
				} else {
					console.log('‚úÖ Bootstrap —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω');
					console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Bootstrap:', Object.keys(bootstrap).filter(key => key !== '__proto__'));
					
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Bootstrap
					const components = ['Modal', 'Dropdown', 'Tooltip', 'Popover', 'Toast', 'Alert'];
					components.forEach(comp => {
						if (bootstrap[comp]) {
							console.log(`‚úÖ Bootstrap ${comp} –¥–æ—Å—Ç—É–ø–µ–Ω`);
						} else {
							console.warn(`‚ö†Ô∏è Bootstrap ${comp} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`);
						}
					});
				}
				
				// –ü–†–û–í–ï–†–ö–ê XLSX
				console.log('\n–ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É XLSX...');
				if (typeof XLSX === 'undefined') {
					console.warn('‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ XLSX –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç Excel –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
					showNotification('–§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å Excel –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', 'warning');
				} else {
					console.log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ XLSX —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
					console.log('–í–µ—Ä—Å–∏—è XLSX:', XLSX.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞');
				}
				
				// –ü–†–û–í–ï–†–ö–ê QRCode
				console.log('\n–ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É QRCode...');
				if (typeof QRCode === 'undefined') {
					console.warn('‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ QRCode –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
					showNotification('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'warning');
				} else {
					console.log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ QRCode —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
				}
				
				// –ü–†–û–í–ï–†–ö–ê –î–†–£–ì–ò–• –í–û–ó–ú–û–ñ–ù–´–• –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô
				console.log('\n–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:');
				
				// –ü—Ä–æ–≤–µ—Ä–∫–∞ jQuery (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
				if (typeof $ !== 'undefined') {
					console.log('‚úÖ jQuery –∑–∞–≥—Ä—É–∂–µ–Ω, –≤–µ—Ä—Å–∏—è:', $.fn.jquery);
				}
				
				// –ü—Ä–æ–≤–µ—Ä–∫–∞ Popper.js (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
				if (typeof Popper !== 'undefined') {
					console.log('‚úÖ Popper.js –∑–∞–≥—Ä—É–∂–µ–Ω');
				}
				
				// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ localStorage
				try {
					localStorage.setItem('test', 'test');
					localStorage.removeItem('test');
					console.log('‚úÖ localStorage –¥–æ—Å—Ç—É–ø–µ–Ω');
				} catch (e) {
					console.warn('‚ö†Ô∏è localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', e.message);
					showNotification('–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, —É –≤–∞—Å –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã cookies.', 'warning');
				}
				
				// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ fetch
				if (typeof fetch === 'undefined') {
					console.warn('‚ö†Ô∏è Fetch API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
					showNotification('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ', 'warning');
				} else {
					console.log('‚úÖ Fetch API –¥–æ—Å—Ç—É–ø–µ–Ω');
				}
				
				// –°–≤–æ–¥–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫
				console.log('\n======= –°–í–û–î–ö–ê –ü–†–û–í–ï–†–û–ö =======');
				const checks = {
					'Bootstrap': typeof bootstrap !== 'undefined',
					'XLSX': typeof XLSX !== 'undefined',
					'QRCode': typeof QRCode !== 'undefined',
					'localStorage': (() => {
						try {
							localStorage.setItem('test', 'test');
							localStorage.removeItem('test');
							return true;
						} catch {
							return false;
						}
					})(),
					'Fetch API': typeof fetch !== 'undefined'
				};
				
				Object.entries(checks).forEach(([name, status]) => {
					console.log(`${status ? '‚úÖ' : '‚ùå'} ${name}: ${status ? '–û–ö' : '–ù–ï –ó–ê–ì–†–£–ñ–ï–ù–û'}`);
				});
				
				console.log('=============================\n');
				
				// –ï—Å–ª–∏ Bootstrap –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç JS
				if (typeof bootstrap !== 'undefined') {
					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ç—É–ª—Ç–∏–ø–æ–≤
					const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
					tooltipTriggerList.map(function (tooltipTriggerEl) {
						return new bootstrap.Tooltip(tooltipTriggerEl);
					});
					
					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ø–∞–ø–æ–≤
					const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
					popoverTriggerList.map(function (popoverTriggerEl) {
						return new bootstrap.Popover(popoverTriggerEl);
					});
					
					console.log('‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Bootstrap –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
				}
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ Bootstrap –∑–∞–≥—Ä—É–∂–µ–Ω
				if (typeof bootstrap !== 'undefined') {
					loadSchoolData();
				} else {
					console.error('‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã: Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
					showNotification('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ Bootstrap', 'error');
				}
				
			}, 100); // –ó–∞–¥–µ—Ä–∂–∫–∞ 100–º—Å –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
		});

		// –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–≥—Ä—É–∑–∫–æ–π
		window.addEventListener('error', function(e) {
			// –§–∏–ª—å—Ç—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Å–∫—Ä–∏–ø—Ç–æ–≤
			if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
				console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–∞:', e.target.src || e.target.href);
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–≤—è–∑–∞–Ω–∞ –ª–∏ –æ—à–∏–±–∫–∞ —Å Bootstrap
				const src = e.target.src || e.target.href || '';
				if (src.includes('bootstrap')) {
					showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Bootstrap: ${e.message}`, 'error');
				}
			}
		});

		// –¢–∞–∫–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–æ–º–∏—Å–æ–≤
		window.addEventListener('unhandledrejection', function(event) {
			console.error('‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–º–∏—Å–∞:', event.reason);
		});

		console.log('–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω');	

		// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
		function debugClassActions() {
			console.log('=== –î–ï–ë–ê–ì –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===');
			console.log('1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ window:');
			console.log('- selectClass:', typeof window.selectClass);
			console.log('- addWholeClassToTestingFromCard:', typeof window.addWholeClassToTestingFromCard);
			console.log('- showQRForClass:', typeof window.showQRForClass);
			console.log('- deleteClass:', typeof window.deleteClass);
			
			console.log('2. –î–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–≤:');
			console.log('–í—Å–µ–≥–æ –∫–ª–∞—Å—Å–æ–≤:', schoolData.classes.length);
			schoolData.classes.forEach((cls, i) => {
				console.log(`–ö–ª–∞—Å—Å ${i}: ${cls.grade}${cls.name}, ID: ${cls.id}, –£—á–µ–Ω–∏–∫–æ–≤: ${cls.students.length}`);
			});
			
			console.log('3. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTML —ç–ª–µ–º–µ–Ω—Ç–æ–≤:');
			setTimeout(() => {
				const buttons = document.querySelectorAll('.btn-group .btn');
				console.log('–ù–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫ –≤ –≥—Ä—É–ø–ø–∞—Ö:', buttons.length);
				buttons.forEach((btn, i) => {
					console.log(`–ö–Ω–æ–ø–∫–∞ ${i}:`, {
						onclick: btn.getAttribute('onclick'),
						html: btn.innerHTML,
						parent: btn.parentElement?.parentElement?.parentElement?.querySelector('h6')?.textContent
					});
				});
			}, 1000);
		}		
		
		// –∫–ª–∞—Å—Å—ã
		function renderClassManager() {
			setTimeout(debugClassActions, 500);
			const container = document.getElementById('classManagerContainer');
			if (!container) return;
			
			container.innerHTML = '';
			
			const classesCount = schoolData.classes.length;
			
			// –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞–º–∏
			const mainCard = document.createElement('div');
			mainCard.className = 'class-manager-container';
			mainCard.innerHTML = `
				<div class="dashboard-header mb-4">
					<div class="row">
						<div class="col-lg-8">
							<div class="d-flex align-items-center">
								<div class="dashboard-icon me-3">
									<i class="fas fa-school fa-2x text-primary"></i>
								</div>
								<div>
									<h1 class="h3 mb-1">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞–º–∏</h1>
									<p class="text-muted mb-0">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏ –∏ –∫–ª–∞—Å—Å–∞–º–∏</p>
								</div>
							</div>
						</div>
						<div class="col-lg-4">
							<div class="stats-card card border-0 bg-primary text-white h-100">
								<div class="card-body py-3">
									<div class="d-flex justify-content-between align-items-center">
										<div>
											<div class="small opacity-75">–í—Å–µ–≥–æ –∫–ª–∞—Å—Å–æ–≤</div>
											<div class="h2 mb-0">${classesCount}</div>
										</div>
										<i class="fas fa-chalkboard fa-2x opacity-50"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="row">
					<div class="col-xl-8">
						<!-- –ë–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ -->
						<div class="card border-0 shadow-sm mb-4">
							<div class="card-header bg-white border-0 py-3">
								<h5 class="mb-0"><i class="fas fa-file-import text-primary me-2"></i>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã</h5>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-md-6 mb-4">
										<div class="mb-3">
											<label class="form-label fw-medium">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã</label>
											<div class="input-group">
												<span class="input-group-text">
													<i class="fas fa-university"></i>
												</span>
												<input type="text" id="schoolName" class="form-control form-control-lg" 
													   value="${schoolData.schoolName || ''}" 
													   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã">
											</div>
										</div>
										
										${schoolData.lastImportDate ? `
											<div class="alert alert-light border mb-4">
												<div class="d-flex align-items-center">
													<i class="fas fa-clock text-info me-3 fa-lg"></i>
													<div>
														<div class="fw-medium">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–º–ø–æ—Ä—Ç</div>
														<div class="text-muted">
															${new Date(schoolData.lastImportDate).toLocaleDateString('ru-RU', {
																day: 'numeric',
																month: 'long',
																year: 'numeric',
																hour: '2-digit',
																minute: '2-digit'
															})}
														</div>
													</div>
												</div>
											</div>
										` : ''}
									</div>
									
									<div class="col-md-6 mb-4">
										<div class="import-card card border-dashed h-100">
											<div class="card-body d-flex flex-column align-items-center justify-content-center py-4">
												<div class="import-icon mb-3">
													<i class="fas fa-cloud-upload-alt fa-3x text-muted"></i>
												</div>
												<h5 class="mb-2">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</h5>
												<p class="text-muted text-center small mb-3">
													–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
												</p>
												
												<div class="file-upload-area w-100">
													<input type="file" id="schoolFileInput" class="d-none" 
														   accept=".xlsx,.xls,.csv,.txt,.json">
													<label for="schoolFileInput" class="btn btn-outline-primary w-100 mb-3">
														<i class="fas fa-folder-open me-2"></i>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
													</label>
													
													<select id="fileFormat" class="form-select">
														<option value="auto">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞</option>
														<option value="excel">Excel —Ñ–æ—Ä–º–∞—Ç</option>
														<option value="csv">CSV —Ñ–∞–π–ª</option>
														<option value="json">JSON –¥–∞–Ω–Ω—ã–µ</option>
													</select>
												</div>
												
												<div class="mt-3 text-center">
													<button class="btn btn-primary px-4" onclick="importSchoolFile()">
														<i class="fas fa-upload me-2"></i>–ù–∞—á–∞—Ç—å –∏–º–ø–æ—Ä—Ç
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								
								<div class="formats-info">
									<div class="row">
										<div class="col-md-4">
											<div class="format-card text-center p-3">
												<div class="format-icon mb-2">
													<i class="fas fa-file-excel fa-2x text-success"></i>
												</div>
												<div class="format-name fw-medium">Excel</div>
												<div class="format-ext small text-muted">.xlsx, .xls</div>
											</div>
										</div>
										<div class="col-md-4">
											<div class="format-card text-center p-3">
												<div class="format-icon mb-2">
													<i class="fas fa-file-csv fa-2x text-info"></i>
												</div>
												<div class="format-name fw-medium">CSV</div>
												<div class="format-ext small text-muted">.csv, .txt</div>
											</div>
										</div>
										<div class="col-md-4">
											<div class="format-card text-center p-3">
												<div class="format-icon mb-2">
													<i class="fas fa-file-code fa-2x text-warning"></i>
												</div>
												<div class="format-name fw-medium">JSON</div>
												<div class="format-ext small text-muted">.json</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<!-- –í—Å–µ –∫–ª–∞—Å—Å—ã —à–∫–æ–ª—ã -->
						<div class="card border-0 shadow-sm">
							<div class="card-header bg-white border-0 py-3">
								<div class="d-flex justify-content-between align-items-center">
									<h5 class="mb-0"><i class="fas fa-chalkboard text-primary me-2"></i>–í—Å–µ –∫–ª–∞—Å—Å—ã —à–∫–æ–ª—ã</h5>
									<span class="badge bg-primary rounded-pill px-3 py-2">${classesCount} –∫–ª–∞—Å—Å–æ–≤</span>
								</div>
							</div>
							<div class="card-body">
								${classesCount === 0 ? `
									<div class="empty-state text-center py-5">
										<div class="empty-state-icon mb-3">
											<i class="fas fa-school fa-3x text-light bg-primary rounded-circle p-4"></i>
										</div>
										<h4 class="text-muted mb-2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∞—Å—Å–∞—Ö</h4>
										<p class="text-muted mb-4">–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º —É—á–∞—â–∏—Ö—Å—è —à–∫–æ–ª—ã</p>
										<button class="btn btn-primary" onclick="importSchoolFile()">
											<i class="fas fa-upload me-2"></i>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
										</button>
									</div>
								` : `
									<div class="row" id="classesGrid">
										<!-- –ö–ª–∞—Å—Å—ã –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
									</div>
								`}
							</div>
						</div>
					</div>
					
					<div class="col-xl-4">
						<!-- –ë–ª–æ–∫ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ -->
						<div class="sticky-top" style="top: 20px;">
							<div class="card border-0 shadow-sm mb-4">
								<div class="card-header bg-white border-0 py-3">
									<h5 class="mb-0"><i class="fas fa-users text-primary me-2"></i>–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä —É—á–µ–Ω–∏–∫–æ–≤</h5>
								</div>
								<div class="card-body">
									<div class="mb-4">
										<label class="form-label fw-medium">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</label>
										<div class="class-selector-wrapper">
											<select id="classSelector" class="form-select form-select-lg" onchange="renderClassStudents()">
												<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å --</option>
												${schoolData.classes.map(cls => `
													<option value="${cls.id}">
														${cls.grade}${cls.name} (${cls.students.length} —É—á.)
													</option>
												`).join('')}
											</select>
											<div class="select-arrow">
												<i class="fas fa-chevron-down"></i>
											</div>
										</div>
									</div>
									
									<div id="classStudentsContainer" class="mb-4">
										<!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —É—á–µ–Ω–∏–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ -->
										<div class="empty-state text-center py-5">
											<div class="empty-state-icon mb-3">
												<i class="fas fa-user-graduate fa-2x text-light bg-primary rounded-circle p-3"></i>
											</div>
											<h6 class="text-muted mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</h6>
											<p class="text-muted small">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —É—á–µ–Ω–∏–∫–æ–≤</p>
										</div>
									</div>
									
									<div class="action-buttons">
										<div class="d-grid gap-3">
											<button class="btn btn-primary btn-lg py-3" 
													onclick="addSelectedToTesting()" 
													disabled 
													id="addSelectedBtn">
												<div class="d-flex align-items-center justify-content-center">
													<i class="fas fa-user-plus me-3 fa-lg"></i>
													<div class="text-start">
														<div class="fw-medium">–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö</div>
														<div class="extra-small">–ù–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
													</div>
												</div>
											</button>
											
											<button class="btn btn-success btn-lg py-3" 
													onclick="addWholeClassToTesting()" 
													disabled 
													id="addWholeClassBtn">
												<div class="d-flex align-items-center justify-content-center">
													<i class="fas fa-users me-3 fa-lg"></i>
													<div class="text-start">
														<div class="fw-medium">–í–µ—Å—å –∫–ª–∞—Å—Å</div>
														<div class="extra-small">–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤</div>
													</div>
												</div>
											</button>
										</div>
									</div>
								</div>
							</div>
							
							<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
							<div class="card border-0 shadow-sm">
								<div class="card-header bg-white border-0 py-3">
									<h6 class="mb-0"><i class="fas fa-chart-bar text-primary me-2"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
								</div>
								<div class="card-body">
									<div class="stats-list">
										<div class="stat-item d-flex justify-content-between align-items-center mb-3">
											<div class="stat-label">
												<i class="fas fa-chalkboard me-2 text-muted"></i>
												–í—Å–µ–≥–æ –∫–ª–∞—Å—Å–æ–≤
											</div>
											<div class="stat-value fw-bold">${classesCount}</div>
										</div>
										
										<div class="stat-item d-flex justify-content-between align-items-center mb-3">
											<div class="stat-label">
												<i class="fas fa-users me-2 text-muted"></i>
												–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤
											</div>
											<div class="stat-value fw-bold">
												${schoolData.classes.reduce((sum, cls) => sum + cls.students.length, 0)}
											</div>
										</div>
										
										<div class="stat-item d-flex justify-content-between align-items-center mb-3">
											<div class="stat-label">
												<i class="fas fa-check-circle me-2 text-muted"></i>
												–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
											</div>
											<div class="stat-value fw-bold">0</div>
										</div>
										
										<div class="progress-wrapper mt-4">
											<div class="d-flex justify-content-between mb-1">
												<div class="extra-small text-muted">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å</div>
												<div class="extra-small text-muted">25%</div>
											</div>
											<div class="progress" style="height: 6px;">
												<div class="progress-bar bg-primary" style="width: 25%"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			`;
			
			container.appendChild(mainCard);
			
			// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–µ—Ç–∫—É –∫–ª–∞—Å—Å–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
			if (classesCount > 0) {
				renderClassesGrid();
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ç–∫–∏ –∫–ª–∞—Å—Å–æ–≤
		function renderClassesGrid() {
			const container = document.getElementById('classesGrid');
			if (!container) return;
			
			container.innerHTML = '';
			
			console.log('–†–µ–Ω–¥–µ—Ä–∏–º —Å–µ—Ç–∫—É –∫–ª–∞—Å—Å–æ–≤. –í—Å–µ–≥–æ –∫–ª–∞—Å—Å–æ–≤:', schoolData.classes.length);
			
			// –ï—Å–ª–∏ –∫–ª–∞—Å—Å–æ–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
			if (schoolData.classes.length === 0) {
				container.innerHTML = `
					<div class="col-12">
						<div class="card border-dashed">
							<div class="card-body text-center py-5">
								<i class="fas fa-school fa-3x text-muted mb-3"></i>
								<h5 class="text-muted">–ö–ª–∞—Å—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
								<p class="text-muted mb-0">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª–∞—Å—Å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
							</div>
						</div>
					</div>
				`;
				return;
			}
			
			schoolData.classes.forEach(cls => {
				const classCard = document.createElement('div');
				classCard.className = 'col-xxl-2 col-xl-3 col-lg-4 col-md-6 mb-4';
				
				const classIdStr = String(cls.id);
				const studentsCount = cls.students.length;
				
				classCard.innerHTML = `
					<div class="class-card card h-100 border-hover shadow-sm">
						<div class="card-header bg-gradient-primary text-white py-3">
							<div class="d-flex justify-content-between align-items-start">
								<div>
									<h5 class="card-title mb-1">${cls.grade}${cls.name}</h5>
									${cls.teacher ? `
										<div class="d-flex align-items-center mt-2">
											<i class="fas fa-chalkboard-teacher me-2 small"></i>
											<span class="small opacity-90">${cls.teacher}</span>
										</div>
									` : ''}
								</div>
								<span class="badge bg-white text-primary rounded-pill px-3 py-2">
									<i class="fas fa-users me-1"></i>
									${studentsCount}
								</span>
							</div>
						</div>
						
						<div class="card-body p-3">
							<div class="students-list" style="max-height: 180px; overflow-y: auto;">
								${cls.students.slice(0, 6).map((student, index) => `
									<div class="student-item d-flex align-items-center justify-content-between py-2 ${index > 0 ? 'border-top-light' : ''}">
										<div class="d-flex align-items-center">
											<div class="student-avatar me-2">
												<div class="avatar-circle bg-light text-dark small">
													${student.lastName.charAt(0)}${student.firstName.charAt(0)}
												</div>
											</div>
											<div>
												<div class="student-name fw-medium">${student.lastName} ${student.firstName.charAt(0)}.</div>
												${student.middleName ? `<div class="student-patronymic text-muted extra-small">${student.middleName}</div>` : ''}
											</div>
										</div>
									</div>
								`).join('')}
								
								${studentsCount > 6 ? `
									<div class="more-students text-center mt-3 pt-2 border-top-light">
										<div class="badge bg-light text-dark px-3 py-2">
											<i class="fas fa-ellipsis-h me-1"></i>
											–ï—â—ë ${studentsCount - 6} —É—á–µ–Ω–∏–∫–æ–≤
										</div>
									</div>
								` : ''}
								
								${studentsCount === 0 ? `
									<div class="text-center py-4">
										<i class="fas fa-user-graduate fa-2x text-muted mb-2"></i>
										<p class="text-muted small mb-0">–í –∫–ª–∞—Å—Å–µ –ø–æ–∫–∞ –Ω–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>
									</div>
								` : ''}
							</div>
						</div>
						
						<div class="card-footer bg-transparent border-top-0 py-3">
							<div class="btn-group-vertical w-100 gap-2">
								<button class="btn btn-primary" onclick="selectClass('${classIdStr}')">
									<i class="fas fa-check me-2"></i>–í—ã–±—Ä–∞—Ç—å –∫–ª–∞—Å—Å
								</button>
								
								<div class="d-grid gap-1">
									<button class="btn btn-outline-success btn-sm" onclick="addWholeClassToTestingFromCard('${classIdStr}')">
										<i class="fas fa-user-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
									</button>
									<button class="btn btn-outline-info btn-sm" onclick="showQRForClass('${classIdStr}')">
										<i class="fas fa-qrcode me-1"></i>QR-–∫–æ–¥ –∫–ª–∞—Å—Å–∞
									</button>
									<button class="btn btn-outline-danger btn-sm" onclick="deleteClass('${classIdStr}')">
										<i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å
									</button>
								</div>
							</div>
						</div>
					</div>
				`;
				container.appendChild(classCard);
			});
		}

		// 10. –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –¥–∞–Ω–Ω—ã—Ö
		function debugSchoolData() {
			console.log('=== –û–¢–õ–ê–î–ö–ê SCHOOLDATA ===');
			console.log('schoolData:', schoolData);
			console.log('–ö–ª–∞—Å—Å—ã:', schoolData.classes.length);
			
			schoolData.classes.forEach((cls, i) => {
				console.log(`–ö–ª–∞—Å—Å ${i}:`, {
					id: cls.id,
					type: typeof cls.id,
					name: `${cls.grade}${cls.name}`,
					students: cls.students.length,
					isClassInstance: cls instanceof SchoolClass
				});
			});
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
			const saved = localStorage.getItem('schoolData');
			if (saved) {
				const parsed = JSON.parse(saved);
				console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage:', parsed);
			}
		}
		
		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–π—Å—Ç–≤–∏–π —Å –∫–ª–∞—Å—Å–∞–º–∏
		function handleClassAction(event) {
			const button = event.target.closest('.class-action-btn');
			if (!button) return;
			
			const classId = button.dataset.classId;
			const action = button.dataset.action;
			
			console.log('handleClassAction:', { classId, action, button: button.innerHTML });
			
			if (!classId) {
				console.error('classId –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ');
				return;
			}
			
			// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –∫–ª–∞—Å—Å–∞
			console.log('–ü–æ–∏—Å–∫ –∫–ª–∞—Å—Å–∞ —Å ID:', classId);
			console.log('–¢–∏–ø classId:', typeof classId);
			console.log('–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ ID:', schoolData.classes.map(c => ({id: c.id, type: typeof c.id})));
			
			const schoolClass = schoolData.classes.find(c => {
				return c.id == classId || 
					   c.id.toString() === classId.toString() ||
					   String(c.id) === String(classId);
			});
			
			if (!schoolClass) {
				console.error('–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º');
				return;
			}
			
			console.log('–ö–ª–∞—Å—Å –Ω–∞–π–¥–µ–Ω:', schoolClass);
			
			switch(action) {
				case 'select':
					selectClass(classId);
					break;
				case 'add-all':
					addWholeClassToTestingFromCard(classId);
					break;
				case 'qr':
					showQRForClass(classId);
					break;
				case 'delete':
					deleteClass(classId);
					break;
			}
		}


		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
		// –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ renderClassStudents:
		function renderClassStudents() {
			const classId = document.getElementById('classSelector').value;
			const container = document.getElementById('classStudentsContainer');
			const addSelectedBtn = document.getElementById('addSelectedBtn');
			const addWholeClassBtn = document.getElementById('addWholeClassBtn');
			
			// –û—á–∏—Å—Ç–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
			if (!classId || !container) {
				if (container) {
					container.innerHTML = `
						<div class="empty-state text-center py-5">
							<div class="empty-state-icon mb-3">
								<i class="fas fa-users fa-3x text-light bg-primary rounded-circle p-4"></i>
							</div>
							<h5 class="text-muted mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</h5>
							<p class="text-muted small">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —É—á–µ–Ω–∏–∫–æ–≤</p>
						</div>
					`;
				}
				if (addSelectedBtn) {
					addSelectedBtn.disabled = true;
					addSelectedBtn.classList.add('opacity-50');
				}
				if (addWholeClassBtn) {
					addWholeClassBtn.disabled = true;
					addWholeClassBtn.classList.add('opacity-50');
				}
				return;
			}
			
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) {
				container.innerHTML = `
					<div class="alert alert-warning">
						<i class="fas fa-exclamation-triangle me-2"></i>
						–ö–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
					</div>
				`;
				return;
			}
			
			const studentsCount = schoolClass.students.length;
			const addedStudents = appData.students || [];
			
			// –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
			let html = `
				<div class="class-header mb-4">
					<div class="d-flex justify-content-between align-items-start mb-3">
						<div>
							<h4 class="mb-1">${schoolClass.grade}${schoolClass.name}</h4>
							${schoolClass.teacher ? `
								<div class="d-flex align-items-center text-muted">
									<i class="fas fa-chalkboard-teacher me-2 small"></i>
									<span>${schoolClass.teacher}</span>
								</div>
							` : ''}
						</div>
						<div class="text-end">
							<span class="badge bg-primary rounded-pill px-3 py-2">
								<i class="fas fa-users me-1"></i>
								${studentsCount} —É—á–µ–Ω–∏–∫–æ–≤
							</span>
							${addedStudents.length > 0 ? `
								<div class="mt-2">
									<span class="badge bg-success rounded-pill px-3 py-1">
										<i class="fas fa-check me-1"></i>
										${addedStudents.filter(s => 
											schoolClass.students.some(clsStudent => 
												s.includes(clsStudent.lastName) && s.includes(clsStudent.firstName)
											)
										).length} –¥–æ–±–∞–≤–ª–µ–Ω–æ
									</span>
								</div>
							` : ''}
						</div>
					</div>
					
					<div class="action-bar card border-0 bg-light p-3 mb-3">
						<div class="row g-2">
							<div class="col-md-8">
								<div class="form-check form-switch d-flex align-items-center">
									<input class="form-check-input me-2" type="checkbox" 
										   id="selectAllStudents" role="switch"
										   onchange="toggleAllStudents(this.checked)">
									<label class="form-check-label fw-medium" for="selectAllStudents">
										–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤
									</label>
								</div>
								<div class="form-text small text-muted mt-1">
									–û—Ç–º–µ—Ç—å—Ç–µ —É—á–µ–Ω–∏–∫–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
								</div>
							</div>
							<div class="col-md-4">
								<div class="btn-group w-100">
									<button class="btn btn-sm btn-outline-primary" onclick="clearSelection()">
										<i class="fas fa-times me-1"></i>–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
									</button>
									<button class="btn btn-sm btn-outline-success" onclick="addInvertedSelection()">
										<i class="fas fa-exchange-alt me-1"></i>–ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="students-container">
					<div class="students-list" style="max-height: 300px; overflow-y: auto;">
			`;
			
			// –°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤
			if (studentsCount === 0) {
				html += `
					<div class="text-center py-5">
						<i class="fas fa-user-graduate fa-3x text-muted mb-3"></i>
						<h5 class="text-muted">–í –∫–ª–∞—Å—Å–µ –Ω–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h5>
						<p class="text-muted small">–î–æ–±–∞–≤—å—Ç–µ —É—á–µ–Ω–∏–∫–æ–≤ –≤ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å</p>
					</div>
				`;
			} else {
				schoolClass.students.forEach((student, index) => {
					const isInTesting = addedStudents.some(s => 
						s.includes(student.lastName) && s.includes(student.firstName)
					);
					const studentId = student.id || `${student.lastName}_${student.firstName}`;
					
					html += `
						<div class="student-card card mb-2 border-hover ${isInTesting ? 'border-success border-2' : ''}">
							<div class="card-body py-2">
								<div class="row align-items-center">
									<div class="col-auto">
										<div class="form-check">
											<input class="form-check-input student-checkbox" type="checkbox" 
												   value="${studentId}" id="student_${studentId}"
												   ${isInTesting ? 'disabled' : ''}>
										</div>
									</div>
									<div class="col">
										<div class="d-flex align-items-center">
											<div class="student-avatar me-3">
												<div class="avatar-circle bg-primary text-white">
													${student.lastName.charAt(0)}${student.firstName.charAt(0)}
												</div>
											</div>
											<div>
												<div class="student-name fw-medium">
													${student.lastName} ${student.firstName}
													${student.middleName ? ` ${student.middleName}` : ''}
												</div>
												<div class="student-id text-muted extra-small">
													ID: ${studentId}
												</div>
											</div>
										</div>
									</div>
									<div class="col-auto">
										<div class="action-buttons">
											${isInTesting ? 
												`<span class="badge bg-success rounded-pill px-3">
													<i class="fas fa-check me-1"></i>–î–æ–±–∞–≤–ª–µ–Ω
												</span>` : 
												`<button class="btn btn-primary btn-sm rounded-pill px-3" 
														onclick="addSingleStudent('${studentId}')">
													<i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å
												</button>`
											}
										</div>
									</div>
								</div>
							</div>
						</div>
					`;
				});
			}
			
			html += `
					</div>
					
					${studentsCount > 0 ? `
						<div class="summary-footer mt-4 pt-3 border-top">
							<div class="row">
								<div class="col-md-6">
									<div class="d-flex align-items-center">
										<div class="me-3">
											<span class="badge bg-light text-dark">–í—ã–±—Ä–∞–Ω–æ: 
												<span id="selectedCount" class="text-primary fw-bold">0</span>
											</span>
										</div>
										<div class="form-text">
											–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ ${studentsCount - (addedStudents.filter(s => 
												schoolClass.students.some(clsStudent => 
													s.includes(clsStudent.lastName) && s.includes(clsStudent.firstName)
												)
											).length)} —É—á–µ–Ω–∏–∫–æ–≤
										</div>
									</div>
								</div>
								<div class="col-md-6 text-end">
									<div class="btn-group">
										<button class="btn btn-primary" id="addSelectedBtn" onclick="addSelectedStudents()">
											<i class="fas fa-user-plus me-2"></i>
											–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
										</button>
										<button class="btn btn-success" id="addWholeClassBtn" onclick="addWholeClassToTesting()">
											<i class="fas fa-users me-2"></i>
											–í–µ—Å—å –∫–ª–∞—Å—Å
										</button>
									</div>
								</div>
							</div>
						</div>
					` : ''}
				</div>
			`;
			
			container.innerHTML = html;
			
			// –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
			if (addSelectedBtn) {
				addSelectedBtn.disabled = false;
				addSelectedBtn.classList.remove('opacity-50');
			}
			if (addWholeClassBtn && studentsCount > 0) {
				addWholeClassBtn.disabled = false;
				addWholeClassBtn.classList.remove('opacity-50');
			}
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
			updateSelectedCount();
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function updateSelectedCount() {
			const checkboxes = document.querySelectorAll('.student-checkbox:not(:disabled)');
			const count = Array.from(checkboxes).filter(cb => cb.checked).length;
			const countElement = document.getElementById('selectedCount');
			if (countElement) {
				countElement.textContent = count;
			}
		}

		function toggleAllStudents(checked) {
			document.querySelectorAll('.student-checkbox:not(:disabled)').forEach(cb => {
				cb.checked = checked;
			});
			updateSelectedCount();
		}

		function clearSelection() {
			toggleAllStudents(false);
		}

		function addInvertedSelection() {
			document.querySelectorAll('.student-checkbox:not(:disabled)').forEach(cb => {
				cb.checked = !cb.checked;
			});
			updateSelectedCount();
		}

		// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —á–µ–∫–±–æ–∫—Å—ã
		document.addEventListener('change', function(e) {
			if (e.target.classList.contains('student-checkbox')) {
				updateSelectedCount();
			}
		});
		
		// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã –∏–∑ localStorage
		function loadSchoolData() {
			try {
				const saved = localStorage.getItem('schoolData');
				if (saved) {
					const parsed = JSON.parse(saved);
					
					// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞–º–∏
					if (parsed.classes && Array.isArray(parsed.classes)) {
						parsed.classes = parsed.classes.map(clsData => {
							const schoolClass = new SchoolClass(clsData.name, clsData.grade, clsData.teacher);
							
							// –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞
							Object.keys(clsData).forEach(key => {
								if (key !== 'students') {
									schoolClass[key] = clsData[key];
								}
							});
							
							// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
							if (clsData.students && Array.isArray(clsData.students)) {
								schoolClass.students = clsData.students.map(studentData => {
									const student = new SchoolStudent(
										studentData.lastName,
										studentData.firstName,
										studentData.middleName,
										studentData.id
									);
									
									// –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
									Object.keys(studentData).forEach(key => {
										if (!['lastName', 'firstName', 'middleName', 'id'].includes(key)) {
											student[key] = studentData[key];
										}
									});
									
									return student;
								});
							}
							
							return schoolClass;
						});
					}
					
					// –û–±–Ω–æ–≤–ª—è–µ–º schoolData
					Object.assign(schoolData, parsed);
					console.log('–î–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', schoolData.classes.length, '–∫–ª–∞—Å—Å–æ–≤');
					
				} else {
					console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã');
				}
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã:', error);
				// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
				schoolData.classes = [];
				schoolData.lastImportDate = null;
				schoolData.schoolName = '';
			}
		}

		// –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
		function deleteClass(classId) {
			if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–ª–∞—Å—Å? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–± —É—á–µ–Ω–∏–∫–∞—Ö –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
				return;
			}
			
			const index = schoolData.classes.findIndex(c => c.id === classId);
			if (index !== -1) {
				schoolData.classes.splice(index, 1);
				localStorage.setItem('schoolData', JSON.stringify(schoolData));
				renderClassManager();
				showNotification('–ö–ª–∞—Å—Å —É–¥–∞–ª–µ–Ω', 'success');
			}
		}	
		
		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞
		function showQRForClass(classId) {
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			// –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –∫–ª–∞—Å—Å–∞
			const classData = {
				classId: schoolClass.id,
				className: `${schoolClass.grade}${schoolClass.name}`,
				students: schoolClass.students.map(s => ({
					lastName: s.lastName,
					firstName: s.firstName,
					middleName: s.middleName
				})),
				timestamp: new Date().toISOString()
			};
			
			const dataStr = JSON.stringify(classData);
			const dataUrl = `data:application/json;charset=utf-8,${encodeURIComponent(dataStr)}`;
			
			// –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å QR-–∫–æ–¥–æ–º
			const modal = document.createElement('div');
			modal.className = 'modal fade';
			modal.id = 'qrModal';
			modal.innerHTML = `
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">QR-–∫–æ–¥ –∫–ª–∞—Å—Å–∞ ${schoolClass.grade}${schoolClass.name}</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body text-center">
							<div id="qrCodeContainer" class="mb-3"></div>
							<p class="text-muted small">
								–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–∞
							</p>
							<div class="d-grid gap-2">
								<button class="btn btn-outline-primary" onclick="downloadQRCode()">
									<i class="fas fa-download me-2"></i>–°–∫–∞—á–∞—Ç—å QR-–∫–æ–¥
								</button>
								<button class="btn btn-outline-secondary" onclick="shareClassData('${classId}')">
									<i class="fas fa-share-alt me-2"></i>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è
								</button>
							</div>
						</div>
					</div>
				</div>
			`;
			
			document.body.appendChild(modal);
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Bootstrap
			const modalInstance = new bootstrap.Modal(modal);
			modalInstance.show();
			
			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –ø–æ—Å–ª–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
			setTimeout(() => {
				QRCode.toCanvas(document.getElementById('qrCodeContainer'), dataUrl, {
					width: 200,
					margin: 2,
					color: {
						dark: '#000000',
						light: '#FFFFFF'
					}
				}, function(error) {
					if (error) {
						console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞:', error);
						showNotification('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞', 'error');
					}
				});
			}, 100);
			
			// –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
			modal.addEventListener('hidden.bs.modal', function() {
				modal.remove();
			});
		}

		// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞
		function downloadQRCode() {
			const canvas = document.querySelector('#qrModal canvas');
			if (!canvas) return;
			
			const link = document.createElement('a');
			link.download = `qr-code-–∫–ª–∞—Å—Å-${new Date().toISOString().slice(0, 10)}.png`;
			link.href = canvas.toDataURL('image/png');
			link.click();
			
			showNotification('QR-–∫–æ–¥ —Å–∫–∞—á–∞–Ω', 'success');
		}

		// –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞
		function shareClassData(classId) {
			const schoolClass = schoolData.classes.find(c => c.id === classId);
			if (!schoolClass) return;
			
			const shareText = `–ö–ª–∞—Å—Å: ${schoolClass.grade}${schoolClass.name}\n` +
							 `–£—á–µ–Ω–∏–∫–æ–≤: ${schoolClass.students.length}\n` +
							 `–°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤:\n` +
							 schoolClass.students.map(s => 
								 `- ${s.lastName} ${s.firstName} ${s.middleName || ''}`
							 ).join('\n');
			
			if (navigator.share) {
				navigator.share({
					title: `–ö–ª–∞—Å—Å ${schoolClass.grade}${schoolClass.name}`,
					text: shareText,
					url: window.location.href
				}).catch(console.error);
			} else {
				// –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
				navigator.clipboard.writeText(shareText)
					.then(() => showNotification('–°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success'))
					.catch(() => {
						// Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
						const textarea = document.createElement('textarea');
						textarea.value = shareText;
						document.body.appendChild(textarea);
						textarea.select();
						document.execCommand('copy');
						document.body.removeChild(textarea);
						showNotification('–°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
					});
			}
		}		
		// –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã –∏–∑ —Ñ–∞–π–ª–∞
		async function importSchoolFile() {
			const fileInput = document.getElementById('schoolFileInput');
			const fileFormat = document.getElementById('fileFormat').value;
			const schoolNameInput = document.getElementById('schoolName');
			
			if (!fileInput.files.length) {
				showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞', 'warning');
				return;
			}
			
			const file = fileInput.files[0];
			const schoolName = schoolNameInput.value.trim() || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
			
			showNotification('–ù–∞—á–∏–Ω–∞—é –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö...', 'info');
			
			try {
				let data = [];
				
				if (file.name.toLowerCase().endsWith('.xlsx') || file.name.toLowerCase().endsWith('.xls')) {
					data = await importFromExcel(file);
				} else if (file.name.toLowerCase().endsWith('.csv') || file.name.toLowerCase().endsWith('.txt')) {
					data = await importFromCSV(file);
				} else {
					showNotification('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
					return;
				}
				
				if (!data || data.length === 0) {
					showNotification('–§–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'warning');
					return;
				}
				
				const classes = parseSchoolData(data);
				
				if (classes.length === 0) {
					showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ', 'warning');
					return;
				}
				
				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
				schoolData.schoolName = schoolName;
				schoolData.classes = classes;
				schoolData.lastImportDate = new Date().toISOString();
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
				saveSchoolData();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
				renderClassManager();
				
				const totalStudents = countTotalStudents(classes);
				showNotification(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${classes.length} –∫–ª–∞—Å—Å–æ–≤, ${totalStudents} —É—á–µ–Ω–∏–∫–æ–≤`, 'success');
				
				console.log('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –î–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã:', schoolData);
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
			}
		}

		// 7. –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é saveSchoolData
		function saveSchoolData() {
			try {
				localStorage.setItem('schoolData', JSON.stringify(schoolData));
				console.log('–î–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', schoolData);
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã:', error);
			}
		}
		
		// –ò–º–ø–æ—Ä—Ç –∏–∑ Excel
		async function importFromExcel(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						console.log('–ß—Ç–µ–Ω–∏–µ Excel —Ñ–∞–π–ª–∞...');
						const data = new Uint8Array(e.target.result);
						const workbook = XLSX.read(data, { 
							type: 'array',
							cellDates: true,
							cellNF: false,
							cellText: false,
							raw: false // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
						});
						
						console.log('–õ–∏—Å—Ç—ã –≤ —Ñ–∞–π–ª–µ:', workbook.SheetNames);
						
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
						const sheetName = workbook.SheetNames[0];
						const worksheet = workbook.Sheets[sheetName];
						
						// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
						const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
							header: 1, // –ü–æ–ª—É—á–∞–µ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤ –º–∞—Å—Å–∏–≤–æ–≤
							defval: '' // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
						});
						
						console.log('–î–∞–Ω–Ω—ã–µ Excel (–ø–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫):', jsonData.slice(0, 10));
						resolve(jsonData);
						
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Excel:', error);
						reject(error);
					}
				};
				
				reader.onerror = function() {
					reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
				};
				
				reader.readAsArrayBuffer(file);
			});
		}

		// –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
		function setupFilePreview() {
			const fileInput = document.getElementById('schoolFileInput');
			if (!fileInput) return;
			
			fileInput.addEventListener('change', function(e) {
				const file = e.target.files[0];
				if (!file) return;
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
				showFilePreview(file);
			});
		}

		// –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞
		async function showFilePreview(file) {
			const previewDiv = document.createElement('div');
			previewDiv.className = 'card mt-3';
			previewDiv.innerHTML = `
				<div class="card-header">
					<h6 class="mb-0">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞: ${file.name}</h6>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-sm table-bordered" id="filePreviewTable">
							<thead>
								<tr>
									<th>#</th>
									<th>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–æ–∫–∏</th>
								</tr>
							</thead>
							<tbody id="previewTableBody">
								<!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
							</tbody>
						</table>
					</div>
					<div class="mt-3">
						<button class="btn btn-sm btn-outline-secondary" onclick="analyzeFileStructure()">
							<i class="fas fa-search me-1"></i>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
						</button>
					</div>
				</div>
			`;
			
			// –í—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π –∏–º–ø–æ—Ä—Ç–∞
			const importButton = document.querySelector('button[onclick="importSchoolFile()"]');
			if (importButton && importButton.parentNode) {
				const existingPreview = document.getElementById('filePreview');
				if (existingPreview) existingPreview.remove();
				
				previewDiv.id = 'filePreview';
				importButton.parentNode.insertBefore(previewDiv, importButton);
			}
			
			// –ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ñ–∞–π–ª–∞
			try {
				let previewData = [];
				
				if (file.name.toLowerCase().endsWith('.xlsx') || file.name.toLowerCase().endsWith('.xls')) {
					previewData = await getFilePreview(file, 10);
				} else {
					previewData = await getCSVPreview(file, 10);
				}
				
				const tbody = document.getElementById('previewTableBody');
				tbody.innerHTML = previewData.map((row, i) => `
					<tr>
						<td class="text-center" style="width: 50px;">${i + 1}</td>
						<td>${row.map(cell => 
							`<span class="badge bg-light text-dark me-1 mb-1">${escapeHtml(String(cell))}</span>`
						).join('')}</td>
					</tr>
				`).join('');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞:', error);
			}
		}

		// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Excel
		async function getFilePreview(file, maxRows = 10) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const data = new Uint8Array(e.target.result);
						const workbook = XLSX.read(data, { type: 'array' });
						const sheetName = workbook.SheetNames[0];
						const worksheet = workbook.Sheets[sheetName];
						const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
						resolve(jsonData.slice(0, maxRows));
					} catch (error) {
						reject(error);
					}
				};
				
				reader.onerror = reject;
				reader.readAsArrayBuffer(file);
			});
		}

		// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ CSV
		async function getCSVPreview(file, maxRows = 10) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const text = e.target.result;
						const lines = text.split('\n').slice(0, maxRows);
						const data = lines.map(line => {
							if (line.includes(';')) return line.split(';');
							if (line.includes(',')) return line.split(',');
							if (line.includes('\t')) return line.split('\t');
							return [line];
						}).map(row => row.map(cell => cell.trim()));
						resolve(data);
					} catch (error) {
						reject(error);
					}
				};
				
				reader.onerror = reject;
				reader.readAsText(file, 'UTF-8');
			});
		}

		// –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞
		async function analyzeFileStructure() {
			const fileInput = document.getElementById('schoolFileInput');
			if (!fileInput.files.length) return;
			
			const file = fileInput.files[0];
			
			try {
				let data = [];
				
				if (file.name.toLowerCase().endsWith('.xlsx') || file.name.toLowerCase().endsWith('.xls')) {
					data = await getFilePreview(file, 20);
				} else {
					data = await getCSVPreview(file, 20);
				}
				
				const structure = detectFileStructure(data);
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
				const resultDiv = document.createElement('div');
				resultDiv.className = 'alert alert-info mt-3';
				resultDiv.innerHTML = `
					<h6><i class="fas fa-chart-bar me-2"></i>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–∞</h6>
					<ul class="mb-0">
						<li><strong>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</strong> ${structure.hasHeader ? '–î–∞' : '–ù–µ—Ç'}</li>
						<li><strong>–§–æ—Ä–º–∞—Ç:</strong> ${structure.format === 'class-first' ? '–ö–ª–∞—Å—Å ‚Üí –§–ò–û' : '–§–ò–û ‚Üí –ö–ª–∞—Å—Å'}</li>
						<li><strong>–ö–æ–ª–æ–Ω–∫–∏:</strong>
							${structure.columns.class >= 0 ? `–ö–ª–∞—Å—Å: ${structure.columns.class + 1}` : '–Ω–µ –Ω–∞–π–¥–µ–Ω'},
							${structure.columns.lastName >= 0 ? `–§–∞–º–∏–ª–∏—è: ${structure.columns.lastName + 1}` : '–Ω–µ –Ω–∞–π–¥–µ–Ω'},
							${structure.columns.firstName >= 0 ? `–ò–º—è: ${structure.columns.firstName + 1}` : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}
						</li>
						<li><strong>–°—Ç—Ä–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</strong> ${data.length}</li>
					</ul>
				`;
				
				// –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
				const existingResults = document.querySelector('.alert.alert-info[style*="analysis"]');
				if (existingResults) existingResults.remove();
				
				resultDiv.style.cssText = 'animation: fadeIn 0.5s;';
				document.getElementById('filePreview').appendChild(resultDiv);
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–∞', 'error');
			}
		}

		// –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// –î–æ–±–∞–≤—å—Ç–µ CSS –∞–Ω–∏–º–∞—Ü–∏—é
		const style = document.createElement('style');
		style.textContent = `
			@keyframes fadeIn {
				from { opacity: 0; transform: translateY(-10px); }
				to { opacity: 1; transform: translateY(0); }
			}
			
			.badge-cell {
				font-family: monospace;
				background-color: #f8f9fa;
				border: 1px solid #dee2e6;
				border-radius: 3px;
				padding: 2px 6px;
				margin: 1px;
				display: inline-block;
				font-size: 12px;
			}
		`;
		document.head.appendChild(style);

		// –ò–º–ø–æ—Ä—Ç –∏–∑ CSV
		async function importFromCSV(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						console.log('–ß—Ç–µ–Ω–∏–µ CSV —Ñ–∞–π–ª–∞...');
						const text = e.target.result;
						
						// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
						let delimiter = ';';
						if (text.includes(',')) delimiter = ',';
						if (text.includes('\t')) delimiter = '\t';
						
						console.log('–û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å:', delimiter);
						
						const lines = text.split('\n').filter(line => line.trim() !== '');
						const data = lines.map(line => {
							// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–≤—ã—á–∫–∏
							const cells = [];
							let currentCell = '';
							let inQuotes = false;
							
							for (let i = 0; i < line.length; i++) {
								const char = line[i];
								const nextChar = line[i + 1];
								
								if (char === '"') {
									if (inQuotes && nextChar === '"') {
										// –î–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞–≤—ã—á–µ–∫
										currentCell += '"';
										i++; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–∞–≤—ã—á–∫—É
									} else {
										inQuotes = !inQuotes;
									}
								} else if (char === delimiter && !inQuotes) {
									cells.push(currentCell);
									currentCell = '';
								} else {
									currentCell += char;
								}
							}
							
							cells.push(currentCell);
							return cells.map(cell => cell.trim());
						});
						
						console.log('–î–∞–Ω–Ω—ã–µ CSV (–ø–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫):', data.slice(0, 10));
						resolve(data);
						
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV:', error);
						reject(error);
					}
				};
				
				reader.onerror = function() {
					reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
				};
				
				reader.readAsText(file, 'UTF-8');
			});
		}

		// –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã –∏–∑ –º–∞—Å—Å–∏–≤–∞
		function parseSchoolData(data) {
			const classesMap = new Map();
			
			const structure = detectFileStructure(data);
			console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:', structure);
			
			let startRow = structure.hasHeader ? 1 : 0;
			
			for (let i = startRow; i < data.length; i++) {
				const row = data[i];
				if (!row || row.length === 0) continue;
				
				const cleanRow = row.map(cell => {
					if (cell === null || cell === undefined) return '';
					return String(cell).trim();
				}).filter(cell => cell !== '');
				
				if (cleanRow.length < 2) continue;
				
				let className = '';
				let lastName = '';
				let firstName = '';
				let middleName = '';
				
				if (structure.format === 'class-first') {
					className = cleanRow[structure.columns.class] || '';
					lastName = cleanRow[structure.columns.lastName] || '';
					firstName = cleanRow[structure.columns.firstName] || '';
					middleName = cleanRow[structure.columns.middleName] || '';
				} else if (structure.format === 'class-last') {
					lastName = cleanRow[structure.columns.lastName] || '';
					firstName = cleanRow[structure.columns.firstName] || '';
					middleName = cleanRow[structure.columns.middleName] || '';
					className = cleanRow[structure.columns.class] || '';
				} else {
					className = findClassName(cleanRow);
					if (className) {
						const classIndex = cleanRow.indexOf(className);
						const fioParts = cleanRow.filter((_, idx) => idx !== classIndex);
						
						if (fioParts.length >= 2) {
							lastName = fioParts[0];
							firstName = fioParts[1];
							middleName = fioParts[2] || '';
						}
					}
				}
				
				className = normalizeClassName(className);
				
				if (!className || !lastName || !firstName) {
					continue;
				}
				
				const match = className.match(/([0-9]+)([–ê-–Ø–∞-—èA-Za-z]+)?/);
				if (!match) continue;
				
				const grade = parseInt(match[1]);
				const letter = (match[2] || '–ê').toUpperCase();
				const classKey = `${grade}-${letter}`;
				
				if (!classesMap.has(classKey)) {
					const schoolClass = new SchoolClass(letter, grade);
					classesMap.set(classKey, schoolClass);
				}
				
				const schoolClass = classesMap.get(classKey);
				
				// –°–æ–∑–¥–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞
				const student = new SchoolStudent(lastName, firstName, middleName);
				student.classId = schoolClass.id;
				schoolClass.students.push(student);
			}
			
			const classesArray = Array.from(classesMap.values());
			console.log('–°–æ–∑–¥–∞–Ω—ã –∫–ª–∞—Å—Å—ã:', classesArray.map(c => ({
				id: c.id,
				name: `${c.grade}${c.name}`,
				students: c.students.length
			})));
			
			return classesArray;
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞
		function detectFileStructure(data) {
			if (!data || data.length === 0) {
				return { hasHeader: false, format: 'unknown' };
			}
			
			const firstRow = data[0];
			const secondRow = data[1] || [];
			
			// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫–∏ –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
			const firstRowLower = firstRow.map(cell => 
				String(cell || '').trim().toLowerCase()
			);
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
			let hasHeader = false;
			const headerKeywords = ['–∫–ª–∞—Å—Å', '—Ñ–∞–º–∏–ª–∏—è', '–∏–º—è', '–æ—Ç—á–µ—Å—Ç–≤–æ', '—É—á–µ–Ω–∏–∫', 'student', 'lastname', 'firstname'];
			
			if (firstRowLower.some(cell => headerKeywords.some(keyword => cell.includes(keyword)))) {
				hasHeader = true;
			}
			
			// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç
			let format = 'unknown';
			let columns = {
				class: -1,
				lastName: -1,
				firstName: -1,
				middleName: -1
			};
			
			// –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –Ω–µ–º—É
			if (hasHeader) {
				firstRowLower.forEach((cell, index) => {
					if (cell.includes('–∫–ª–∞—Å—Å')) columns.class = index;
					if (cell.includes('—Ñ–∞–º–∏–ª–∏—è') || cell.includes('lastname')) columns.lastName = index;
					if (cell.includes('–∏–º—è') || cell.includes('firstname')) columns.firstName = index;
					if (cell.includes('–æ—Ç—á–µ—Å—Ç–≤–æ') || cell.includes('middlename')) columns.middleName = index;
				});
				
				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –ø–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—é –∫–æ–ª–æ–Ω–∫–∏ "–∫–ª–∞—Å—Å"
				if (columns.class === 0) {
					format = 'class-first';
				} else if (columns.class > 0) {
					format = 'class-last';
				}
			} else {
				// –ü—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –ø–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ
				if (secondRow.length >= 4) {
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –ø–µ—Ä–≤–∞—è —è—á–µ–π–∫–∞ –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞
					const firstCell = String(secondRow[0] || '').trim();
					if (firstCell.match(/[0-9]+[–ê-–Ø–∞-—èA-Za-z]/)) {
						format = 'class-first';
						columns = { class: 0, lastName: 1, firstName: 2, middleName: 3 };
					} else {
						format = 'class-last';
						columns = { lastName: 0, firstName: 1, middleName: 2, class: 3 };
					}
				}
			}
			
			return { hasHeader, format, columns };
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–∞ –∫–ª–∞—Å—Å–∞ –≤ —Å—Ç—Ä–æ–∫–µ
		function findClassName(rowCells) {
			for (const cell of rowCells) {
				const str = String(cell).trim();
				// –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã: "5–ê", "10–ë", "11–∞", "7-b", "8 –∫–ª–∞—Å—Å", "9 –∫–ª–∞—Å—Å –ê"
				const match = str.match(/([0-9]+)[\s\-]*([–ê-–Ø–∞-—èA-Za-z]+)?[\s]*–∫?–ª?–∞?—Å?—Å?/i);
				if (match) {
					return match[1] + (match[2] || '–ê');
				}
			}
			return '';
		}

		// –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞
		function normalizeClassName(className) {
			if (!className) return '';
			
			// –£–¥–∞–ª—è–µ–º —Å–ª–æ–≤–æ "–∫–ª–∞—Å—Å" –∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
			let normalized = className.replace(/[\s\-]*–∫?–ª?–∞?—Å?—Å?/gi, '').trim();
			
			// –î–æ–±–∞–≤–ª—è–µ–º –±—É–∫–≤—É "–ê", –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä
			if (normalized.match(/^[0-9]+$/)) {
				normalized += '–ê';
			}
			
			return normalized;
		}

		// –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–µ–Ω–∏–∫–æ–≤
		function countTotalStudents(classes) {
			return classes.reduce((total, cls) => total + cls.students.length, 0);
		}		
		
		// ==================== –§–£–ù–ö–¶–ò–ò –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–Ø ====================

		function handleDragStart(e) {
			dragStartIndex = parseInt(e.target.closest('tr').dataset.index);
			const row = e.target.closest('tr');
			row.style.opacity = '0.5';
			row.style.backgroundColor = '#e3f2fd';
			isDragging = true;
			
			e.dataTransfer.effectAllowed = 'move';
			e.dataTransfer.setData('text/plain', dragStartIndex.toString());
		}

		function handleDragOver(e) {
			e.preventDefault();
			e.dataTransfer.dropEffect = 'move';
			
			const row = e.target.closest('tr');
			if (row && row.id !== `student-row-${dragStartIndex}`) {
				row.style.borderTop = '2px solid #2196f3';
				row.style.borderBottom = '2px solid #2196f3';
			}
		}

		function handleDrop(e) {
			e.preventDefault();
			
			const dragEndRow = e.target.closest('tr');
			if (!dragEndRow) return;
			
			const dragEndIndex = parseInt(dragEndRow.dataset.index);
			if (dragStartIndex === null || dragEndIndex === null || dragStartIndex === dragEndIndex) {
				return;
			}
			
			// –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞
			moveStudent(dragStartIndex, dragEndIndex);
			
			// –°–Ω–∏–º–∞–µ–º —Å—Ç–∏–ª–∏
			document.querySelectorAll('#studentsTableBody tr').forEach(row => {
				row.style.borderTop = '';
				row.style.borderBottom = '';
				row.style.opacity = '';
				row.style.backgroundColor = '';
			});
			
			dragStartIndex = null;
			isDragging = false;
		}

		function handleDragEnd(e) {
			document.querySelectorAll('#studentsTableBody tr').forEach(row => {
				row.style.borderTop = '';
				row.style.borderBottom = '';
				row.style.opacity = '';
				row.style.backgroundColor = '';
			});
			dragStartIndex = null;
			isDragging = false;
		}

		// ==================== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

		function addMultipleStudents(count) {
			for (let i = 0; i < count; i++) {
				const newStudent = `–£—á–∞—â–∏–π—Å—è ${appData.students.length + 1}`;
				appData.students.push(newStudent);
				appData.results.push(new Array(appData.tasks.length).fill(0));
			}
			
			saveData();
			
			renderStudents();
			renderResults();
			showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${count} —É—á–∞—â–∏—Ö—Å—è`, "success");
		}

		function clearStudents() {
			if (appData.students.length === 0) return;
			
			if (confirm(`–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è (${appData.students.length} –∑–∞–ø–∏—Å–µ–π)? –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
				appData.students = [];
				appData.results = [];
				appData.errors = [];
				
				// –°–æ–∑–¥–∞–µ–º –æ–¥–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
				appData.students.push('–£—á–∞—â–∏–π—Å—è 1');
				appData.results.push(new Array(appData.tasks.length).fill(0));
				
				saveData();
				
				renderStudents();
				renderResults();
				showNotification("–°–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è –æ—á–∏—â–µ–Ω", "success");
			}
		}

		function filterStudents() {
			const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
			const rows = document.querySelectorAll('#studentsTableBody tr');
			
			rows.forEach(row => {
				const input = row.querySelector('input[type="text"]');
				if (input) {
					const studentName = input.value.toLowerCase();
					if (studentName.includes(searchTerm) || searchTerm === '') {
						row.style.display = '';
					} else {
						row.style.display = 'none';
					}
				}
			});
		}

		// ==================== –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏) ====================

		function duplicateStudent(index) {
			const originalStudent = appData.students[index];
			const originalResults = [...appData.results[index]];
			
			const newStudent = `${originalStudent} (–∫–æ–ø–∏—è)`;
			appData.students.splice(index + 1, 0, newStudent);
			appData.results.splice(index + 1, 0, originalResults);
			
			saveData();
			
			renderStudents();
			renderResults();
			showNotification(`–°–æ–∑–¥–∞–Ω–∞ –∫–æ–ø–∏—è —É—á–∞—â–µ–≥–æ—Å—è`, "info");
		}

		function moveStudentUp(index) {
			if (index > 0) {
				moveStudent(index, index - 1);
			}
		}

		function moveStudentDown(index) {
			if (index < appData.students.length - 1) {
				moveStudent(index, index + 1);
			}
		}

		function moveStudent(fromIndex, toIndex) {
			if (fromIndex === toIndex) return;
			
			const student = appData.students[fromIndex];
			const result = appData.results[fromIndex];
			
			appData.students.splice(fromIndex, 1);
			appData.results.splice(fromIndex, 1);
			
			appData.students.splice(toIndex, 0, student);
			appData.results.splice(toIndex, 0, result);
			
			appData.errors = appData.errors.filter(error => error.studentIndex !== fromIndex);
			appData.errors.forEach(error => {
				if (error.studentIndex > fromIndex && error.studentIndex <= toIndex) {
					error.studentIndex--;
				} else if (error.studentIndex < fromIndex && error.studentIndex >= toIndex) {
					error.studentIndex++;
				}
			});
			
			saveData();
			renderStudents();
			renderResults();
			
			showNotification(`–£—á–∞—â–∏–π—Å—è –ø–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ –ø–æ–∑–∏—Ü–∏—é ${toIndex + 1}`, "info");
		}

		function sortStudentsAlphabetically() {
			const studentsWithData = appData.students.map((student, index) => ({
				name: student,
				results: appData.results[index],
				originalIndex: index
			}));
			
			studentsWithData.sort((a, b) => a.name.localeCompare(b.name));
			
			appData.students = studentsWithData.map(item => item.name);
			appData.results = studentsWithData.map(item => item.results);
			
			saveData();
			renderStudents();
			showNotification("–°–ø–∏—Å–æ–∫ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É", "info");
		}

		function randomizeOrder() {
			const studentsCopy = [...appData.students];
			const resultsCopy = [...appData.results];
			
			for (let i = studentsCopy.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[studentsCopy[i], studentsCopy[j]] = [studentsCopy[j], studentsCopy[i]];
				[resultsCopy[i], resultsCopy[j]] = [resultsCopy[j], resultsCopy[i]];
			}
			
			appData.students = studentsCopy;
			appData.results = resultsCopy;
			
			saveData();
			renderStudents();
			renderResults();
			showNotification("–ü–æ—Ä—è–¥–æ–∫ —É—á–∞—â–∏—Ö—Å—è –∏–∑–º–µ–Ω–µ–Ω —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º", "info");
		}

		function generateDefaultNames() {
			const names = [
				'–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω', '–ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞', '–°–∏–¥–æ—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π', '–ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ú–∞—Ä–∏—è',
				'–°–º–∏—Ä–Ω–æ–≤ –î–º–∏—Ç—Ä–∏–π', '–ü–æ–ø–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', '–õ–µ–±–µ–¥–µ–≤ –ú–∏—Ö–∞–∏–ª', '–ù–æ–≤–∏–∫–æ–≤–∞ –û–ª—å–≥–∞',
				'–ú–æ—Ä–æ–∑–æ–≤ –°–µ—Ä–≥–µ–π', '–í–æ–ª–∫–æ–≤–∞ –ù–∞—Ç–∞–ª—å—è', '–ê–ª–µ–∫—Å–µ–µ–≤ –ê–Ω–¥—Ä–µ–π', '–ü–∞–≤–ª–æ–≤–∞ –Æ–ª–∏—è'
			];
			
			appData.students = [];
			appData.results = [];
			
			for (let i = 0; i < Math.min(names.length, 12); i++) {
				appData.students.push(names[i]);
				appData.results.push(new Array(appData.tasks.length).fill(0));
			}
			
			for (let i = names.length; i < appData.test.presentStudents; i++) {
				appData.students.push(`–£—á–∞—â–∏–π—Å—è ${i + 1}`);
				appData.results.push(new Array(appData.tasks.length).fill(0));
			}
			
			saveData();
			renderStudents();
			renderResults();
			showNotification("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–º–µ–Ω–∞", "success");
		}

		function exportStudentsList() {
			const csvContent = appData.students
				.map((student, index) => `${index + 1},${student}`)
				.join('\n');
			
			const blob = new Blob(['‚Ññ,–§–ò–û —É—á–∞—â–µ–≥–æ—Å—è\n' + csvContent], { type: 'text/csv;charset=utf-8;' });
			const link = document.createElement('a');
			const url = URL.createObjectURL(blob);
			
			link.setAttribute('href', url);
			link.setAttribute('download', `—É—á–∞—â–∏–µ—Å—è_${new Date().toLocaleDateString('ru-RU').replace(/\./g, '-')}.csv`);
			link.style.visibility = 'hidden';
			
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			
			showNotification("–°–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ CSV", "success");
		}

		function editStudentInModal(index) {
			const student = appData.students[index];
			const newName = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –§–ò–û —É—á–∞—â–µ–≥–æ—Å—è:', student);
			
			if (newName !== null && newName.trim() !== '') {
				updateStudent(index, newName.trim());
				showNotification("–§–ò–û —É—á–∞—â–µ–≥–æ—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ", "success");
			}
		}
		// ==================== CSS –°–¢–ò–õ–ò ====================
		const studentsStyles = `
			.students-controls-panel {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 20px;
				border-radius: 12px;
				margin-bottom: 20px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}
			
			.controls-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 15px;
			}
			
			.controls-toolbar {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-bottom: 15px;
				align-items: center;
			}
			
			.controls-search {
				position: relative;
				flex-grow: 1;
				max-width: 300px;
			}
			
			.controls-search input {
				padding-left: 35px;
			}
			
			.controls-search i {
				position: absolute;
				left: 12px;
				top: 50%;
				transform: translateY(-50%);
				color: #999;
			}
			
			.students-table-wrapper {
				background: white;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
				overflow: hidden;
				margin-bottom: 20px;
			}
			
			.students-table {
				width: 100%;
				border-collapse: collapse;
			}
			
			.students-table th {
				background: #f8f9fa;
				padding: 12px 15px;
				text-align: left;
				font-weight: 600;
				color: #495057;
				border-bottom: 2px solid #dee2e6;
				user-select: none;
			}
			
			.students-table td {
				padding: 12px 15px;
				border-bottom: 1px solid #e9ecef;
				transition: background-color 0.2s;
			}
			
			.students-table tr:hover td {
				background-color: #f8f9fa;
			}
			
			.students-table tr.dragging {
				opacity: 0.5;
				background: #e3f2fd;
			}
			
			.students-table tr.drag-over td {
				border-top: 2px solid #2196f3;
				border-bottom: 2px solid #2196f3;
			}
			
			.drag-handle {
				cursor: grab;
				color: #adb5bd;
				text-align: center;
				user-select: none;
			}
			
			.drag-handle:hover {
				color: #495057;
			}
			
			.student-name-editor {
				display: flex;
				flex-direction: column;
				gap: 5px;
			}
			
			.student-name-input {
				border: 1px solid #ced4da;
				transition: all 0.3s;
			}
			
			.student-name-input:focus {
				border-color: #80bdff;
				box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
			}
			
			.student-progress {
				display: flex;
				align-items: center;
				gap: 10px;
				font-size: 12px;
			}
			
			.progress-bar-bg {
				flex-grow: 1;
				height: 6px;
				background: #e9ecef;
				border-radius: 3px;
				overflow: hidden;
			}
			
			.progress-bar-fill {
				height: 100%;
				background: linear-gradient(90deg, #28a745, #20c997);
				transition: width 0.3s;
			}
			
			.student-actions {
				display: flex;
				gap: 5px;
				flex-wrap: nowrap;
			}
			
			.student-actions .btn-sm {
				padding: 2px 8px;
				font-size: 12px;
			}
			
			.quick-actions {
				background: #f8f9fa;
				padding: 15px;
				border-radius: 8px;
				border: 1px solid #dee2e6;
			}
			
			.quick-actions-header {
				margin-bottom: 10px;
			}
			
			.quick-actions-buttons {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
			}
			
			.students-pagination {
				text-align: center;
				padding: 10px;
				color: #6c757d;
				font-size: 14px;
			}
			
			@media (max-width: 768px) {
				.controls-toolbar {
					flex-direction: column;
					align-items: stretch;
				}
				
				.controls-search {
					max-width: 100%;
				}
				
				.student-actions {
					flex-wrap: wrap;
				}
				
				.students-table {
					display: block;
					overflow-x: auto;
				}
			}
		`;

		// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤ DOM
		if (!document.querySelector('#students-styles')) {
			const styleSheet = document.createElement('style');
			styleSheet.id = 'students-styles';
			styleSheet.textContent = studentsStyles;
			document.head.appendChild(styleSheet);
		}

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é updateStudent –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
		function updateStudent(index, value) {
			if (isDragging) return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
			
			if (index >= 0 && index < appData.students.length) {
				appData.students[index] = value;
				saveData();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
				updateStudentProgressBar(index);
			}
		}

		function updateStudentProgressBar(index) {
			const progressBar = document.querySelector(`#student-row-${index} .progress-bar-fill`);
			if (progressBar) {
				const studentResults = appData.results[index] || [];
				const completedTasks = studentResults.filter(score => score > 0).length;
				const totalTasks = appData.tasks.length;
				const progressPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
				
				// –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
				const progressFill = document.querySelector(`#student-row-${index} [style*="background: linear-gradient"]`);
				if (progressFill) {
					progressFill.style.width = `${progressPercentage}%`;
				}
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
				const progressText = document.querySelector(`#student-row-${index} small`);
				if (progressText) {
					progressText.textContent = `${completedTasks}/${totalTasks}`;
				}
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
				const statusBadge = document.querySelector(`#student-row-${index} span[style*="background:"]`);
				if (statusBadge) {
					if (progressPercentage === 100) {
						statusBadge.style.background = '#d4edda';
						statusBadge.style.color = '#155724';
						statusBadge.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
					} else if (progressPercentage > 0) {
						statusBadge.style.background = '#fff3cd';
						statusBadge.style.color = '#856404';
						statusBadge.textContent = '–ß–∞—Å—Ç–∏—á–Ω–æ';
					} else {
						statusBadge.style.background = '#e9ecef';
						statusBadge.style.color = '#495057';
						statusBadge.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
					}
				}
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
		function validateStudentData() {
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			if (appData.students.length !== appData.results.length) {
				console.warn('–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ò—Å–ø—Ä–∞–≤–ª—è—é...');
				
				// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º: –¥–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
				while (appData.students.length > appData.results.length) {
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
				
				// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
				while (appData.students.length < appData.results.length) {
					appData.results.pop();
				}
				
				saveData();
				showNotification('–î–∞–Ω–Ω—ã–µ —É—á–∞—â–∏—Ö—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã', 'warning');
			}
		}

		// –í—ã–∑—ã–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö
		function onDataLoad() {
			validateStudentData();
		}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è
		function addStudent() {
			const newStudent = `–£—á–∞—â–∏–π—Å—è ${appData.students.length + 1}`;
			appData.students.push(newStudent);
			
			const emptyResults = new Array(appData.tasks.length).fill(0);
			appData.results.push(emptyResults);
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö
			appData.test.presentStudents = appData.students.length;
			if (document.getElementById('presentStudents')) {
				document.getElementById('presentStudents').value = appData.students.length;
			}
			
			saveData();
			renderStudents();
			renderResults();
			
			setTimeout(() => {
				const studentsContainer = document.getElementById('studentsContainer');
				const lastStudent = studentsContainer.querySelector('#studentsTableBody tr:last-child');
				if (lastStudent) {
					lastStudent.scrollIntoView({ behavior: 'smooth' });
				}
			}, 100);
			
			showNotification(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —É—á–∞—â–∏–π—Å—è: ${newStudent}`, "success");
		}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—â–µ–≥–æ—Å—è
		function removeStudent(studentIndex) {
			if (appData.students.length <= 1) {
				showNotification("–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è!", "error");
				return;
			}
			
			if (studentIndex < 0 || studentIndex >= appData.students.length) {
				showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å —É—á–∞—â–µ–≥–æ—Å—è!", "error");
				return;
			}
			
			const studentName = appData.students[studentIndex];
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å —É—á–∞—â–µ–≥–æ—Å—è "${studentName}"? –í—Å–µ –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
				// –£–¥–∞–ª—è–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞
				appData.students.splice(studentIndex, 1);
				appData.results.splice(studentIndex, 1);
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –æ—à–∏–±–∫–∏
				// 1. –£–¥–∞–ª—è–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
				appData.errors = appData.errors.filter(error => error.studentIndex !== studentIndex);
				
				// 2. –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ
				appData.errors.forEach(error => {
					if (error.studentIndex > studentIndex) {
						error.studentIndex--;
					}
				});
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö
				appData.test.presentStudents = Math.max(1, appData.students.length);
				if (document.getElementById('presentStudents')) {
					document.getElementById('presentStudents').value = appData.students.length;
				}
				
				saveData();
				renderStudents();
				renderResults();
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
				showNotification(`–£—á–∞—â–∏–π—Å—è "${studentName}" —É–¥–∞–ª–µ–Ω!`, "success");
				
				// –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞,
				// –Ω—É–∂–Ω–æ –∏—Ö –æ–±–Ω–æ–≤–∏—Ç—å
				updateAllStudentDependentElements();
			}
		}
		
		// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
		function updateAllStudentDependentElements() {
			// –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
			if (typeof renderCharts === 'function') {
				renderCharts();
			}
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è
			if (typeof renderStatistics === 'function') {
				renderStatistics();
			}
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
			if (typeof renderResults === 'function') {
				renderResults();
			}
		}
		
		function removeLastStudent() {
			if (appData.students.length <= 1) {
				showNotification("–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è!", "error");
				return;
			}
			
			const lastIndex = appData.students.length - 1;
			const studentName = appData.students[lastIndex];
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è "${studentName}"? –í—Å–µ –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
				// –£–¥–∞–ª—è–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞
				appData.students.pop();
				appData.results.pop();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ - —É–¥–∞–ª—è–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
				appData.errors = appData.errors.filter(error => error.studentIndex !== lastIndex);
				// –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º, —Ç–∞–∫ –∫–∞–∫ —É–¥–∞–ª–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
				
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö
				appData.test.presentStudents = Math.max(1, appData.students.length);
				if (document.getElementById('presentStudents')) {
					document.getElementById('presentStudents').value = appData.students.length;
				}
				
				saveData();
				renderStudents();
				renderResults();
				showNotification(`–£—á–∞—â–∏–π—Å—è "${studentName}" —É–¥–∞–ª–µ–Ω!`, "success");
			}
		}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—â–∏—Ö—Å—è
		function setStudentsCount(count) {
			if (count < 1 || count > 100) {
				showNotification("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 100", "error");
				return;
			}
			
			const currentCount = appData.students.length;
			
			if (count > currentCount) {
				// –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
				for (let i = currentCount; i < count; i++) {
					appData.students.push(`–£—á–∞—â–∏–π—Å—è ${i + 1}`);
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
			} else if (count < currentCount) {
				// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
				if (confirm(`–£–¥–∞–ª–∏—Ç—å ${currentCount - count} –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É—á–∞—â–∏—Ö—Å—è? –í—Å–µ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
					// –£–¥–∞–ª—è–µ–º —Å –∫–æ–Ω—Ü–∞
					const studentsToRemove = currentCount - count;
					appData.students.splice(count, studentsToRemove);
					appData.results.splice(count, studentsToRemove);
					
					// –û–±–Ω–æ–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ - —É–¥–∞–ª—è–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
					appData.errors = appData.errors.filter(error => error.studentIndex < count);
				} else {
					return; // –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
				}
			}
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
			appData.test.presentStudents = count;
			if (document.getElementById('presentStudents')) {
				document.getElementById('presentStudents').value = count;
			}
			
			saveData();
			renderStudents();
			renderResults();
			
			showNotification(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${count} —É—á–∞—â–∏—Ö—Å—è`, "success");
		}

        // –î–∏–∞–ª–æ–≥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function showQuickSetDialog() {
            const count = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è:', appData.students.length);
            if (count !== null) {
                const numCount = parseInt(count);
                if (!isNaN(numCount) && numCount > 0) {
                    setStudentsCount(numCount);
                } else {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ!', "error");
                }
            }
        }

        // –î–∏–∞–ª–æ–≥ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
        function showMassImportDialog() {
            const namesText = prompt(`–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è (–∫–∞–∂–¥–æ–µ –∏–º—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):\n\n–ü—Ä–∏–º–µ—Ä:\n–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π\n–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è\n–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π`, appData.students.join('\n'));
            
            if (namesText !== null) {
                const names = namesText.split('\n')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);
                
                if (names.length > 0) {
                    generateStudents(names);
                } else {
                    showNotification('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∏–º–µ–Ω —É—á–∞—â–∏—Ö—Å—è!', "error");
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —É—á–∞—â–∏—Ö—Å—è
        function generateStudents(names) {
            if (!names || names.length === 0) {
                showNotification("–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω —É—á–∞—â–∏—Ö—Å—è!", "error");
                return;
            }
            
            appData.students = [];
            appData.results = [];
            appData.errors = [];
            
            names.forEach((name, index) => {
                appData.students.push(name.trim());
                appData.results.push(new Array(appData.tasks.length).fill(0));
            });
            
            appData.test.presentStudents = names.length;
            document.getElementById('presentStudents').value = names.length;
            
            saveData();
            renderStudents();
            renderResults();
            showNotification(`–°–æ–∑–¥–∞–Ω–æ ${names.length} —É—á–∞—â–∏—Ö—Å—è!`, "success");
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function saveStudents() {
            saveData();
            showNotification("–°–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω!", "success");
        }



        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
        function addError() {
            const studentIndex = parseInt(document.getElementById('errorStudent').value);
            const taskIndex = parseInt(document.getElementById('errorTask').value);
            const type = document.getElementById('errorType').value;
            const description = document.getElementById('errorDescription').value;
            
            if (!description) {
                showNotification("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏!", "error");
                return;
            }
            
            appData.errors.push({
                studentIndex,
                taskIndex,
                type,
                description,
                count: 1
            });
            
            saveData();
            renderResults();
            document.getElementById('errorDescription').value = '';
            showNotification("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞", "success");
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function updateResult(studentIndex, taskIndex, value) {
			if (!appData.results[studentIndex]) {
				appData.results[studentIndex] = [];
			}
			
			// –ñ–µ—Å—Ç–∫–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —á–∏—Å–ª—É
			let numValue = parseInt(value);
			
			// –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ –º–µ–Ω—å—à–µ 0, –Ω–µ –±–æ–ª—å—à–µ –º–∞–∫—Å. –±–∞–ª–ª–∞
			const maxScore = appData.tasks[taskIndex].maxScore;
			if (isNaN(numValue)) numValue = 0;
			if (numValue < 0) numValue = 0;
			if (numValue > maxScore) {
				numValue = maxScore;
				showNotification(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª –∑–∞ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ: ${maxScore}`, 'warning');
			}

			appData.results[studentIndex][taskIndex] = numValue;
			
			saveData();
			// –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—è–∂–µ–ª–æ–π, –ª—É—á—à–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥
			// –ù–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º renderResults()
			renderResults();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function saveResults() {
            saveData();
            showNotification("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
        }

        // –†–∞—Å—á–µ—Ç –æ—Ü–µ–Ω–∫–∏
		function calculateGrade(totalScore) {
			// 1. –ó–∞—â–∏—Ç–∞ –æ—Ç —Ç–∏–ø–æ–≤
			const score = parseFloat(totalScore) || 0;
			
			// 2. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
			const type = appData.test.criteriaType || 'points';
			const criteria = appData.test.criteria;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + (parseFloat(task.maxScore) || 0), 0);

			if (!criteria) return 2; // Fallback

			// 3. –†–∞—Å—á–µ—Ç –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
			if (type === 'percentage' || type === 'percent') { // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –≤ –∫–æ–¥–µ
				const percentage = maxPossible > 0 ? (score / maxPossible) * 100 : 0;
				
				// –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —É—Ä–æ–≤–Ω—è–º –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (1-10 –∏–ª–∏ 2-5)
				for (const [level, range] of Object.entries(criteria)) {
					if (percentage >= range.min && percentage <= range.max) {
						// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª—é—á —É—Ä–æ–≤–Ω—è (–Ω–∞–ø—Ä–∏–º–µ—Ä "5" –∏–ª–∏ "high")
						// –ï—Å–ª–∏ –∫–ª—é—á —á–∏—Å–ª–æ–≤–æ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∏—Å–ª–æ
						return isNaN(parseInt(level)) ? level : parseInt(level);
					}
				}
				return 2; // Default low grade
			}
			
			// 4. –†–∞—Å—á–µ—Ç –¥–ª—è –±–∞–ª–ª–æ–≤ (points)
			else {
				for (const [level, range] of Object.entries(criteria)) {
					if (score >= range.min && score <= range.max) {
						return isNaN(parseInt(level)) ? level : parseInt(level);
					}
				}
			}

			// –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –Ω–∏ –≤ –æ–¥–∏–Ω –¥–∏–∞–ø–∞–∑–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0 –±–∞–ª–ª–æ–≤)
			return 2;
		}


        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—â–∏—Ö—Å—è
        function syncStudentsCount() {
            const currentCount = appData.students.length;
            document.getElementById('presentStudents').value = currentCount;
            appData.test.presentStudents = currentCount;
            saveData();
            showNotification(`–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${currentCount}`, "success");
        }

        // ==================== –ê–ù–ê–õ–ò–¢–ò–ö–ê ====================

		// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é updateAnalytics()
		function updateAnalytics() {
			try {
				// –í–°–ï –§–£–ù–ö–¶–ò–ò –í –ë–õ–û–ö–ï try-catch
				updateKPIDashboard();
				updateTaxonomyAnalysis();
				updateErrorsAnalysis();
				updatePersonalAnalysis();
				showSmartRecommendations();
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ä–∞–±–æ—Ç—ã
				const workType = safeGet(appData, 'test.workType', 'current');
				
				switch(workType) {
					case 'vpr':
						updateVPRAnalysis();
						break;
					case 'func_literacy':
						updateLiteracyAnalysis();
						break;
					case 'oge':
					case 'ege':
						updateGIAnalysis();
						break;
					case 'final':
						updateFinalAnalysis();
						break;
					case 'milestone':
						updateMilestoneAnalysis();
						break;
					case 'current':
						updateCurrentAnalysis();
						break;
					case 'diagnostic':
						updateDiagnosticAnalysis();
						break;
					case 'psychology':
					updatePsychologyAnalysis();
					break;
					default:
						document.getElementById('specializedAnalysis').innerHTML = 
							'<p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã</p>';
				}
			} catch (error) {
				console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ updateAnalytics:', error);
				document.getElementById('specializedAnalysis').innerHTML = 
					`<div class="alert alert-danger">
						<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: ${error.message}</p>
						<button class="btn btn-sm" onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
					</div>`;
			}
		}

        // KPI –¥–∞—à–±–æ—Ä–¥
        function updateKPIDashboard() {
            if (appData.results.length === 0) {
                document.getElementById('kpiDashboard').innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>';
                return;
            }
            
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            const completionRate = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
            
            const sou = (grades.filter(g => g >= 3).length / grades.length * 100);
            
            const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
            grades.forEach(grade => gradeCounts[grade]++);
            const mode = Object.keys(gradeCounts).reduce((a, b) => gradeCounts[a] > gradeCounts[b] ? a : b);
            const median = calculateMedian(totalScores);
            
            const stdDev = Math.sqrt(totalScores.reduce((sum, score) => sum + Math.pow(score - avgScore, 2), 0) / totalScores.length);
            
            document.getElementById('kpiDashboard').innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-value">${avgScore.toFixed(1)}</div>
                    <div class="kpi-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${successRate.toFixed(1)}%</div>
                    <div class="kpi-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${qualityRate.toFixed(1)}%</div>
                    <div class="kpi-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${sou.toFixed(1)}%</div>
                    <div class="kpi-label">–°–û–£</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${completionRate.toFixed(1)}%</div>
                    <div class="kpi-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${stdDev.toFixed(2)}</div>
                    <div class="kpi-label">–°—Ç–∞–Ω–¥. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${mode}</div>
                    <div class="kpi-label">–ú–æ–¥–∞ –æ—Ü–µ–Ω–æ–∫</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${median.toFixed(1)}</div>
                    <div class="kpi-label">–ú–µ–¥–∏–∞–Ω–∞ –±–∞–ª–ª–æ–≤</div>
                </div>
            `;
        }

		// –ì–õ–û–ë–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö
		window.addEventListener('error', function(event) {
			console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
			if (event.error.message && event.error.message.includes('Cannot read properties')) {
				showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
			}
			
			// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
			event.preventDefault();
		});

		// –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø PROMISE –û–®–ò–ë–û–ö
		window.addEventListener('unhandledrejection', function(event) {
			console.error('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ Promise:', event.reason);
			showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏', 'error');
		});

		// –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ
		function initializeDefaultData() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º appData –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π
				if (!appData) {
					appData = {
						test: {},
						tasks: [],
						students: [],
						results: [],
						errors: []
					};
				}
				
				// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				appData.test = appData.test || {};
				appData.tasks = appData.tasks || [];
				appData.students = appData.students || [];
				appData.results = appData.results || [];
				appData.errors = appData.errors || [];
				
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
				if (!appData.test.criteria) {
					appData.test.criteria = {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					};
				}
				
				saveData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
			}
		}

		// ==================== –ï–î–ò–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –≠–ö–°–ü–û–†–¢–ê/–ò–ú–ü–û–†–¢–ê ====================
		function exportAppData(format = 'json') {
			try {
				// –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö
				const exportData = {
					version: '2.0',
					timestamp: new Date().toISOString(),
					appData: JSON.parse(JSON.stringify(appData)),
					metadata: {
						testCount: appData.tasks.length,
						studentCount: appData.students.length,
						errorCount: appData.errors.length,
						avgScore: calculateAverageScore().toFixed(2)
					}
				};
				
				const dataStr = JSON.stringify(exportData, null, 2);
				
				if (format === 'json') {
					// –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
					const blob = new Blob([dataStr], { type: 'application/json' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = `–∞–Ω–∞–ª–∏–∑_${appData.test.subject || '–¥–∞–Ω–Ω—ã–µ'}_${new Date().toISOString().slice(0, 10)}.json`;
					a.click();
					URL.revokeObjectURL(url);
					
					showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON', 'success');
					return true;
				}
				
				return false;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', 'error');
				return false;
			}
		}

		function importAppData(jsonString) {
			try {
				const importedData = JSON.parse(jsonString);
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
				if (!importedData.appData) {
					throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö');
				}
				
				// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
				createBackup();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
				Object.assign(appData, importedData.appData);
				
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è
				initializeAppData();
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º
				saveData();
				renderAll();
				
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.', 'error');
				return false;
			}
		}

		function handleFileImport(event) {
			const file = event.target.files[0];
			if (!file) return;
			
			const reader = new FileReader();
			reader.onload = function(e) {
				if (confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
					importAppData(e.target.result);
				}
			};
			reader.readAsText(file);
			
			// –°–±—Ä–∞—Å—ã–≤–∞–µ–º input
			event.target.value = '';
		}
		
		// ==================== –ù–ê–î–ï–ñ–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ====================
		function initializeAppData() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ appData
				if (!window.appData) {
					window.appData = {
						test: {},
						tasks: [],
						students: [],
						results: [],
						errors: [],
						psychologyFeatures: []
					};
				}
				
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Ç–µ—Å—Ç–∞
				const defaultTest = {
					subject: "",
					class: "",
					testDate: new Date().toISOString().split('T')[0],
					theme: "",
					goals: "",
					workType: "current",
					workFormat: "mixed",
					timeLimit: 45,
					totalStudents: 25,
					presentStudents: 23,
					absentReason: "",
					criteria: {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					},
					criteriaType: 'points',
					criteriaSystem: 'standard',
					customCriteria: [],
					criteriaCount: 4,
					criteriaScale: '2-5'
				};
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
				appData.test = { ...defaultTest, ...(appData.test || {}) };
				
				// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ –º–∞—Å—Å–∏–≤—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				appData.tasks = appData.tasks || [];
				appData.students = appData.students || [];
				appData.results = appData.results || [];
				appData.errors = appData.errors || [];
				appData.psychologyFeatures = appData.psychologyFeatures || [];
				
				console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				// –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ
				window.appData = {
					test: {
						subject: "–ù–æ–≤—ã–π —Ç–µ—Å—Ç",
						class: "5–ê",
						testDate: new Date().toISOString().split('T')[0],
						criteria: {
							5: { min: 18, max: 20 },
							4: { min: 15, max: 17 },
							3: { min: 10, max: 14 },
							2: { min: 0, max: 9 }
						}
					},
					tasks: [],
					students: [],
					results: [],
					errors: [],
					psychologyFeatures: []
				};
				return false;
			}
		}		
		
		// –û–ë–ù–û–í–õ–Ø–ï–ú –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
		document.addEventListener('DOMContentLoaded', function() {
			try {
				// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
				loadAppData();
				
				// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
				if (typeof renderAll === 'function') {
					renderAll();
				}
				
				if (typeof setupTabNavigation === 'function') {
					setupTabNavigation();
				}
				
				// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
				setTimeout(() => {
					try {
						if (typeof setupHotkeys === 'function') setupHotkeys();
						if (typeof setupProgressiveSaving === 'function') setupProgressiveSaving();
						if (typeof enhanceExportSection === 'function') enhanceExportSection();
					} catch (e) {
						console.warn('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:', e);
					}
				}, 500);
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				const tourCompleted = localStorage.getItem('tourCompleted');
				if (!tourCompleted) {
					setTimeout(() => {
						if (confirm('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –∫—Ä–∞—Ç–∫–∏–π —Ç—É—Ä –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º —Å–∏—Å—Ç–µ–º—ã?')) {
							if (typeof startTour === 'function') {
								try { startTour(); } catch(e) { console.error(e); }
							}
						}
					}, 2000);
				}
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
				const savedAutoSave = localStorage.getItem('autoSaveEnabled');
				if (savedAutoSave !== null) {
					autoSaveEnabled = savedAutoSave === 'true';
				}
				
				console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ');
			} catch (error) {
				console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
				const errorHtml = `
					<div style="padding: 20px; text-align: center;">
						<h2 style="color: #e74c3c;">‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
						<p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
						<ol style="text-align: left; display: inline-block;">
							<li>–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)</li>
							<li>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞</li>
							<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä</li>
						</ol>
						<button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
							üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
						</button>
					</div>
				`;
				
				const container = document.querySelector('.container');
				if (container) {
					container.innerHTML = errorHtml;
				}
			}
		});

		// –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∫ HTML –æ—Ç—á–µ—Ç —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—á–∞—Ç–∏
		async function exportChartsAsHTML() {
			closeExportMenu();
			
			try {
				showNotification('–°–æ–∑–¥–∞–µ–º HTML –æ—Ç—á–µ—Ç...', 'info');
				
				// –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç—á–µ—Ç–∞
				const modal = document.createElement('div');
				modal.className = 'modal fade show d-block';
				modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
				modal.innerHTML = `
					<div class="modal-dialog modal-xl modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header bg-primary text-white">
								<h5 class="modal-title">
									<i class="fas fa-chart-bar me-2"></i>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç
								</h5>
								<button type="button" class="btn-close btn-close-white" onclick="closeReportModal()"></button>
							</div>
							<div class="modal-body p-4" id="reportContent">
								<!-- –ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—á–µ—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
								<div class="text-center py-5">
									<div class="spinner-border text-primary" role="status">
										<span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
									</div>
									<p class="mt-3">–§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç...</p>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" onclick="closeReportModal()">
									<i class="fas fa-times me-2"></i>–ó–∞–∫—Ä—ã—Ç—å
								</button>
								<button type="button" class="btn btn-success" onclick="exportReport('html')">
									<i class="fas fa-print me-2"></i>–ü–µ—á–∞—Ç—å
								</button>
								<button type="button" class="btn btn-primary" onclick="saveReportAsPDF()">
									<i class="fas fa-file-pdf me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ PDF
								</button>
							</div>
						</div>
					</div>
				`;
				
				document.body.appendChild(modal);
				
				// –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
				await loadReportLibraries();
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—á–µ—Ç–∞
				await generateReportContent();
				addExportButtons();
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞', 'error');
				closeReportModal();
			}
		}


		// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
		function exportReport(type = 'print') {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) {
				showNotification('–û—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
				return;
			}

			if (type === 'html') {
				exportToHTML();
				return;
			}
			
			if (type === 'docx') {
				exportToDOCX();
				return;
			}
			
			// –î–ª—è –ø–µ—á–∞—Ç–∏
			printReport();
		}

		// –§—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∏
		async function printReport() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			try {
				showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –∫ –ø–µ—á–∞—Ç–∏...', 'info');
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
				const originalHtml = reportContent.innerHTML;
				const originalDisplay = reportContent.style.display;
				
				// –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
				reportContent.style.display = 'none';
				
				// –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–µ—á–∞—Ç–∏
				const printContainer = document.createElement('div');
				printContainer.id = 'printContainer';
				printContainer.style.cssText = `
					position: fixed;
					left: -10000px;
					top: 0;
					width: 210mm;
					min-height: 100%;
					background: white;
					z-index: 99999;
					padding: 15mm;
					box-sizing: border-box;
					font-family: 'Arial', sans-serif;
					font-size: 11pt;
					line-height: 1.4;
					color: #000 !important;
					visibility: hidden;
				`;
				
				// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ canvas –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤—ã—Å–æ–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º
				const canvasPromises = [];
				const canvases = reportContent.querySelectorAll('canvas');
				
				canvases.forEach((canvas, index) => {
					const promise = new Promise((resolve) => {
						try {
							// –î–ª—è Chart.js
							if (canvas.chart && typeof canvas.chart.toBase64Image === 'function') {
								// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–∞–∑–º–µ—Ä—ã
								const originalWidth = canvas.width;
								const originalHeight = canvas.height;
								
								// –í—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
								canvas.width = originalWidth * 3;
								canvas.height = originalHeight * 3;
								canvas.chart.resize();
								
								const dataUrl = canvas.chart.toBase64Image();
								
								// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã
								canvas.width = originalWidth;
								canvas.height = originalHeight;
								canvas.chart.resize();
								
								resolve({
									index: index,
									dataUrl: dataUrl,
									type: 'chartjs'
								});
							} else {
								// –û–±—ã—á–Ω—ã–π canvas
								const tempCanvas = document.createElement('canvas');
								const ctx = tempCanvas.getContext('2d');
								
								// –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤ 3 —Ä–∞–∑–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
								tempCanvas.width = canvas.width * 3;
								tempCanvas.height = canvas.height * 3;
								
								// –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∏ —Ä–∏—Å—É–µ–º —Å –≤—ã—Å–æ–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º
								ctx.scale(3, 3);
								ctx.drawImage(canvas, 0, 0);
								
								const dataUrl = tempCanvas.toDataURL('image/png', 1.0);
								resolve({
									index: index,
									dataUrl: dataUrl,
									type: 'canvas'
								});
							}
						} catch (error) {
							console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ canvas:', error);
							resolve(null);
						}
					});
					canvasPromises.push(promise);
				});
				
				// –ñ–¥–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö canvas
				const canvasResults = await Promise.all(canvasPromises);
				
				// –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
				const contentClone = reportContent.cloneNode(true);
				
				// –ó–∞–º–µ–Ω—è–µ–º canvas –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
				canvasResults.forEach(result => {
					if (result && result.dataUrl) {
						const canvas = contentClone.querySelectorAll('canvas')[result.index];
						if (canvas) {
							const img = document.createElement('img');
							img.src = result.dataUrl;
							img.style.width = '100%';
							img.style.maxWidth = '100%';
							img.style.height = 'auto';
							img.style.display = 'block';
							img.style.margin = '10px 0';
							img.alt = '–ì—Ä–∞—Ñ–∏–∫';
							img.style.pageBreakInside = 'avoid';
							img.style.breakInside = 'avoid';
							
							// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
							if (canvas.style.width) img.style.width = canvas.style.width;
							if (canvas.style.height) img.style.height = canvas.style.height;
							
							canvas.parentNode.replaceChild(img, canvas);
						}
					}
				});
				
				// –£–¥–∞–ª—è–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
				const elementsToRemove = contentClone.querySelectorAll(
					'.btn, .no-print, .modal-footer, .spinner-border, .alert:not(.print-show), ' +
					'button, .navbar, .sidebar, .dropdown, .tooltip, .popover'
				);
				elementsToRemove.forEach(el => el.remove());
				
				// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏ (1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 2)
				const fixGrades = (text) => {
					return text.replace(/\b1\b/g, '2');
				};
				
				// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã
				const walker = document.createTreeWalker(contentClone, NodeFilter.SHOW_TEXT, null, false);
				let node;
				while (node = walker.nextNode()) {
					if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
						node.textContent = fixGrades(node.textContent);
					}
				}
				
				// –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç—á–µ—Ç–∞
				const reportSections = [];
				
				// –†–∞–∑–±–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ—Å—Ç–∏
				const sections = contentClone.querySelectorAll('.card, .section, table, .chart-container');
				
				let currentSection = [];
				let currentHeight = 0;
				const maxPageHeight = 250; // –º–º (–ø—Ä–∏–º–µ—Ä–Ω–æ –¥–ª—è A4 —Å —É—á–µ—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤)
				
				sections.forEach((section, index) => {
					// –ü—Ä–æ—Å—Ç–∞—è –æ—Ü–µ–Ω–∫–∞ –≤—ã—Å–æ—Ç—ã (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
					const estimatedHeight = section.tagName === 'TABLE' ? 100 : 
										  section.classList.contains('chart-container') ? 120 : 80;
					
					if (currentHeight + estimatedHeight > maxPageHeight && currentSection.length > 0) {
						reportSections.push(currentSection);
						currentSection = [section];
						currentHeight = estimatedHeight;
					} else {
						currentSection.push(section);
						currentHeight += estimatedHeight;
					}
				});
				
				if (currentSection.length > 0) {
					reportSections.push(currentSection);
				}
				
				// –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –ø–µ—á–∞—Ç–∏
				let printHTML = `
					<!DOCTYPE html>
					<html lang="ru">
					<head>
						<meta charset="UTF-8">
						<meta name="viewport" content="width=device-width, initial-scale=1.0">
						<title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç</title>
						<style>
							@page {
								margin: 15mm;
								size: A4 portrait;
							}
							
							@media print {
								body {
									font-family: 'Arial', sans-serif;
									font-size: 11pt;
									line-height: 1.4;
									color: #000 !important;
									background: white !important;
									margin: 0;
									padding: 0;
								}
								
								.print-page {
									width: 210mm;
									min-height: 297mm;
									padding: 15mm;
									box-sizing: border-box;
									page-break-after: always;
									position: relative;
								}
								
								.print-page:last-child {
									page-break-after: auto;
								}
								
								.print-header {
									text-align: center;
									margin-bottom: 20mm;
									border-bottom: 2px solid #000;
									padding-bottom: 5mm;
								}
								
								.print-header h1 {
									font-size: 18pt;
									margin: 0 0 3mm 0;
									font-weight: bold;
								}
								
								.print-header .subtitle {
									font-size: 12pt;
									margin: 2mm 0;
								}
								
								.print-footer {
									position: fixed;
									bottom: 0;
									left: 0;
									width: 100%;
									text-align: center;
									font-size: 9pt;
									color: #666;
									padding: 5mm;
									border-top: 1px solid #ddd;
								}
								
								.section {
									margin-bottom: 10mm;
									page-break-inside: avoid;
								}
								
								.card {
									border: 1px solid #000;
									border-radius: 3mm;
									margin-bottom: 5mm;
									page-break-inside: avoid;
									overflow: hidden;
								}
								
								.card-header {
									background: #f5f5f5;
									padding: 3mm;
									border-bottom: 1px solid #000;
									font-weight: bold;
								}
								
								.card-body {
									padding: 3mm;
								}
								
								table {
									width: 100%;
									border-collapse: collapse;
									margin: 3mm 0;
									page-break-inside: avoid;
									font-size: 10pt;
								}
								
								th, td {
									border: 1px solid #000;
									padding: 2mm;
									text-align: left;
								}
								
								th {
									background: #f5f5f5;
									font-weight: bold;
								}
								
								img {
									max-width: 100%;
									height: auto;
									display: block;
									margin: 2mm auto;
									page-break-inside: avoid;
								}
								
								.progress {
									height: 4mm;
									background: #eee;
									border-radius: 2mm;
									overflow: hidden;
									margin: 2mm 0;
								}
								
								.progress-bar {
									height: 100%;
									background: #007bff;
								}
								
								.no-print, .btn, button {
									display: none !important;
								}
								
								/* –°—Ç–∏–ª–∏ –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–π –ø–µ—á–∞—Ç–∏ */
								.print-color * {
									-webkit-print-color-adjust: exact;
									print-color-adjust: exact;
								}
								
								.text-primary { color: #007bff !important; }
								.text-success { color: #28a745 !important; }
								.text-warning { color: #ffc107 !important; }
								.text-danger { color: #dc3545 !important; }
								.text-info { color: #17a2b8 !important; }
								
								.bg-primary { background-color: #007bff !important; color: white !important; }
								.bg-success { background-color: #28a745 !important; color: white !important; }
								.bg-warning { background-color: #ffc107 !important; color: #000 !important; }
								.bg-danger { background-color: #dc3545 !important; color: white !important; }
								.bg-info { background-color: #17a2b8 !important; color: white !important; }
							}
							
							@media screen {
								body {
									background: #f0f0f0;
									padding: 20px;
								}
								
								.print-page {
									background: white;
									margin: 0 auto 20px;
									box-shadow: 0 0 20px rgba(0,0,0,0.1);
									min-height: auto;
								}
							}
						</style>
					</head>
					<body>
				`;
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
				reportSections.forEach((sections, pageIndex) => {
					printHTML += `
						<div class="print-page">
							<div class="print-header">
								<h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç</h1>
								<div class="subtitle">${document.title || '–û—Ç—á–µ—Ç'}</div>
								<div>–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageIndex + 1} –∏–∑ ${reportSections.length}</div>
								<div>–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}</div>
							</div>
							
							<div class="print-content">
					`;
					
					sections.forEach(section => {
						printHTML += `<div class="section">${section.outerHTML}</div>`;
					});
					
					printHTML += `
							</div>
							
							<div class="print-footer">
								–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–∏—Å—Ç–µ–º–æ–π ‚Ä¢ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageIndex + 1} –∏–∑ ${reportSections.length}
							</div>
						</div>
					`;
				});
				
				printHTML += `
						</body>
						</html>
					`;
				
				// –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ –¥–ª—è –ø–µ—á–∞—Ç–∏
				const printWindow = window.open('', '_blank');
				if (printWindow) {
					printWindow.document.write(printHTML);
					printWindow.document.close();
					
					// –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
					setTimeout(() => {
						printWindow.focus();
						
						// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –ø–µ—á–∞—Ç–∏
						const printDialog = `
							<div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
									   background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 30px rgba(0,0,0,0.3);
									   z-index: 100000; text-align: center; display: none;">
								<h3 style="margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–µ—á–∞—Ç–∏</h3>
								<div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
									<button onclick="window.print(); this.parentNode.parentNode.style.display=\'none\';" 
											style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
										üñ® –ü–µ—á–∞—Ç—å
									</button>
									<button onclick="window.close();" 
											style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
										‚úï –û—Ç–º–µ–Ω–∞
									</button>
								</div>
								<div style="display: flex; gap: 10px; justify-content: center;">
									<button onclick="document.body.classList.add(\'print-color\'); window.print(); this.parentNode.parentNode.style.display=\'none\';" 
											style="padding: 8px 15px; background: linear-gradient(45deg, #FF6B6B, #4ECDC4); color: white; border: none; border-radius: 5px; cursor: pointer;">
										üåà –¶–≤–µ—Ç–Ω–∞—è
									</button>
									<button onclick="document.body.classList.remove(\'print-color\'); window.print(); this.parentNode.parentNode.style.display=\'none\';" 
											style="padding: 8px 15px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer;">
										‚ö´ –ß/–ë
									</button>
								</div>
							</div>
						`;
						
						printWindow.document.body.insertAdjacentHTML('beforeend', printDialog);
						
					}, 1000);
					
					// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
					reportContent.style.display = originalDisplay;
					
				} else {
					showNotification('–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏', 'warning');
					reportContent.style.display = originalDisplay;
				}
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø–µ—á–∞—Ç–∏:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏', 'error');
			}
		}

		// –≠–∫—Å–ø–æ—Ä—Ç –≤ HTML
		async function exportToHTML() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			try {
				showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ HTML —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');
				
				// –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
				const contentClone = reportContent.cloneNode(true);
				
				// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º canvas
				const canvasPromises = [];
				const canvases = contentClone.querySelectorAll('canvas');
				
				canvases.forEach((canvas, index) => {
					const promise = new Promise((resolve) => {
						try {
							if (canvas.chart && typeof canvas.chart.toBase64Image === 'function') {
								// –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è Chart.js
								const originalWidth = canvas.width;
								const originalHeight = canvas.height;
								canvas.width = originalWidth * 2;
								canvas.height = originalHeight * 2;
								canvas.chart.resize();
								
								const dataUrl = canvas.chart.toBase64Image();
								
								canvas.width = originalWidth;
								canvas.height = originalHeight;
								canvas.chart.resize();
								
								resolve({ canvas, dataUrl });
							} else {
								const dataUrl = canvas.toDataURL('image/png', 1.0);
								resolve({ canvas, dataUrl });
							}
						} catch (error) {
							resolve(null);
						}
					});
					canvasPromises.push(promise);
				});
				
				const canvasResults = await Promise.all(canvasPromises);
				
				// –ó–∞–º–µ–Ω—è–µ–º canvas –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
				canvasResults.forEach(result => {
					if (result && result.dataUrl) {
						const img = document.createElement('img');
						img.src = result.dataUrl;
						img.style.width = '100%';
						img.style.maxWidth = '100%';
						img.style.height = 'auto';
						result.canvas.parentNode.replaceChild(img, result.canvas);
					}
				});
				
				// –£–¥–∞–ª—è–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
				const elementsToRemove = contentClone.querySelectorAll(
					'.btn, .no-export, .modal-footer, .spinner-border, button, .navbar, .sidebar'
				);
				elementsToRemove.forEach(el => el.remove());
				
				// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏
				const fixGrades = (text) => text.replace(/\b1\b/g, '2');
				
				const walker = document.createTreeWalker(contentClone, NodeFilter.SHOW_TEXT, null, false);
				let node;
				while (node = walker.nextNode()) {
					if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
						node.textContent = fixGrades(node.textContent);
					}
				}
				
				// –°–æ–∑–¥–∞–µ–º HTML –¥–æ–∫—É–º–µ–Ω—Ç
				const htmlContent = `
					<!DOCTYPE html>
					<html lang="ru">
					<head>
						<meta charset="UTF-8">
						<meta name="viewport" content="width=device-width, initial-scale=1.0">
						<title>${document.title || '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç'}</title>
						<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
						<style>
							body {
								font-family: Arial, sans-serif;
								padding: 20px;
								max-width: 1200px;
								margin: 0 auto;
							}
							.report-header {
								text-align: center;
								margin-bottom: 30px;
								padding-bottom: 20px;
								border-bottom: 2px solid #007bff;
							}
							.card {
								margin-bottom: 20px;
								box-shadow: 0 2px 10px rgba(0,0,0,0.1);
							}
							img {
								max-width: 100%;
								height: auto;
							}
							table {
								width: 100%;
								margin-bottom: 20px;
							}
							.export-info {
								text-align: center;
								margin-top: 40px;
								padding-top: 20px;
								border-top: 1px solid #ddd;
								color: #666;
								font-size: 12px;
							}
						</style>
					</head>
					<body>
						<div class="report-header">
							<h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç</h1>
							<h3>${document.title || ''}</h3>
							<p>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${new Date().toLocaleDateString('ru-RU')} ${new Date().toLocaleTimeString('ru-RU')}</p>
						</div>
						
						<div class="report-content">
							${contentClone.innerHTML}
						</div>
						
						<div class="export-info">
							<p>–û—Ç—á–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>
							<p>¬© ${new Date().getFullYear()}</p>
						</div>
					</body>
					</html>
				`;
				
				// –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
				const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = `–æ—Ç—á–µ—Ç_${new Date().toISOString().slice(0,10)}.html`;
				document.body.appendChild(a);
				a.click();
				document.body.removeChild(a);
				URL.revokeObjectURL(url);
				
				showNotification('HTML —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ HTML:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ HTML', 'error');
			}
		}

		// –≠–∫—Å–ø–æ—Ä—Ç –≤ DOCX (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ HTML)
		async function exportToDOCX() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			try {
				showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ DOCX —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');
				
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É html-docx-js –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
				if (typeof htmlDocx !== 'undefined') {
					// –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è DOCX
					const htmlForDocx = await createHTMLForDOCX();
					const converted = htmlDocx.asBlob(htmlForDocx);
					
					const url = URL.createObjectURL(converted);
					const a = document.createElement('a');
					a.href = url;
					a.download = `–æ—Ç—á–µ—Ç_${new Date().toISOString().slice(0,10)}.docx`;
					document.body.appendChild(a);
					a.click();
					document.body.removeChild(a);
					URL.revokeObjectURL(url);
					
					showNotification('DOCX —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
				} else {
					// Fallback: —ç–∫—Å–ø–æ—Ä—Ç –∫–∞–∫ HTML
					showNotification('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è DOCX –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞–∫ HTML', 'warning');
					exportToHTML();
				}
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ DOCX:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ DOCX', 'error');
			}
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è HTML –¥–ª—è DOCX
		async function createHTMLForDOCX() {
			const reportContent = document.getElementById('reportContent');
			const contentClone = reportContent.cloneNode(true);
			
			// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º canvas
			const canvasPromises = [];
			const canvases = contentClone.querySelectorAll('canvas');
			
			canvases.forEach((canvas, index) => {
				const promise = new Promise((resolve) => {
					try {
						if (canvas.chart && typeof canvas.chart.toBase64Image === 'function') {
							// –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è Chart.js
							const originalWidth = canvas.width;
							const originalHeight = canvas.height;
							canvas.width = originalWidth * 2;
							canvas.height = originalHeight * 2;
							canvas.chart.resize();
							
							const dataUrl = canvas.chart.toBase64Image();
							
							canvas.width = originalWidth;
							canvas.height = originalHeight;
							canvas.chart.resize();
							
							resolve({ canvas, dataUrl });
						} else {
							const dataUrl = canvas.toDataURL('image/png', 1.0);
							resolve({ canvas, dataUrl });
						}
					} catch (error) {
						resolve(null);
					}
				});
				canvasPromises.push(promise);
			});
			
			const canvasResults = await Promise.all(canvasPromises);
			
			// –ó–∞–º–µ–Ω—è–µ–º canvas –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
			canvasResults.forEach(result => {
				if (result && result.dataUrl) {
					const img = document.createElement('img');
					img.src = result.dataUrl;
					img.style.width = '100%';
					img.style.maxWidth = '100%';
					img.style.height = 'auto';
					result.canvas.parentNode.replaceChild(img, result.canvas);
				}
			});
			
			// –£–¥–∞–ª—è–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
			const elementsToRemove = contentClone.querySelectorAll(
				'.btn, .no-export, .modal-footer, .spinner-border, button, .navbar, .sidebar'
			);
			elementsToRemove.forEach(el => el.remove());
			
			// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏
			const fixGrades = (text) => text.replace(/\b1\b/g, '2');
			
			const walker = document.createTreeWalker(contentClone, NodeFilter.SHOW_TEXT, null, false);
			let node;
			while (node = walker.nextNode()) {
				if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
					node.textContent = fixGrades(node.textContent);
				}
			}

			return `
				<!DOCTYPE html>
				<html>
				<head>
					<meta charset="UTF-8">
					<style>
						body {
							font-family: 'Times New Roman', Times, serif;
							font-size: 12pt;
							line-height: 1.5;
						}
						h1 { font-size: 16pt; }
						h2 { font-size: 14pt; }
						h3 { font-size: 12pt; }
						table { border-collapse: collapse; width: 100%; }
						th, td { border: 1px solid black; padding: 5px; }
						th { background: #f0f0f0; }
						img { max-width: 100%; height: auto; }
					</style>
				</head>
				<body>
					<h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç</h1>
					<p>–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}</p>
					${contentClone.innerHTML}
				</body>
				</html>
			`;
		}

		// –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—ã–∑–æ–≤–∞ —ç—Ç–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
		function addExportButtons() {
			try {
				// –ò—â–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫
				let container = null;
				
				// –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—â–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫
				const possibleSelectors = [
					'.report-header',
					'.card-header:has(h1, h2, h3)',
					'.d-flex.justify-content-between',
					'.btn-toolbar',
					'.actions',
					'.toolbar',
					'#reportActions',
					'.container-fluid:first-child'
				];
				
				for (const selector of possibleSelectors) {
					const element = document.querySelector(selector);
					if (element) {
						container = element;
						break;
					}
				}
				
				// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—â–µ–º reportContent –∏ —Ä–∞–∑–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–¥ –Ω–∏–º –∏–ª–∏ –ø–æ—Å–ª–µ
				if (!container) {
					const reportContent = document.getElementById('reportContent');
					if (reportContent) {
						// –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–¥ –æ—Ç—á–µ—Ç–æ–º
						const buttonContainer = document.createElement('div');
						buttonContainer.className = 'report-export-buttons mb-4';
						buttonContainer.style.cssText = `
							display: flex;
							justify-content: flex-end;
							gap: 10px;
							padding: 15px;
							background: #f8f9fa;
							border-radius: 8px;
							border: 1px solid #dee2e6;
						`;
						
						reportContent.parentNode.insertBefore(buttonContainer, reportContent);
						container = buttonContainer;
					}
				}
				
				// –í–∞—Ä–∏–∞–Ω—Ç 3: –°–æ–∑–¥–∞–µ–º –ø–ª–∞–≤–∞—é—â—É—é –ø–∞–Ω–µ–ª—å –∫–Ω–æ–ø–æ–∫
				if (!container) {
					container = document.createElement('div');
					container.id = 'floatingExportButtons';
					container.style.cssText = `
						position: fixed;
						top: 100px;
						right: 20px;
						z-index: 1000;
						background: white;
						padding: 10px;
						border-radius: 8px;
						box-shadow: 0 4px 20px rgba(0,0,0,0.15);
						display: flex;
						flex-direction: column;
						gap: 8px;
						border: 1px solid #dee2e6;
					`;
					document.body.appendChild(container);
				}
				
				// –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏
				const buttonsHTML = `
					<div class="btn-group" role="group" aria-label="–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞">
						<button type="button" class="btn btn-primary btn-sm" onclick="exportReport('print')" 
								title="–ü–µ—á–∞—Ç—å –æ—Ç—á–µ—Ç–∞">
							<i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å
						</button>
						<button type="button" class="btn btn-success btn-sm" onclick="exportReport('html')"
								title="–≠–∫—Å–ø–æ—Ä—Ç –≤ HTML">
							<i class="fas fa-file-code"></i> HTML
						</button>
						<button type="button" class="btn btn-info btn-sm" onclick="exportReport('docx')"
								title="–≠–∫—Å–ø–æ—Ä—Ç –≤ Word">
							<i class="fas fa-file-word"></i> DOCX
						</button>
					</div>
					
					<style>
						.report-export-buttons .btn {
							min-width: 100px;
						}
						
						#floatingExportButtons .btn {
							min-width: 120px;
							justify-content: flex-start;
						}
						
						@media (max-width: 768px) {
							#floatingExportButtons {
								position: fixed;
								bottom: 20px;
								top: auto;
								right: 20px;
								left: 20px;
								flex-direction: row;
								justify-content: center;
							}
							
							#floatingExportButtons .btn {
								min-width: auto;
								flex: 1;
							}
						}
					</style>
				`;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
				if (container.id === 'floatingExportButtons') {
					container.innerHTML = buttonsHTML;
				} else {
					// –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –Ω–µ–≥–æ
					if (container.querySelector('.btn-group')) {
						// –£–∂–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö
						container.querySelector('.btn-group').outerHTML = buttonsHTML;
					} else {
						// –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É –∫–Ω–æ–ø–æ–∫
						container.insertAdjacentHTML('beforeend', buttonsHTML);
					}
				}
				
				console.log('–ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤:', container);
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
				
				// Fallback: —Å–æ–∑–¥–∞–µ–º –ø–ª–∞–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É
				createFloatingExportButton();
			}
		}

		// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞
		function createFloatingExportButton() {
			const floatingBtn = document.createElement('button');
			floatingBtn.id = 'floatingExportBtn';
			floatingBtn.innerHTML = '<i class="fas fa-download"></i>';
			floatingBtn.title = '–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞';
			floatingBtn.style.cssText = `
				position: fixed;
				bottom: 30px;
				right: 30px;
				width: 60px;
				height: 60px;
				border-radius: 50%;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				border: none;
				font-size: 24px;
				cursor: pointer;
				z-index: 1000;
				box-shadow: 0 6px 20px rgba(0,0,0,0.3);
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.3s ease;
			`;
			
			// –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
			floatingBtn.addEventListener('mouseenter', () => {
				floatingBtn.style.transform = 'scale(1.1)';
				floatingBtn.style.boxShadow = '0 8px 25px rgba(0,0,0,0.4)';
			});
			
			floatingBtn.addEventListener('mouseleave', () => {
				floatingBtn.style.transform = 'scale(1)';
				floatingBtn.style.boxShadow = '0 6px 20px rgba(0,0,0,0.3)';
			});
			
			// –ú–µ–Ω—é —ç–∫—Å–ø–æ—Ä—Ç–∞
			let menuVisible = false;
			const exportMenu = document.createElement('div');
			exportMenu.id = 'exportMenu';
			exportMenu.style.cssText = `
				position: absolute;
				bottom: 70px;
				right: 0;
				background: white;
				border-radius: 10px;
				box-shadow: 0 10px 30px rgba(0,0,0,0.2);
				padding: 10px;
				min-width: 150px;
				display: none;
				flex-direction: column;
				gap: 5px;
				z-index: 1001;
				border: 1px solid #dee2e6;
			`;
			
			const menuItems = [
				{ text: 'üñ® –ü–µ—á–∞—Ç—å', action: 'print', color: '#007bff' },
				{ text: 'üìÑ HTML', action: 'html', color: '#28a745' },
				{ text: 'üìù Word', action: 'docx', color: '#17a2b8' }
			];
			
			menuItems.forEach(item => {
				const menuItem = document.createElement('button');
				menuItem.textContent = item.text;
				menuItem.style.cssText = `
					padding: 8px 12px;
					background: ${item.color};
					color: white;
					border: none;
					border-radius: 5px;
					cursor: pointer;
					text-align: left;
					font-size: 14px;
					transition: all 0.2s;
				`;
				
				menuItem.addEventListener('mouseenter', () => {
					menuItem.style.opacity = '0.9';
					menuItem.style.transform = 'translateX(-5px)';
				});
				
				menuItem.addEventListener('mouseleave', () => {
					menuItem.style.opacity = '1';
					menuItem.style.transform = 'translateX(0)';
				});
				
				menuItem.addEventListener('click', () => {
					exportReport(item.action);
					exportMenu.style.display = 'none';
					menuVisible = false;
				});
				
				exportMenu.appendChild(menuItem);
			});
			
			floatingBtn.appendChild(exportMenu);
			
			// –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
			floatingBtn.addEventListener('click', (e) => {
				e.stopPropagation();
				menuVisible = !menuVisible;
				exportMenu.style.display = menuVisible ? 'flex' : 'none';
			});
			
			// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
			document.addEventListener('click', () => {
				if (menuVisible) {
					exportMenu.style.display = 'none';
					menuVisible = false;
				}
			});
			
			document.body.appendChild(floatingBtn);
		}

		// –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
		function initExportButtons() {
			// –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', () => {
					setTimeout(addExportButtons, 1500);
				});
			} else {
				setTimeout(addExportButtons, 1500);
			}
			
			// –¢–∞–∫–∂–µ –ø—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ AJAX-–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
			// –ï—Å–ª–∏ —É –≤–∞—Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –¥–æ–±–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ addExportButtons –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–∞
		}

		// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
		// initExportButtons();

		// –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ - —Å–¥–µ–ª–∞–π—Ç–µ –µ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π
		window.exportReport = function(type = 'print') {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) {
				showNotification('–û—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
				return;
			}

			if (type === 'html') {
				exportToHTML();
				return;
			}
			
			if (type === 'docx') {
				exportToDOCX();
				return;
			}
			
			// –î–ª—è –ø–µ—á–∞—Ç–∏
			printReport();
		};

		// –°–¥–µ–ª–∞–π—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–æ–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
		window.printReport = printReport;
		window.exportToHTML = exportToHTML;
		window.exportToDOCX = exportToDOCX;
		function exportChartsForPrint() {
			const charts = [];
			document.querySelectorAll('canvas').forEach((canvas, index) => {
				try {
					const dataUrl = canvas.toDataURL('image/png', 1.0);
					charts.push({
						id: canvas.id || `chart-${index}`,
						dataUrl: dataUrl,
						width: canvas.width,
						height: canvas.height
					});
				} catch (e) {
					console.warn('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', e);
				}
			});
			return charts;
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
		function optimizeForPrint(container) {
			// –†–∞–∑–±–∏–≤–∞–µ–º –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã
			const tables = container.querySelectorAll('table');
			tables.forEach(table => {
				if (table.offsetHeight > 500) { // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è
					table.classList.add('no-break');
				}
			});
			
			// –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
			const images = container.querySelectorAll('img');
			images.forEach(img => {
				img.style.maxWidth = '100%';
				img.style.height = 'auto';
			});
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑—Ä—ã–≤—ã —Å—Ç—Ä–∞–Ω–∏—Ü –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
			const sections = container.querySelectorAll('.card, .section');
			sections.forEach((section, index) => {
				if (index > 0 && section.offsetHeight > 400) {
					section.classList.add('no-break');
				}
			});
			
			// –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
			const emptyElements = container.querySelectorAll(':empty');
			emptyElements.forEach(el => {
				if (!el.hasChildNodes() && el.tagName !== 'INPUT' && el.tagName !== 'BR' && el.tagName !== 'HR') {
					el.remove();
				}
			});
		}
		// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
		async function loadReportLibraries() {
			if (typeof html2canvas === 'undefined') {
				await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
			}
		}



		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç—á–µ—Ç–∞
		async function generateReportContent() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			try {
				// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞
				const totalScores = appData.results.map(scores => 
					scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0)
				);
				const averageScore = totalScores.reduce((a, b) => a + b, 0) / (totalScores.length || 1);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				const averagePercentage = (averageScore / (maxPossible || 1)) * 100;
				const minScore = Math.min(...totalScores);
				const maxScore = Math.max(...totalScores);
				
				// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
				const gradeDistribution = calculateGradeDistribution();
				
				// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
				const chartImages = await getChartImages();
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –æ—Ç—á–µ—Ç–∞
				const html = `
					<div class="report-container">
						<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á–µ—Ç–∞ -->
						<div class="report-header text-center mb-5">
							<h1 class="display-5 fw-bold text-primary mb-3">–ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢</h1>
							<div class="report-subtitle text-muted">
								<p class="lead">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
								<p class="mb-0">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU', {
									day: 'numeric',
									month: 'long',
									year: 'numeric',
									hour: '2-digit',
									minute: '2-digit'
								})}</p>
							</div>
						</div>
						
						<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ -->
						<div class="report-section card border-0 shadow-sm mb-5">
							<div class="card-header bg-primary text-white">
								<h3 class="mb-0"><i class="fas fa-info-circle me-2"></i>–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –¢–ï–°–¢–ï</h3>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-md-6">
										<ul class="list-group list-group-flush">
											<li class="list-group-item d-flex justify-content-between">
												<span class="text-muted">–ü—Ä–µ–¥–º–µ—Ç:</span>
												<span class="fw-bold">${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span class="text-muted">–ö–ª–∞—Å—Å:</span>
												<span class="fw-bold">${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span class="text-muted">–¢–µ–º–∞:</span>
												<span class="fw-bold">${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</span>
											</li>
										</ul>
									</div>
									<div class="col-md-6">
										<ul class="list-group list-group-flush">
											<li class="list-group-item d-flex justify-content-between">
												<span class="text-muted">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</span>
												<span class="fw-bold">${appData.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span class="text-muted">–í—Å–µ–≥–æ —É—á–∞—â–∏—Ö—Å—è:</span>
												<span class="fw-bold">${appData.students.length}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span class="text-muted">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ:</span>
												<span class="fw-bold">${appData.test.presentStudents || appData.students.length}</span>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
						
						<!-- –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
						<div class="report-section mb-5">
							<h3 class="mb-4 text-center"><i class="fas fa-chart-line me-2"></i>–ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò</h3>
							<div class="row g-4">
								<div class="col-md-3 col-6">
									<div class="metric-card card border-0 text-center h-100 shadow-sm">
										<div class="card-body">
											<div class="metric-icon mb-3">
												<i class="fas fa-users fa-2x text-primary"></i>
											</div>
											<div class="metric-value display-6 fw-bold text-primary">${appData.students.length}</div>
											<div class="metric-label text-muted">–£—á–∞—â–∏—Ö—Å—è</div>
										</div>
									</div>
								</div>
								<div class="col-md-3 col-6">
									<div class="metric-card card border-0 text-center h-100 shadow-sm">
										<div class="card-body">
											<div class="metric-icon mb-3">
												<i class="fas fa-tasks fa-2x text-success"></i>
											</div>
											<div class="metric-value display-6 fw-bold text-success">${appData.tasks.length}</div>
											<div class="metric-label text-muted">–ó–∞–¥–∞–Ω–∏–π</div>
										</div>
									</div>
								</div>
								<div class="col-md-3 col-6">
									<div class="metric-card card border-0 text-center h-100 shadow-sm">
										<div class="card-body">
											<div class="metric-icon mb-3">
												<i class="fas fa-star fa-2x text-warning"></i>
											</div>
											<div class="metric-value display-6 fw-bold text-warning">${averageScore.toFixed(1)}</div>
											<div class="metric-label text-muted">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
											<div class="metric-subtext small">–∏–∑ ${maxPossible}</div>
										</div>
									</div>
								</div>
								<div class="col-md-3 col-6">
									<div class="metric-card card border-0 text-center h-100 shadow-sm">
										<div class="card-body">
											<div class="metric-icon mb-3">
												<i class="fas fa-percentage fa-2x text-info"></i>
											</div>
											<div class="metric-value display-6 fw-bold text-info">${averagePercentage.toFixed(1)}%</div>
											<div class="metric-label text-muted">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
											<div class="metric-subtext small">–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
						<div class="report-section mb-5">
							<h3 class="mb-4 text-center"><i class="fas fa-chart-bar me-2"></i>–ì–†–ê–§–ò–ö–ò –ò –î–ò–ê–ì–†–ê–ú–ú–´</h3>
							<div class="row g-4">
								${chartImages.gradesChart ? `
									<div class="col-md-6">
										<div class="chart-card card border-0 shadow-sm h-100">
											<div class="card-header bg-light">
												<h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h5>
											</div>
											<div class="card-body text-center">
												<img src="${chartImages.gradesChart}" class="img-fluid rounded" alt="–ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫">
											</div>
										</div>
									</div>
								` : ''}
								
								${chartImages.solvabilityChart ? `
									<div class="col-md-6">
										<div class="chart-card card border-0 shadow-sm h-100">
											<div class="card-header bg-light">
												<h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π</h5>
											</div>
											<div class="card-body text-center">
												<img src="${chartImages.solvabilityChart}" class="img-fluid rounded" alt="–ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π">
											</div>
										</div>
									</div>
								` : ''}
								
								${chartImages.complexityChart ? `
									<div class="col-12 mt-4">
										<div class="chart-card card border-0 shadow-sm">
											<div class="card-header bg-light">
												<h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>–°–≤—è–∑—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏</h5>
											</div>
											<div class="card-body text-center">
												<img src="${chartImages.complexityChart}" class="img-fluid rounded" style="max-height: 500px;" alt="–ì—Ä–∞—Ñ–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏">
											</div>
										</div>
									</div>
								` : ''}
							</div>
						</div>
						
						<!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
						<div class="report-section mb-5">
							<h3 class="mb-4 text-center"><i class="fas fa-list-alt me-2"></i>–ü–û–î–†–û–ë–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
							
							<div class="row">
								<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
								<div class="col-md-6 mb-4">
									<div class="card border-0 shadow-sm h-100">
										<div class="card-header bg-light">
											<h5 class="mb-0"><i class="fas fa-calculator me-2"></i>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
										</div>
										<div class="card-body">
											<ul class="list-group list-group-flush">
												<li class="list-group-item d-flex justify-content-between">
													<span>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</span>
													<span class="fw-bold">${minScore}</span>
												</li>
												<li class="list-group-item d-flex justify-content-between">
													<span>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</span>
													<span class="fw-bold">${maxScore}</span>
												</li>
												<li class="list-group-item d-flex justify-content-between">
													<span>–†–∞–∑–º–∞—Ö –±–∞–ª–ª–æ–≤:</span>
													<span class="fw-bold">${maxScore - minScore}</span>
												</li>
												<li class="list-group-item d-flex justify-content-between">
													<span>–ú–µ–¥–∏–∞–Ω–Ω—ã–π –±–∞–ª–ª:</span>
													<span class="fw-bold">${calculateMedian(totalScores).toFixed(1)}</span>
												</li>
											</ul>
										</div>
									</div>
								</div>
								
								<!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ -->
								<div class="col-md-6 mb-4">
									<div class="card border-0 shadow-sm h-100">
										<div class="card-header bg-light">
											<h5 class="mb-0"><i class="fas fa-star-half-alt me-2"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h5>
										</div>
										<div class="card-body">
											<div class="table-responsive">
												<table class="table table-hover">
													<thead>
														<tr>
															<th>–û—Ü–µ–Ω–∫–∞</th>
															<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
															<th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
														</tr>
													</thead>
													<tbody>
														${Object.entries(gradeDistribution).map(([grade, count]) => {
															const percentage = ((count / appData.students.length) * 100).toFixed(1);
															const gradeLabel = getGradeLabel(parseInt(grade));
															return `
																<tr>
																	<td>${grade} (${gradeLabel})</td>
																	<td>${count}</td>
																	<td>
																		<div class="d-flex align-items-center">
																			<div class="progress flex-grow-1 me-2" style="height: 8px;">
																				<div class="progress-bar" style="width: ${percentage}%"></div>
																			</div>
																			<span>${percentage}%</span>
																		</div>
																	</td>
																</tr>
															`;
														}).join('')}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
							
							<!-- –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
							<div class="row mt-4">
								<div class="col-12">
									<div class="card border-0 shadow-sm">
										<div class="card-header bg-light">
											<h5 class="mb-0"><i class="fas fa-layer-group me-2"></i>–ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h5>
										</div>
										<div class="card-body">
											<div class="table-responsive">
												<table class="table table-hover">
													<thead>
														<tr>
															<th>–£—Ä–æ–≤–µ–Ω—å</th>
															<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π</th>
															<th>–°—Ä–µ–¥–Ω—è—è —Ä–µ—à–∞–µ–º–æ—Å—Ç—å</th>
															<th>–û–±—â–∏–π –±–∞–ª–ª</th>
															<th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∑–∞ –∑–∞–¥–∞–Ω–∏–µ</th>
														</tr>
													</thead>
													<tbody>
														${generateDifficultyAnalysis().map(level => `
															<tr>
																<td>${level.level}</td>
																<td>${level.taskCount}</td>
																<td>
																	<div class="d-flex align-items-center">
																		<div class="progress flex-grow-1 me-2" style="height: 8px;">
																			<div class="progress-bar bg-${getDifficultyColor(level.avgSolvability)}" 
																				 style="width: ${level.avgSolvability}%"></div>
																		</div>
																		<span>${level.avgSolvability.toFixed(1)}%</span>
																	</div>
																</td>
																<td>${level.totalScore.toFixed(1)}</td>
																<td>${level.avgScorePerTask.toFixed(1)}</td>
															</tr>
														`).join('')}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<!-- –ó–∞–∫–ª—é—á–µ–Ω–∏–µ -->
						<div class="report-section">
							<div class="card border-0 shadow-sm bg-light">
								<div class="card-body text-center">
									<h4 class="mb-3"><i class="fas fa-clipboard-check me-2"></i>–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï</h4>
									<p class="lead mb-4">${generateConclusion(averagePercentage, gradeDistribution)}</p>
									<div class="row">
										<div class="col-md-4">
											<div class="d-flex align-items-center justify-content-center">
												<i class="fas fa-calendar-check fa-2x text-primary me-3"></i>
												<div>
													<div class="fw-bold">–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞</div>
													<div>${new Date().toLocaleDateString('ru-RU')}</div>
												</div>
											</div>
										</div>
										<div class="col-md-4">
											<div class="d-flex align-items-center justify-content-center">
												<i class="fas fa-chart-bar fa-2x text-success me-3"></i>
												<div>
													<div class="fw-bold">–û–±—â–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
													<div>${averagePercentage.toFixed(1)}%</div>
												</div>
											</div>
										</div>
										<div class="col-md-4">
											<div class="d-flex align-items-center justify-content-center">
												<i class="fas fa-user-check fa-2x text-info me-3"></i>
												<div>
													<div class="fw-bold">–£—á–∞—â–∏—Ö—Å—è —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å</div>
													<div>${calculateSuccessRate(gradeDistribution)}%</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				`;
				
				reportContent.innerHTML = html;
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏
				addPrintStyles();
				
				showNotification('HTML –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', error);
				reportContent.innerHTML = `
					<div class="alert alert-danger">
						<i class="fas fa-exclamation-triangle me-2"></i>
						<strong>–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞:</strong> ${error.message}
					</div>
				`;
			}
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		async function getChartImages() {
			const charts = {
				gradesChart: document.getElementById('gradesChart'),
				solvabilityChart: document.getElementById('solvabilityChart'),
				complexityChart: document.getElementById('complexityChart')
			};
			
			const images = {};
			
			for (const [name, canvas] of Object.entries(charts)) {
				if (canvas) {
					try {
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º html2canvas –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
						if (typeof html2canvas !== 'undefined') {
							const canvasData = await html2canvas(canvas, {
								scale: 2,
								backgroundColor: '#ffffff',
								logging: false
							});
							images[name] = canvasData.toDataURL('image/png', 1.0);
						} else {
							// Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π canvas
							images[name] = canvas.toDataURL('image/png', 1.0);
						}
					} catch (error) {
						console.error(`–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ ${name}:`, error);
						images[name] = null;
					}
				}
			}
			
			return images;
		}



		function calculateGradeDistribution(totalScores, maxPossible) {
			const distribution = {};
			
			totalScores.forEach(score => {
				// –í—ã—á–∏—Å–ª—è–µ–º –æ—Ü–µ–Ω–∫—É –ø–æ –±–∞–ª–ª–∞–º
				let grade;
				if (maxPossible > 0) {
					if (score >= (maxPossible * 0.85)) grade = 5;
					else if (score >= (maxPossible * 0.70)) grade = 4;
					else if (score >= (maxPossible * 0.55)) grade = 3;
					else if (score >= (maxPossible * 0.40)) grade = 2;
					else grade = 1;
				} else {
					// –ï—Å–ª–∏ maxPossible –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É
					const maxScore = Math.max(...totalScores, 1);
					const percentage = (score / maxScore) * 100;
					
					if (percentage >= 85) grade = 5;
					else if (percentage >= 70) grade = 4;
					else if (percentage >= 55) grade = 3;
					else if (percentage >= 40) grade = 2;
					else grade = 1;
				}
				
				distribution[grade] = (distribution[grade] || 0) + 1;
			});
			
			return distribution;
		}


        // –†–∞—Å—á–µ—Ç –º–µ–¥–∏–∞–Ω—ã
        function calculateMedian(scores) {
            const sorted = [...scores].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }

		function generateDifficultyAnalysis() {
			const levels = {};
			
			appData.tasks.forEach((task, index) => {
				const level = task.level || '–ù–µ —É–∫–∞–∑–∞–Ω';
				if (!levels[level]) {
					levels[level] = {
						level: level,
						taskCount: 0,
						totalSolvability: 0,
						totalScore: 0
					};
				}
				
				// –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ—à–∞–µ–º–æ—Å—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
				const taskResults = appData.results.map(result => result[index] || 0);
				const maxScore = task.maxScore || 1;
				const solvability = (taskResults.reduce((a, b) => a + b, 0) / (taskResults.length * maxScore)) * 100;
				const avgScore = taskResults.reduce((a, b) => a + b, 0) / taskResults.length;
				
				levels[level].taskCount++;
				levels[level].totalSolvability += solvability;
				levels[level].totalScore += avgScore;
			});
			
			return Object.values(levels).map(level => ({
				...level,
				avgSolvability: level.totalSolvability / level.taskCount,
				avgScorePerTask: level.totalScore / level.taskCount
			}));
		}

		function getDifficultyColor(solvability) {
			if (solvability >= 80) return 'success';
			if (solvability >= 60) return 'info';
			if (solvability >= 40) return 'warning';
			return 'danger';
		}

		function getGradeLabel(grade) {
			const labels = {
				5: '–û—Ç–ª–∏—á–Ω–æ',
				4: '–•–æ—Ä–æ—à–æ',
				3: '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ',
				2: '–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ',
				1: '–ü–ª–æ—Ö–æ'
			};
			return labels[grade] || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
		}

		function calculateSuccessRate(distribution) {
			const totalStudents = appData.students.length;
			const successful = (distribution[4] || 0) + (distribution[5] || 0);
			return ((successful / totalStudents) * 100).toFixed(1);
		}

		function generateConclusion(averagePercentage, gradeDistribution) {
			if (averagePercentage === 0 && (!gradeDistribution || Object.keys(gradeDistribution).length === 0)) {
				return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–ª—é—á–µ–Ω–∏—è. –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.';
			}
			
			let conclusion = '';
			
			if (averagePercentage >= 80) {
				conclusion = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞. ';
			} else if (averagePercentage >= 60) {
				conclusion = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π. ';
			} else if (averagePercentage >= 40) {
				conclusion = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã. ';
			} else {
				conclusion = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è. ';
			}
			
			const goodGrades = (gradeDistribution[4] || 0) + (gradeDistribution[5] || 0);
			const totalStudents = appData.students.length || 1;
			const goodPercentage = ((goodGrades / totalStudents) * 100).toFixed(1);
			
			conclusion += `${goodPercentage}% —É—á–∞—â–∏—Ö—Å—è –ø–æ–∫–∞–∑–∞–ª–∏ —Ö–æ—Ä–æ—à–∏–µ –∏ –æ—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. `;
			
			if (goodPercentage >= 70) {
				conclusion += '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å –∑–∞–¥–∞–Ω–∏—è–º–∏.';
			} else if (goodPercentage >= 50) {
				conclusion += '–û–∫–æ–ª–æ –ø–æ–ª–æ–≤–∏–Ω—ã —É—á–∞—â–∏—Ö—Å—è –æ—Å–≤–æ–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ.';
			} else {
				conclusion += '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —É—á–∞—â–∏–º–∏—Å—è, –ø–æ–∫–∞–∑–∞–≤—à–∏–º–∏ –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.';
			}
			
			return conclusion;
		}

		// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
		function closeReportModal() {
			const modal = document.querySelector('.modal');
			if (modal) modal.remove();
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç—á–µ—Ç–∞
		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç—á–µ—Ç–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
		async function generateReportContent() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			try {
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
				reportContent.innerHTML = `
					<div class="text-center py-5">
						<div class="spinner-border text-primary" role="status">
							<span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
						</div>
						<p class="mt-3">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏ –≥—Ä–∞—Ñ–∏–∫–∏...</p>
					</div>
				`;
				
				// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞
				const totalScores = appData.results.map(scores => 
					scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0)
				);
				const averageScore = totalScores.reduce((a, b) => a + b, 0) / (totalScores.length || 1);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + (task.maxScore || 0), 0);
				const averagePercentage = maxPossible > 0 ? (averageScore / maxPossible) * 100 : 0;
				const minScore = totalScores.length > 0 ? Math.min(...totalScores) : 0;
				const maxScore = totalScores.length > 0 ? Math.max(...totalScores) : 0;
				
				// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ (–ø–µ—Ä–µ–¥–∞–µ–º maxPossible –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä)
				const gradeDistribution = calculateGradeDistribution(totalScores, maxPossible);
				
				// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)
				let chartImages = {};
				try {
					chartImages = await getChartImages();
				} catch (chartError) {
					console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤:', chartError);
					// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
					chartImages = {
						gradesChart: null,
						solvabilityChart: null,
						complexityChart: null
					};
				}
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –æ—Ç—á–µ—Ç–∞
				const html = generateReportHTML({
					averageScore,
					maxPossible,
					averagePercentage,
					minScore,
					maxScore,
					gradeDistribution,
					chartImages,
					totalScores,
					studentCount: appData.students.length,
					taskCount: appData.tasks.length
				});
				
				reportContent.innerHTML = html;
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏
				addPrintStyles();
				
				showNotification('HTML –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', error);
				reportContent.innerHTML = `
					<div class="alert alert-danger">
						<i class="fas fa-exclamation-triangle me-2"></i>
						<strong>–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞:</strong> ${error.message}
						<div class="mt-2">
							<button class="btn btn-sm btn-outline-primary" onclick="generateSimpleReport()">
								–°–æ–∑–¥–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç
							</button>
						</div>
					</div>
				`;
			}
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞ (–≤—ã–Ω–µ—Å–µ–Ω–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é)
		function generateReportHTML(data) {
			const {
				averageScore,
				maxPossible,
				averagePercentage,
				minScore,
				maxScore,
				gradeDistribution,
				chartImages,
				totalScores,
				studentCount,
				taskCount
			} = data;
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
			if (studentCount === 0) {
				return `
					<div class="text-center py-5">
						<div class="alert alert-warning">
							<i class="fas fa-exclamation-triangle me-2"></i>
							<strong>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞</strong>
							<p class="mt-2">–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—â–∏—Ö—Å—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
						</div>
					</div>
				`;
			}
			
			return `
				<div class="report-container">
					<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á–µ—Ç–∞ -->
					<div class="report-header text-center mb-5">
						<h1 class="display-5 fw-bold text-primary mb-3">–ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢</h1>
						<div class="report-subtitle text-muted">
							<p class="lead">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
							<p class="mb-0">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU', {
								day: 'numeric',
								month: 'long',
								year: 'numeric',
								hour: '2-digit',
								minute: '2-digit'
							})}</p>
						</div>
					</div>
					
					<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ -->
					<div class="report-section card border-0 shadow-sm mb-5">
						<div class="card-header bg-primary text-white">
							<h3 class="mb-0"><i class="fas fa-info-circle me-2"></i>–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –¢–ï–°–¢–ï</h3>
						</div>
						<div class="card-body">
							<div class="row">
								<div class="col-md-6">
									<ul class="list-group list-group-flush">
										<li class="list-group-item d-flex justify-content-between">
											<span class="text-muted">–ü—Ä–µ–¥–º–µ—Ç:</span>
											<span class="fw-bold">${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
										</li>
										<li class="list-group-item d-flex justify-content-between">
											<span class="text-muted">–ö–ª–∞—Å—Å:</span>
											<span class="fw-bold">${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
										</li>
										<li class="list-group-item d-flex justify-content-between">
											<span class="text-muted">–¢–µ–º–∞:</span>
											<span class="fw-bold">${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</span>
										</li>
									</ul>
								</div>
								<div class="col-md-6">
									<ul class="list-group list-group-flush">
										<li class="list-group-item d-flex justify-content-between">
											<span class="text-muted">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</span>
											<span class="fw-bold">${appData.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</span>
										</li>
										<li class="list-group-item d-flex justify-content-between">
											<span class="text-muted">–í—Å–µ–≥–æ —É—á–∞—â–∏—Ö—Å—è:</span>
											<span class="fw-bold">${studentCount}</span>
										</li>
										<li class="list-group-item d-flex justify-content-between">
											<span class="text-muted">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ:</span>
											<span class="fw-bold">${appData.test.presentStudents || studentCount}</span>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					
					<!-- –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
					<div class="report-section mb-5">
						<h3 class="mb-4 text-center"><i class="fas fa-chart-line me-2"></i>–ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò</h3>
						<div class="row g-4">
							<div class="col-md-3 col-6">
								<div class="metric-card card border-0 text-center h-100 shadow-sm">
									<div class="card-body">
										<div class="metric-icon mb-3">
											<i class="fas fa-users fa-2x text-primary"></i>
										</div>
										<div class="metric-value display-6 fw-bold text-primary">${studentCount}</div>
										<div class="metric-label text-muted">–£—á–∞—â–∏—Ö—Å—è</div>
									</div>
								</div>
							</div>
							<div class="col-md-3 col-6">
								<div class="metric-card card border-0 text-center h-100 shadow-sm">
									<div class="card-body">
										<div class="metric-icon mb-3">
											<i class="fas fa-tasks fa-2x text-success"></i>
										</div>
										<div class="metric-value display-6 fw-bold text-success">${taskCount}</div>
										<div class="metric-label text-muted">–ó–∞–¥–∞–Ω–∏–π</div>
									</div>
								</div>
							</div>
							<div class="col-md-3 col-6">
								<div class="metric-card card border-0 text-center h-100 shadow-sm">
									<div class="card-body">
										<div class="metric-icon mb-3">
											<i class="fas fa-star fa-2x text-warning"></i>
										</div>
										<div class="metric-value display-6 fw-bold text-warning">${averageScore.toFixed(1)}</div>
										<div class="metric-label text-muted">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
										<div class="metric-subtext small">–∏–∑ ${maxPossible}</div>
									</div>
								</div>
							</div>
							<div class="col-md-3 col-6">
								<div class="metric-card card border-0 text-center h-100 shadow-sm">
									<div class="card-body">
										<div class="metric-icon mb-3">
											<i class="fas fa-percentage fa-2x text-info"></i>
										</div>
										<div class="metric-value display-6 fw-bold text-info">${averagePercentage.toFixed(1)}%</div>
										<div class="metric-label text-muted">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
										<div class="metric-subtext small">–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
					<div class="report-section mb-5">
						<h3 class="mb-4 text-center"><i class="fas fa-chart-bar me-2"></i>–ì–†–ê–§–ò–ö–ò –ò –î–ò–ê–ì–†–ê–ú–ú–´</h3>
						<div class="row g-4">
							${generateChartHTML(chartImages)}
						</div>
					</div>
					
					<!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
					<div class="report-section mb-5">
						<h3 class="mb-4 text-center"><i class="fas fa-list-alt me-2"></i>–ü–û–î–†–û–ë–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
						
						<div class="row">
							<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
							<div class="col-md-6 mb-4">
								<div class="card border-0 shadow-sm h-100">
									<div class="card-header bg-light">
										<h5 class="mb-0"><i class="fas fa-calculator me-2"></i>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
									</div>
									<div class="card-body">
										<ul class="list-group list-group-flush">
											<li class="list-group-item d-flex justify-content-between">
												<span>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</span>
												<span class="fw-bold">${minScore}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</span>
												<span class="fw-bold">${maxScore}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span>–†–∞–∑–º–∞—Ö –±–∞–ª–ª–æ–≤:</span>
												<span class="fw-bold">${maxScore - minScore}</span>
											</li>
											<li class="list-group-item d-flex justify-content-between">
												<span>–ú–µ–¥–∏–∞–Ω–Ω—ã–π –±–∞–ª–ª:</span>
												<span class="fw-bold">${calculateMedian(totalScores).toFixed(1)}</span>
											</li>
										</ul>
									</div>
								</div>
							</div>
							
							<!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ -->
							<div class="col-md-6 mb-4">
								<div class="card border-0 shadow-sm h-100">
									<div class="card-header bg-light">
										<h5 class="mb-0"><i class="fas fa-star-half-alt me-2"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h5>
									</div>
									<div class="card-body">
										<div class="table-responsive">
											<table class="table table-hover">
												<thead>
													<tr>
														<th>–û—Ü–µ–Ω–∫–∞</th>
														<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
														<th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
													</tr>
												</thead>
												<tbody>
													${generateGradeDistributionHTML(gradeDistribution, studentCount)}
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<!-- –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
						${taskCount > 0 ? `
							<div class="row mt-4">
								<div class="col-12">
									<div class="card border-0 shadow-sm">
										<div class="card-header bg-light">
											<h5 class="mb-0"><i class="fas fa-layer-group me-2"></i>–ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h5>
										</div>
										<div class="card-body">
											<div class="table-responsive">
												<table class="table table-hover">
													<thead>
														<tr>
															<th>–£—Ä–æ–≤–µ–Ω—å</th>
															<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π</th>
															<th>–°—Ä–µ–¥–Ω—è—è —Ä–µ—à–∞–µ–º–æ—Å—Ç—å</th>
															<th>–û–±—â–∏–π –±–∞–ª–ª</th>
															<th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∑–∞ –∑–∞–¥–∞–Ω–∏–µ</th>
														</tr>
													</thead>
													<tbody>
														${generateDifficultyAnalysisHTML()}
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						` : ''}
					</div>
					
					<!-- –ó–∞–∫–ª—é—á–µ–Ω–∏–µ -->
					<div class="report-section">
						<div class="card border-0 shadow-sm bg-light">
							<div class="card-body text-center">
								<h4 class="mb-3"><i class="fas fa-clipboard-check me-2"></i>–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï</h4>
								<p class="lead mb-4">${generateConclusion(averagePercentage, gradeDistribution)}</p>
								<div class="row">
									<div class="col-md-4">
										<div class="d-flex align-items-center justify-content-center">
											<i class="fas fa-calendar-check fa-2x text-primary me-3"></i>
											<div>
												<div class="fw-bold">–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞</div>
												<div>${new Date().toLocaleDateString('ru-RU')}</div>
											</div>
										</div>
									</div>
									<div class="col-md-4">
										<div class="d-flex align-items-center justify-content-center">
											<i class="fas fa-chart-bar fa-2x text-success me-3"></i>
											<div>
												<div class="fw-bold">–û–±—â–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
												<div>${averagePercentage.toFixed(1)}%</div>
											</div>
										</div>
									</div>
									<div class="col-md-4">
										<div class="d-flex align-items-center justify-content-center">
											<i class="fas fa-user-check fa-2x text-info me-3"></i>
											<div>
												<div class="fw-bold">–£—á–∞—â–∏—Ö—Å—è —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å</div>
												<div>${calculateSuccessRate(gradeDistribution)}%</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			`;
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ)

		function generateChartHTML(chartImages) {
			let html = '';
			
			if (chartImages.gradesChart) {
				html += `
					<div class="col-md-6">
						<div class="chart-card card border-0 shadow-sm h-100">
							<div class="card-header bg-light">
								<h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h5>
							</div>
							<div class="card-body text-center">
								<img src="${chartImages.gradesChart}" class="img-fluid rounded" alt="–ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫">
							</div>
						</div>
					</div>
				`;
			} else {
				html += `
					<div class="col-md-6">
						<div class="chart-card card border-0 shadow-sm h-100">
							<div class="card-header bg-light">
								<h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h5>
							</div>
							<div class="card-body text-center">
								<div class="alert alert-info">
									<i class="fas fa-exclamation-circle me-2"></i>
									–ì—Ä–∞—Ñ–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
								</div>
							</div>
						</div>
					</div>
				`;
			}
			
			if (chartImages.solvabilityChart) {
				html += `
					<div class="col-md-6">
						<div class="chart-card card border-0 shadow-sm h-100">
							<div class="card-header bg-light">
								<h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π</h5>
							</div>
							<div class="card-body text-center">
								<img src="${chartImages.solvabilityChart}" class="img-fluid rounded" alt="–ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π">
							</div>
						</div>
					</div>
				`;
			} else {
				html += `
					<div class="col-md-6">
						<div class="chart-card card border-0 shadow-sm h-100">
							<div class="card-header bg-light">
								<h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π</h5>
							</div>
							<div class="card-body text-center">
								<div class="alert alert-info">
									<i class="fas fa-exclamation-circle me-2"></i>
									–ì—Ä–∞—Ñ–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
								</div>
							</div>
						</div>
					</div>
				`;
			}
			
			if (chartImages.complexityChart) {
				html += `
					<div class="col-12 mt-4">
						<div class="chart-card card border-0 shadow-sm">
							<div class="card-header bg-light">
								<h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>–°–≤—è–∑—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏</h5>
							</div>
							<div class="card-body text-center">
								<img src="${chartImages.complexityChart}" class="img-fluid rounded" style="max-height: 500px;" alt="–ì—Ä–∞—Ñ–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏">
							</div>
						</div>
					</div>
				`;
			}
			
			return html;
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
		function generateSimpleReport() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			const totalScores = appData.results.map(scores => 
				scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0)
			);
			const averageScore = totalScores.reduce((a, b) => a + b, 0) / (totalScores.length || 1);
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const averagePercentage = (averageScore / (maxPossible || 1)) * 100;
			
			reportContent.innerHTML = `
				<div class="report-container">
					<div class="report-header text-center mb-5">
						<h1 class="display-5 fw-bold text-primary mb-3">–ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢</h1>
						<p class="text-muted">–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</p>
					</div>
					
					<div class="alert alert-info">
						<i class="fas fa-info-circle me-2"></i>
						<strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ì—Ä–∞—Ñ–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç—á–µ—Ç–∞.
					</div>
					
					<div class="row mt-4">
						<div class="col-md-6">
							<div class="card">
								<div class="card-header">–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
								<div class="card-body">
									<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
									<p><strong>–ö–ª–∞—Å—Å:</strong> ${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
									<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
									<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${appData.students.length}</p>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="card">
								<div class="card-header">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
								<div class="card-body">
									<p><strong>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong> ${averageScore.toFixed(2)} –∏–∑ ${maxPossible}</p>
									<p><strong>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å:</strong> ${averagePercentage.toFixed(1)}%</p>
									<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${appData.tasks.length}</p>
								</div>
							</div>
						</div>
					</div>
					
					<div class="mt-4">
						<button class="btn btn-primary" onclick="tryGenerateFullReport()">
							–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
						</button>
					</div>
				</div>
			`;
		}
		
		function tryGenerateFullReport() {
			const reportContent = document.getElementById('reportContent');
			if (!reportContent) return;
			
			reportContent.innerHTML = `
				<div class="text-center py-5">
					<div class="spinner-border text-primary" role="status">
						<span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
					</div>
					<p class="mt-3">–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞...</p>
				</div>
			`;
			
			setTimeout(() => {
				generateReportContent();
			}, 500);
		}
		
		function generateGradeDistributionHTML(gradeDistribution, studentCount) {
			if (!gradeDistribution || Object.keys(gradeDistribution).length === 0) {
				return `
					<tr>
						<td colspan="3" class="text-center text-muted">
							<i class="fas fa-info-circle me-2"></i>
							–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –æ—Ü–µ–Ω–æ–∫
						</td>
					</tr>
				`;
			}
			
			return Object.entries(gradeDistribution).map(([grade, count]) => {
				const percentage = ((count / studentCount) * 100).toFixed(1);
				const gradeLabel = getGradeLabel(parseInt(grade));
				return `
					<tr>
						<td>${grade} (${gradeLabel})</td>
						<td>${count}</td>
						<td>
							<div class="d-flex align-items-center">
								<div class="progress flex-grow-1 me-2" style="height: 8px;">
									<div class="progress-bar" style="width: ${percentage}%"></div>
								</div>
								<span>${percentage}%</span>
							</div>
						</td>
					</tr>
				`;
			}).join('');
		}


		function generateDifficultyAnalysisHTML() {
			const analysis = generateDifficultyAnalysis();
			return analysis.map(level => `
				<tr>
					<td>${level.level}</td>
					<td>${level.taskCount}</td>
					<td>
						<div class="d-flex align-items-center">
							<div class="progress flex-grow-1 me-2" style="height: 8px;">
								<div class="progress-bar bg-${getDifficultyColor(level.avgSolvability)}" 
									 style="width: ${level.avgSolvability}%"></div>
							</div>
							<span>${level.avgSolvability.toFixed(1)}%</span>
						</div>
					</td>
					<td>${level.totalScore.toFixed(1)}</td>
					<td>${level.avgScorePerTask.toFixed(1)}</td>
				</tr>
			`).join('');
		}

		async function saveReportAsPDF() {
			showNotification('–°–æ–∑–¥–∞–µ–º PDF –≤–µ—Ä—Å–∏—é...', 'info');
			
			try {
				if (typeof window.jspdf === 'undefined') {
					await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
					await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
				}
				
				const reportContent = document.getElementById('reportContent');
				if (!reportContent) return;
				
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º html2canvas –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
				const canvas = await html2canvas(reportContent, {
					scale: 2,
					useCORS: true,
					logging: false,
					backgroundColor: '#ffffff'
				});
				
				const { jsPDF } = window.jspdf;
				const pdf = new jsPDF('p', 'mm', 'a4');
				
				const imgData = canvas.toDataURL('image/png', 1.0);
				const imgWidth = 210; // A4 —à–∏—Ä–∏–Ω–∞ –≤ –º–º
				const imgHeight = canvas.height * imgWidth / canvas.width;
				
				pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
				pdf.save(`–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π_–æ—Ç—á–µ—Ç_${getTimestamp()}.pdf`);
				
				showNotification('PDF –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è PDF', 'error');
			}
		}

		function addPrintStyles() {
			// –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –ø–µ—á–∞—Ç–∏
			const style = document.createElement('style');
			style.innerHTML = `
				@media print {
					body * {
						visibility: hidden;
					}
					.modal, .modal * {
						visibility: visible;
					}
					.modal {
						position: absolute;
						left: 0;
						top: 0;
						width: 100%;
						height: auto;
						background: white !important;
					}
					.modal-dialog {
						max-width: 100% !important;
						margin: 0 !important;
					}
					.modal-header, .modal-footer {
						display: none !important;
					}
					.report-container {
						padding: 20px;
					}
				}
			`;
			document.head.appendChild(style);
		}

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
        function calculateAverageScore() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            return totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
        }

		function calculateSuccessRate(gradeDistribution) {
			if (!gradeDistribution || Object.keys(gradeDistribution).length === 0) {
				return 0;
			}
			
			const totalStudents = appData.students.length || 1;
			const successful = (gradeDistribution[4] || 0) + (gradeDistribution[5] || 0);
			return ((successful / totalStudents) * 100).toFixed(1);
		}


        function calculateQualityRate() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            return (grades.filter(grade => grade >= 4).length / grades.length * 100);
        }

        function calculateSou() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            return (grades.filter(g => g >= 3).length / grades.length * 100);
        }

        // –¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
        function updateTaxonomyAnalysis() {
            let html = '<div class="table-container"><table>';
            html += '<thead><tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>–°—Ä. –±–∞–ª–ª</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–ê–Ω–∞–ª–∏–∑</th></tr></thead><tbody>';
            
            Object.entries(complexityLevels).forEach(([level, data]) => {
                const levelTasks = appData.tasks.filter(task => task.level == level);
                if (levelTasks.length === 0) {
                    html += `<tr><td>${level}. ${data.name}</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>`;
                    return;
                }
                
                let totalMaxScore = 0;
                let totalActualScore = 0;
                let taskNumbers = [];
                
                levelTasks.forEach((task, index) => {
                    const taskIndex = appData.tasks.indexOf(task);
                    taskNumbers.push(taskIndex + 1);
                    
                    const maxScore = task.maxScore;
                    const actualScores = appData.results.map(student => student[taskIndex] || 0);
                    const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
                    
                    totalMaxScore += maxScore * appData.results.length;
                    totalActualScore += actualTotal;
                });
                
                const avgScore = totalActualScore / (levelTasks.length * appData.results.length);
                const completion = (totalActualScore / totalMaxScore) * 100;
                
                let analysis = "";
                if (completion >= 80) analysis = "üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
                else if (completion >= 60) analysis = "üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
                else if (completion >= 40) analysis = "üü† –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è";
                else analysis = "üî¥ –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã";
                
                html += `<tr>
                    <td><strong>${level}. ${data.name}</strong></td>
                    <td>${taskNumbers.join(', ')}</td>
                    <td>${avgScore.toFixed(2)}</td>
                    <td>${completion.toFixed(1)}%</td>
                    <td>${analysis}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('taxonomyAnalysis').innerHTML = html;
        }

        // –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫
        function updateErrorsAnalysis() {
            if (appData.errors.length === 0) {
                document.getElementById('errorsAnalysis').innerHTML = '<p>–î–∞–Ω–Ω—ã–µ –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–µ –≤–Ω–µ—Å–µ–Ω—ã</p>';
                return;
            }
            
            const errorStats = {};
            Object.keys(errorTypes).forEach(type => {
                errorStats[type] = appData.errors.filter(e => e.type === type).length;
            });
            
            const topErrors = Object.entries(errorStats)
                .filter(([_, count]) => count > 0)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            let html = '<div class="kpi-grid">';
            topErrors.forEach(([type, count]) => {
                html += `
                    <div class="kpi-card">
                        <div class="kpi-value">${count}</div>
                        <div class="kpi-label">${errorTypes[type].name}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            html += '<div class="table-container"><table><thead><tr><th>–¢–∏–ø –æ—à–∏–±–∫–∏</th><th>–ö–æ–ª-–≤–æ</th><th>% –æ—Ç –≤—Å–µ—Ö</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr></thead><tbody>';
            
            topErrors.forEach(([type, count]) => {
                const percentage = (count / appData.errors.length * 100).toFixed(1);
                let recommendation = "";
                
                switch(type) {
                    case 'calculation': recommendation = "–û—Ç—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤"; break;
                    case 'conceptual': recommendation = "–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞"; break;
                    case 'attention': recommendation = "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"; break;
                    case 'application': recommendation = "–†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞—á"; break;
                    case 'factual': recommendation = "–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π"; break;
                    default: recommendation = "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞";
                }
                
                html += `<tr>
                    <td><span class="error-type error-${type}">${errorTypes[type].name}</span></td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                    <td>${recommendation}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('errorsAnalysis').innerHTML = html;
        }

        // –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
        function updatePersonalAnalysis() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            
            const excellent = [];
            const good = [];
            const satisfactory = [];
            const unsatisfactory = [];
            
            appData.students.forEach((student, index) => {
                const data = {
                    name: student,
                    score: totalScores[index],
                    grade: grades[index],
                    percentage: (totalScores[index] / maxPossible) * 100,
                    errors: appData.errors.filter(e => e.studentIndex === index)
                };
                
                if (data.grade === 5) excellent.push(data);
                else if (data.grade === 4) good.push(data);
                else if (data.grade === 3) satisfactory.push(data);
                else unsatisfactory.push(data);
            });
            
            let html = `
                <div class="kpi-grid">
                    <div class="kpi-card" style="border-left-color: #27ae60">
                        <div class="kpi-value">${excellent.length}</div>
                        <div class="kpi-label">–û—Ç–ª–∏—á–Ω–∏–∫–∏ (5)</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #3498db">
                        <div class="kpi-value">${good.length}</div>
                        <div class="kpi-label">–•–æ—Ä–æ—à–∏—Å—Ç—ã (4)</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #f39c12">
                        <div class="kpi-value">${satisfactory.length}</div>
                        <div class="kpi-label">–£–¥–æ–≤–ª–µ—Ç–≤. (3)</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #e74c3c">
                        <div class="kpi-value">${unsatisfactory.length}</div>
                        <div class="kpi-label">–ù–µ—É–¥–æ–≤–ª. (2)</div>
                    </div>
                </div>
            `;
            
            html += '<div class="sub-section"><h4>üë• –£—á–∞—â–∏–µ—Å—è –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞ (–Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ):</h4>';
            if (unsatisfactory.length > 0) {
                unsatisfactory.forEach(student => {
                    html += `<div class="recommendation-card">
                        <strong>${student.name}</strong> - ${student.score} –±–∞–ª–ª–æ–≤ (${student.percentage.toFixed(1)}%)<br>
                        <small>–û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏: ${student.errors.length > 0 ? 
                            student.errors.map(e => errorTypes[e.type].name).join(', ') : '—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞'}</small>
                    </div>`;
                });
            } else {
                html += '<p>‚úÖ –ù–µ—Ç —É—á–∞—â–∏—Ö—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</p>';
            }
            html += '</div>';
            
            document.getElementById('personalAnalysis').innerHTML = html;
        }

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –í–ü–†
		// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –í–ü–†
		function updateVPRAnalysis() {
			let html = '<h3 class="section-title">üìä –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º –í–ü–†</h3>';
			
			const competenceStats = {};
			const levelStats = {1: {total: 0, max: 0, count: 0}, 2: {total: 0, max: 0, count: 0}};
			
			// –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º –∏ —É—Ä–æ–≤–Ω—è–º
			appData.tasks.forEach((task, taskIndex) => {
				if (task.competence && competenceStats[task.competence]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					competenceStats[task.competence].total += actualTotal;
					competenceStats[task.competence].max += maxScore * appData.results.length;
					competenceStats[task.competence].count++;
				}
				
				// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º –í–ü–†
				if (task.vprLevel && levelStats[task.vprLevel]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					levelStats[task.vprLevel].total += actualTotal;
					levelStats[task.vprLevel].max += maxScore * appData.results.length;
					levelStats[task.vprLevel].count++;
				}
			});
			
			// KPI –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º
			html += '<div class="kpi-grid">';
			Object.entries(competenceStats).forEach(([comp, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const competenceName = vprCompetencies[comp];
					let status = '';
					
					if (percentage >= 80) status = 'success';
					else if (percentage >= 60) status = 'warning';
					else status = 'danger';
					
					html += `
						<div class="kpi-card ${status}">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${competenceName}</div>
						</div>
					`;
				}
			});
			html += '</div>';
			
			// –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º
			html += '<h4 style="margin-top: 20px;">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr></thead><tbody>';
			
			Object.entries(competenceStats).forEach(([comp, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const competenceName = vprCompetencies[comp];
					
					let level = '';
					let levelColor = '';
					let recommendations = '';
					
					if (percentage >= 80) {
						level = '–í—ã—Å–æ–∫–∏–π';
						levelColor = '#27ae60';
						recommendations = '–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞. –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ';
					} else if (percentage >= 60) {
						level = '–°—Ä–µ–¥–Ω–∏–π';
						levelColor = '#f39c12';
						recommendations = '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∞';
					} else {
						level = '–ù–∏–∑–∫–∏–π';
						levelColor = '#e74c3c';
						recommendations = '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞';
					}
					
					html += `
						<tr>
							<td><strong>${competenceName}</strong></td>
							<td>${percentage.toFixed(1)}%</td>
							<td style="color: ${levelColor}; font-weight: bold;">${level}</td>
							<td>${recommendations}</td>
						</tr>
					`;
				}
			});
			
			html += '</tbody></table></div>';
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º –í–ü–†
			html += '<h4 style="margin-top: 20px;">üìà –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –í–ü–†</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(levelStats).forEach(([level, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const levelName = vprLevels[level].name;
					const levelColor = vprLevels[level].color;
					
					html += `
						<div class="kpi-card" style="border-left-color: ${levelColor}">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${levelName} —É—Ä–æ–≤–µ–Ω—å</div>
							<small>${stats.count} –∑–∞–¥–∞–Ω–∏–π</small>
						</div>
					`;
				}
			});
			
			html += '</div>';
			
			// –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
			html += '<h4 style="margin-top: 20px;">üìã –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –í–ü–†</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>‚Ññ</th><th>–ó–∞–¥–∞–Ω–∏–µ</th><th>–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
			
			appData.tasks.forEach((task, index) => {
				const completion = calculateTaskCompletion(index);
				const competenceName = task.competence ? vprCompetencies[task.competence] : '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
				const levelName = task.vprLevel ? vprLevels[task.vprLevel].name : '–ù–µ —É–∫–∞–∑–∞–Ω';
				
				let status = '';
				let statusColor = '';
				
				if (completion >= 80) {
					status = '–í—ã—Å–æ–∫–∏–π';
					statusColor = '#27ae60';
				} else if (completion >= 60) {
					status = '–°—Ä–µ–¥–Ω–∏–π';
					statusColor = '#f39c12';
				} else if (completion >= 40) {
					status = '–ù–∏–∑–∫–∏–π';
					statusColor = '#e74c3c';
				} else {
					status = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';
					statusColor = '#c0392b';
				}
				
				html += `
					<tr>
						<td><strong>${index + 1}</strong></td>
						<td>${task.type}</td>
						<td>${competenceName}</td>
						<td>${levelName}</td>
						<td>${completion.toFixed(1)}%</td>
						<td style="color: ${statusColor}; font-weight: bold;">${status}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div>';
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –í–ü–†
			html += generateVPRRecommendations(competenceStats, levelStats);
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –í–ü–†
		function generateVPRRecommendations(competenceStats, levelStats) {
			let html = '<h4 style="margin-top: 20px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –í–ü–†</h4>';
			html += '<div class="recommendation-card">';
			
			// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π
			const problemCompetences = Object.entries(competenceStats)
				.filter(([_, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					return percentage < 60;
				})
				.map(([comp, _]) => vprCompetencies[comp]);
			
			if (problemCompetences.length > 0) {
				html += `<strong>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏:</strong> ${problemCompetences.join(', ')}<br>`;
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong><br>';
				html += '‚Ä¢ –£—Å–∏–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏<br>';
				html += '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –í–ü–† –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏<br>';
				html += '‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è<br>';
			} else {
				html += '<strong>‚úÖ –í—Å–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ</strong><br>';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏';
			}
			
			// –ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
			const baseLevelPercentage = levelStats[1].max > 0 ? (levelStats[1].total / levelStats[1].max) * 100 : 0;
			const advancedLevelPercentage = levelStats[2].max > 0 ? (levelStats[2].total / levelStats[2].max) * 100 : 0;
			
			html += '<br><strong>üìä –ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π:</strong><br>';
			html += `‚Ä¢ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${baseLevelPercentage.toFixed(1)}%<br>`;
			html += `‚Ä¢ –ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: ${advancedLevelPercentage.toFixed(1)}%<br>`;
			
			if (advancedLevelPercentage < 60) {
				html += '<br><strong>üéØ –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ù–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ.<br>';
				html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å–∏–ª–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ —Å–ª–æ–∂–Ω—ã–º –∑–∞–¥–∞–Ω–∏—è–º.';
			}
			
			html += '</div>';
			
			// –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
			html += `
				<div class="recommendation-card">
					<h5>üìÖ –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –í–ü–†</h5>
					<ul>
						<li>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –í–ü–†</li>
						<li>–†–∞–±–æ—Ç–∞ —Å —Ç–∏–ø–æ–≤—ã–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º</li>
						<li>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –∏—Ö —Ä–∞–∑–±–æ—Ä</li>
						<li>–ü—Ä–æ–±–Ω–∞—è –í–ü–† –∑–∞ 2 –Ω–µ–¥–µ–ª–∏ –¥–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏</li>
					</ul>
				</div>
			`;
			
			return html;
		}

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
		function updateLiteracyAnalysis() {
			let html = '<h3 class="section-title">üéØ –ü—Ä–æ—Ñ–∏–ª—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∞</h3>';
			
			const literacyStats = {};
			const contextStats = {};
			const skillStats = {};
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
			Object.keys(functionalLiteracyTypes).forEach(type => {
				literacyStats[type] = { total: 0, max: 0, count: 0 };
			});
			
			Object.keys(literacyContexts).forEach(context => {
				contextStats[context] = { total: 0, max: 0, count: 0 };
			});
			
			// –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
			appData.tasks.forEach((task, taskIndex) => {
				if (task.literacyType && literacyStats[task.literacyType]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					literacyStats[task.literacyType].total += actualTotal;
					literacyStats[task.literacyType].max += maxScore * appData.results.length;
					literacyStats[task.literacyType].count++;
				}
				
				if (task.context && contextStats[task.context]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					contextStats[task.context].total += actualTotal;
					contextStats[task.context].max += maxScore * appData.results.length;
					contextStats[task.context].count++;
				}
				
				// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –Ω–∞–≤—ã–∫–∞–º
				if (task.skill) {
					if (!skillStats[task.skill]) {
						skillStats[task.skill] = { total: 0, max: 0, count: 0 };
					}
					
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					skillStats[task.skill].total += actualTotal;
					skillStats[task.skill].max += maxScore * appData.results.length;
					skillStats[task.skill].count++;
				}
			});
			
			// KPI –ø–æ –≤–∏–¥–∞–º –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			html += '<h4>üìä –£—Ä–æ–≤–µ–Ω—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(literacyStats).forEach(([type, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const literacyData = functionalLiteracyTypes[type];
					
					let status = '';
					if (percentage >= 80) status = 'success';
					else if (percentage >= 60) status = 'warning';
					else status = 'danger';
					
					html += `
						<div class="kpi-card ${status}" style="border-left-color: ${literacyData.color}">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${literacyData.name}</div>
							<small>${stats.count} –∑–∞–¥–∞–Ω–∏–π</small>
						</div>
					`;
				}
			});
			
			html += '</div>';
			
			// –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			html += '<h4 style="margin-top: 20px;">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–í–∏–¥ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</th></tr></thead><tbody>';
			
			Object.entries(literacyStats).forEach(([type, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const literacyData = functionalLiteracyTypes[type];
					
					let level = '';
					let interpretation = '';
					
					if (percentage >= 80) {
						level = '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ —É—Å—Ç–æ–π—á–∏–≤–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω';
					} else if (percentage >= 60) {
						level = '–ë–∞–∑–æ–≤—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–º —É—Ä–æ–≤–Ω–µ';
					} else if (percentage >= 40) {
						level = '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–≤–∏—Ç–∏—è';
					} else {
						level = '–ù–∞—á–∞–ª—å–Ω—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω';
					}
					
					html += `
						<tr>
							<td><strong>${literacyData.name}</strong></td>
							<td>${percentage.toFixed(1)}%</td>
							<td style="color: ${literacyData.color}; font-weight: bold;">${level}</td>
							<td>${interpretation}</td>
						</tr>
					`;
				}
			});
			
			html += '</tbody></table></div>';
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º
			html += '<h4 style="margin-top: 20px;">üåç –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(contextStats).forEach(([context, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const contextName = literacyContexts[context];
					
					html += `
						<div class="kpi-card">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${contextName} –∫–æ–Ω—Ç–µ–∫—Å—Ç</div>
							<small>${stats.count} –∑–∞–¥–∞–Ω–∏–π</small>
						</div>
					`;
				}
			});
			
			html += '</div>';
			
			// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤
			if (Object.keys(skillStats).length > 0) {
				html += '<h4 style="margin-top: 20px;">üõ†Ô∏è –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤</h4>';
				html += '<div class="table-container"><table>';
				html += '<thead><tr><th>–ù–∞–≤—ã–∫</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr></thead><tbody>';
				
				Object.entries(skillStats).forEach(([skill, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					
					let status = '';
					let recommendations = '';
					
					if (percentage >= 80) {
						status = '–û—Å–≤–æ–µ–Ω';
						recommendations = '–ó–∞–∫—Ä–µ–ø–ª—è—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –Ω–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö';
					} else if (percentage >= 60) {
						status = '–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–≤–æ–µ–Ω';
						recommendations = '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞';
					} else {
						status = '–ù–µ –æ—Å–≤–æ–µ–Ω';
						recommendations = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ';
					}
					
					html += `
						<tr>
							<td>${skill}</td>
							<td>${percentage.toFixed(1)}%</td>
							<td>${status}</td>
							<td>${recommendations}</td>
						</tr>
					`;
				});
				
				html += '</tbody></table></div>';
			}
			
			// –†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
			// –ü–û–õ–ù–ê–Ø –ó–ê–ú–ï–ù–ê –±–ª–æ–∫–∞ —Å —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º–æ–π
			html += `
<div class="chart-container" style="
    height: 450px; 
    min-height: 450px; 
    position: relative; 
    margin: 25px 0; 
    border: 1px solid #e0e0e0; 
    border-radius: 10px; 
    padding: 20px; 
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
">
    <h4 style="margin: 0 0 20px 0; padding: 0; color: #2c3e50;">üìà –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
    <div style="height: 380px; position: relative; background: #f8f9fa; border-radius: 6px; padding: 10px;">
        <canvas id="literacyRadarChart" 
                style="display: block; width: 100%; height: 100%; background: white; border-radius: 4px;"></canvas>
    </div>
</div>
			`;
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é
			html += generateLiteracyRecommendations(literacyStats, contextStats, skillStats);
			
			document.getElementById('specializedAnalysis').innerHTML = html;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã
			setTimeout(() => {
				initLiteracyRadarChart();
			}, 100);
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
		function generateLiteracyRecommendations(literacyStats, contextStats, skillStats) {
			let html = '<h4 style="margin-top: 20px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>';
			html += '<div class="recommendation-card">';
			
			// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			const problemLiteracies = Object.entries(literacyStats)
				.filter(([_, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					return percentage < 60;
				})
				.map(([type, _]) => functionalLiteracyTypes[type].name);
			
			if (problemLiteracies.length > 0) {
				html += `<strong>‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç —Ä–∞–∑–≤–∏—Ç–∏—è:</strong> ${problemLiteracies.join(', ')}<br>`;
				html += '<strong>–ú–µ—Ä—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é:</strong><br>';
				
				problemLiteracies.forEach(literacy => {
					switch(literacy) {
						case '–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –í–∫–ª—é—á–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Ç–µ–∫—Å—Ç–æ–≤<br>';
							break;
						case '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á<br>';
							break;
						case '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–Ω–∞—É—á–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤<br>';
							break;
						case '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∑–∞–¥–∞—á<br>';
							break;
						case '–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏':
							html += '‚Ä¢ –û–±—Å—É–∂–¥–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏<br>';
							break;
						case '–¶–∏—Ñ—Ä–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –†–∞–±–æ—Ç–∞ —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π<br>';
							break;
					}
				});
			} else {
				html += '<strong>‚úÖ –í—Å–µ –≤–∏–¥—ã –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç—ã –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ</strong><br>';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —É–≥–ª—É–±–ª—è—Ç—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏';
			}
			
			// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
			const problemContexts = Object.entries(contextStats)
				.filter(([_, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					return percentage < 60;
				})
				.map(([context, _]) => literacyContexts[context]);
			
			if (problemContexts.length > 0) {
				html += `<br><strong>üåç –°–ª–∞–±—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:</strong> ${problemContexts.join(', ')}<br>`;
				html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π';
			}
			
			html += '</div>';
			
			// –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è
			html += `
				<div class="recommendation-card">
					<h5>üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h5>
					<ul>
						<li>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –≤ —É—Ä–æ—á–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–ø—Ä–µ–¥–º–µ—Ç–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π –≤ –æ–±—É—á–µ–Ω–∏–∏</li>
						<li>–†–∞–∑–≤–∏—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
						<li>–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</li>
					</ul>
				</div>
			`;
			
			return html;
		}

        function initLiteracyChart() {
            if (window.literacyChartInstance) {
                window.literacyChartInstance.destroy();
            }
            
            const literacyStats = {};
            Object.keys(functionalLiteracyTypes).forEach(type => {
                literacyStats[type] = { total: 0, max: 0, count: 0 };
            });
            
            appData.tasks.forEach((task, taskIndex) => {
                if (task.literacyType && literacyStats[task.literacyType]) {
                    const maxScore = task.maxScore;
                    const actualScores = appData.results.map(student => student[taskIndex] || 0);
                    const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
                    
                    literacyStats[task.literacyType].total += actualTotal;
                    literacyStats[task.literacyType].max += maxScore * appData.results.length;
                }
            });
            
            const ctx = document.getElementById('literacyChart').getContext('2d');
            const labels = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].name);
            const data = Object.values(literacyStats).map(stats => 
                stats.max > 0 ? (stats.total / stats.max) * 100 : 0
            );
            const colors = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].color);
            
            window.literacyChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–£—Ä–æ–≤–µ–Ω—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ (%)',
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 0.8)',
                        pointBackgroundColor: colors,
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –û–ì–≠/–ï–ì–≠
		function updateGIAnalysis() {
			let html = '<h3 class="section-title">üéì –ê–Ω–∞–ª–∏–∑ –ø–æ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º (–ö–≠–°)</h3>';
			
			const kesStats = {};
			const puStats = {};
			
			// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏–π –ø–æ –ö–≠–° –∏ –ü–£
			appData.tasks.forEach((task, taskIndex) => {
				if (task.kes) {
					const kesCode = task.kes.split('.')[0];
					if (!kesStats[kesCode]) {
						kesStats[kesCode] = { 
							total: 0, 
							max: 0, 
							count: 0, 
							tasks: [],
							name: getKESName(kesCode)
						};
					}
					
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					kesStats[kesCode].total += actualTotal;
					kesStats[kesCode].max += maxScore * appData.results.length;
					kesStats[kesCode].count++;
					kesStats[kesCode].tasks.push(taskIndex + 1);
				}
				
				// –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —É–º–µ–Ω–∏—è–º (–ü–£)
				if (task.pu) {
					if (!puStats[task.pu]) {
						puStats[task.pu] = { 
							total: 0, 
							max: 0, 
							count: 0,
							tasks: []
						};
					}
					
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					puStats[task.pu].total += actualTotal;
					puStats[task.pu].max += maxScore * appData.results.length;
					puStats[task.pu].count++;
					puStats[task.pu].tasks.push(taskIndex + 1);
				}
			});
			
			// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ö–≠–°, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–∏–π –∞–Ω–∞–ª–∏–∑
			if (Object.keys(kesStats).length === 0) {
				html += `
					<div class="alert-card">
						<strong>‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ –ö–≠–° –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã</strong>
						<p>–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –û–ì–≠ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–¥—ã –ö–≠–° –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∑–∞–¥–∞–Ω–∏–π.</p>
					</div>
					
					<h4>üìä –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π –û–ì–≠</h4>
					<div class="kpi-grid">
						<div class="kpi-card">
							<div class="kpi-value">${calculateAverageScore().toFixed(1)}</div>
							<div class="kpi-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
						</div>
						<div class="kpi-card">
							<div class="kpi-value">${calculateSuccessRate().toFixed(1)}%</div>
							<div class="kpi-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
						</div>
						<div class="kpi-card">
							<div class="kpi-value">${calculateTaskCompletion(0).toFixed(1)}%</div>
							<div class="kpi-label">1 —á–∞—Å—Ç—å</div>
						</div>
						<div class="kpi-card">
							<div class="kpi-value">${calculateTaskCompletion(appData.tasks.length-1).toFixed(1)}%</div>
							<div class="kpi-label">2 —á–∞—Å—Ç—å</div>
						</div>
					</div>
				`;
			} else {
				// –ê–Ω–∞–ª–∏–∑ –ø–æ –ö–≠–°
				html += '<div class="table-container"><table>';
				html += '<thead><tr><th>–ë–ª–æ–∫ –ö–≠–°</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–ê–Ω–∞–ª–∏–∑</th></tr></thead><tbody>';
				
				Object.entries(kesStats).forEach(([kes, stats]) => {
					const percentage = stats.max > 0 ? (stats.total / stats.max) * 100 : 0;
					let analysis = "";
					let analysisIcon = "";
					
					if (percentage >= 80) {
						analysis = "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";
						analysisIcon = "üü¢";
					} else if (percentage >= 60) {
						analysis = "–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å";
						analysisIcon = "üü°";
					} else if (percentage >= 40) {
						analysis = "–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è";
						analysisIcon = "üü†";
					} else {
						analysis = "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";
						analysisIcon = "üî¥";
					}
					
					html += `<tr>
						<td><strong>${kes}</strong></td>
						<td>${stats.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
						<td>${stats.tasks.join(', ')}</td>
						<td>${percentage.toFixed(1)}%</td>
						<td>${analysisIcon} ${analysis}</td>
					</tr>`;
				});
				
				html += '</tbody></table></div>';
			}
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —É–º–µ–Ω–∏—è–º
			if (Object.keys(puStats).length > 0) {
				html += '<h4 style="margin-top: 20px;">üéØ –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —É–º–µ–Ω–∏—è–º (–ü–£)</h4>';
				html += '<div class="table-container"><table>';
				html += '<thead><tr><th>–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ —É–º–µ–Ω–∏–µ</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å</th></tr></thead><tbody>';
				
				Object.entries(puStats).forEach(([pu, stats]) => {
					const percentage = stats.max > 0 ? (stats.total / stats.max) * 100 : 0;
					let level = "";
					
					if (percentage >= 80) level = "–û—Å–≤–æ–µ–Ω–æ";
					else if (percentage >= 60) level = "–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–≤–æ–µ–Ω–æ";
					else if (percentage >= 40) level = "–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏";
					else level = "–ù–µ –æ—Å–≤–æ–µ–Ω–æ";
					
					html += `<tr>
						<td>${pu}</td>
						<td>${stats.tasks.join(', ')}</td>
						<td>${percentage.toFixed(1)}%</td>
						<td>${level}</td>
					</tr>`;
				});
				
				html += '</tbody></table></div>';
			}
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –û–ì–≠
			html += generateOGERecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –±–ª–æ–∫–æ–≤ –ö–≠–°
		function getKESName(kesCode) {
			const kesNames = {
				'1': '–ß–∏—Å–ª–∞ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è',
				'2': '–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è',
				'3': '–£—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞',
				'4': '–ß–∏—Å–ª–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
				'5': '–§—É–Ω–∫—Ü–∏–∏',
				'6': '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –ø—Ä—è–º–æ–π –∏ –ø–ª–æ—Å–∫–æ—Å—Ç–∏',
				'7': '–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∏–≥—É—Ä—ã –∏ –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞',
				'8': '–ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –≤–µ–ª–∏—á–∏–Ω',
				'9': '–í–µ–∫—Ç–æ—Ä—ã –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–∏'
			};
			return kesNames[kesCode] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±–ª–æ–∫';
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –û–ì–≠
		function generateOGERecommendations() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			
			let html = '<h4 style="margin-top: 20px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –û–ì–≠</h4>';
			html += '<div class="recommendation-card">';
			
			// –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			const percentage = (avgScore / maxPossible) * 100;
			
			if (percentage >= 80) {
				html += '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–£—á–∞—â–∏–µ—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –û–ì–≠. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –†–∞–±–æ—Ç–∞ –Ω–∞–¥ —Å–ª–æ–∂–Ω—ã–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏<br>';
				html += '‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è<br>';
				html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏<br>';
			} else if (percentage >= 60) {
				html += '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–£—á–∞—â–∏–µ—Å—è —É—Å–≤–æ–∏–ª–∏ –±–∞–∑–æ–≤—ã–µ —Ç–µ–º—ã, –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–µ–ª—ã. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º<br>';
				html += '‚Ä¢ –û—Ç—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π<br>';
				html += '‚Ä¢ –†–∞–±–æ—Ç–∞ –Ω–∞–¥ –∑–∞–¥–∞–Ω–∏—è–º–∏ —Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º<br>';
			} else if (percentage >= 40) {
				html += '<strong>üü† –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å–∏–ª–µ–Ω–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</strong><br>';
				html += '–ï—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–µ–º<br>';
				html += '‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç—Å—Ç–∞—é—â–∏–º–∏<br>';
				html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è<br>';
			} else {
				html += '<strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞<br>';
				html += '‚Ä¢ –§–æ–∫—É—Å –Ω–∞ –±–∞–∑–æ–≤—ã—Ö —Ç–µ–º–∞—Ö<br>';
				html += '‚Ä¢ –ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∫ –∫–æ–Ω—Ç—Ä–æ–ª—é<br>';
			}
			
			// –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –∑–∞–¥–∞–Ω–∏–π
			const firstPartTasks = appData.tasks.filter(task => task.answerType === 'short');
			const secondPartTasks = appData.tasks.filter(task => task.answerType === 'detailed');
			
			if (firstPartTasks.length > 0 && secondPartTasks.length > 0) {
				const firstPartCompletion = firstPartTasks.reduce((sum, task) => {
					const taskIndex = appData.tasks.indexOf(task);
					return sum + calculateTaskCompletion(taskIndex);
				}, 0) / firstPartTasks.length;
				
				const secondPartCompletion = secondPartTasks.reduce((sum, task) => {
					const taskIndex = appData.tasks.indexOf(task);
					return sum + calculateTaskCompletion(taskIndex);
				}, 0) / secondPartTasks.length;
				
				html += `<br><strong>–ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–µ–π —ç–∫–∑–∞–º–µ–Ω–∞:</strong><br>`;
				html += `‚Ä¢ 1 —á–∞—Å—Ç—å (—Ç–µ—Å—Ç–æ–≤–∞—è): ${firstPartCompletion.toFixed(1)}%<br>`;
				html += `‚Ä¢ 2 —á–∞—Å—Ç—å (—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è): ${secondPartCompletion.toFixed(1)}%<br>`;
				
				if (secondPartCompletion < 50) {
					html += '<br><strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ù–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ 2 —á–∞—Å—Ç–∏. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å–∏–ª–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –∑–∞–¥–∞–Ω–∏—è–º —Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º.';
				}
			}
			
			html += '</div>';
			
			return html;
		}


        // ==================== –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø ====================
		function addVisualizationButton() {
			const nav = document.querySelector('.nav-tabs, .navigation, header');
			if (nav) {
				const button = document.createElement('button');
				button.className = 'btn btn-primary';
				button.innerHTML = 'üìà –ì—Ä–∞—Ñ–∏–∫–∏';
				button.onclick = () => {
					setupVisualizationTab();
					renderVisualizationSection();
					showNotification('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
				};
				nav.appendChild(button);
			}
		}
				
		// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			addVisualizationButton();
			setupVisualizationTab();
		});
		
		// ==================== –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –ì–†–ê–§–ò–ö–ò ====================

		// –ö—ç—à –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
		const chartCache = {
		  grades: null,
		  solvability: null,
		  complexity: null,
		  lastUpdate: 0
		};

		// –î–µ–±–∞—É–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
		let chartUpdateTimeout;
		const CHART_UPDATE_DELAY = 500; // 0.5 —Å–µ–∫—É–Ω–¥—ã

		// –î–µ—Å—Ç—Ä–æ–π —Å—Ç–∞—Ä—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
		function destroyChartIfExists(chartInstance) {
		  if (chartInstance && typeof chartInstance.destroy === 'function') {
			chartInstance.destroy();
		  }
		  return null;
		}

		// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		function updateVisualizationDebounced() {
		  clearTimeout(chartUpdateTimeout);
		  chartUpdateTimeout = setTimeout(() => {
			updateVisualization();
		  }, CHART_UPDATE_DELAY);
		}		
		// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
		function updateVisualization() {
		  console.time('updateVisualization');
		  
		  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à (–æ–±–Ω–æ–≤–ª—è–µ–º –Ω–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 2 —Å–µ–∫—É–Ω–¥—ã)
		  const now = Date.now();
		  if (chartCache.lastUpdate && now - chartCache.lastUpdate < 2000 && chartCache.grades) {
			console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤');
			renderChartsFromCache();
			console.timeEnd('updateVisualization');
			return;
		  }
		  
		  // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
		  prepareChartData();
		  
		  // –†–µ–Ω–¥–µ—Ä–∏–º –≥—Ä–∞—Ñ–∏–∫–∏
		  renderCharts();
		  
		  chartCache.lastUpdate = now;
		  console.timeEnd('updateVisualization');
		}

		function prepareChartData() {
		  const totalStudents = appData.students.length;
		  const totalTasks = appData.tasks.length;
		  
		  if (totalStudents === 0 || totalTasks === 0) {
			chartCache.grades = { labels: [], datasets: [] };
			chartCache.solvability = { labels: [], data: [] };
			chartCache.complexity = { labels: [], data: [] };
			chartCache.scatterData = []; // –î–æ–±–∞–≤–∏–º –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
			return;
		  }
		  
		  // 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
		  const gradeCounts = { 2: 0, 3: 0, 4: 0, 5: 0 };
		  
		  appData.results.forEach((studentScores, studentIndex) => {
			const totalScore = studentScores.reduce((sum, score, taskIndex) => {
			  return sum + (parseFloat(score) || 0);
			}, 0);
			
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			
			let grade = 2;
			if (percentage >= 85) grade = 5;
			else if (percentage >= 70) grade = 4;
			else if (percentage >= 50) grade = 3;
			
			gradeCounts[grade] = (gradeCounts[grade] || 0) + 1;
		  });
		  
		  chartCache.grades = {
			labels: ['2 (–ù–µ—É–¥)', '3 (–£–¥–æ–≤–ª)', '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'],
			datasets: [{
			  label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è',
			  data: [gradeCounts[2], gradeCounts[3], gradeCounts[4], gradeCounts[5]],
			  backgroundColor: [
				'rgba(231, 76, 60, 0.7)',
				'rgba(241, 196, 15, 0.7)',
				'rgba(52, 152, 219, 0.7)',
				'rgba(46, 204, 113, 0.7)'
			  ],
			  borderColor: [
				'#e74c3c',
				'#f1c40f',
				'#3498db',
				'#2ecc71'
			  ],
			  borderWidth: 2
			}]
		  };
		  
		  // 2. –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π
		  const solvabilityData = [];
		  const solvabilityLabels = [];
		  
		  for (let taskIndex = 0; taskIndex < totalTasks; taskIndex++) {
			const task = appData.tasks[taskIndex];
			let totalScore = 0;
			let maxPossible = 0;
			
			appData.results.forEach(studentScores => {
			  const score = parseFloat(studentScores[taskIndex]) || 0;
			  totalScore += score;
			  maxPossible += task.maxScore;
			});
			
			const percentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			solvabilityData.push(percentage);
			solvabilityLabels.push(`–ó–∞–¥–∞–Ω–∏–µ ${taskIndex + 1}`);
		  }
		  
		  chartCache.solvability = {
			labels: solvabilityLabels,
			data: solvabilityData
		  };
		  
		  // 3. –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å
		  chartCache.scatterData = [];
		  
		  // –î–ª—è –ö–ê–ñ–î–û–ì–û –∑–∞–¥–∞–Ω–∏—è —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
		  for (let taskIndex = 0; taskIndex < totalTasks; taskIndex++) {
			const task = appData.tasks[taskIndex];
			const complexity = task.level || 1;
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ—à–∞–µ–º–æ—Å—Ç—å –¥–ª—è –≠–¢–û–ì–û –∑–∞–¥–∞–Ω–∏—è
			let totalScore = 0;
			let maxPossible = 0;
			
			appData.results.forEach(studentScores => {
			  const score = parseFloat(studentScores[taskIndex]) || 0;
			  totalScore += score;
			  maxPossible += task.maxScore;
			});
			
			const percentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É
			chartCache.scatterData.push({
			  x: complexity, // –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-4)
			  y: percentage, // –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
			  r: 8 + (task.maxScore || 1), // –†–∞–∑–º–µ—Ä —Ç–æ—á–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–ª–∞
			  taskIndex: taskIndex,
			  taskNumber: taskIndex + 1,
			  maxScore: task.maxScore,
			  label: complexityLevels[complexity]?.name || `–£—Ä–æ–≤–µ–Ω—å ${complexity}`
			});
		  }
		  
		  // –î–ª—è –ª–∏–Ω–µ–π–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ (—Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
		  const complexityAverages = { 1: [], 2: [], 3: [], 4: [] };
		  const complexityLabels = ['–ë–∞–∑–æ–≤—ã–π', '–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ', '–ê–Ω–∞–ª–∏–∑', '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ'];
		  
		  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
		  chartCache.scatterData.forEach(point => {
			if (complexityAverages[point.x]) {
			  complexityAverages[point.x].push(point.y);
			}
		  });
		  
		  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ
		  chartCache.complexity = {
			labels: complexityLabels,
			datasets: [
			  {
				label: '–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
				data: complexityLabels.map((label, index) => {
				  const level = index + 1;
				  const percentages = complexityAverages[level];
				  return percentages.length > 0 
					? percentages.reduce((a, b) => a + b, 0) / percentages.length 
					: 0;
				}),
				backgroundColor: ['#27ae60', '#3498db', '#f39c12', '#e74c3c'],
				borderColor: '#fff',
				borderWidth: 2
			  }
			]
		  };
		}

		function renderChartsFromCache() {
		  renderGradesChart();
		  renderSolvabilityChart();
		  renderComplexityChart();
		}

		function renderCharts() {
		  renderGradesChart();
		  renderSolvabilityChart();
		  renderComplexityChart();
		  renderHeatmap();
		}		
		// –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
		function renderGradesChart() {
		  const canvas = document.getElementById('gradesChart');
		  if (!canvas) return;
		  
		  const ctx = canvas.getContext('2d');
		  
		  // –î–µ—Å—Ç—Ä–æ–π —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫
		  window.gradesChartInstance = destroyChartIfExists(window.gradesChartInstance);
		  
		  if (!chartCache.grades || chartCache.grades.labels.length === 0) {
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.fillStyle = '#999';
			ctx.textAlign = 'center';
			ctx.font = '14px Arial';
			ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', canvas.width/2, canvas.height/2);
			return;
		  }
		  
		  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
		  window.gradesChartInstance = new Chart(ctx, {
			type: 'bar',
			data: chartCache.grades,
			options: {
			  responsive: true,
			  maintainAspectRatio: false,
			  plugins: {
				legend: {
				  display: true,
				  position: 'top'
				},
				tooltip: {
				  callbacks: {
					label: function(context) {
					  const label = context.dataset.label || '';
					  const value = context.parsed.y;
					  const total = appData.students.length;
					  const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
					  return `${label}: ${value} (${percentage}%)`;
					}
				  }
				}
			  },
			  scales: {
				y: {
				  beginAtZero: true,
				  title: {
					display: true,
					text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è'
				  }
				},
				x: {
				  title: {
					display: true,
					text: '–û—Ü–µ–Ω–∫–∞'
				  }
				}
			  }
			}
		  });
		}

		// –ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏
		function renderSolvabilityChart() {
		  const canvas = document.getElementById('solvabilityChart');
		  if (!canvas) return;
		  
		  const ctx = canvas.getContext('2d');
		  
		  // –î–µ—Å—Ç—Ä–æ–π —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫
		  window.solvabilityChartInstance = destroyChartIfExists(window.solvabilityChartInstance);
		  
		  if (!chartCache.solvability || chartCache.solvability.labels.length === 0) {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.fillStyle = '#999';
			ctx.textAlign = 'center';
			ctx.font = '14px Arial';
			ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', canvas.width/2, canvas.height/2);
			return;
		  }
		  
		  // –°–æ–∑–¥–∞–µ–º dataset —Å –∑–æ–Ω–∞–º–∏
		  const dataset = {
			label: '–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π (%)',
			data: chartCache.solvability.data,
			backgroundColor: chartCache.solvability.data.map(p => {
			  if (p < 30) return 'rgba(231, 76, 60, 0.7)';
			  if (p < 60) return 'rgba(241, 196, 15, 0.7)';
			  if (p < 90) return 'rgba(52, 152, 219, 0.7)';
			  return 'rgba(46, 204, 113, 0.7)';
			}),
			borderColor: chartCache.solvability.data.map(p => {
			  if (p < 30) return '#e74c3c';
			  if (p < 60) return '#f1c40f';
			  if (p < 90) return '#3498db';
			  return '#2ecc71';
			}),
			borderWidth: 2
		  };
		  
		  window.solvabilityChartInstance = new Chart(ctx, {
			type: 'bar',
			data: {
			  labels: chartCache.solvability.labels,
			  datasets: [dataset]
			},
			options: {
			  responsive: true,
			  maintainAspectRatio: false,
			  plugins: {
				legend: {
				  display: false
				},
				annotation: {
				  annotations: {
					redZone: {
					  type: 'box',
					  yMin: 0,
					  yMax: 30,
					  backgroundColor: 'rgba(231, 76, 60, 0.1)',
					  borderColor: 'rgba(231, 76, 60, 0.3)',
					  borderWidth: 1
					},
					yellowZone: {
					  type: 'box',
					  yMin: 30,
					  yMax: 60,
					  backgroundColor: 'rgba(241, 196, 15, 0.1)',
					  borderColor: 'rgba(241, 196, 15, 0.3)',
					  borderWidth: 1
					},
					greenZone: {
					  type: 'box',
					  yMin: 60,
					  yMax: 90,
					  backgroundColor: 'rgba(46, 204, 113, 0.1)',
					  borderColor: 'rgba(46, 204, 113, 0.3)',
					  borderWidth: 1
					}
				  }
				}
			  },
			  scales: {
				y: {
				  beginAtZero: true,
				  max: 100,
				  title: {
					display: true,
					text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (%)'
				  }
				},
				x: {
				  title: {
					display: true,
					text: '–ù–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è'
				  },
				  ticks: {
					maxRotation: 45
				  }
				}
			  }
			}
		  });
		}

		// –ì—Ä–∞—Ñ–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ vs —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏
		// –ì—Ä–∞—Ñ–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ vs —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ (—Ç–æ—á–µ—á–Ω—ã–π)
		function renderComplexityChart() {
		  const canvas = document.getElementById('complexityChart');
		  if (!canvas) return;
		  
		  const ctx = canvas.getContext('2d');
		  
		  // –î–µ—Å—Ç—Ä–æ–π —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫
		  window.complexityChartInstance = destroyChartIfExists(window.complexityChartInstance);
		  
		  if (!chartCache.scatterData || chartCache.scatterData.length === 0) {
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.fillStyle = '#999';
			ctx.textAlign = 'center';
			ctx.font = '14px Arial';
			ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', canvas.width/2, canvas.height/2);
			return;
		  }
		  
		  // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Chart.js
		  const scatterDataset = {
			label: '–ó–∞–¥–∞–Ω–∏—è',
			data: chartCache.scatterData,
			backgroundColor: chartCache.scatterData.map(point => {
			  // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
			  if (point.y < 30) return 'rgba(231, 76, 60, 0.7)';
			  if (point.y < 60) return 'rgba(241, 196, 15, 0.7)';
			  if (point.y < 90) return 'rgba(52, 152, 219, 0.7)';
			  return 'rgba(46, 204, 113, 0.7)';
			}),
			borderColor: '#fff',
			borderWidth: 1,
			pointRadius: chartCache.scatterData.map(point => point.r || 8),
			pointHoverRadius: chartCache.scatterData.map(point => (point.r || 8) + 3)
		  };
		  
		  // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
		  window.complexityChartInstance = new Chart(ctx, {
			type: 'scatter',
			data: {
			  datasets: [scatterDataset]
			},
			options: {
			  responsive: true,
			  maintainAspectRatio: false,
			  plugins: {
				legend: {
				  display: true,
				  position: 'top'
				},
				tooltip: {
				  callbacks: {
					label: function(context) {
					  const point = context.raw;
					  return [
						`–ó–∞–¥–∞–Ω–∏–µ ${point.taskNumber}`,
						`–£—Ä–æ–≤–µ–Ω—å: ${point.label}`,
						`–†–µ—à–∞–µ–º–æ—Å—Ç—å: ${point.y.toFixed(1)}%`,
						`–ú–∞–∫—Å. –±–∞–ª–ª: ${point.maxScore}`
					  ];
					}
				  }
				}
			  },
			  scales: {
				y: {
				  beginAtZero: true,
				  max: 100,
				  title: {
					display: true,
					text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (%)',
					font: {
					  size: 14,
					  weight: 'bold'
					}
				  },
				  ticks: {
					callback: function(value) {
					  return value + '%';
					}
				  }
				},
				x: {
				  type: 'linear',
				  min: 0.5,
				  max: 4.5,
				  title: {
					display: true,
					text: '–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏',
					font: {
					  size: 14,
					  weight: 'bold'
					}
				  },
				  ticks: {
					stepSize: 1,
					callback: function(value) {
					  const levels = {
						1: '1. –ë–∞–∑–æ–≤—ã–π',
						2: '2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ', 
						3: '3. –ê–Ω–∞–ª–∏–∑',
						4: '4. –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ'
					  };
					  return levels[value] || '';
					}
				  },
				  grid: {
					color: 'rgba(0,0,0,0.1)'
				  }
				}
			  }
			}
		  });
		  
		  // –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–µ–Ω–¥—É —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
		  addComplexityLegend();
		}

		function addComplexityLegend() {
		  const container = document.querySelector('#complexityChart').parentElement;
		  if (!container) return;
		  
		  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ª–µ–≥–µ–Ω–¥—É
		  const oldLegend = container.querySelector('.complexity-legend');
		  if (oldLegend) oldLegend.remove();
		  
		  const legend = document.createElement('div');
		  legend.className = 'complexity-legend';
		  legend.style.marginTop = '15px';
		  legend.style.textAlign = 'center';
		  legend.style.fontSize = '12px';
		  
		  legend.innerHTML = `
			<div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 15px; height: 15px; background: #27ae60; border-radius: 50%;"></div>
				<span>–£—Ä–æ–≤–µ–Ω—å 1: –ë–∞–∑–æ–≤—ã–π/–†–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π</span>
			  </div>
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 15px; height: 15px; background: #3498db; border-radius: 50%;"></div>
				<span>–£—Ä–æ–≤–µ–Ω—å 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ</span>
			  </div>
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 15px; height: 15px; background: #f39c12; border-radius: 50%;"></div>
				<span>–£—Ä–æ–≤–µ–Ω—å 3: –ê–Ω–∞–ª–∏–∑/–°–∏–Ω—Ç–µ–∑</span>
			  </div>
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 15px; height: 15px; background: #e74c3c; border-radius: 50%;"></div>
				<span>–£—Ä–æ–≤–µ–Ω—å 4: –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</span>
			  </div>
			</div>
			<p style="margin-top: 10px; color: #666;">
			  –†–∞–∑–º–µ—Ä —Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª –∑–∞–¥–∞–Ω–∏—è
			</p>
		  `;
		  
		  container.appendChild(legend);
		}

		// –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (Canvas-based –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
		function renderHeatmap() {
		  const container = document.getElementById('heatmapContainer');
		  if (!container) return;
		  
		  const totalStudents = appData.students.length;
		  const totalTasks = appData.tasks.length;
		  
		  if (totalStudents === 0 || totalTasks === 0) {
			container.innerHTML = `
			  <div style="text-align: center; padding: 40px; color: #999;">
				<i class="fas fa-chart-heatmap" style="font-size: 48px; margin-bottom: 15px;"></i>
				<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã</p>
				<p><small>–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—â–∏—Ö—Å—è –∏ –∑–∞–¥–∞–Ω–∏—è</small></p>
			  </div>
			`;
			return;
		  }
		  
		  // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –≤–º–µ—Å—Ç–æ canvas –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
		  let html = `
			<div class="heatmap-wrapper" style="overflow-x: auto; position: relative;">
			  <div class="heatmap-controls" style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
				<button class="btn btn-sm btn-outline" onclick="toggleHeatmapLabels()">
				  <i class="fas fa-font"></i> –°–∫—Ä—ã—Ç—å –∏–º–µ–Ω–∞
				</button>
				<button class="btn btn-sm btn-outline" onclick="toggleHeatmapColors()">
				  <i class="fas fa-palette"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞–ª–∏—Ç—Ä—É
				</button>
				<div style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
				  <label style="font-size: 12px;">
					<input type="checkbox" id="heatmapHighlights" checked onchange="updateHeatmap()">
					–ü–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
				  </label>
				</div>
			  </div>
			  
			  <table class="heatmap-table" style="border-collapse: collapse; width: 100%; font-size: 12px;">
				<thead>
				  <tr>
					<th style="position: sticky; left: 0; background: #34495e; color: white; padding: 10px; min-width: 150px; z-index: 10;">
					  –£—á–∞—â–∏–π—Å—è / –ó–∞–¥–∞–Ω–∏–µ
					</th>
		  `;
		  
		  // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–¥–∞–Ω–∏–π
		  for (let i = 0; i < totalTasks; i++) {
			const task = appData.tasks[i];
			html += `
			  <th style="background: #34495e; color: white; padding: 10px 5px; text-align: center; min-width: 40px; position: sticky; top: 0; z-index: 5;">
				<div title="–ó–∞–¥–∞–Ω–∏–µ ${i+1}: ${task.type || ''}">
				  ${i+1}
				  <div style="font-size: 9px; opacity: 0.8;">${task.maxScore} –±.</div>
				</div>
			  </th>
			`;
		  }
		  
		  html += `
				  </tr>
				</thead>
				<tbody>
		  `;
		  
		  // –î–∞–Ω–Ω—ã–µ —É—á–∞—â–∏—Ö—Å—è
		  for (let studentIndex = 0; studentIndex < totalStudents; studentIndex++) {
			const studentName = appData.students[studentIndex];
			const totalScore = appData.results[studentIndex]?.reduce((sum, score) => sum + (parseFloat(score) || 0), 0) || 0;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const studentPercentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			
			html += `
			  <tr>
				<td style="position: sticky; left: 0; background: #f8f9fa; padding: 8px 10px; border-right: 2px solid #ddd; z-index: 2;">
				  <div style="display: flex; justify-content: space-between; align-items: center;">
					<div>
					  <strong>${studentName}</strong>
					  <div style="font-size: 10px; color: #666;">
						${totalScore.toFixed(1)}/${maxPossible} –±. (${studentPercentage.toFixed(1)}%)
					  </div>
					</div>
					<div style="width: 20px; height: 20px; border-radius: 50%; background: ${getPercentageColor(studentPercentage)};"></div>
				  </div>
				</td>
			`;
			
			// –Ø—á–µ–π–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
			for (let taskIndex = 0; taskIndex < totalTasks; taskIndex++) {
			  const score = parseFloat(appData.results[studentIndex]?.[taskIndex]) || 0;
			  const maxScore = appData.tasks[taskIndex]?.maxScore || 1;
			  const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
			  const color = getPercentageColor(percentage);
			  const textColor = percentage < 30 ? 'white' : 'black';
			  
			  // –ò—â–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è —ç—Ç–æ–π —è—á–µ–π–∫–∏
			  const errors = appData.errors.filter(err => 
				err.studentIndex === studentIndex && err.taskIndex === taskIndex
			  );
			  
			  const hasError = errors.length > 0;
			  const errorIcon = hasError ? ' ‚ö†Ô∏è' : '';
			  
			  html += `
				<td class="heatmap-cell" 
					style="background: ${color}; color: ${textColor}; padding: 8px 5px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.3);"
					onclick="showHeatmapCellDetails(${studentIndex}, ${taskIndex})"
					onmouseenter="highlightHeatmapRowCol(${studentIndex}, ${taskIndex})"
					onmouseleave="clearHeatmapHighlights()"
					data-student="${studentIndex}"
					data-task="${taskIndex}"
					title="${studentName} - –ó–∞–¥–∞–Ω–∏–µ ${taskIndex+1}: ${score}/${maxScore} –±. (${percentage.toFixed(1)}%)${hasError ? '\n–ï—Å—Ç—å –æ—à–∏–±–∫–∏: ' + errors.map(e => errorTypes[e.type]?.name).join(', ') : ''}">
				  <div style="font-weight: bold;">${score.toFixed(0)}${errorIcon}</div>
				  <div style="font-size: 9px; opacity: 0.8;">${percentage.toFixed(0)}%</div>
				</td>
			  `;
			}
			
			html += `</tr>`;
		  }
		  
		  // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (—Å—Ä–µ–¥–Ω–∏–µ –ø–æ –∑–∞–¥–∞–Ω–∏—è–º)
		  html += `
			  <tr style="background: rgba(52, 73, 94, 0.1);">
				<td style="position: sticky; left: 0; background: #34495e; color: white; padding: 10px; font-weight: bold;">
				  –°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
				</td>
		  `;
		  
		  for (let taskIndex = 0; taskIndex < totalTasks; taskIndex++) {
			let totalScore = 0;
			let maxPossible = 0;
			
			appData.results.forEach(studentScores => {
			  const score = parseFloat(studentScores[taskIndex]) || 0;
			  totalScore += score;
			  maxPossible += appData.tasks[taskIndex]?.maxScore || 1;
			});
			
			const avgPercentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			const color = getPercentageColor(avgPercentage);
			const textColor = avgPercentage < 30 ? 'white' : 'black';
			
			html += `
			  <td style="background: ${color}; color: ${textColor}; padding: 10px 5px; text-align: center; font-weight: bold; border: 2px solid #34495e;">
				${avgPercentage.toFixed(1)}%
			  </td>
			`;
		  }
		  
		  html += `
				</tr>
			  </tbody>
			</table>
			
			<div class="heatmap-legend" style="margin-top: 20px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 20px; height: 20px; background: #e74c3c;"></div>
				<span>&lt;30% - –Ω–∏–∑–∫–∏–π</span>
			  </div>
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 20px; height: 20px; background: #f39c12;"></div>
				<span>30-60% - —Å—Ä–µ–¥–Ω–∏–π</span>
			  </div>
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 20px; height: 20px; background: #3498db;"></div>
				<span>60-90% - —Ö–æ—Ä–æ—à–∏–π</span>
			  </div>
			  <div style="display: flex; align-items: center; gap: 5px;">
				<div style="width: 20px; height: 20px; background: #2ecc71;"></div>
				<span>&gt;90% - –æ—Ç–ª–∏—á–Ω—ã–π</span>
			  </div>
			</div>
			
			<div style="margin-top: 15px; text-align: center; color: #666; font-size: 12px;">
			  <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π ‚Ä¢ –ù–∞–≤–µ–¥–∏—Ç–µ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å—Ç—Ä–æ–∫–∏ –∏ —Å—Ç–æ–ª–±—Ü–∞</p>
			</div>
		  </div>
		  `;
		  
		  container.innerHTML = html;
		  
		  // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
		  addHeatmapStyles();
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
		function getPercentageColor(percentage) {
		  if (percentage < 30) return '#e74c3c';
		  if (percentage < 60) return '#f39c12';
		  if (percentage < 90) return '#3498db';
		  return '#2ecc71';
		}

		function addHeatmapStyles() {
		  const styleId = 'heatmap-styles';
		  if (document.getElementById(styleId)) return;
		  
		  const style = document.createElement('style');
		  style.id = styleId;
		  style.textContent = `
			.heatmap-cell:hover {
			  transform: scale(1.1);
			  z-index: 1;
			  position: relative;
			  box-shadow: 0 0 10px rgba(0,0,0,0.3);
			}
			
			.heatmap-row-highlight td:not(:first-child) {
			  background-color: rgba(52, 152, 219, 0.2) !important;
			}
			
			.heatmap-col-highlight {
			  background-color: rgba(46, 204, 113, 0.2) !important;
			}
			
			.heatmap-cell-highlight {
			  box-shadow: inset 0 0 0 3px #2c3e50;
			  z-index: 2;
			  position: relative;
			}
			
			.heatmap-table th {
			  transition: background 0.3s;
			}
			
			.heatmap-table th:hover {
			  background: #2c3e50 !important;
			}
		  `;
		  
		  document.head.appendChild(style);
		}

		// –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		let currentColorScheme = 0;
		const colorSchemes = [
		  { low: '#e74c3c', medium: '#f39c12', high: '#3498db', excellent: '#2ecc71' },
		  { low: '#ff6b6b', medium: '#ffa726', high: '#42a5f5', excellent: '#66bb6a' },
		  { low: '#d32f2f', medium: '#f57c00', high: '#1976d2', excellent: '#388e3c' },
		  { low: '#c2185b', medium: '#fbc02d', high: '#0288d1', excellent: '#689f38' }
		];

		function toggleHeatmapColors() {
		  currentColorScheme = (currentColorScheme + 1) % colorSchemes.length;
		  updateHeatmap();
		}

		function toggleHeatmapLabels() {
		  const table = document.querySelector('.heatmap-table');
		  if (table) {
			const labels = table.querySelectorAll('td:first-child, th:first-child');
			labels.forEach(label => {
			  label.style.display = label.style.display === 'none' ? '' : 'none';
			});
		  }
		}

		function updateHeatmap() {
		  // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
		  renderHeatmap();
		}

		function showHeatmapCellDetails(studentIndex, taskIndex) {
		  const studentName = appData.students[studentIndex];
		  const task = appData.tasks[taskIndex];
		  const score = parseFloat(appData.results[studentIndex]?.[taskIndex]) || 0;
		  const maxScore = task.maxScore || 1;
		  const percentage = (score / maxScore) * 100;
		  
		  // –ò—â–µ–º –æ—à–∏–±–∫–∏
		  const errors = appData.errors.filter(err => 
			err.studentIndex === studentIndex && err.taskIndex === taskIndex
		  );
		  
		  let html = `
			<div style="padding: 20px;">
			  <h3>–î–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</h3>
			  
			  <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
				<p><strong>–£—á–∞—â–∏–π—Å—è:</strong> ${studentName}</p>
				<p><strong>–ó–∞–¥–∞–Ω–∏–µ ${taskIndex + 1}:</strong> ${task.type || '–ó–∞–¥–∞–Ω–∏–µ'}</p>
				<p><strong>–ë–∞–ª–ª—ã:</strong> ${score.toFixed(1)} / ${maxScore}</p>
				<p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${percentage.toFixed(1)}%</p>
				<div style="width: 100%; height: 20px; background: #eee; border-radius: 10px; margin-top: 10px; overflow: hidden;">
				  <div style="width: ${percentage}%; height: 100%; background: ${getPercentageColor(percentage)};"></div>
				</div>
			  </div>
		  `;
		  
		  if (errors.length > 0) {
			html += `
			  <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
				<h4>‚ö†Ô∏è –û—à–∏–±–∫–∏ –≤ —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏:</h4>
				<ul style="margin-top: 10px;">
			`;
			
			errors.forEach(error => {
			  html += `
				<li style="margin-bottom: 5px;">
				  <strong>${errorTypes[error.type]?.name || error.type}:</strong>
				  ${error.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
				  ${error.count > 1 ? ` (–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: ${error.count})` : ''}
				</li>
			  `;
			});
			
			html += `</ul></div>`;
		  } else {
			html += `
			  <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0;">
				<p>‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</p>
			  </div>
			`;
		  }
		  
		  html += `
			  <div style="margin-top: 20px;">
				<button class="btn btn-warning" onclick="editStudentScore(${studentIndex}, ${taskIndex}); hideModal()">
				  ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É
				</button>
				<button class="btn btn-info" onclick="addErrorForCell(${studentIndex}, ${taskIndex}); hideModal()">
				  ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É
				</button>
			  </div>
			</div>
		  `;
		  
		  showModal(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${studentName} - –ó–∞–¥–∞–Ω–∏–µ ${taskIndex + 1}`, html);
		}

		function highlightHeatmapRowCol(studentIndex, taskIndex) {
		  // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
		  clearHeatmapHighlights();
		  
		  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É
		  const rows = document.querySelectorAll('.heatmap-table tbody tr');
		  if (rows[studentIndex]) {
			rows[studentIndex].classList.add('heatmap-row-highlight');
		  }
		  
		  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å—Ç–æ–ª–±–µ—Ü
		  const cells = document.querySelectorAll(`.heatmap-cell[data-task="${taskIndex}"]`);
		  cells.forEach(cell => {
			cell.classList.add('heatmap-col-highlight');
		  });
		  
		  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —è—á–µ–π–∫—É
		  const currentCell = document.querySelector(`.heatmap-cell[data-student="${studentIndex}"][data-task="${taskIndex}"]`);
		  if (currentCell) {
			currentCell.classList.add('heatmap-cell-highlight');
		  }
		}

		function clearHeatmapHighlights() {
		  document.querySelectorAll('.heatmap-row-highlight').forEach(el => {
			el.classList.remove('heatmap-row-highlight');
		  });
		  document.querySelectorAll('.heatmap-col-highlight').forEach(el => {
			el.classList.remove('heatmap-col-highlight');
		  });
		  document.querySelectorAll('.heatmap-cell-highlight').forEach(el => {
			el.classList.remove('heatmap-cell-highlight');
		  });
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function editStudentScore(studentIndex, taskIndex) {
		  // –í–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
		  showNotification(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è ${appData.students[studentIndex]}`, 'info');
		}

		function addErrorForCell(studentIndex, taskIndex) {
		  // –í–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏
		  showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –¥–ª—è ${appData.students[studentIndex]}`, 'info');
		}

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
		  // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
		  const observer = new MutationObserver(function() {
			updateVisualizationDebounced();
		  });
		  
		  // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
		  const resultsContainer = document.getElementById('resultsContainer');
		  if (resultsContainer) {
			observer.observe(resultsContainer, { childList: true, subtree: true });
		  }
		  
		  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		  setTimeout(updateVisualization, 1000);
		});
		
		
		
		
		function updateVisualizationz() {
			console.log('=== –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò ===');
			
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ª–∏ –≤–∫–ª–∞–¥–∫–∞ visualization
				const vizTab = document.getElementById('visualization');
				const gradesChart = document.getElementById('gradesChart');
				
				if (!gradesChart || !vizTab || vizTab.innerHTML.trim().length < 100) {
					console.log('–í–∫–ª–∞–¥–∫–∞ visualization –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º...');
					setupVisualizationTab();
					return;
				}
				
				// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¢–£–¢
				destroyAllCharts();
				
				// –ñ–¥–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ DOM
				setTimeout(() => {
					try {
						// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏
						updateCharts();
						
						// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É
						updateHeatmap();
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
						if (appData.test.workType === 'func_literacy') {
							console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏');
							initLiteracyCharts();
						} else if (appData.test.workType === 'psychology') {
							console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≥—Ä–∞—Ñ–∏–∫–∏');
							initPsychologyCharts();
						}
						
						// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Å–∞–π–∑ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
						setTimeout(() => {
							safeResizeCharts();
							console.log('–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
						}, 300);
						
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤:', error);
						showChartError();
					}
				}, 150);
				
			} catch (error) {
				console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ updateVisualization:', error);
				showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
			}
		}
		// –ù–∞–π–¥–∏—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã –∏ –¥–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
		function setupTabsNavigation() {
			const tabs = document.querySelectorAll('.nav-link');
			tabs.forEach(tab => {
				tab.addEventListener('click', function() {
					const tabId = this.getAttribute('href')?.replace('#', '');
					if (tabId === 'visualization') {
						console.log('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–∫–ª–∞–¥–∫—É visualization');
						
						// –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ DOM
						setTimeout(() => {
							if (document.getElementById('visualization').querySelectorAll('canvas').length === 0) {
								console.log('–í–∫–ª–∞–¥–∫–∞ –ø—É—Å—Ç–∞—è, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º...');
								setupVisualizationTab();
							} else {
								console.log('–û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏...');
								updateVisualization();
							}
						}, 100);
					}
				});
			});
		}

		// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			setupTabsNavigation();
			console.log('–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
		});

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		function updateCharts() {
			console.log('updateCharts –≤—ã–∑–≤–∞–Ω–∞, –¥–∞–Ω–Ω—ã–µ:', {
				results: appData.results.length,
				tasks: appData.tasks.length
			});
			
			if (appData.results.length === 0 || appData.tasks.length === 0) {
				console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤');
				showNoDataMessage();
				return;
			}
			
			try {
				// 1. –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
				updateGradesChart();
				
				// 2. –ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π
				updateSolvabilityChart();
				
				// 3. –ì—Ä–∞—Ñ–∏–∫ —Å–≤—è–∑–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏
				updateComplexityChart();
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≤ updateCharts:', error);
				throw error;
			}
		}

		function updateGradesChart() {
			const canvas = document.getElementById('gradesChart');
			if (!canvas) {
				console.warn('Canvas gradesChart –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			}
			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫...');
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ —ç—Ç–æ–º canvas
			const existingChart = Chart.getChart(canvas);
			if (existingChart) {
				console.log(`–ù–∞ canvas ${canvas.id} —É–∂–µ –µ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Å ID ${existingChart.id}, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º...`);
				existingChart.destroy();
			}
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º canvas –∫–æ–Ω—Ç–µ–∫—Å—Ç
			if (!canvas.getContext) {
				console.error('Canvas –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç getContext');
				return;
			}
			

			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫...');
			
			const totalScores = appData.results.map(scores => 
				scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0)
			);
			
			const grades = totalScores.map(score => {
				const grade = calculateGrade(score);
				console.log(`–ë–∞–ª–ª—ã: ${score}, –û—Ü–µ–Ω–∫–∞: ${grade}`);
				return grade;
			});
			
			console.log('–í—Å–µ –æ—Ü–µ–Ω–∫–∏:', grades);
			
			// –°—á–∏—Ç–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
			const gradeCounts = {};
			grades.forEach(grade => {
				if (grade && grade !== '?') {
					gradeCounts[grade] = (gradeCounts[grade] || 0) + 1;
				}
			});
			
			console.log('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫:', gradeCounts);
			
			// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è Chart.js
			const labels = Object.keys(gradeCounts).sort();
			const data = labels.map(label => gradeCounts[label]);
			const backgroundColors = labels.map(label => getGradeColor(label));
			
			if (labels.length === 0) {
				canvas.parentElement.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫</p>';
				return;
			}
			
			const ctx = canvas.getContext('2d');
			window.gradesChartInstance = new Chart(ctx, {
				type: 'doughnut',
				data: {
					labels: labels.map(label => `–û—Ü–µ–Ω–∫–∞ ${label}`),
					datasets: [{
						data: data,
						backgroundColor: backgroundColors,
						borderWidth: 2,
						borderColor: '#fff',
						hoverOffset: 10
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { 
							position: 'bottom',
							labels: {
								padding: 20,
								usePointStyle: true,
								font: { size: 12 }
							}
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									const label = context.label || '';
									const value = context.raw || 0;
									const total = context.dataset.data.reduce((a, b) => a + b, 0);
									const percentage = Math.round((value / total) * 100);
									return `${label}: ${value} —É—á. (${percentage}%)`;
								}
							}
						},
						title: {
							display: true,
							text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫',
							font: { size: 16, weight: 'bold' },
							padding: { top: 10, bottom: 20 }
						}
					},
					cutout: '50%'
				}
			});
		}

		function updateSolvabilityChart() {
			const canvas = document.getElementById('solvabilityChart');
			if (!canvas) {
				console.warn('Canvas solvabilityChart –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			}
			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏...');
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ—à–∞–µ–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
			const taskStats = [];
			for (let i = 0; i < appData.tasks.length; i++) {
				const task = appData.tasks[i];
				const maxScore = parseInt(task.maxScore) || 1;
				const actualScores = appData.results.map(student => parseInt(student[i]) || 0);
				const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
				const completion = maxScore > 0 ? (actualTotal / (maxScore * appData.results.length)) * 100 : 0;
				
				taskStats.push({
					taskNumber: i + 1,
					completion: completion,
					type: task.type,
					level: task.level
				});
			}
			
			console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π:', taskStats);
			
			const ctx = canvas.getContext('2d');
			window.solvabilityChartInstance = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: taskStats.map(t => `–ó–∞–¥. ${t.taskNumber}`),
					datasets: [{
						label: '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
						data: taskStats.map(t => t.completion),
						backgroundColor: taskStats.map(t => complexityLevels[t.level]?.color || '#3498db'),
						borderColor: '#2c3e50',
						borderWidth: 1
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						x: {
							title: { 
								display: true, 
								text: '–ù–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è',
								font: { size: 14, weight: 'bold' }
							},
							grid: { display: false }
						},
						y: {
							title: { 
								display: true, 
								text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
								font: { size: 14, weight: 'bold' }
							},
							min: 0,
							max: 100,
							ticks: {
								callback: function(value) {
									return value + '%';
								}
							}
						}
					},
					plugins: {
						legend: { display: false },
						tooltip: {
							callbacks: {
								label: function(context) {
									const task = taskStats[context.dataIndex];
									return [
										`–ó–∞–¥–∞–Ω–∏–µ ${task.taskNumber}: ${task.type}`,
										`–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${task.level}`,
										`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${context.raw.toFixed(1)}%`
									];
								}
							}
						},
						title: {
							display: true,
							text: '–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π',
							font: { size: 16, weight: 'bold' },
							padding: { top: 10, bottom: 20 }
						}
					}
				}
			});
		}
		function createAllCharts() {
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö canvas —ç–ª–µ–º–µ–Ω—Ç–æ–≤
			const chartIds = ['gradesChart', 'solvabilityChart', 'complexityChart'];
			
			chartIds.forEach(id => {
				if (!document.getElementById(id)) {
					console.log(`–°–æ–∑–¥–∞–µ–º canvas –¥–ª—è ${id}...`);
					createChartContainer(id);
				}
			});
		}

		function createChartContainer(chartId) {
			const container = document.getElementById('chartsContainer') || createChartsSection();
			
			const chartContainer = document.createElement('div');
			chartContainer.className = 'chart-container';
			chartContainer.innerHTML = `
				<h3>${getChartTitle(chartId)}</h3>
				<div class="chart-wrapper">
					<canvas id="${chartId}"></canvas>
				</div>
			`;
			
			container.appendChild(chartContainer);
			return chartContainer;
		}

		function getChartTitle(chartId) {
			const titles = {
				'gradesChart': 'üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫',
				'solvabilityChart': 'üìà –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π',
				'complexityChart': 'üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å'
			};
			return titles[chartId] || chartId;
		}
		// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏
		function findChartsContainer() {
			console.log('=== –ü–û–ò–°–ö –ö–û–ù–¢–ï–ô–ù–ï–†–ê –ì–†–ê–§–ò–ö–û–í ===');
			
			// –í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
			const possibleIds = [
				'visualizationContainer', 'chartsContainer', 'graphsContainer',
				'analyticsContainer', 'statisticsContainer', 'resultsCharts'
			];
			
			const possibleClasses = [
				'charts-section', 'graphs-section', 'visualization-section',
				'analytics-tab', 'statistics-tab', 'chart-container'
			];
			
			// –ò—â–µ–º –ø–æ ID
			console.log('–ü–æ–∏—Å–∫ –ø–æ ID:');
			possibleIds.forEach(id => {
				const element = document.getElementById(id);
				if (element) {
					console.log(`‚úì –ù–∞–π–¥–µ–Ω: #${id}`, element);
					console.log('  –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π HTML:', element.innerHTML.substring(0, 200) + '...');
				}
			});
			
			// –ò—â–µ–º –ø–æ –∫–ª–∞—Å—Å–∞–º
			console.log('\n–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∞—Å—Å–∞–º:');
			possibleClasses.forEach(className => {
				const elements = document.getElementsByClassName(className);
				if (elements.length > 0) {
					console.log(`‚úì –ù–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–æ–º .${className}:`, elements.length);
					console.log('  –ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç:', elements[0]);
				}
			});
			
			// –ò—â–µ–º –≤—Å–µ canvas
			console.log('\n–í—Å–µ canvas –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:');
			const allCanvas = document.getElementsByTagName('canvas');
			console.log(`–í—Å–µ–≥–æ canvas: ${allCanvas.length}`);
			for (let i = 0; i < allCanvas.length; i++) {
				const canvas = allCanvas[i];
				console.log(`${i+1}. id="${canvas.id}", —Ä–æ–¥–∏—Ç–µ–ª—å:`, canvas.parentElement);
			}
			
			// –ò—â–µ–º –≤–∫–ª–∞–¥–∫–∏/—Ç–∞–±—ã
			console.log('\n–í—Å–µ –≤–∫–ª–∞–¥–∫–∏ (tabs):');
			const tabs = document.querySelectorAll('[role="tab"], .tab-pane, .tab-content');
			tabs.forEach(tab => {
				console.log('–í–∫–ª–∞–¥–∫–∞:', tab.id || tab.className, tab);
			});
		}

		function setupVisualizationTab() {
			console.log('=== –ù–ê–°–¢–†–û–ô–ö–ê –í–ö–õ–ê–î–ö–ò –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò ===');
			
			const vizTab = document.getElementById('visualization');
			if (!vizTab) {
				console.error('–í–∫–ª–∞–¥–∫–∞ visualization –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
				return;
			}
			
			destroyAllCharts();
			
			// –û—á–∏—â–∞–µ–º –≤–∫–ª–∞–¥–∫—É
			vizTab.innerHTML = '';
			
			// –ó–∞–≥–æ–ª–æ–≤–æ–∫
			vizTab.innerHTML += `
				<h2>üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
				
				<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
					<button class="btn btn-primary" onclick="updateVisualization()" style="margin-right: 10px;">
						üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
					</button>
					<button class="btn btn-warning" onclick="exportAllCharts()" style="margin-right: 10px;">
						üì• –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
					</button>
					<button class="btn" onclick="toggleDarkMode()" style="margin-right: 10px;">
						üåô –¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º
					</button>
					<button class="btn" onclick="debugCharts()">
						üêõ –û—Ç–ª–∞–¥–∫–∞
					</button>
				</div>
				
				<div class="charts-grid" id="chartsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px;">
					<!-- –ì—Ä–∞—Ñ–∏–∫ 1: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
						</h3>
						<div style="position: relative; height: 300px;">
							<canvas id="gradesChart"></canvas>
						</div>
						<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
							–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—á–∞—â–∏—Ö—Å—è –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –æ—Ü–µ–Ω–∫–∞–º
						</p>
					</div>
					
					<!-- –ì—Ä–∞—Ñ–∏–∫ 2: –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üìà –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π
						</h3>
						<div style="position: relative; height: 300px;">
							<canvas id="solvabilityChart"></canvas>
						</div>
						<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
							–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
						</p>
					</div>
					
					<!-- –ì—Ä–∞—Ñ–∏–∫ 3: –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å
						</h3>
						<div style="position: relative; height: 300px;">
							<canvas id="complexityChart"></canvas>
						</div>
						<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
							–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
						</p>
					</div>
				</div>
				
				<!-- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ -->
				<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
					<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
						üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
					</h3>
					<div id="heatmapContainer"></div>
					<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
						–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –∫–∞–∂–¥—ã–º —É—á–∞—â–∏–º—Å—è
					</p>
				</div>
				
				<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ -->
				<div id="additionalCharts"></div>
			`;
			
			console.log('–í–∫–ª–∞–¥–∫–∞ visualization –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
			setTimeout(() => {
				updateVisualization();
				console.log('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
			}, 500);
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
		async function exportAllCharts() {
			try {
				console.log('=== –≠–ö–°–ü–û–†–¢ –ì–†–ê–§–ò–ö–û–í ===');
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞
				showExportMenu();
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤:', error);
				showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤', 'error');
			}
		}

		// –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
		function showExportMenu() {
			const menuHtml = `
				<div class="modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
					<div style="background: white; padding: 25px; border-radius: 10px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
						<h3 style="margin-top: 0; color: #2c3e50;">üì• –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤</h3>
						
						<div style="margin-bottom: 20px;">
							<p style="color: #666; margin-bottom: 15px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</p>
							
							<div class="export-options" style="display: grid; grid-template-columns: 1fr; gap: 10px;">
								<button class="btn btn-primary" onclick="exportChartsAsPNG()" style="text-align: left; padding: 15px;">
									<div style="display: flex; align-items: center;">
										<span style="font-size: 24px; margin-right: 10px;">üñºÔ∏è</span>
										<div>
											<strong>PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</strong><br>
											<small>–û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞</small>
										</div>
									</div>
								</button>
								
								<button class="btn btn-primary" onclick="exportChartsAsHTML()" style="text-align: left; padding: 15px;">
									<div style="display: flex; align-items: center;">
										<span style="font-size: 24px; margin-right: 10px;">üìÑ</span>
										<div>
											<strong>HTML/PDF –æ—Ç—á–µ—Ç</strong><br>
											<small>–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –æ–¥–Ω–æ–º PDF —Ñ–∞–π–ª–µ</small>
										</div>
									</div>
								</button>
								
								<button class="btn btn-primary" onclick="exportChartsAsSingleImage()" style="text-align: left; padding: 15px;">
									<div style="display: flex; align-items: center;">
										<span style="font-size: 24px; margin-right: 10px;">üñºÔ∏è</span>
										<div>
											<strong>–û–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</strong><br>
											<small>–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –æ–¥–Ω–æ–º PNG —Ñ–∞–π–ª–µ</small>
										</div>
									</div>
								</button>
								
								<button class="btn" onclick="copyChartsToClipboard()" style="text-align: left; padding: 15px;">
									<div style="display: flex; align-items: center;">
										<span style="font-size: 24px; margin-right: 10px;">üìã</span>
										<div>
											<strong>–í –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞</strong><br>
											<small>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</small>
										</div>
									</div>
								</button>
							</div>
						</div>
						
						<div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
							<button class="btn" onclick="closeExportMenu()" style="padding: 8px 20px;">
								–û—Ç–º–µ–Ω–∞
							</button>
						</div>
					</div>
				</div>
			`;
			
			document.body.insertAdjacentHTML('beforeend', menuHtml);
		}

		function closeExportMenu() {
			const modal = document.querySelector('.modal');
			if (modal) modal.remove();
		}

		// –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ PNG —Ñ–∞–π–ª—ã
		async function exportChartsAsPNG() {
			closeExportMenu();
			
			const charts = [
				{ id: 'gradesChart', name: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ_–æ—Ü–µ–Ω–æ–∫' },
				{ id: 'solvabilityChart', name: '–†–µ—à–∞–µ–º–æ—Å—Ç—å_–∑–∞–¥–∞–Ω–∏–π' },
				{ id: 'complexityChart', name: '–°–ª–æ–∂–Ω–æ—Å—Ç—å_–∏_—Ä–µ—à–∞–µ–º–æ—Å—Ç—å' }
			];
			
			// –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
			const additionalCharts = ['literacyChart', 'psychologyProfileChart', 'normDistributionChart'];
			additionalCharts.forEach(id => {
				if (document.getElementById(id)) {
					charts.push({ id, name: id });
				}
			});
			
			const exportPromises = charts.map(chart => exportSingleChart(chart.id, chart.name));
			
			try {
				showNotification('–ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç PNG...', 'info');
				
				// –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤
				if (exportPromises.length > 1) {
					const files = await Promise.all(exportPromises);
					await downloadAsZip(files, 'charts_export');
				} else if (exportPromises.length === 1) {
					await exportPromises[0];
				}
				
				showNotification('–≠–∫—Å–ø–æ—Ä—Ç PNG –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ PNG:', error);
				showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ PNG', 'error');
			}
		}

		// –≠–∫—Å–ø–æ—Ä—Ç –æ–¥–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
		async function exportSingleChart(canvasId, fileName) {
			const canvas = document.getElementById(canvasId);
			if (!canvas) {
				console.warn(`Canvas ${canvasId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
				return null;
			}
			
			return new Promise((resolve, reject) => {
				try {
					// –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π canvas —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º
					const tempCanvas = document.createElement('canvas');
					const ctx = tempCanvas.getContext('2d');
					const scale = 2; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤ 2 —Ä–∞–∑–∞
					
					tempCanvas.width = canvas.width * scale;
					tempCanvas.height = canvas.height * scale;
					
					// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
					ctx.scale(scale, scale);
					ctx.imageSmoothingEnabled = true;
					ctx.imageSmoothingQuality = 'high';
					
					// –ö–æ–ø–∏—Ä—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π canvas
					ctx.drawImage(canvas, 0, 0);
					
					// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ blob
					tempCanvas.toBlob(blob => {
						if (!blob) {
							reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'));
							return;
						}
						
						const url = URL.createObjectURL(blob);
						const link = document.createElement('a');
						link.download = `${fileName}_${getTimestamp()}.png`;
						link.href = url;
						link.style.display = 'none';
						
						document.body.appendChild(link);
						link.click();
						
						// –û—á–∏—Å—Ç–∫–∞
						setTimeout(() => {
							document.body.removeChild(link);
							URL.revokeObjectURL(url);
						}, 100);
						
						resolve({ name: link.download, blob });
						
					}, 'image/png', 1.0); // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
				} catch (error) {
					reject(error);
				}
			});
		}

		// –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∫ PDF
		async function exportChartsAsPDF() {
			closeExportMenu();
			
			try {
				showNotification('–°–æ–∑–¥–∞–µ–º PDF –æ—Ç—á–µ—Ç...', 'info');
				
				// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º jsPDF –µ—Å–ª–∏ –Ω–µ—Ç
				if (typeof window.jspdf === 'undefined') {
					await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
					await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
				}
				
				const { jsPDF } = window.jspdf;
				const pdf = new jsPDF('p', 'mm', 'a4');
				let yOffset = 20;
				
				// –ó–∞–≥–æ–ª–æ–≤–æ–∫
				pdf.setFontSize(20);
				pdf.setTextColor(40, 40, 40);
				pdf.text('–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç', 105, yOffset, { align: 'center' });
				
				yOffset += 10;
				
				// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ
				pdf.setFontSize(12);
				pdf.setTextColor(100, 100, 100);
				const testInfo = [
					`–ü—Ä–µ–¥–º–µ—Ç: ${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}`,
					`–ö–ª–∞—Å—Å: ${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}`,
					`–¢–µ–º–∞: ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}`,
					`–î–∞—Ç–∞: ${appData.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}`,
					`–£—á–∞—â–∏—Ö—Å—è: ${appData.students.length}`
				];
				
				testInfo.forEach((line, i) => {
					pdf.text(line, 20, yOffset + (i * 7));
				});
				
				yOffset += testInfo.length * 7 + 10;
				
				// –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∂–¥–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
				const charts = [
					{ id: 'gradesChart', title: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫' },
					{ id: 'solvabilityChart', title: '–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π' },
					{ id: 'complexityChart', title: '–°–≤—è–∑—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏' }
				];
				
				for (const chart of charts) {
					const canvas = document.getElementById(chart.id);
					if (!canvas) continue;
					
					// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ª–∏—Å—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
					if (yOffset > 250) {
						pdf.addPage();
						yOffset = 20;
					}
					
					// –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
					pdf.setFontSize(16);
					pdf.setTextColor(40, 40, 40);
					pdf.text(chart.title, 20, yOffset);
					yOffset += 10;
					
					try {
						// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º canvas –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
						const imageData = canvas.toDataURL('image/png', 1.0);
						
						// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏
						const pageWidth = pdf.internal.pageSize.getWidth();
						const maxWidth = pageWidth - 40; // –û—Ç—Å—Ç—É–ø—ã –ø–æ 20–º–º —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
						const canvasRatio = canvas.width / canvas.height;
						const imgWidth = Math.min(maxWidth, 150);
						const imgHeight = imgWidth / canvasRatio;
						
						// –í—Å—Ç–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
						pdf.addImage(imageData, 'PNG', 20, yOffset, imgWidth, imgHeight);
						yOffset += imgHeight + 15;
						
					} catch (error) {
						console.error(`–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ ${chart.id}:`, error);
						pdf.setFontSize(10);
						pdf.setTextColor(200, 0, 0);
						pdf.text(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞: ${chart.title}`, 20, yOffset);
						yOffset += 10;
					}
				}
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
				if (yOffset > 200) {
					pdf.addPage();
					yOffset = 20;
				}
				
				pdf.setFontSize(16);
				pdf.setTextColor(40, 40, 40);
				pdf.text('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 20, yOffset);
				yOffset += 10;
				
				pdf.setFontSize(11);
				pdf.setTextColor(80, 80, 80);
				
				const stats = generateStatsSummary();
				stats.forEach((stat, i) => {
					if (yOffset > 270) {
						pdf.addPage();
						yOffset = 20;
					}
					pdf.text(stat, 20, yOffset + (i * 6));
				});
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
				pdf.save(`–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π_–æ—Ç—á–µ—Ç_${getTimestamp()}.pdf`);
				
				showNotification('PDF –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è PDF', 'error');
			}
		}

		// –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∫–∞–∫ –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
		async function exportChartsAsSingleImage() {
			closeExportMenu();
			
			try {
				showNotification('–°–æ–∑–¥–∞–µ–º –æ–±—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...', 'info');
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º html2canvas –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
				if (typeof html2canvas === 'undefined') {
					await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
				}
				
				// –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
				const container = document.getElementById('chartsGrid') || 
								 document.querySelector('.charts-grid') ||
								 document.getElementById('visualization');
				
				if (!container) {
					throw new Error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
				}
				
				// –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
				const clone = container.cloneNode(true);
				clone.style.width = container.offsetWidth + 'px';
				clone.style.background = 'white';
				clone.style.padding = '20px';
				clone.style.borderRadius = '10px';
				clone.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
				const title = document.createElement('h2');
				title.textContent = '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏';
				title.style.marginTop = '0';
				title.style.marginBottom = '20px';
				title.style.color = '#2c3e50';
				clone.insertBefore(title, clone.firstChild);
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
				const info = document.createElement('div');
				info.style.marginBottom = '20px';
				info.style.padding = '10px';
				info.style.background = '#f8f9fa';
				info.style.borderRadius = '5px';
				info.style.fontSize = '12px';
				info.innerHTML = `
					<strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'} | 
					<strong>–ö–ª–∞—Å—Å:</strong> ${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'} | 
					<strong>–î–∞—Ç–∞:</strong> ${appData.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'} |
					<strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${appData.students.length}
				`;
				clone.insertBefore(info, clone.children[1]);
				
				// –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
				clone.style.position = 'fixed';
				clone.style.top = '-9999px';
				clone.style.left = '-9999px';
				clone.style.zIndex = '-1000';
				document.body.appendChild(clone);
				
				// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
				const canvas = await html2canvas(clone, {
					scale: 2,
					useCORS: true,
					backgroundColor: '#ffffff',
					logging: false
				});
				
				// –£–¥–∞–ª—è–µ–º –∫–ª–æ–Ω
				document.body.removeChild(clone);
				
				// –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
				const link = document.createElement('a');
				link.download = `–í—Å–µ_–≥—Ä–∞—Ñ–∏–∫–∏_${getTimestamp()}.png`;
				link.href = canvas.toDataURL('image/png', 1.0);
				link.style.display = 'none';
				
				document.body.appendChild(link);
				link.click();
				
				// –û—á–∏—Å—Ç–∫–∞
				setTimeout(() => {
					document.body.removeChild(link);
				}, 100);
				
				showNotification('–û–±—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
				showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
			}
		}

		// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
		async function copyChartsToClipboard() {
			closeExportMenu();
			
			try {
				// –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏–ª–∏ complexityChart –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π
				const canvas = document.getElementById('complexityChart') || 
							  document.getElementById('gradesChart') || 
							  document.getElementById('solvabilityChart');
				
				if (!canvas) {
					showNotification('–ù–µ—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
					return;
				}
				
				// –°–æ–∑–¥–∞–µ–º blob –∏–∑ canvas
				const blob = await new Promise(resolve => {
					canvas.toBlob(resolve, 'image/png', 1.0);
				});
				
				// –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
				await navigator.clipboard.write([
					new ClipboardItem({
						[blob.type]: blob
					})
				]);
				
				showNotification('–ì—Ä–∞—Ñ–∏–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞:', error);
				
				// Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Clipboard API
				const canvas = document.getElementById('complexityChart');
				if (canvas) {
					canvas.toBlob(blob => {
						const item = new ClipboardItem({ [blob.type]: blob });
						navigator.clipboard.write([item])
							.then(() => showNotification('–ì—Ä–∞—Ñ–∏–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success'))
							.catch(() => showNotification('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl+C –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç', 'warning'));
					});
				} else {
					showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫', 'error');
				}
			}
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

		function loadScript(src) {
			return new Promise((resolve, reject) => {
				const script = document.createElement('script');
				script.src = src;
				script.onload = resolve;
				script.onerror = reject;
				document.head.appendChild(script);
			});
		}

		function getTimestamp() {
			const now = new Date();
			return `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}-${now.getMinutes().toString().padStart(2,'0')}`;
		}

		function generateStatsSummary() {
			const totalScores = appData.results.map(scores => 
				scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0)
			);
			const averageScore = totalScores.reduce((a, b) => a + b, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const averagePercentage = (averageScore / maxPossible) * 100;
			
			return [
				`–í—Å–µ–≥–æ —É—á–∞—â–∏—Ö—Å—è: ${appData.students.length}`,
				`–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${averageScore.toFixed(1)} –∏–∑ ${maxPossible}`,
				`–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç: ${averagePercentage.toFixed(1)}%`,
				`–ó–∞–¥–∞–Ω–∏–π: ${appData.tasks.length}`,
				`–£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${[...new Set(appData.tasks.map(t => t.level))].join(', ')}`
			];
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSZip)
		async function downloadAsZip(files, zipName) {
			try {
				// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º JSZip
				if (typeof JSZip === 'undefined') {
					await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js');
				}
				
				const zip = new JSZip();
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –≤ –∞—Ä—Ö–∏–≤
				files.filter(f => f && f.blob).forEach(file => {
					zip.file(file.name, file.blob);
				});
				
				// –î–æ–±–∞–≤–ª—è–µ–º README —Ñ–∞–π–ª
				const readmeText = `
–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏
–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${new Date().toLocaleString()}
–ü—Ä–µ–¥–º–µ—Ç: ${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}
–ö–ª–∞—Å—Å: ${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}
–¢–µ–º–∞: ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
–í—Å–µ–≥–æ —É—á–∞—â–∏—Ö—Å—è: ${appData.students.length}
–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π: ${appData.tasks.length}

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–∞:
${files.map(f => f ? `- ${f.name}` : '').join('\n')}
				`.trim();
				
				zip.file('README.txt', readmeText);
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞—Ä—Ö–∏–≤
				const content = await zip.generateAsync({ type: 'blob' });
				
				// –°–∫–∞—á–∏–≤–∞–µ–º –∞—Ä—Ö–∏–≤
				const link = document.createElement('a');
				link.href = URL.createObjectURL(content);
				link.download = `${zipName}_${getTimestamp()}.zip`;
				link.style.display = 'none';
				
				document.body.appendChild(link);
				link.click();
				
				// –û—á–∏—Å—Ç–∫–∞
				setTimeout(() => {
					document.body.removeChild(link);
					URL.revokeObjectURL(link.href);
				}, 100);
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞', 'error');
				throw error;
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
		function toggleDarkMode() {
			document.body.classList.toggle('dark-mode');
			updateVisualization();
			showNotification('–¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞', 'info');
		}
		function updateComplexityChart() {
			const canvas = document.getElementById('complexityChart');
			if (!canvas) {
				console.error('Canvas complexityChart –Ω–µ –Ω–∞–π–¥–µ–Ω!');
				return;
			}
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
			if (!appData.results || appData.results.length === 0 || !appData.tasks || appData.tasks.length === 0) {
				console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è complexity chart');
				return;
			}
			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏...');
			
			// –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –æ—Ç–ª–∞–¥–∫–æ–π
			const taskStats = [];
			
			for (let i = 0; i < appData.tasks.length; i++) {
				const task = appData.tasks[i];
				const maxScore = parseInt(task.maxScore) || 1;
				const level = parseInt(task.level) || 1;
				
				console.log(`–ó–∞–¥–∞–Ω–∏–µ ${i+1}: —É—Ä–æ–≤–µ–Ω—å=${level}, maxScore=${maxScore}`);
				
				// –°–æ–±–∏—Ä–∞–µ–º –æ—Ü–µ–Ω–∫–∏ –∑–∞ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ
				const scores = [];
				for (let j = 0; j < appData.results.length; j++) {
					const studentScore = appData.results[j][i];
					const normalizedScore = Math.min(parseInt(studentScore) || 0, maxScore);
					scores.push(normalizedScore);
				}
				
				// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
				const totalPossible = maxScore * scores.length;
				const actualTotal = scores.reduce((sum, score) => sum + score, 0);
				const completion = totalPossible > 0 ? (actualTotal / totalPossible) * 100 : 0;
				
				console.log(`  –û—Ü–µ–Ω–∫–∏: ${scores.slice(0, 5).join(', ')}...`);
				console.log(`  –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${completion.toFixed(1)}% (${actualTotal}/${totalPossible})`);
				
				taskStats.push({
					taskNumber: i + 1,
					completion: completion,
					level: level,
					type: task.type || `–ó–∞–¥–∞–Ω–∏–µ ${i+1}`,
					actualTotal: actualTotal,
					totalPossible: totalPossible
				});
			}
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
			taskStats.sort((a, b) => a.level - b.level);
			
			console.log('–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', taskStats);
			
			// –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
			const ctx = canvas.getContext('2d');
			
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
			if (window.complexityChartInstance) {
				window.complexityChartInstance.destroy();
			}
			
			window.complexityChartInstance = new Chart(ctx, {
				type: 'scatter',
				data: {
					datasets: [{
						label: '–ó–∞–¥–∞–Ω–∏—è',
						data: taskStats.map(t => ({
							x: t.level,
							y: t.completion,
							taskNumber: t.taskNumber,
							type: t.type,
							details: `${t.actualTotal}/${t.totalPossible}`
						})),
						backgroundColor: taskStats.map(t => 
							complexityLevels[t.level]?.color || '#3498db'
						),
						pointRadius: 10,
						pointHoverRadius: 12,
						pointBorderWidth: 2,
						pointBorderColor: '#ffffff'
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						x: {
							type: 'linear',
							title: { 
								display: true, 
								text: '–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏',
								font: { size: 14, weight: 'bold' },
								color: '#2c3e50'
							},
							min: 0.5,
							max: 4.5,
							ticks: {
								stepSize: 1,
								callback: function(value) {
									if (Number.isInteger(value)) {
										const level = complexityLevels[value];
										return level ? `${value}. ${level.name}` : value;
									}
									return value;
								},
								font: { size: 12 }
							},
							grid: {
								color: 'rgba(0,0,0,0.05)'
							}
						},
						y: {
							title: { 
								display: true, 
								text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (%)',
								font: { size: 14, weight: 'bold' },
								color: '#2c3e50'
							},
							min: 0,
							max: 100,
							ticks: {
								callback: function(value) {
									return value + '%';
								},
								font: { size: 12 }
							},
							grid: {
								color: 'rgba(0,0,0,0.05)'
							}
						}
					},
					plugins: {
						tooltip: {
							backgroundColor: 'rgba(0, 0, 0, 0.8)',
							titleColor: '#fff',
							bodyColor: '#fff',
							borderColor: '#3498db',
							borderWidth: 1,
							callbacks: {
								title: function(context) {
									const point = context[0].raw;
									return `–ó–∞–¥–∞–Ω–∏–µ ${point.taskNumber}: ${point.type}`;
								},
								label: function(context) {
									const point = context.raw;
									return [
										`–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${complexityLevels[point.x]?.name || point.x}`,
										`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${point.y.toFixed(1)}%`,
										`–ë–∞–ª–ª—ã: ${point.details}`
									];
								}
							}
						},
						legend: { 
							display: false 
						},
						title: {
							display: true,
							text: '–°–≤—è–∑—å —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π',
							font: { size: 16, weight: 'bold' },
							color: '#2c3e50',
							padding: { top: 10, bottom: 30 }
						}
					}
				}
			});
			
			console.log('–ì—Ä–∞—Ñ–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function getGradeColor(grade) {
			const colorMap = {
				'1': '#c0392b', '2': '#e74c3c', '3': '#f39c12',
				'4': '#3498db', '5': '#27ae60',
				'?': '#95a5a6'
			};
			return colorMap[grade] || '#3498db';
		}

		function safeResizeCharts() {
			const charts = [
				window.gradesChartInstance,
				window.complexityChartInstance,
				window.solvabilityChartInstance
			];
			
			charts.forEach(chart => {
				if (chart) {
					try {
						chart.resize();
					} catch (error) {
						console.warn('–û—à–∏–±–∫–∞ —Ä–µ—Å–∞–π–∑–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
					}
				}
			});
		}

		function showNoDataMessage() {
			const containers = [
				document.getElementById('gradesChart')?.parentElement,
				document.getElementById('solvabilityChart')?.parentElement,
				document.getElementById('complexityChart')?.parentElement
			];
			
			containers.forEach(container => {
				if (container) {
					container.innerHTML = `
						<div style="text-align: center; padding: 40px 20px; color: #666;">
							<div style="font-size: 48px; margin-bottom: 10px;">üìä</div>
							<h4 style="margin-bottom: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h4>
							<p style="font-size: 14px;">–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ</p>
						</div>
					`;
				}
			});
		}

		function showChartError() {
			const containers = [
				document.getElementById('gradesChart')?.parentElement,
				document.getElementById('solvabilityChart')?.parentElement,
				document.getElementById('complexityChart')?.parentElement
			];
			
			containers.forEach(container => {
				if (container) {
					container.innerHTML = `
						<div style="text-align: center; padding: 40px 20px; color: #e74c3c;">
							<div style="font-size: 48px; margin-bottom: 10px;">‚ùå</div>
							<h4 style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</h4>
							<p style="font-size: 14px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
						</div>
					`;
				}
			});
		}

		function destroyAllCharts() {
			console.log('=== –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–ï –í–°–ï–• –ì–†–ê–§–ò–ö–û–í ===');
			
			// –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
			const chartInstances = [
				'gradesChartInstance',
				'complexityChartInstance',
				'solvabilityChartInstance',
				'literacyChartInstance',
				'literacyRadarChartInstance',
				'trendChartInstance',
				'psychologyProfileChartInstance',
				'normDistributionChartInstance',
				'radarChartInstance'
			];
			
			// –¢–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ Chart.js –≥—Ä–∞—Ñ–∏–∫–∏
			const chartRegistry = Chart.registry || {};
			
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –≤ window
			chartInstances.forEach(chartName => {
				if (window[chartName] && typeof window[chartName].destroy === 'function') {
					try {
						console.log(`–£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫: ${chartName}`);
						window[chartName].destroy();
						window[chartName] = null;
					} catch (error) {
						console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ ${chartName}:`, error);
					}
				}
			});
			
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ Chart.js
			try {
				const charts = Chart.instances || [];
				console.log(`–í—Å–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ Chart.registry: ${Object.keys(chartRegistry).length}`);
				
				// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ canvas –∏ —Å–º–æ—Ç—Ä–∏–º –µ—Å—Ç—å –ª–∏ —É –Ω–∏—Ö –≥—Ä–∞—Ñ–∏–∫–∏
				document.querySelectorAll('canvas').forEach(canvas => {
					const chartId = canvas.id;
					if (chartId) {
						const chartInstance = Chart.getChart(canvas);
						if (chartInstance) {
							console.log(`–£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –Ω–∞ canvas: ${chartId}`);
							chartInstance.destroy();
						}
					}
				});
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ä–µ–µ—Å—Ç—Ä–∞ Chart.js:', error);
			}
			
			// –û—á–∏—â–∞–µ–º –≤—Å–µ canvas
			document.querySelectorAll('canvas').forEach(canvas => {
				const ctx = canvas.getContext('2d');
				if (ctx) {
					ctx.clearRect(0, 0, canvas.width, canvas.height);
				}
			});
			
			console.log('–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã');
		}
		function destroyAllCharts() {
			console.log('=== –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–ï –í–°–ï–• –ì–†–ê–§–ò–ö–û–í ===');
			
			// –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
			const chartInstances = [
				'gradesChartInstance',
				'complexityChartInstance',
				'solvabilityChartInstance',
				'literacyChartInstance',
				'literacyRadarChartInstance',
				'trendChartInstance',
				'psychologyProfileChartInstance',
				'normDistributionChartInstance',
				'radarChartInstance'
			];
			
			// –¢–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ Chart.js –≥—Ä–∞—Ñ–∏–∫–∏
			const chartRegistry = Chart.registry || {};
			
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –≤ window
			chartInstances.forEach(chartName => {
				if (window[chartName] && typeof window[chartName].destroy === 'function') {
					try {
						console.log(`–£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫: ${chartName}`);
						window[chartName].destroy();
						window[chartName] = null;
					} catch (error) {
						console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ ${chartName}:`, error);
					}
				}
			});
			
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ Chart.js
			try {
				const charts = Chart.instances || [];
				console.log(`–í—Å–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ Chart.registry: ${Object.keys(chartRegistry).length}`);
				
				// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ canvas –∏ —Å–º–æ—Ç—Ä–∏–º –µ—Å—Ç—å –ª–∏ —É –Ω–∏—Ö –≥—Ä–∞—Ñ–∏–∫–∏
				document.querySelectorAll('canvas').forEach(canvas => {
					const chartId = canvas.id;
					if (chartId) {
						const chartInstance = Chart.getChart(canvas);
						if (chartInstance) {
							console.log(`–£–Ω–∏—á—Ç–æ–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –Ω–∞ canvas: ${chartId}`);
							chartInstance.destroy();
						}
					}
				});
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ä–µ–µ—Å—Ç—Ä–∞ Chart.js:', error);
			}
			
			// –û—á–∏—â–∞–µ–º –≤—Å–µ canvas
			document.querySelectorAll('canvas').forEach(canvas => {
				const ctx = canvas.getContext('2d');
				if (ctx) {
					ctx.clearRect(0, 0, canvas.width, canvas.height);
				}
			});
			
			console.log('–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã');
		}

		// –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ resize
		window.addEventListener('resize', debounce(safeResizeCharts, 250));

		function debounce(func, wait) {
			let timeout;
			return function executedFunction(...args) {
				const later = () => {
					clearTimeout(timeout);
					func(...args);
				};
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
			};
		}

		// ==================== –°–ë–†–û–° –î–ê–ù–ù–´–• ====================
		function resetAppData() {
			if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
				try {
					// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º
					const backupKey = `backup_pre_reset_${new Date().toISOString().replace(/[:.]/g, '-')}`;
					localStorage.setItem(backupKey, JSON.stringify({
						data: JSON.parse(JSON.stringify(appData)),
						timestamp: new Date().toLocaleString(),
						reason: 'pre-reset'
					}));
					
					// –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
					localStorage.removeItem('testAnalyticsData');
					
					// –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π
					const backups = Object.keys(localStorage)
						.filter(key => key.startsWith('backup_'))
						.sort()
						.reverse()
						.slice(1);
					
					backups.forEach(key => localStorage.removeItem(key));
					
					// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
					location.reload();
					
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö:', error);
					showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
				}
			}
		}

		function showResetDialog() {
			const html = `
				<h3>‚ö†Ô∏è –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã</h3>
				
				<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4 style="color: #856404;">–í–Ω–∏–º–∞–Ω–∏–µ!</h4>
					<p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç:</p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤</li>
						<li>–°–ø–∏—Å–∫–∏ —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ—Ü–µ–Ω–∫–∏</li>
						<li>–ê–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –æ—Ç—á–µ—Ç—ã</li>
					</ul>
					<p><strong>–î–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</strong></p>
				</div>
				
				<div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4>üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º:</h4>
					<ol style="margin: 10px 0; padding-left: 20px;">
						<li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
						<li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</li>
						<li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</li>
					</ol>
				</div>
				
				<div style="margin-top: 20px;">
					<button class="btn" onclick="exportAppData('json')" style="margin-right: 10px;">
						üíæ –°–Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
					</button>
					<button class="btn btn-danger" onclick="resetAppData()">
						‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
					</button>
				</div>
			`;
			
			showModal('–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã', html);
		}

		
		function safeResizeCharts() {
			// –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∞–¥—Ä–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
			requestAnimationFrame(() => {
				const chartInstances = [
					window.gradesChartInstance,
					window.complexityChartInstance,
					window.solvabilityChartInstance,
					window.trendChartInstance,
					window.psychologyProfileChartInstance,
					window.normDistributionChartInstance,
					window.radarChartInstance
				];
				
				chartInstances.forEach(chart => {
					if (chart) {
						try {
							chart.resize();
						} catch (error) {
							console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
						}
					}
				});
			});
		}
        // –£–ª—É—á—à–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∫–æ—Ä–∏–¥–æ—Ä–∞ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏
        function updateSolvabilityChart() {
            const taskStats = [];
            for (let i = 0; i < appData.tasks.length; i++) {
                const task = appData.tasks[i];
                const maxScore = task.maxScore;
                const actualScores = appData.results.map(student => student[i] || 0);
                const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
                const completion = (actualTotal / (maxScore * appData.results.length)) * 100;
                
                taskStats.push({
                    task: i + 1,
                    completion: completion,
                    level: task.level,
                    type: task.type
                });
            }
            
            const ctx = document.getElementById('solvabilityChart').getContext('2d');
            
            if (window.solvabilityChartInstance) {
                window.solvabilityChartInstance.destroy();
            }
            
            window.solvabilityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: taskStats.map(t => `–ó–∞–¥. ${t.task}`),
                    datasets: [{
                        label: '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
                        data: taskStats.map(t => t.completion),
                        backgroundColor: taskStats.map(t => {
                            if (t.completion >= 90) return '#27ae60';
                            if (t.completion >= 60) return '#2ecc71';
                            if (t.completion >= 30) return '#f39c12';
                            return '#e74c3c';
                        }),
                        borderColor: taskStats.map(t => {
                            if (t.completion >= 90) return '#219a52';
                            if (t.completion >= 60) return '#27ae60';
                            if (t.completion >= 30) return '#e67e22';
                            return '#c0392b';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { 
                                display: true, 
                                text: '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: { size: 12 }
                            },
                            grid: {
                                color: function(context) {
                                    const value = context.tick.value;
                                    if (value === 30 || value === 60 || value === 90) {
                                        return 'rgba(0,0,0,0.3)';
                                    }
                                    return 'rgba(0,0,0,0.1)';
                                },
                                lineWidth: function(context) {
                                    const value = context.tick.value;
                                    if (value === 30 || value === 60 || value === 90) {
                                        return 2;
                                    }
                                    return 1;
                                }
                            }
                        },
                        x: {
                            title: { 
                                display: true, 
                                text: '–ù–æ–º–µ—Ä–∞ –∑–∞–¥–∞–Ω–∏–π',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                font: { size: 12 }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const task = taskStats[context.dataIndex];
                                    return [
                                        `–ó–∞–¥–∞–Ω–∏–µ ${task.task}: ${task.completion.toFixed(1)}%`,
                                        `–¢–∏–ø: ${task.type}`,
                                        `–£—Ä–æ–≤–µ–Ω—å: ${complexityLevels[task.level].name}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
        function updateHeatmap() {
            let html = '<div class="table-container"><table>';
            
            html += '<thead><tr><th>–£—á–∞—â–∏–π—Å—è</th>';
            for (let i = 0; i < appData.tasks.length; i++) {
                html += `<th>${i+1}</th>`;
            }
            html += '<th>‚àë</th><th>–û—Ü–µ–Ω–∫–∞</th></tr></thead><tbody>';
            
            appData.students.forEach((student, studentIndex) => {
                const scores = appData.results[studentIndex] || [];
                const totalScore = scores.reduce((sum, score) => sum + score, 0);
                const grade = calculateGrade(totalScore);
                
                html += `<tr>
                    <td><strong>${student}</strong></td>`;
                
                for (let taskIndex = 0; taskIndex < appData.tasks.length; taskIndex++) {
                    const maxScore = appData.tasks[taskIndex].maxScore;
                    const score = scores[taskIndex] || 0;
                    const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
                    const heatmapClass = `heatmap-${Math.floor(percentage / 20) * 20}`;
                    
                    html += `<td class="heatmap-cell ${heatmapClass}" title="–ó–∞–¥–∞–Ω–∏–µ ${taskIndex+1}: ${score}/${maxScore} (${percentage.toFixed(0)}%)">
                        ${score}
                    </td>`;
                }
                
                html += `<td><strong>${totalScore}</strong></td>
                    <td class="grade-${grade}"><strong>${grade}</strong></td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('heatmapContainer').innerHTML = html;
        }

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
        function updateLiteracyVisualization() {
            let html = '<div class="chart-container">';
            html += `
<div class="chart-container" style="
    height: 450px; 
    min-height: 450px; 
    position: relative; 
    margin: 25px 0; 
    border: 1px solid #e0e0e0; 
    border-radius: 10px; 
    padding: 20px; 
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
">
    <h4 style="margin: 0 0 20px 0; padding: 0; color: #2c3e50;">üìà –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
    <div style="height: 380px; position: relative; background: #f8f9fa; border-radius: 6px; padding: 10px;">
        <canvas id="literacyRadarChart" 
                style="display: block; width: 100%; height: 100%; background: white; border-radius: 4px;"></canvas>
    </div>
</div>
			`;
            
            document.getElementById('specializedCharts').innerHTML = html;
            
            setTimeout(() => {
                initLiteracyRadarChart();
            }, 100);
        }

		// –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π
		function updateMilestoneAnalysis() {
			let html = '<h3 class="section-title">üìÖ –ê–Ω–∞–ª–∏–∑ —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ —Å –Ω–∞—á–∞–ª–∞ —É—á–µ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
			const history = JSON.parse(localStorage.getItem('workHistory') || '[]')
				.filter(item => item.data.test.subject === appData.test.subject && 
							   item.data.test.class === appData.test.class &&
							   item.data.test.workType === 'current') // –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ —Ä–∞–±–æ—Ç—ã
				.sort((a, b) => new Date(a.data.test.testDate) - new Date(b.data.test.testDate));
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateQualityRate().toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${history.length + 1}</div>
						<div class="stat-label">–†–∞–±–æ—Ç–∞ ‚Ññ</div>
					</div>
				</div>
			`;
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–±–æ—Ç—ã
			if (history.length > 0) {
				const currentSummary = generateWorkSummary();
				const previousSummary = history[history.length - 1].summary;
				
				html += `
					<h4>üìà –î–∏–Ω–∞–º–∏–∫–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–∞–±–æ—Ç—ã</h4>
					<div class="comparative-grid">
						<div class="comparative-card">
							<h5>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h5>
							<div class="comparative-value ${currentSummary.avgScore > previousSummary.avgScore ? 'positive' : 'negative'}">
								${currentSummary.avgScore.toFixed(1)} 
								<span class="trend">${currentSummary.avgScore > previousSummary.avgScore ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.avgScore.toFixed(1)}</div>
						</div>
						<div class="comparative-card">
							<h5>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</h5>
							<div class="comparative-value ${currentSummary.successRate > previousSummary.successRate ? 'positive' : 'negative'}">
								${currentSummary.successRate.toFixed(1)}%
								<span class="trend">${currentSummary.successRate > previousSummary.successRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.successRate.toFixed(1)}%</div>
						</div>
						<div class="comparative-card">
							<h5>–ö–∞—á–µ—Å—Ç–≤–æ</h5>
							<div class="comparative-value ${currentSummary.qualityRate > previousSummary.qualityRate ? 'positive' : 'negative'}">
								${currentSummary.qualityRate.toFixed(1)}%
								<span class="trend">${currentSummary.qualityRate > previousSummary.qualityRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.qualityRate.toFixed(1)}%</div>
						</div>
					</div>
				`;
			}
			
			// –ê–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
			html += generateLearningElementsAnalysis();
			
			// –ü—Ä–æ–≥–Ω–æ–∑ –∏—Ç–æ–≥–æ–≤–æ–π —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
			html += generateProgressForecast();
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞
			html += generateMilestoneRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π
		function updateCurrentAnalysis() {
			let html = '<h3 class="section-title">üìù –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${countStudentsByPerformanceLevel('mastered')}</div>
						<div class="stat-label">–û—Å–≤–æ–∏–ª–∏ —Ç–µ–º—É</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${countStudentsByPerformanceLevel('need_help')}</div>
						<div class="stat-label">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å</div>
					</div>
				</div>
			`;
			
			// –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —Ç–µ–º—ã
			html += generateTopicMasteryAnalysis();
			
			// –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
			html += generateCurrentErrorsAnalysis();
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É—Ä–æ–∫–∞
			html += generateLessonRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã
		function updateDiagnosticAnalysis() {
			let html = '<h3 class="section-title">üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateBaselineLevel()}</div>
						<div class="stat-label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${identifyGaps().length}</div>
						<div class="stat-label">–í—ã—è–≤–ª–µ–Ω–æ –ø—Ä–æ–±–µ–ª–æ–≤</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateReadinessLevel()}</div>
						<div class="stat-label">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é</div>
					</div>
				</div>
			`;
			
			// –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤
			html += generateGapsAnalysis();
			
			// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º
			html += generateDiagnosticGroups();
			
			// –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
			html += generateDiagnosticRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

		// –ê–Ω–∞–ª–∏–∑ —É—á–µ–±–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
		function generateLearningElementsAnalysis() {
			let html = '<h4>üìö –ê–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h4>';
			
			const elementStats = {};
			
			appData.tasks.forEach((task, taskIndex) => {
				const element = task.knowledge || '–£—á–µ–±–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç';
				if (!elementStats[element]) {
					elementStats[element] = {
						completion: 0,
						count: 0,
						importance: task.level // –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞–∫ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –≤–∞–∂–Ω–æ—Å—Ç–∏
					};
				}
				
				const completion = calculateTaskCompletion(taskIndex);
				elementStats[element].completion += completion;
				elementStats[element].count++;
			});
			
			// –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
			Object.keys(elementStats).forEach(element => {
				elementStats[element].completion = elementStats[element].completion / elementStats[element].count;
			});
			
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–£—á–µ–±–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç</th><th>–í–∞–∂–Ω–æ—Å—Ç—å</th><th>% –æ—Å–≤–æ–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
			
			Object.entries(elementStats).forEach(([element, stats]) => {
				let status = '';
				let statusIcon = '';
				
				if (stats.completion >= 80) {
					status = '–û—Å–≤–æ–µ–Ω';
					statusIcon = 'üü¢';
				} else if (stats.completion >= 60) {
					status = '–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–≤–æ–µ–Ω';
					statusIcon = 'üü°';
				} else {
					status = '–ù–µ –æ—Å–≤–æ–µ–Ω';
					statusIcon = 'üî¥';
				}
				
				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–∂–Ω–æ—Å—Ç—å
				const importance = stats.importance <= 2 ? '–ë–∞–∑–æ–≤–∞—è' : '–ö–ª—é—á–µ–≤–∞—è';
				
				html += `
					<tr>
						<td>${element}</td>
						<td>${importance}</td>
						<td>${stats.completion.toFixed(1)}%</td>
						<td>${statusIcon} ${status}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div>';
			
			return html;
		}

		// –ü—Ä–æ–≥–Ω–æ–∑ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
		function generateProgressForecast() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			let forecast = '';
			let forecastColor = '';
			
			if (percentage >= 80) {
				forecast = '–í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
				forecastColor = '#27ae60';
			} else if (percentage >= 60) {
				forecast = '–°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ö–æ—Ä–æ—à–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã';
				forecastColor = '#3498db';
			} else if (percentage >= 40) {
				forecast = '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
				forecastColor = '#f39c12';
			} else {
				forecast = '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –Ω–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
				forecastColor = '#e74c3c';
			}
			
			return `
				<div class="recommendation-card">
					<h4>üéØ –ü—Ä–æ–≥–Ω–æ–∑ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h4>
					<p style="color: ${forecastColor}; font-weight: bold;">${forecast}</p>
					<p><strong>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Å–≤–æ–µ–Ω–∏—è:</strong> ${percentage.toFixed(1)}%</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${generateForecastRecommendation(percentage)}</p>
				</div>
			`;
		}

		function generateForecastRecommendation(percentage) {
			if (percentage >= 80) return '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –æ–±—É—á–µ–Ω–∏—è';
			if (percentage >= 60) return '–£—Å–∏–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —Å–ª–æ–∂–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏';
			if (percentage >= 40) return '–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è';
			return '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º';
		}

		// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
		function generateMilestoneRecommendations() {
			return `
				<div class="recommendation-card">
					<h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥</h4>
					<ul>
						<li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π</li>
						<li>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≥—Ä—É–ø–ø —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö</li>
						<li>–í–µ—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏–Ω–∞–º–∏–∫–∏ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</li>
					</ul>
				</div>
			`;
		}

		// –ê–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —Ç–µ–º—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
		function generateTopicMasteryAnalysis() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const avgPercentage = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
			
			let masteryLevel = '';
			if (avgPercentage >= 80) masteryLevel = '–¢–µ–º–∞ —É—Å–≤–æ–µ–Ω–∞';
			else if (avgPercentage >= 60) masteryLevel = '–¢–µ–º–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —É—Å–≤–æ–µ–Ω–∞';
			else if (avgPercentage >= 40) masteryLevel = '–¢–µ–º–∞ —É—Å–≤–æ–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ';
			else masteryLevel = '–¢–µ–º–∞ –Ω–µ —É—Å–≤–æ–µ–Ω–∞';
			
			return `
				<div class="recommendation-card">
					<h4>üìñ –û—Å–≤–æ–µ–Ω–∏–µ —É—á–µ–±–Ω–æ–π —Ç–µ–º—ã</h4>
					<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme}</p>
					<p><strong>–£—Ä–æ–≤–µ–Ω—å –æ—Å–≤–æ–µ–Ω–∏—è:</strong> ${masteryLevel}</p>
					<p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${avgPercentage.toFixed(1)}%</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${generateTopicRecommendation(avgPercentage)}</p>
				</div>
			`;
		}

		function generateTopicRecommendation(percentage) {
			if (percentage >= 80) return '–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º–µ';
			if (percentage >= 60) return '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ —É—Ä–æ–∫ –æ–±–æ–±—â–µ–Ω–∏—è';
			if (percentage >= 40) return '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–∫ –ø–æ —Ç–µ–º–µ';
			return '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ —Ç–µ–º—ã';
		}

		// –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
		function generateCurrentErrorsAnalysis() {
			if (appData.errors.length === 0) {
				return `
					<div class="recommendation-card">
						<h4>‚úÖ –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h4>
						<p>–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã. –£—á–∞—â–∏–µ—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å –∑–∞–¥–∞–Ω–∏—è–º–∏.</p>
					</div>
				`;
			}
			
			const errorStats = {};
			appData.errors.forEach(error => {
				errorStats[error.type] = (errorStats[error.type] || 0) + 1;
			});
			
			const topErrors = Object.entries(errorStats)
				.sort(([,a], [,b]) => b - a)
				.slice(0, 3);
			
			let html = '<div class="recommendation-card">';
			html += '<h4>‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏</h4>';
			html += '<ul>';
			
			topErrors.forEach(([type, count]) => {
				html += `<li>${errorTypes[type].name}: ${count} —Å–ª—É—á–∞–µ–≤</li>`;
			});
			
			html += '</ul>';
			html += '<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong></p>';
			html += '<ul>';
			
			topErrors.forEach(([type, _]) => {
				switch(type) {
					case 'calculation':
						html += '<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –º–∏–Ω—É—Ç–∫—É –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–∫–µ</li>';
						break;
					case 'conceptual':
						html += '<li>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è —Ç–µ–º—ã</li>';
						break;
					case 'attention':
						html += '<li>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏–π</li>';
						break;
					default:
						html += '<li>–ü—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏</li>';
				}
			});
			
			html += '</ul></div>';
			
			return html;
		}
		// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∫–æ–Ω–æ–∫ –¥–ª—è PWA
		function generatePwaIcons() {
		  console.log('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫ PWA...');
		  
		  const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
		  
		  sizes.forEach(size => {
			const canvas = document.createElement('canvas');
			canvas.width = size;
			canvas.height = size;
			const ctx = canvas.getContext('2d');
			
			// –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
			const gradient = ctx.createLinearGradient(0, 0, size, size);
			gradient.addColorStop(0, '#667eea');
			gradient.addColorStop(1, '#764ba2');
			ctx.fillStyle = gradient;
			ctx.fillRect(0, 0, size, size);
			
			// –ë–µ–ª—ã–π –∫—Ä—É–≥
			ctx.fillStyle = 'white';
			ctx.beginPath();
			ctx.arc(size/2, size/2, size/3, 0, Math.PI * 2);
			ctx.fill();
			
			// –ò–∫–æ–Ω–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
			ctx.fillStyle = '#667eea';
			ctx.font = `bold ${size/4}px Arial`;
			ctx.textAlign = 'center';
			ctx.textBaseline = 'middle';
			ctx.fillText('üìä', size/2, size/2);
			
			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
			const link = document.createElement('a');
			link.download = `icon-${size}x${size}.png`;
			link.href = canvas.toDataURL('image/png');
			link.click();
			
			console.log(`–°–æ–∑–¥–∞–Ω–∞ –∏–∫–æ–Ω–∫–∞ ${size}x${size}`);
		  });
		  
		  showNotification('–ò–∫–æ–Ω–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–∫–∞—á–∞–Ω—ã! –ü–æ–ª–æ–∂–∏—Ç–µ –∏—Ö –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞.', 'success');
		}

		// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∫–æ–Ω–æ–∫
		function checkPwaIcons() {
		  const requiredIcons = [
			'icon-72x72.png',
			'icon-96x96.png', 
			'icon-128x128.png',
			'icon-144x144.png',
			'icon-152x152.png',
			'icon-192x192.png',
			'icon-384x384.png',
			'icon-512x512.png'
		  ];
		  
		  let missingIcons = [];
		  
		  requiredIcons.forEach(icon => {
			const img = new Image();
			img.onerror = () => {
			  missingIcons.push(icon);
			  console.warn(`–ò–∫–æ–Ω–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: ${icon}`);
			};
			img.src = icon;
		  });
		  
		  setTimeout(() => {
			if (missingIcons.length > 0) {
			  console.warn('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∫–æ–Ω–∫–∏:', missingIcons);
			  
			  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
			  showModal('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∫–æ–Ω–∫–∏ PWA', `
				<div style="padding: 20px;">
				  <h3>‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç—Å—è –∏–∫–æ–Ω–∫–∏ –¥–ª—è PWA</h3>
				  <p>–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∫–æ–Ω–∫–∏: ${missingIcons.join(', ')}</p>
				  
				  <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4>–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:</h4>
					<ol>
					  <li>–°–æ–∑–¥–∞—Ç—å –∏–∫–æ–Ω–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ)</li>
					  <li>–°–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å <a href="https://www.pwabuilder.com/imageGenerator" target="_blank">PWABuilder</a></li>
					  <li>–°–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ</li>
					</ol>
				  </div>
				  
				  <div style="margin-top: 20px; display: flex; gap: 10px;">
					<button class="btn btn-primary" onclick="generatePwaIcons()">
					  üé® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∫–æ–Ω–∫–∏
					</button>
					<button class="btn" onclick="hideModal()">
					  –ü–æ–∑–∂–µ
					</button>
				  </div>
				</div>
			  `);
			}
		  }, 1000);
		}

		// –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
		function addPwaDebugButton() {
		  const debugBtn = document.createElement('button');
		  debugBtn.innerHTML = 'üõ† PWA Debug';
		  debugBtn.className = 'btn btn-sm btn-outline-warning';
		  debugBtn.style.position = 'fixed';
		  debugBtn.style.top = '10px';
		  debugBtn.style.right = '10px';
		  debugBtn.style.zIndex = '10000';
		  debugBtn.onclick = function() {
			showModal('–û—Ç–ª–∞–¥–∫–∞ PWA', `
			  <div style="padding: 20px;">
				<h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è PWA</h3>
				
				<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
				  <p><strong>–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:</strong> ${checkIfPwaInstalled() ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>
				  <p><strong>Service Worker:</strong> ${'serviceWorker' in navigator ? '‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}</p>
				  <p><strong>–û—Ñ–ª–∞–π–Ω:</strong> ${navigator.onLine ? '‚úÖ –û–Ω–ª–∞–π–Ω' : '‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω'}</p>
				  <p><strong>–ü—Ä–æ–º–ø—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:</strong> ${deferredPrompt ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>
				</div>
				
				<div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
				  <button class="btn" onclick="checkPwaIcons()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∫–æ–Ω–∫–∏</button>
				  <button class="btn" onclick="installPwa()">üì± –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É</button>
				  <button class="btn" onclick="registerServiceWorker()">üîÑ –ü–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å SW</button>
				  <button class="btn" onclick="generatePwaIcons()">üé® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∫–æ–Ω–∫–∏</button>
				  <button class="btn btn-danger" onclick="uninstallPwa()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å PWA</button>
				</div>
			  </div>
			`);
		  };
		  
		  document.body.appendChild(debugBtn);
		}

		// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è PWA (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
		function uninstallPwa() {
		  if (confirm('–£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ PWA? –≠—Ç–æ –æ—á–∏—Å—Ç–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.')) {
			if ('serviceWorker' in navigator) {
			  navigator.serviceWorker.getRegistrations().then(registrations => {
				registrations.forEach(registration => {
				  registration.unregister();
				});
			  });
			}
			
			// –û—á–∏—â–∞–µ–º –∫—ç—à
			caches.keys().then(cacheNames => {
			  cacheNames.forEach(cacheName => {
				caches.delete(cacheName);
			  });
			});
			
			// –û—á–∏—â–∞–µ–º localStorage
			localStorage.clear();
			
			showNotification('PWA —É–¥–∞–ª–µ–Ω–æ. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'warning');
			setTimeout(() => location.reload(), 2000);
		  }
		}


		// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É—Ä–æ–∫–∞
		function generateLessonRecommendations() {
			const needHelpCount = countStudentsByPerformanceLevel('need_help');
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞</h4>';
			
			if (needHelpCount === 0) {
				html += '<p>–í—Å–µ —É—á–∞—â–∏–µ—Å—è —É—Å–ø–µ—à–Ω–æ –æ—Å–≤–æ–∏–ª–∏ —Ç–µ–º—É. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –Ω–æ–≤–æ–º—É –º–∞—Ç–µ—Ä–∏–∞–ª—É.</p>';
			} else if (needHelpCount <= 5) {
				html += `
					<p><strong>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${needHelpCount} —É—á–∞—â–∏–º—Å—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å</p>
					<ul>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –ø–∞—Ä–∞—Ö</li>
						<li>–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏-–ø–æ–º–æ—â–Ω–∏–∫–∏</li>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤</li>
					</ul>
				`;
			} else {
				html += `
					<p><strong>–ì—Ä—É–ø–ø–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${needHelpCount} —É—á–∞—â–∏–º—Å—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å</p>
					<ul>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —É—Ä–æ–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –º–∞–ª—ã—Ö –≥—Ä—É–ø–ø–∞—Ö</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</li>
					</ul>
				`;
			}
			
			html += '</div>';
			return html;
		}

		// –ü–æ–¥—Å—á–µ—Ç —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
		function countStudentsByPerformanceLevel(level) {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentages = totalScores.map(score => (score / maxPossible) * 100);
			
			switch(level) {
				case 'mastered':
					return percentages.filter(p => p >= 70).length;
				case 'need_help':
					return percentages.filter(p => p < 50).length;
				default:
					return 0;
			}
		}

		// –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function calculateBaselineLevel() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			if (percentage >= 70) return '–í—ã—Å–æ–∫–∏–π';
			if (percentage >= 50) return '–°—Ä–µ–¥–Ω–∏–π';
			if (percentage >= 30) return '–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ';
			return '–ù–∏–∑–∫–∏–π';
		}

		function identifyGaps() {
			const gaps = [];
			
			appData.tasks.forEach((task, index) => {
				const completion = calculateTaskCompletion(index);
				if (completion < 50) {
					gaps.push({
						task: task.type,
						completion: completion,
						knowledge: task.knowledge
					});
				}
			});
			
			return gaps;
		}

		function calculateReadinessLevel() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			if (percentage >= 80) return '–ì–æ—Ç–æ–≤';
			if (percentage >= 60) return '–£—Å–ª–æ–≤–Ω–æ –≥–æ—Ç–æ–≤';
			if (percentage >= 40) return '–¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏';
			return '–ù–µ –≥–æ—Ç–æ–≤';
		}

		// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã
		function generateGapsAnalysis() {
			const gaps = identifyGaps();
			
			if (gaps.length === 0) {
				return `
					<div class="recommendation-card">
						<h4>‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤</h4>
						<p>–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã.</p>
					</div>
				`;
			}
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–û–±–ª–∞—Å—Ç—å –∑–Ω–∞–Ω–∏–π</th><th>–ó–∞–¥–∞–Ω–∏–µ</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å</th></tr></thead><tbody>';
			
			gaps.forEach(gap => {
				let criticality = '';
				let color = '';
				
				if (gap.completion < 30) {
					criticality = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';
					color = '#e74c3c';
				} else if (gap.completion < 40) {
					criticality = '–í—ã—Å–æ–∫–∏–π';
					color = '#f39c12';
				} else {
					criticality = '–°—Ä–µ–¥–Ω–∏–π';
					color = '#3498db';
				}
				
				html += `
					<tr>
						<td>${gap.knowledge}</td>
						<td>${gap.task}</td>
						<td>${gap.completion.toFixed(1)}%</td>
						<td style="color: ${color}; font-weight: bold;">${criticality}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div></div>';
			
			return html;
		}

		// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É—á–∞—â–∏—Ö—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
		function generateDiagnosticGroups() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentages = totalScores.map(score => (score / maxPossible) * 100);
			
			const groups = {
				advanced: percentages.filter(p => p >= 80).length,
				proficient: percentages.filter(p => p >= 60 && p < 80).length,
				basic: percentages.filter(p => p >= 40 && p < 60).length,
				below_basic: percentages.filter(p => p < 40).length
			};
			
			return `
				<div class="recommendation-card">
					<h4>üë• –ì—Ä—É–ø–ø—ã —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</h4>
					<div class="kpi-grid">
						<div class="kpi-card" style="border-left-color: #27ae60">
							<div class="kpi-value">${groups.advanced}</div>
							<div class="kpi-label">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</div>
							<small>> 80%</small>
						</div>
						<div class="kpi-card" style="border-left-color: #3498db">
							<div class="kpi-value">${groups.proficient}</div>
							<div class="kpi-label">–ë–∞–∑–æ–≤—ã–π</div>
							<small>60-79%</small>
						</div>
						<div class="kpi-card" style="border-left-color: #f39c12">
							<div class="kpi-value">${groups.basic}</div>
							<div class="kpi-label">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π</div>
							<small>40-59%</small>
						</div>
						<div class="kpi-card" style="border-left-color: #e74c3c">
							<div class="kpi-value">${groups.below_basic}</div>
							<div class="kpi-label">–ù–∏–∑–∫–∏–π</div>
							<small>< 40%</small>
						</div>
					</div>
				</div>
			`;
		}

		// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
		function generateDiagnosticRecommendations() {
			const gaps = identifyGaps();
			const readiness = calculateReadinessLevel();
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üí° –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>';
			
			html += `<p><strong>–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:</strong> ${readiness}</p>`;
			html += `<p><strong>–í—ã—è–≤–ª–µ–Ω–æ –ø—Ä–æ–±–µ–ª–æ–≤:</strong> ${gaps.length}</p>`;
			
			html += '<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</strong></p>';
			html += '<ul>';
			
			if (gaps.length > 5) {
				html += '<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</li>';
				html += '<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</li>';
				html += '<li>–í–µ—Å—Ç–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>';
			} else if (gaps.length > 0) {
				html += '<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ü–µ–ª–µ–≤—ã–µ —É—Ä–æ–∫–∏ –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>';
				html += '<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â—å –≤ –∫–ª–∞—Å—Å–µ</li>';
				html += '<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</li>';
			} else {
				html += '<li>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ</li>';
				html += '<li>–í–∫–ª—é—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è</li>';
				html += '<li>–†–∞–∑–≤–∏–≤–∞—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è</li>';
			}
			
			html += '</ul></div>';
			
			return html;
		}

		// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
		function generateMilestoneSpecializedReport() {
			updateMilestoneAnalysis();
			return `
				<h3>üìÖ –ê–Ω–∞–ª–∏–∑ —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>
				<p>–û—Ü–µ–Ω–∫–∞ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å –∞–Ω–∞–ª–∏–∑–æ–º –¥–∏–Ω–∞–º–∏–∫–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–º –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.</p>
				${document.getElementById('specializedAnalysis').innerHTML}
			`;
		}

		function generateCurrentSpecializedReport() {
			updateCurrentAnalysis();
			return `
				<h3>üìù –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>
				<p>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω–æ–π —Ç–µ–º—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ —É—Ä–æ–∫–µ.</p>
				${document.getElementById('specializedAnalysis').innerHTML}
			`;
		}

		function generateDiagnosticSpecializedReport() {
			updateDiagnosticAnalysis();
			return `
				<h3>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
				<p>–í—ã—è–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –∑–Ω–∞–Ω–∏—è—Ö –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π.</p>
				${document.getElementById('specializedAnalysis').innerHTML}
			`;
		}

		// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é exportSpecializedReport()
		function exportSpecializedReport() {
			const workType = appData.test.workType;
			let reportTitle = "";
			let reportDescription = "";
			let specializedContent = "";
			
			switch(workType) {
				case 'vpr': 
					updateVPRAnalysis();
					specializedContent = generateVPRSpecializedReport();
					reportTitle = "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –í–ü–†";
					reportDescription = "–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã";
					break;
				case 'oge': 
					updateGIAnalysis();
					specializedContent = generateOGESpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –û–ì–≠";
					reportDescription = "–û—Ç—á–µ—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –ø–æ –∫–æ–¥–∞–º –ö–≠–° –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —ç–∫–∑–∞–º–µ–Ω—É";
					break;
				case 'ege': 
					updateGIAnalysis();
					specializedContent = generateEGESpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ï–ì–≠";
					reportDescription = "–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É";
					break;
				case 'func_literacy': 
					updateLiteracyAnalysis();
					specializedContent = generateLiteracySpecializedReport();
					reportTitle = "–û—Ç—á–µ—Ç –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏";
					reportDescription = "–ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è";
					break;
				case 'final':
					updateFinalAnalysis();
					specializedContent = generateFinalSpecializedReport();
					reportTitle = "–ò—Ç–æ–≥–æ–≤—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑";
					reportDescription = "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥";
					break;
				case 'milestone':
					updateMilestoneAnalysis();
					specializedContent = generateMilestoneSpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã";
					reportDescription = "–û—Ü–µ–Ω–∫–∞ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥";
					break;
				case 'current':
					updateCurrentAnalysis();
					specializedContent = generateCurrentSpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã";
					reportDescription = "–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω–æ–π —Ç–µ–º—ã";
					break;
				case 'diagnostic':
					updateDiagnosticAnalysis();
					specializedContent = generateDiagnosticSpecializedReport();
					reportTitle = "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑";
					reportDescription = "–í—ã—è–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è";
					break;
				case 'psychology': 
					specializedContent = generatePsychologyPrintReport();
					reportTitle = "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ";
					reportDescription = "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏";
					break;
				default: 
					specializedContent = generateStandardSpecializedReport();
					reportTitle = "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑";
					reportDescription = "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤";
			}
			
			const fullReport = generateSpecializedReportHTML(reportTitle, reportDescription, specializedContent);
			
			const blob = new Blob([fullReport], { type: 'text/html' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `${reportTitle.toLowerCase().replace(/\s+/g, '_')}_${new Date().toLocaleDateString()}.html`;
			a.click();
			URL.revokeObjectURL(url);
			showNotification("–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", "success");
		}

		function initLiteracyRadarChart() {
		    const canvas = document.getElementById('literacyRadarChart');
			const container = canvas.parentElement;
			
			// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—è
			canvas.width = container.offsetWidth;
			canvas.height = container.offsetHeight - 50; // –ú–∏–Ω—É—Å –º–µ—Å—Ç–æ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
			
			if (window.literacyRadarChartInstance) {
				window.literacyRadarChartInstance.destroy();
			}
			
			const literacyStats = {};
			Object.keys(functionalLiteracyTypes).forEach(type => {
				literacyStats[type] = { total: 0, max: 0, count: 0 };
			});
			
			appData.tasks.forEach((task, taskIndex) => {
				if (task.literacyType && literacyStats[task.literacyType]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					literacyStats[task.literacyType].total += actualTotal;
					literacyStats[task.literacyType].max += maxScore * appData.results.length;
				}
			});
			
			const ctx = document.getElementById('literacyRadarChart').getContext('2d');
			const labels = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].name);
			const data = Object.values(literacyStats).map(stats => 
				stats.max > 0 ? (stats.total / stats.max) * 100 : 0
			);
			const colors = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].color);
			
			window.literacyRadarChartInstance = new Chart(ctx, {
				type: 'radar',
				data: {
					labels: labels,
					datasets: [{
						label: '–£—Ä–æ–≤–µ–Ω—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (%)',
						data: data,
						backgroundColor: 'rgba(54, 162, 235, 0.2)',
						borderColor: 'rgba(54, 162, 235, 0.8)',
						pointBackgroundColor: colors,
						pointBorderColor: '#fff',
						pointHoverBackgroundColor: '#fff',
						pointHoverBorderColor: colors,
						pointRadius: 4,
						pointBorderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						r: {
							beginAtZero: true,
							max: 100,
							ticks: {
								callback: function(value) {
									return value + '%';
								},
								stepSize: 20
							},
							pointLabels: {
								font: {
									size: 11
								}
							}
						}
					},
					plugins: {
						legend: {
							display: true,
							position: 'top'
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									return `${context.label}: ${context.raw.toFixed(1)}%`;
								}
							}
						}
					}
				}
			});
			// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Ñ–ª–æ—É –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ layout
			setTimeout(() => {
				const chartContainer = document.querySelector('.chart-container');
				if (chartContainer) {
					chartContainer.style.display = 'none';
					chartContainer.offsetHeight; // trigger reflow
					chartContainer.style.display = 'block';
				}
			}, 100);
		}

        // ==================== –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ====================

        function updateRecommendations() {
            updatePrintHeaders();
            updateKeyConclusions();
            updateCorrectionPlan();
            updateNextSteps();
        }

        function updatePrintHeaders() {
            document.getElementById('printSubjectClass').textContent = `${appData.test.subject}, ${appData.test.class}`;
            document.getElementById('printTheme').textContent = appData.test.theme;
            document.getElementById('printDate').textContent = new Date(appData.test.testDate).toLocaleDateString();
        }

        // –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã
        function updateKeyConclusions() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            
            let html = '<div class="recommendation-card">';
            
            if (successRate >= 80) {
                html += '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
                html += '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å —Ä–∞–±–æ—Ç–æ–π. ';
            } else if (successRate >= 60) {
                html += '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
                html += '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ —É—á–∞—â–∏—Ö—Å—è. ';
            } else {
                html += '<strong>üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
                html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç–æ–¥—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ. ';
            }
            
            const difficultTasks = [];
            appData.tasks.forEach((task, index) => {
                const completion = calculateTaskCompletion(index);
                if (completion < 50) {
                    difficultTasks.push({ task: index + 1, completion: completion, type: task.type });
                }
            });
            
            if (difficultTasks.length > 0) {
                html += `<br><strong>–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:</strong> `;
                html += difficultTasks.map(t => `‚Ññ${t.task} (${t.completion.toFixed(1)}%)`).join(', ');
            }
            
            if (appData.errors.length > 0) {
                const topErrorType = getTopErrorType();
                html += `<br><strong>–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–µ –æ—à–∏–±–∫–∏:</strong> ${errorTypes[topErrorType].name}`;
            }
            
            const workType = appData.test.workType;
            if (workType === 'vpr') {
                html += `<br><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –í–ü–†:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–µ–ª–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π.`;
            } else if (workType === 'func_literacy') {
                html += `<br><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏:</strong> –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —É–º–µ–Ω–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.`;
            } else if (workType === 'oge' || workType === 'ege') {
                html += `<br><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ì–ò–ê:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ —ç–∫–∑–∞–º–µ–Ω—É.`;
            }
            
            html += '</div>';
            document.getElementById('keyConclusions').innerHTML = html;
        }

        // –ü–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
        function updateCorrectionPlan() {
            let html = '';
            
            html += '<div class="sub-section"><h4>üë®‚Äçüè´ –î–ª—è –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞:</h4>';
            html += '<div class="recommendation-card">';
            html += '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏<br>';
            html += '‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º<br>';
            html += '‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π<br>';
            html += '‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—é —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º';
            
            const workType = appData.test.workType;
            if (workType === 'vpr') {
                html += '<br>‚Ä¢ –ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –í–ü–†';
            } else if (workType === 'func_literacy') {
                html += '<br>‚Ä¢ –í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏';
                html += '<br>‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π';
            } else if (workType === 'oge' || workType === 'ege') {
                html += '<br>‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ì–ò–ê';
                html += '<br>‚Ä¢ –†–∞–±–æ—Ç–∞ —Å –∫–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π';
            }
            
            html += '</div></div>';
            
            const unsatisfactory = appData.results.map((scores, index) => ({
                name: appData.students[index],
                score: scores.reduce((sum, score) => sum + score, 0),
                grade: calculateGrade(scores.reduce((sum, score) => sum + score, 0))
            })).filter(s => s.grade === 2);
            
            if (unsatisfactory.length > 0) {
                html += '<div class="sub-section"><h4>üî¥ –î–ª—è —É—á–∞—â–∏—Ö—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:</h4>';
                unsatisfactory.forEach(student => {
                    html += `<div class="recommendation-card">
                        <strong>${student.name}</strong><br>
                        ‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏<br>
                        ‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–µ–º<br>
                        ‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è<br>
                        ‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
                    </div>`;
                });
                html += '</div>';
            }
            
            document.getElementById('correctionPlan').innerHTML = html;
        }

        // –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏
        function updateNextSteps() {
            let html = `
                <div class="recommendation-card">
                    <strong>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</strong><br>
                    ‚Ä¢ –°—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏: 1 –Ω–µ–¥–µ–ª—è<br>
                    ‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: –ø–æ –≥—Ä–∞—Ñ–∏–∫—É<br>
                    ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π: –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –¥–Ω–µ–π<br>
                    ‚Ä¢ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å: —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏<br>
                    ‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ö–¢–ü: –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º—ã
            `;
            
            const workType = appData.test.workType;
            if (workType === 'vpr') {
                html += '<br>‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏';
                html += '<br>‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –¥–µ—Ñ–∏—Ü–∏—Ç–æ–≤';
            } else if (workType === 'func_literacy') {
                html += '<br>‚Ä¢ –í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫';
                html += '<br>‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏';
            } else if (workType === 'oge' || workType === 'ege') {
                html += '<br>‚Ä¢ –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤';
                html += '<br>‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–±–Ω—ã—Ö —ç–∫–∑–∞–º–µ–Ω–∞—Ö';
            }
            
            html += '</div>';
            document.getElementById('nextSteps').innerHTML = html;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function calculateTaskCompletion(taskIndex) {
			try {
				if (!appData.tasks || !appData.results || appData.results.length === 0) {
					return 0;
				}
				
				const task = appData.tasks[taskIndex];
				if (!task || typeof task.maxScore !== 'number' || task.maxScore <= 0) {
					return 0;
				}
				
				const maxScore = task.maxScore;
				const actualScores = appData.results.map(student => 
					student && student[taskIndex] !== undefined ? student[taskIndex] : 0
				);
				const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
				const totalPossible = maxScore * appData.results.length;
				
				return totalPossible > 0 ? (actualTotal / totalPossible) * 100 : 0;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error, taskIndex);
				return 0;
			}
		}

        function getTopErrorType() {
            const errorStats = {};
            appData.errors.forEach(error => {
                errorStats[error.type] = (errorStats[error.type] || 0) + 1;
            });
            return Object.entries(errorStats).sort(([,a], [,b]) => b - a)[0][0];
        }

        // ==================== –≠–ö–°–ü–û–†–¢ –ò –ü–ï–ß–ê–¢–¨ ====================

		function generateFullReportForPrint() {
			if (!appData.test.subject && !appData.test.class) {
				return `
					<div class="header">
						<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
						<p>–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—Ç—ã –∏ –≤–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.</p>
					</div>
				`;
			}

			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.length > 0 ? totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length : 0;
			const successRate = totalScores.length > 0 ? (grades.filter(grade => grade >= 3).length / grades.length * 100) : 0;
			const qualityRate = totalScores.length > 0 ? (grades.filter(grade => grade >= 4).length / grades.length * 100) : 0;
			
			const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
			grades.forEach(grade => gradeCounts[grade]++);

			const taskAnalysis = appData.tasks.map((task, index) => {
				const completion = calculateTaskCompletion(index);
				let zone = '';
				let zoneColor = '';
				if (completion >= 90) { zone = '–û—Ç–ª–∏—á–Ω–∞—è'; zoneColor = '#27ae60'; }
				else if (completion >= 60) { zone = '–ó–µ–ª–µ–Ω–∞—è'; zoneColor = '#2ecc71'; }
				else if (completion >= 30) { zone = '–ñ–µ–ª—Ç–∞—è'; zoneColor = '#f39c12'; }
				else { zone = '–ö—Ä–∞—Å–Ω–∞—è'; zoneColor = '#e74c3c'; }
				
				return { task, index, completion, zone, zoneColor };
			});

			const levelAnalysis = {};
			Object.keys(complexityLevels).forEach(level => {
				const levelTasks = appData.tasks.filter(task => task.level == level);
				if (levelTasks.length > 0) {
					let totalMaxScore = 0;
					let totalActualScore = 0;
					
					levelTasks.forEach(task => {
						const taskIndex = appData.tasks.indexOf(task);
						const maxScore = task.maxScore;
						const actualScores = appData.results.map(student => student[taskIndex] || 0);
						const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
						
						totalMaxScore += maxScore * appData.results.length;
						totalActualScore += actualTotal;
					});
					
					const completion = totalMaxScore > 0 ? (totalActualScore / totalMaxScore) * 100 : 0;
					levelAnalysis[level] = { completion, count: levelTasks.length };
				}
			});

			let reportContent = `
				<div class="header">
					<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
					<h2>${appData.test.subject || '–ü—Ä–µ–¥–º–µ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω'}, ${appData.test.class || '–ö–ª–∞—Å—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</h2>
					<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'} | <strong>–î–∞—Ç–∞:</strong> ${appData.test.testDate ? new Date(appData.test.testDate).toLocaleDateString() : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
					<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType]?.name || appData.test.workType}</p>
				</div>

				<div class="section">
					<h3 class="section-title">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
					<div class="stats-grid">
						<div class="stat-card">
							<div class="stat-value">${avgScore.toFixed(1)}</div>
							<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${successRate.toFixed(1)}%</div>
							<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${qualityRate.toFixed(1)}%</div>
							<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${appData.students.length}</div>
							<div class="stat-label">–£—á–∞—â–∏—Ö—Å—è</div>
						</div>
					</div>
					
					<div class="kpi-grid">
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[5]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 5</div>
						</div>
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[4]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 4</div>
						</div>
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[3]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 3</div>
						</div>
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[2]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 2</div>
						</div>
					</div>
				</div>

				<div class="section print-break">
					<h3 class="section-title">üéØ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π</h3>
					${taskAnalysis.length > 0 ? `
						<table>
							<thead>
								<tr>
									<th>‚Ññ</th>
									<th>–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è</th>
									<th>–£—Ä–æ–≤–µ–Ω—å</th>
									<th>–ú–∞–∫—Å. –±–∞–ª–ª</th>
									<th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
									<th>–ó–æ–Ω–∞</th>
								</tr>
							</thead>
							<tbody>
								${taskAnalysis.map(item => `
									<tr>
										<td><strong>${item.index + 1}</strong></td>
										<td>${item.task.type}</td>
										<td>${item.task.level}. ${complexityLevels[item.task.level]?.name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
										<td>${item.task.maxScore}</td>
										<td>${item.completion.toFixed(1)}%</td>
										<td style="color: ${item.zoneColor}; font-weight: bold;">${item.zone}</td>
									</tr>
								`).join('')}
							</tbody>
						</table>
					` : '<p>–ó–∞–¥–∞–Ω–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>'}
				</div>

				<div class="section">
					<h3 class="section-title">üìà –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
					${Object.keys(levelAnalysis).length > 0 ? `
						<table>
							<thead>
								<tr>
									<th>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</th>
									<th>–ö–æ–ª-–≤–æ –∑–∞–¥–∞–Ω–∏–π</th>
									<th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
									<th>–ê–Ω–∞–ª–∏–∑</th>
								</tr>
							</thead>
							<tbody>
								${Object.entries(levelAnalysis).map(([level, data]) => {
									let analysis = "";
									if (data.completion >= 80) analysis = "üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
									else if (data.completion >= 60) analysis = "üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
									else if (data.completion >= 40) analysis = "üü† –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è";
									else analysis = "üî¥ –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã";
									
									return `
										<tr>
											<td><strong>${level}. ${complexityLevels[level]?.name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</strong></td>
											<td>${data.count}</td>
											<td>${data.completion.toFixed(1)}%</td>
											<td>${analysis}</td>
										</tr>
									`;
								}).join('')}
							</tbody>
						</table>
					` : '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>'}
				</div>
			`;
			reportContent += generateCriteriaSummary();
			// –î–û–ë–ê–í–õ–Ø–ï–ú –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –ï–°–õ–ò –≠–¢–û –ü–°–ò–•–û–õ–û–ì–ò–Ø
			if (appData.test.workType === 'psychology') {
				reportContent += generatePsychologyPrintReport();
			}

			reportContent += `
				<div class="section print-break">
					<h3 class="section-title">üí° –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
					<div class="recommendation-card">
						${generateKeyConclusionsText()}
					</div>
					
					<h4 style="margin-top: 20px;">üìÖ –ü–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:</h4>
					<div class="recommendation-card">
						<ul style="margin: 0; padding-left: 20px;">
							<li>–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏</li>
							<li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
							<li>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>
							<li>–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ä–∞–±–æ—Ç—ã</li>
							<li>–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏</li>
						</ul>
					</div>
				</div>

				<div class="section small-text text-center">
					<p><em>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()} —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</em></p>
				</div>
			`;
			
			return reportContent;
		}		
        
		// –î–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤
		function addCriteriaPresets() {
			return `
				<div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
					<h5 style="margin: 0 0 10px 0; font-size: 14px;">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</h5>
					<div style="display: flex; flex-wrap: wrap; gap: 5px;">
						<button class="btn btn-sm" onclick="applyPreset('standard_5')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('five_point')" 
								style="font-size: 12px; padding: 5px 10px;">
							1Ô∏è‚É£ –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('vpr_percent')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìù –í–ü–† (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('ege_points')" 
								style="font-size: 12px; padding: 5px 10px;">
							üéì –ï–ì–≠ (–±–∞–ª–ª—ã)
						</button>
					</div>
					<small style="display: block; margin-top: 8px; color: #666;">
						–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞ —Å–±—Ä–æ—Å–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
					</small>
				</div>
			`;
		}
		function addCriteriaPresets() {
			return `
				<div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
					<h5 style="margin: 0 0 10px 0; font-size: 14px;">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</h5>
					<div style="display: flex; flex-wrap: wrap; gap: 5px;">
						<button class="btn btn-sm" onclick="applyPreset('standard_5')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('five_point')" 
								style="font-size: 12px; padding: 5px 10px;">
							1Ô∏è‚É£ –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('vpr_percent')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìù –í–ü–† (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('ege_points')" 
								style="font-size: 12px; padding: 5px 10px;">
							üéì –ï–ì–≠ (–±–∞–ª–ª—ã)
						</button>
					</div>
					<small style="display: block; margin-top: 8px; color: #666;">
						–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞ —Å–±—Ä–æ—Å–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
					</small>
				</div>
			`;
		}

		function applyPreset(presetName) {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			switch(presetName) {
				case 'standard_5':
					appData.test.criteriaType = 'points';
					appData.test.criteriaSystem = 'standard';
					appData.test.criteriaCount = 4;
					appData.test.criteria = {
						1: { min: 0, max: Math.round(maxPossible * 0.49) },
						2: { min: Math.round(maxPossible * 0.5), max: Math.round(maxPossible * 0.69) },
						3: { min: Math.round(maxPossible * 0.7), max: Math.round(maxPossible * 0.84) },
						4: { min: Math.round(maxPossible * 0.85), max: maxPossible }
					};
					break;
					
				case 'five_point':
					appData.test.criteriaType = 'points';
					appData.test.criteriaSystem = 'five_point';
					appData.test.criteriaCount = 5;
					appData.test.criteria = {
						1: { min: 0, max: Math.round(maxPossible * 0.2) },
						2: { min: Math.round(maxPossible * 0.21), max: Math.round(maxPossible * 0.4) },
						3: { min: Math.round(maxPossible * 0.41), max: Math.round(maxPossible * 0.6) },
						4: { min: Math.round(maxPossible * 0.61), max: Math.round(maxPossible * 0.8) },
						5: { min: Math.round(maxPossible * 0.81), max: maxPossible }
					};
					break;
					
				case 'vpr_percent':
					appData.test.criteriaType = 'percentage';
					appData.test.criteriaSystem = 'standard';
					appData.test.criteriaCount = 4;
					appData.test.criteria = {
						1: { min: 0, max: 44 },
						2: { min: 45, max: 64 },
						3: { min: 65, max: 84 },
						4: { min: 85, max: 100 }
					};
					break;
					
				case 'psychology_levels':
					appData.test.criteriaType = 'percentage';
					appData.test.criteriaSystem = 'custom';
					appData.test.criteriaCount = 5;
					appData.test.customCriteria = [
						{
							name: "–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π",
							min: 0,
							max: 29,
							description: "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ –±–∞–∑–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤",
							color: "#c0392b"
						},
						{
							name: "–ù–∏–∑–∫–∏–π",
							min: 30,
							max: 49,
							description: "–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
							color: "#e74c3c"
						},
						{
							name: "–°—Ä–µ–¥–Ω–∏–π",
							min: 50,
							max: 69,
							description: "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ",
							color: "#f39c12"
						},
						{
							name: "–í—ã—Å–æ–∫–∏–π",
							min: 70,
							max: 84,
							description: "–•–æ—Ä–æ—à–æ —Ä–∞–∑–≤–∏—Ç—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
							color: "#3498db"
						},
						{
							name: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π",
							min: 85,
							max: 100,
							description: "–í—ã–¥–∞—é—â–∏–µ—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
							color: "#27ae60"
						}
					];
					appData.test.criteria = {
						1: { min: 0, max: 29 },
						2: { min: 30, max: 49 },
						3: { min: 50, max: 69 },
						4: { min: 70, max: 84 },
						5: { min: 85, max: 100 }
					};
					break;
			}
			
			renderCriteriaSettings();
			showNotification(`–ü—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–µ—Å–µ—Ç: ${presetName}`, "success");
		}
		
		function generatePsychologyPrintReport() {
			if (appData.test.workType !== 'psychology') return '';
			
			const settings = appData.test.psychologySettings;
			const levels = settings?.levels || [];
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			const levelCounts = {};
			levels.forEach(level => {
				levelCounts[level.name] = totalScores.filter(score => 
					score >= level.min && score <= level.max
				).length;
			});
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º
			const dimensions = settings?.dimensions || [];
			const dimensionStats = [];
			
			dimensions.forEach(dimension => {
				const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
				if (dimensionTasks.length === 0) return;
				
				let totalScore = 0;
				let totalMax = 0;
				
				dimensionTasks.forEach(task => {
					const taskIndex = appData.tasks.indexOf(task);
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					totalScore += actualTotal;
					totalMax += maxScore * appData.results.length;
				});
				
				const percentage = totalMax > 0 ? (totalScore / totalMax) * 100 : 0;
				dimensionStats.push({
					name: dimension.name,
					percentage: percentage,
					description: dimension.description || ''
				});
			});
			
			// –ù–∞—Ö–æ–¥–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥—Ä—É–ø–ø—ã
			const groupFeatures = [];
			if (appData.psychologyFeatures && appData.psychologyFeatures.length > 0) {
				const featureCounts = {};
				appData.psychologyFeatures.forEach(feature => {
					featureCounts[feature.name] = (featureCounts[feature.name] || 0) + 1;
				});
				
				// –ë–µ—Ä–µ–º 3 —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
				Object.entries(featureCounts)
					.sort(([,a], [,b]) => b - a)
					.slice(0, 3)
					.forEach(([name, count]) => {
						const percentage = (count / appData.students.length) * 100;
						if (percentage >= 20) { // –ï—Å–ª–∏ —É 20% –∏ –±–æ–ª–µ–µ —É—á–∞—â–∏—Ö—Å—è
							groupFeatures.push(`${name} (${count} —á–µ–ª., ${percentage.toFixed(0)}%)`);
						}
					});
			}
			
			return `
				<div class="section print-break">
					<h3 class="section-title">üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
					
					<div class="recommendation-card">
						<h4>üìã –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</h4>
						<p><strong>–ú–µ—Ç–æ–¥–∏–∫–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞:</strong> ${settings?.normGroup || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞:</strong> ${settings?.reliability ? settings.reliability.toFixed(2) : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ú–µ—Ç–æ–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏:</strong> ${settings?.interpretationMethod === 'normative' ? '–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–æ–π)' : 
																   settings?.interpretationMethod === 'ipsative' ? '–ò–ø—Å–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–∞–º–∏–º —Å–æ–±–æ–π)' : 
																   settings?.interpretationMethod === 'criterion' ? '–ö—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏)' : '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
					</div>
					
					<h4>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º —Ä–∞–∑–≤–∏—Ç–∏—è</h4>
					<table>
						<thead>
							<tr>
								<th>–£—Ä–æ–≤–µ–Ω—å</th>
								<th>–î–∏–∞–ø–∞–∑–æ–Ω</th>
								<th>–ö–æ–ª-–≤–æ —É—á–∞—â–∏—Ö—Å—è</th>
								<th>% –æ—Ç –≥—Ä—É–ø–ø—ã</th>
								<th>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</th>
							</tr>
						</thead>
						<tbody>
							${levels.map(level => {
								const count = levelCounts[level.name] || 0;
								const percentage = (count / appData.students.length) * 100;
								return `
									<tr>
										<td style="color: ${level.color}; font-weight: bold;">${level.name}</td>
										<td>${level.min}-${level.max}%</td>
										<td>${count}</td>
										<td>${percentage.toFixed(1)}%</td>
										<td>${level.interpretation || ''}</td>
									</tr>
								`;
							}).join('')}
						</tbody>
					</table>
					
					${dimensionStats.length > 0 ? `
						<h4 style="margin-top: 20px;">üéØ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º</h4>
						<table>
							<thead>
								<tr>
									<th>–ò–∑–º–µ—Ä–µ–Ω–∏–µ</th>
									<th>–£—Ä–æ–≤–µ–Ω—å –≥—Ä—É–ø–ø—ã</th>
									<th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
									<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
								</tr>
							</thead>
							<tbody>
								${dimensionStats.map(dim => {
									let levelText = '';
									let levelColor = '';
									
									if (dim.percentage >= 85) {
										levelText = '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π';
										levelColor = '#27ae60';
									} else if (dim.percentage >= 70) {
										levelText = '–í—ã—Å–æ–∫–∏–π';
										levelColor = '#3498db';
									} else if (dim.percentage >= 50) {
										levelText = '–°—Ä–µ–¥–Ω–∏–π';
										levelColor = '#f39c12';
									} else if (dim.percentage >= 30) {
										levelText = '–ù–∏–∑–∫–∏–π';
										levelColor = '#e74c3c';
									} else {
										levelText = '–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π';
										levelColor = '#c0392b';
									}
									
									return `
										<tr>
											<td><strong>${dim.name}</strong></td>
											<td style="color: ${levelColor}; font-weight: bold;">${levelText}</td>
											<td>${dim.percentage.toFixed(1)}%</td>
											<td><small>${dim.description}</small></td>
										</tr>
									`;
								}).join('')}
							</tbody>
						</table>
					` : ''}
					
					${groupFeatures.length > 0 ? `
						<div class="recommendation-card" style="margin-top: 20px;">
							<h4>üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–æ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
							<ul style="margin: 0; padding-left: 20px;">
								${groupFeatures.map(feature => `<li>${feature}</li>`).join('')}
							</ul>
						</div>
					` : ''}
					
					<div class="recommendation-card" style="margin-top: 20px;">
						<h4>üí° –ü—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
						${generatePsychologyRecommendationsText()}
					</div>
				</div>
			`;
		}

		function generatePsychologyRecommendationsText() {
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			let recommendations = '';
			
			if (avgScore >= 70) {
				recommendations = `
					<p><strong>–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è –≥—Ä—É–ø–ø—ã.</strong> –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong></p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å</li>
						<li>–í–∫–ª—é—á–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è</li>
						<li>–†–∞–∑–≤–∏–≤–∞—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∏ –ª–∏–¥–µ—Ä—Å–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≥—Ä—É–ø–ø—ã –¥–ª—è –ø–æ–º–æ—â–∏ –æ—Ç—Å—Ç–∞—é—â–∏–º</li>
					</ul>
				`;
			} else if (avgScore >= 50) {
				recommendations = `
					<p><strong>–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è –≥—Ä—É–ø–ø—ã.</strong> –£—á–∞—â–∏–µ—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ, –Ω–æ –µ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤—ã –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è.</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong></p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∑–∞–Ω—è—Ç–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –º–∞–ª—ã—Ö –≥—Ä—É–ø–ø–∞—Ö</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</li>
						<li>–†–∞–∑–≤–∏–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏ —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</li>
					</ul>
				`;
			} else {
				recommendations = `
					<p><strong>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ.</strong> –í—ã—è–≤–ª–µ–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —É –≥—Ä—É–ø–ø—ã.</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong></p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</li>
						<li>–ü—Ä–∏–≤–ª–µ—á—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∫ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —â–∞–¥—è—â–∏–µ –º–µ—Ç–æ–¥—ã –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</li>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü</li>
					</ul>
				`;
			}
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤
			const individualRisks = [];
			totalScores.forEach((score, index) => {
				if (score < 30) {
					individualRisks.push(appData.students[index]);
				}
			});
			
			if (individualRisks.length > 0) {
				recommendations += `
					<p><strong>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${individualRisks.length} —É—á–∞—â–∏–º—Å—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ (${individualRisks.slice(0, 3).join(', ')}${individualRisks.length > 3 ? ' –∏ –¥—Ä—É–≥–∏–µ' : ''})</p>
				`;
			}
			
			return recommendations;
		}
		
        // –ü–µ—á–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
        function printFullReport() {
			const printContent = generateFullReportForPrint();
			
			const printWindow = window.open('', '_blank');
			
			printWindow.document.write(`
				<!DOCTYPE html>
				<html>
				<head>
					<title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç - ${appData.test.theme || '–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞'}</title>
					<meta charset="UTF-8">
					<style>
						body { 
							font-family: 'Arial', sans-serif; 
							margin: 0; 
							padding: 15mm; 
							line-height: 1.4;
							color: #333;
							font-size: 12pt;
						}
						@page {
							size: A4;
							margin: 15mm;
						}
						.header { 
							text-align: center; 
							margin-bottom: 20px;
							padding-bottom: 15px;
							border-bottom: 2px solid #3498db;
							background: linear-gradient(135deg, #2c3e50, #3498db);
							color: white;
							padding: 20px;
							border-radius: 8px;
						}
						.section { 
							margin: 25px 0; 
							page-break-inside: avoid;
						}
						.section-title {
							color: #2c3e50;
							margin: 15px 0 10px 0;
							padding-bottom: 8px;
							border-bottom: 1px solid #3498db;
							font-size: 1.2em;
						}
						.stats-grid { 
							display: grid; 
							grid-template-columns: repeat(2, 1fr); 
							gap: 10px; 
							margin: 15px 0; 
						}
						.stat-card { 
							background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
							color: white; 
							padding: 15px; 
							border-radius: 8px; 
							text-align: center; 
							box-shadow: 0 3px 10px rgba(0,0,0,0.2);
						}
						.stat-value { 
							font-size: 1.6em; 
							font-weight: bold; 
							margin: 8px 0; 
						}
						.stat-label { 
							font-size: 0.8em; 
							opacity: 0.9; 
						}
						table { 
							width: 100%; 
							border-collapse: collapse; 
							margin: 10px 0;
							font-size: 10pt;
							page-break-inside: avoid;
						}
						th, td { 
							border: 1px solid #ddd; 
							padding: 8px; 
							text-align: left; 
						}
						th { 
							background-color: #34495e; 
							color: white; 
							font-weight: bold;
						}
						.kpi-grid { 
							display: grid; 
							grid-template-columns: repeat(4, 1fr); 
							gap: 10px; 
							margin: 15px 0; 
						}
						.kpi-card { 
							background: #f8f9fa; 
							padding: 12px; 
							border-radius: 6px; 
							text-align: center; 
							border-left: 4px solid #3498db; 
						}
						.kpi-card.success { border-left-color: #27ae60 !important; }
						.kpi-card.warning { border-left-color: #f39c12 !important; }
						.kpi-card.danger { border-left-color: #e74c3c !important; }

						.kpi-card.success .kpi-value { color: #27ae60; }
						.kpi-card.warning .kpi-value { color: #f39c12; }
						.kpi-card.danger .kpi-value { color: #e74c3c; }
						
						.psychology-level {
							display: inline-block;
							padding: 2px 8px;
							border-radius: 12px;
							font-size: 11px;
							margin: 2px;
							color: white;
						}
						.level-very-high { background: #27ae60; }
						.level-high { background: #3498db; }
						.level-medium { background: #f39c12; }
						.level-low { background: #e74c3c; }
						.level-very-low { background: #c0392b; }
						
						.recommendation-card {
							background: #e8f4fc;
							padding: 12px;
							margin: 8px 0;
							border-radius: 6px;
							border-left: 4px solid #3498db;
						}
						.task-analysis {
							background: #f8f9fa;
							padding: 10px;
							margin: 5px 0;
							border-radius: 4px;
							border-left: 3px solid #3498db;
						}
						.print-break { 
							page-break-before: always; 
						}
						.no-print { display: none; }
						.small-text { font-size: 10pt; }
						.text-center { text-align: center; }
						.grade-5 { background-color: #d4edda !important; }
						.grade-4 { background-color: #fff3cd !important; }
						.grade-3 { background-color: #ffeaa7 !important; }
						.grade-2 { background-color: #f8d7da !important; }
						/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π */
						.psychology-feature {
							display: inline-block;
							background: #f8f9fa;
							border: 1px solid #ddd;
							padding: 3px 8px;
							margin: 2px;
							border-radius: 4px;
							font-size: 10pt;
						}
						ul {
							margin: 10px 0;
							padding-left: 20px;
						}
						li {
							margin: 5px 0;
						}
						.dimension-table {
							margin: 15px 0;
						}
						.dimension-table td {
							vertical-align: top;
						}
						.interpretation-box {
							background: #f8f9fa;
							border-left: 4px solid #3498db;
							padding: 10px;
							margin: 10px 0;
							border-radius: 0 4px 4px 0;
						}
					</style>
				</head>
				<body>
					${printContent}
				</body>
				</html>
			`);
			
			printWindow.document.close();
			
			setTimeout(() => {
				printWindow.print();
				setTimeout(() => {
					printWindow.close();
				}, 500);
			}, 500);
		}

        function exportHTML() {
            const reportContent = generateFullReport();
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–∞–Ω–∞–ª–∏–∑_${appData.test.subject}_${appData.test.class}_${new Date().toLocaleDateString()}.html`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification("HTML –æ—Ç—á–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", "success");
        }

        function generateFullReport() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            const completionRate = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
            
            const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
            grades.forEach(grade => gradeCounts[grade]++);
            
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: ${appData.test.theme}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
            color: #333;
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            padding-bottom: 20px; 
            border-bottom: 2px solid #3498db; 
        }
        .section { 
            margin: 30px 0; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 10px; 
            text-align: left; 
        }
        th { 
            background-color: #34495e; 
            color: white; 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .stat-value { 
            font-size: 2em; 
            font-weight: bold; 
            margin: 10px 0; 
        }
        .stat-label { 
            font-size: 0.9em; 
            opacity: 0.9; 
        }
        .recommendation-card {
            background: #e8f4fc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .kpi-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .kpi-card { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center; 
            border-left: 4px solid #3498db; 
        }
		.kpi-card.success { border-left-color: #27ae60 !important; }
		.kpi-card.warning { border-left-color: #f39c12 !important; }
		.kpi-card.danger { border-left-color: #e74c3c !important; }

		.kpi-card.success .kpi-value { color: #27ae60; }
		.kpi-card.warning .kpi-value { color: #f39c12; }
		.kpi-card.danger .kpi-value { color: #e74c3c; }
        .print-break { 
            page-break-before: always; 
        }
		/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
		#literacyRadarChart {
			max-height: 400px !important;
			width: 100% !important;
			margin: 0 auto;
		}

		/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
		.chart-container {
			position: relative;
			height: 400px;
			min-height: 400px;
		}
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
        <h2>${appData.test.subject}, ${appData.test.class}</h2>
        <p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme} | <strong>–î–∞—Ç–∞:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
        <p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType].name}</p>
    </div>
    
    <div class="section">
        <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">${avgScore.toFixed(1)}</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${successRate.toFixed(1)}%</div>
                <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${qualityRate.toFixed(1)}%</div>
                <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${completionRate.toFixed(1)}%</div>
                <div class="stat-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[5]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 5</div>
            </div>
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[4]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 4</div>
            </div>
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[3]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 3</div>
            </div>
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[2]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 2</div>
            </div>
        </div>
    </div>
    
    <div class="section print-break">
        <h3>üìà –¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
        ${document.getElementById('taxonomyAnalysis').innerHTML}
    </div>
    
    <div class="section">
        <h3>üí° –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        ${document.getElementById('keyConclusions').innerHTML}
        ${document.getElementById('correctionPlan').innerHTML}
        ${document.getElementById('nextSteps').innerHTML}
    </div>

    <div class="section">
        <p style="text-align: center; color: #7f8c8d; font-size: 0.9em;">
            –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()} —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        </p>
    </div>
</body>
</html>`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—á–∞—Ç–∏
        function printOptimizedReport() {
            const printWindow = window.open('', '_blank');
            const reportContent = generatePrintableReport();
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç - ${appData.test.theme}</title>
                    <meta charset="UTF-8">
                    <style>
                        body { 
                            font-family: 'Arial', sans-serif; 
                            margin: 0; 
                            padding: 15mm; 
                            line-height: 1.4;
                            color: #333;
                            font-size: 12pt;
                        }
                        @page {
                            size: A4;
                            margin: 15mm;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 20px;
                            padding-bottom: 15px;
                            border-bottom: 2px solid #3498db;
                        }
                        .stats-grid { 
                            display: grid; 
                            grid-template-columns: repeat(2, 1fr); 
                            gap: 10px; 
                            margin: 15px 0; 
                        }
                        .stat-card { 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; 
                            padding: 15px; 
                            border-radius: 8px; 
                            text-align: center; 
                            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                        }
                        .stat-value { 
                            font-size: 1.6em; 
                            font-weight: bold; 
                            margin: 8px 0; 
                        }
                        .stat-label { 
                            font-size: 0.8em; 
                            opacity: 0.9; 
                        }
                        .section { 
                            margin: 20px 0; 
                            page-break-inside: avoid;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 10px 0;
                            font-size: 10pt;
                            page-break-inside: avoid;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #34495e; 
                            color: white; 
                        }
                        .recommendation-card {
                            background: #e8f4fc;
                            padding: 12px;
                            margin: 8px 0;
                            border-radius: 6px;
                            border-left: 4px solid #3498db;
                        }
                        .no-print { display: none; }
                        .print-break { page-break-before: always; }
                        .small-text { font-size: 10pt; }
						/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
						#literacyRadarChart {
							max-height: 400px !important;
							width: 100% !important;
							margin: 0 auto;
						}

						/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
						.chart-container {
							position: relative;
							height: 400px;
							min-height: 400px;
						}
                    </style>
                </head>
                <body>
                    ${reportContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
        function generatePrintableReport() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            const completionRate = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
            
            const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
            grades.forEach(grade => gradeCounts[grade]++);
            
            const taskAnalysis = appData.tasks.map((task, index) => {
                const completion = calculateTaskCompletion(index);
                let zone = '';
                let zoneColor = '';
                if (completion >= 90) { zone = '–û—Ç–ª–∏—á–Ω–∞—è'; zoneColor = '#27ae60'; }
                else if (completion >= 60) { zone = '–ó–µ–ª–µ–Ω–∞—è'; zoneColor = '#2ecc71'; }
                else if (completion >= 30) { zone = '–ñ–µ–ª—Ç–∞—è'; zoneColor = '#f39c12'; }
                else { zone = '–ö—Ä–∞—Å–Ω–∞—è'; zoneColor = '#e74c3c'; }
                
                return { task, index, completion, zone, zoneColor };
            });
            
            return `
                <div class="header">
                    <h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
                    <h2>${appData.test.subject}, ${appData.test.class}</h2>
                    <p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme}</p>
                    <p><strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
                    <p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType].name}</p>
                </div>

                <div class="section">
                    <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${avgScore.toFixed(1)}</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${successRate.toFixed(1)}%</div>
                            <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${qualityRate.toFixed(1)}%</div>
                            <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${completionRate.toFixed(1)}%</div>
                            <div class="stat-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0;">
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #27ae60;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[5]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 5</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #2ecc71;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[4]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 4</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[3]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 3</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[2]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 2</div>
                        </div>
                    </div>
                </div>

                <div class="section print-break">
                    <h3>üéØ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>–ó–∞–¥–∞–Ω–∏–µ</th>
                                <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                <th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                                <th>–ó–æ–Ω–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${taskAnalysis.map(item => `
                                <tr>
                                    <td>${item.index + 1}. ${item.task.type}</td>
                                    <td>${item.task.level}. ${complexityLevels[item.task.level].name}</td>
                                    <td>${item.completion.toFixed(1)}%</td>
                                    <td style="color: ${item.zoneColor}; font-weight: bold;">${item.zone}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h3>üí° –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                    <div class="recommendation-card">
                        ${generateKeyConclusionsText()}
                    </div>
                </div>

                <div class="section small-text">
                    <p><em>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()} —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</em></p>
                </div>
            `;
        }
		
		// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Ç–æ–≥–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã
		function updateFinalAnalysis() {
			let html = '<h3 class="section-title">üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
			const history = JSON.parse(localStorage.getItem('workHistory') || '[]')
				.filter(item => item.data.test.subject === appData.test.subject && 
							   item.data.test.class === appData.test.class)
				.sort((a, b) => new Date(a.data.test.testDate) - new Date(b.data.test.testDate));
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${successRate.toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${qualityRate.toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSou().toFixed(1)}%</div>
						<div class="stat-label">–°–û–£</div>
					</div>
				</div>
			`;
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è
			if (history.length > 1) {
				const currentSummary = generateWorkSummary();
				const firstSummary = history[0].summary;
				
				html += `
					<h4>üìà –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥</h4>
					<div class="comparative-grid">
						<div class="comparative-card">
							<h5>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h5>
							<div class="comparative-value ${currentSummary.avgScore > firstSummary.avgScore ? 'positive' : 'negative'}">
								${currentSummary.avgScore.toFixed(1)} 
								<span class="trend">${currentSummary.avgScore > firstSummary.avgScore ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ù–∞—á–∞–ª–æ: ${firstSummary.avgScore.toFixed(1)}</div>
						</div>
						<div class="comparative-card">
							<h5>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</h5>
							<div class="comparative-value ${currentSummary.successRate > firstSummary.successRate ? 'positive' : 'negative'}">
								${currentSummary.successRate.toFixed(1)}%
								<span class="trend">${currentSummary.successRate > firstSummary.successRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ù–∞—á–∞–ª–æ: ${firstSummary.successRate.toFixed(1)}%</div>
						</div>
						<div class="comparative-card">
							<h5>–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</h5>
							<div class="comparative-value ${currentSummary.qualityRate > firstSummary.qualityRate ? 'positive' : 'negative'}">
								${currentSummary.qualityRate.toFixed(1)}%
								<span class="trend">${currentSummary.qualityRate > firstSummary.qualityRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ù–∞—á–∞–ª–æ: ${firstSummary.qualityRate.toFixed(1)}%</div>
						</div>
					</div>
				`;
			}
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —É—Å–≤–æ–µ–Ω–∏—è
			html += `
				<h4>üéØ –£—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</h4>
				<div class="kpi-grid">
					<div class="kpi-card" style="border-left-color: #27ae60">
						<div class="kpi-value">${countStudentsByLevel('high')}</div>
						<div class="kpi-label">–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ 80-100%</small>
					</div>
					<div class="kpi-card" style="border-left-color: #3498db">
						<div class="kpi-value">${countStudentsByLevel('medium')}</div>
						<div class="kpi-label">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ 60-79%</small>
					</div>
					<div class="kpi-card" style="border-left-color: #f39c12">
						<div class="kpi-value">${countStudentsByLevel('low')}</div>
						<div class="kpi-label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ 40-59%</small>
					</div>
					<div class="kpi-card" style="border-left-color: #e74c3c">
						<div class="kpi-value">${countStudentsByLevel('critical')}</div>
						<div class="kpi-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ –º–µ–Ω–µ–µ 40%</small>
					</div>
				</div>
			`;
			
			// –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º
			html += generateKeyTopicsAnalysis();
			
			// –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã
			html += generatePedagogicalConclusions();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º —É—Å–≤–æ–µ–Ω–∏—è
		function countStudentsByLevel(level) {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			
			const percentages = totalScores.map(score => (score / maxPossible) * 100);
			
			switch(level) {
				case 'high':
					return percentages.filter(p => p >= 80).length;
				case 'medium':
					return percentages.filter(p => p >= 60 && p < 80).length;
				case 'low':
					return percentages.filter(p => p >= 40 && p < 60).length;
				case 'critical':
					return percentages.filter(p => p < 40).length;
				default:
					return 0;
			}
		}

		// –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º
		function generateKeyTopicsAnalysis() {
			let html = '<h4>üìö –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º</h4>';
			
			// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ —Ç–µ–º–∞–º (–ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è)
			const topicStats = {};
			
			appData.tasks.forEach((task, taskIndex) => {
				const topic = task.knowledge || '–û–±—â–∞—è —Ç–µ–º–∞';
				if (!topicStats[topic]) {
					topicStats[topic] = {
						completion: 0,
						count: 0,
						tasks: []
					};
				}
				
				const completion = calculateTaskCompletion(taskIndex);
				topicStats[topic].completion += completion;
				topicStats[topic].count++;
				topicStats[topic].tasks.push(taskIndex + 1);
			});
			
			// –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —Ç–µ–º–∞–º
			Object.keys(topicStats).forEach(topic => {
				topicStats[topic].completion = topicStats[topic].completion / topicStats[topic].count;
			});
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–µ–º—ã –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
			const sortedTopics = Object.entries(topicStats)
				.sort(([,a], [,b]) => a.completion - b.completion);
			
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–¢–µ–º–∞</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
			
			sortedTopics.forEach(([topic, stats]) => {
				let status = '';
				let statusIcon = '';
				
				if (stats.completion >= 80) {
					status = '–£—Å–≤–æ–µ–Ω–∞';
					statusIcon = 'üü¢';
				} else if (stats.completion >= 60) {
					status = '–ß–∞—Å—Ç–∏—á–Ω–æ —É—Å–≤–æ–µ–Ω–∞';
					statusIcon = 'üü°';
				} else if (stats.completion >= 40) {
					status = '–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏';
					statusIcon = 'üü†';
				} else {
					status = '–ü—Ä–æ–±–ª–µ–º–Ω–∞—è';
					statusIcon = 'üî¥';
				}
				
				html += `
					<tr>
						<td>${topic}</td>
						<td>${stats.tasks.join(', ')}</td>
						<td>${stats.completion.toFixed(1)}%</td>
						<td>${statusIcon} ${status}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div>';
			
			return html;
		}

		// –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã
		function generatePedagogicalConclusions() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			let html = '<h4>üí° –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã</h4>';
			html += '<div class="recommendation-card">';
			
			if (percentage >= 80) {
				html += '<strong>‚úÖ –í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è</strong><br>';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É—é—Ç –æ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ —É—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞. ';
				html += '<strong>–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:</strong><br>';
				html += '‚Ä¢ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å –≤ –∏–∑—É—á–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞<br>';
				html += '‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω—è–µ–º—ã—Ö –º–µ—Ç–æ–¥–∏–∫<br>';
				html += '‚Ä¢ –•–æ—Ä–æ—à–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è —É—á–∞—â–∏—Ö—Å—è<br>';
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>';
				html += '‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫<br>';
				html += '‚Ä¢ –í–Ω–µ–¥—Ä—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è<br>';
				html += '‚Ä¢ –†–∞–∑–≤–∏–≤–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏<br>';
			} else if (percentage >= 60) {
				html += '<strong>üü° –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è</strong><br>';
				html += '–£—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª —É—Å–≤–æ–µ–Ω –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ. ';
				html += '<strong>–ù–∞–±–ª—é–¥–µ–Ω–∏—è:</strong><br>';
				html += '‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π<br>';
				html += '‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è —Å–ª–∞–±–æ—É—Å–ø–µ–≤–∞—é—â–∏—Ö<br>';
				html += '‚Ä¢ –ù—É–∂–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—Ç—å —Ñ–æ—Ä–º—ã —Ä–∞–±–æ—Ç—ã<br>';
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>';
				html += '‚Ä¢ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Ñ–æ—Ä–º —Ä–∞–±–æ—Ç—ã<br>';
				html += '‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è<br>';
				html += '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤<br>';
			} else if (percentage >= 40) {
				html += '<strong>üü† –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞</strong><br>';
				html += '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö. ';
				html += '<strong>–ü—Ä–æ–±–ª–µ–º—ã:</strong><br>';
				html += '‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —É—Å–≤–æ–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏–π<br>';
				html += '‚Ä¢ –ù–∏–∑–∫–∞—è —É—á–µ–±–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è<br>';
				html += '‚Ä¢ –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–∏—Ö –º–µ—Ç–æ–¥–∏–∫<br>';
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>';
				html += '‚Ä¢ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –æ–±—ä—è—Å–Ω–µ–Ω–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–∞<br>';
				html += '‚Ä¢ –£—Å–∏–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã<br>';
				html += '‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –≤ —É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å<br>';
			} else {
				html += '<strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤ –æ–±—É—á–µ–Ω–∏–∏</strong><br>';
				html += '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ. ';
				html += '<strong>–ü—Ä–∏—á–∏–Ω—ã:</strong><br>';
				html += '‚Ä¢ –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö<br>';
				html += '‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—á–µ–±–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã<br>';
				html += '‚Ä¢ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ—Ç–æ–¥–∏–∫ —É—Ä–æ–≤–Ω—é –∫–ª–∞—Å—Å–∞<br>';
				html += '<strong>–°—Ä–æ—á–Ω—ã–µ –º–µ—Ä—ã:</strong><br>';
				html += '‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º<br>';
				html += '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π<br>';
				html += '‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –º–µ—Ç–æ–¥–∏—Å—Ç–æ–º<br>';
			}
			
			html += '</div>';
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
			html += `
				<div class="recommendation-card">
					<h5>üìÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
					<ul>
						<li>–£—á–µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—á–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥</li>
						<li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ-—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
						<li>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º –≤ –Ω–∞—á–∞–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è —Å–ª–∞–±–æ—É—Å–ø–µ–≤–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–Ω–∞–Ω–∏–π</li>
					</ul>
				</div>
			`;
			
			return html;
		}

		// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ –≤–∞—à JavaScript –∫–æ–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–¥ updateVisualization()
		function debugCharts() {
			console.log('=== –û–¢–õ–ê–î–ö–ê –ì–†–ê–§–ò–ö–û–í ===');
			console.log('Chart.js –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof Chart !== 'undefined');
			console.log('Chart –≤–µ—Ä—Å–∏—è:', Chart ? Chart.version : '–Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
			
			console.log('\nCanvas —ç–ª–µ–º–µ–Ω—Ç—ã:');
			const canvasIds = ['gradesChart', 'solvabilityChart', 'complexityChart'];
			canvasIds.forEach(id => {
				const canvas = document.getElementById(id);
				console.log(`- ${id}:`, canvas);
				if (canvas) {
					console.log(`  –†–∞–∑–º–µ—Ä: ${canvas.width}x${canvas.height}`);
					console.log(`  –°—Ç–∏–ª—å:`, canvas.style.cssText);
				}
			});
			
			console.log('\n–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:');
			canvasIds.forEach(id => {
				const canvas = document.getElementById(id);
				if (canvas) {
					console.log(`- ${id} —Ä–æ–¥–∏—Ç–µ–ª—å:`, canvas.parentElement);
					console.log(`  –í–∏–¥–∏–º—ã–π:`, canvas.parentElement ? canvas.parentElement.offsetParent !== null : '–Ω–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è');
				}
			});
			
			console.log('\n–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:');
			console.log('- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:', appData.results ? appData.results.length : '–Ω–µ—Ç');
			console.log('- –ó–∞–¥–∞–Ω–∏—è:', appData.tasks ? appData.tasks.length : '–Ω–µ—Ç');
			console.log('- –°—Ç—É–¥–µ–Ω—Ç—ã:', appData.students ? appData.students.length : '–Ω–µ—Ç');
			
			console.log('\ncomplexityLevels:', complexityLevels);
			
			console.log('\n–¢–µ–∫—É—â–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤:');
			const chartInstances = [
				'gradesChartInstance',
				'complexityChartInstance',
				'solvabilityChartInstance'
			];
			chartInstances.forEach(name => {
				console.log(`- ${name}:`, window[name]);
			});
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
			if (appData.results && appData.results.length > 0 && appData.tasks && appData.tasks.length > 0) {
				console.log('\n–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è:');
				const firstTaskScores = appData.results.map(student => student[0] || 0);
				console.log('- –û—Ü–µ–Ω–∫–∏:', firstTaskScores);
				console.log('- –ú–∞–∫—Å –±–∞–ª–ª:', appData.tasks[0].maxScore);
			}
		}

		// –¢–∞–∫–∂–µ –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
		function testChart() {
			console.log('=== –¢–ï–°–¢–û–í–´–ô –ì–†–ê–§–ò–ö ===');
			
			// –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
			const testCanvas = document.createElement('canvas');
			testCanvas.id = 'testChart';
			testCanvas.style.width = '400px';
			testCanvas.style.height = '300px';
			document.body.appendChild(testCanvas);
			
			const ctx = testCanvas.getContext('2d');
			const testChart = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: ['–¢–µ—Å—Ç 1', '–¢–µ—Å—Ç 2', '–¢–µ—Å—Ç 3'],
					datasets: [{
						label: '–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ',
						data: [10, 20, 30],
						backgroundColor: ['#ff6384', '#36a2eb', '#cc65fe']
					}]
				}
			});
			
			console.log('–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω:', testChart);
			console.log('–ï—Å–ª–∏ —ç—Ç–æ—Ç –≥—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –∑–Ω–∞—á–∏—Ç Chart.js —Ä–∞–±–æ—Ç–∞–µ—Ç');
			
			// –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
			setTimeout(() => {
				testChart.destroy();
				testCanvas.remove();
				console.log('–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —É–¥–∞–ª–µ–Ω');
			}, 5000);
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
		function drawSimpleGradesChart() {
			console.log('=== –ü–†–û–°–¢–û–ô –ì–†–ê–§–ò–ö –û–¶–ï–ù–û–ö ===');
			
			const canvas = document.getElementById('gradesChart');
			if (!canvas) {
				console.error('Canvas gradesChart –Ω–µ –Ω–∞–π–¥–µ–Ω!');
				// –ü—Ä–æ–≤–µ—Ä–∏–º, –≥–¥–µ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
				const container = document.querySelector('[id*="grade"], [class*="grade"]');
				console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:', container);
				return;
			}
			
			console.log('Canvas –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫...');
			
			// –ü—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
			const testData = {
				labels: ['5', '4', '3', '2'],
				datasets: [{
					data: [5, 10, 7, 3],
					backgroundColor: ['#27ae60', '#2ecc71', '#f39c12', '#e74c3c']
				}]
			};
			
			const ctx = canvas.getContext('2d');
			try {
				window.gradesChartInstance = new Chart(ctx, {
					type: 'pie',
					data: testData,
					options: {
						responsive: true,
						plugins: {
							title: {
								display: true,
								text: '–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫'
							}
						}
					}
				});
				console.log('–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞:', error);
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã
		function generateFinalSpecializedReport() {
			updateFinalAnalysis();
			const analysisContent = document.getElementById('specializedAnalysis').innerHTML;
			
			return `
				<h3>üìä –ò—Ç–æ–≥–æ–≤—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
				<p>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –≤—ã–≤–æ–¥–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculateAverageScore().toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateQualityRate().toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSou().toFixed(1)}%</div>
						<div class="stat-label">–°–û–£</div>
					</div>
				</div>
				
				${analysisContent}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üéØ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è</h4>
					<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>
					<ul>
						<li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–µ–±–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —É—á–µ—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π</li>
						<li>–í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–ü–æ–≤—ã—Å–∏—Ç—å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</li>
						<li>–ê–∫—Ç–∏–≤–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –ø–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—é –æ–±—É—á–µ–Ω–∏—è</li>
					</ul>
				</div>
			`;
		}
		
		
        // –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–ª—é—á–µ–≤—ã—Ö –≤—ã–≤–æ–¥–æ–≤ –¥–ª—è –ø–µ—á–∞—Ç–∏
		function generateKeyConclusionsText() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			
			let conclusions = '';
			
			if (appData.test.workType === 'psychology') {
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				const avgPercentage = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
				
				const levels = appData.test.psychologySettings?.levels || [];
				let dominantLevel = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
				
				for (let level of levels) {
					const count = totalScores.filter(score => {
						const percentage = (score / maxPossible) * 100;
						return percentage >= level.min && percentage <= level.max;
					}).length;
					
					if (count >= totalScores.length * 0.4) { // –ï—Å–ª–∏ 40% –∏ –±–æ–ª–µ–µ –≤ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ
						dominantLevel = level.name;
						break;
					}
				}
				
				conclusions = `
					<strong>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –≥—Ä—É–ø–ø—ã:</strong> ${dominantLevel} —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è<br>
					<strong>–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å:</strong> ${avgPercentage.toFixed(1)}%<br>
					<strong>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</strong> ${grades.filter(g => g === 5).length} —á–µ–ª. - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å, 
					${grades.filter(g => g === 4).length} —á–µ–ª. - –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ,
					${grades.filter(g => g === 3).length} —á–µ–ª. - —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å,
					${grades.filter(g => g <= 2).length} —á–µ–ª. - –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å<br>
				`;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
				if (appData.test.psychologySettings?.dimensions) {
					const dimensions = appData.test.psychologySettings.dimensions;
					const weakestDimension = findWeakestDimension();
					if (weakestDimension) {
						conclusions += `<strong>–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:</strong> ${weakestDimension.name} (${weakestDimension.percentage.toFixed(1)}%)<br>`;
					}
				}
			} else {
				// –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç
				if (successRate >= 80) {
					conclusions = '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
					conclusions += '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å —Ä–∞–±–æ—Ç–æ–π. ';
				} else if (successRate >= 60) {
					conclusions = '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
					conclusions += '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ —É—á–∞—â–∏—Ö—Å—è. ';
				} else {
					conclusions = '<strong>üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
					conclusions += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç–æ–¥—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ. ';
				}
				
				const difficultTasks = [];
				appData.tasks.forEach((task, index) => {
					const completion = calculateTaskCompletion(index);
					if (completion < 50) {
						difficultTasks.push({ task: index + 1, completion: completion, type: task.type });
					}
				});
				
				if (difficultTasks.length > 0) {
					conclusions += `<br><strong>–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:</strong> `;
					conclusions += difficultTasks.map(t => `‚Ññ${t.task} (${t.completion.toFixed(1)}%)`).join(', ');
				}
				
				if (appData.errors.length > 0) {
					const topErrorType = getTopErrorType();
					conclusions += `<br><strong>–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–µ –æ—à–∏–±–∫–∏:</strong> ${errorTypes[topErrorType].name}`;
				}
			}
			
			return conclusions;
		}

		function findWeakestDimension() {
			if (!appData.test.psychologySettings?.dimensions) return null;
			
			const dimensions = appData.test.psychologySettings.dimensions;
			let weakest = null;
			let minPercentage = 100;
			
			dimensions.forEach(dimension => {
				const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
				if (dimensionTasks.length === 0) return;
				
				let totalScore = 0;
				let totalMax = 0;
				
				dimensionTasks.forEach(task => {
					const taskIndex = appData.tasks.indexOf(task);
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					totalScore += actualTotal;
					totalMax += maxScore * appData.results.length;
				});
				
				const percentage = totalMax > 0 ? (totalScore / totalMax) * 100 : 0;
				if (percentage < minPercentage) {
					minPercentage = percentage;
					weakest = { name: dimension.name, percentage: percentage };
				}
			});
			
			return weakest;
		}
        function updateReportPreview() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            
            document.getElementById('reportPreview').innerHTML = `
                <div class="recommendation-card">
                    <h4>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h4>
                    <p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p><strong>–ö–ª–∞—Å—Å:</strong> ${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                    <p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType].name}</p>
                    <p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${appData.students.length} –∏–∑ ${appData.test.presentStudents}</p>
                    <p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${appData.tasks.length}</p>
                    <p><strong>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong> ${totalScores.length > 0 ? avgScore.toFixed(1) : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</p>
                </div>
            `;
        }
        
        // –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç


		// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –í–ü–†
		function generateVPRSpecializedReport() {
			updateVPRAnalysis();
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
			
			// –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –í–ü–†
			const vprCriteriaAnalysis = analyzeVPRCriteria();
			
			return `
				<h3>üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>
				<p>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –í–ü–† —Å –æ—Ü–µ–Ω–∫–æ–π —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculateAverageScore().toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${successRate.toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${qualityRate.toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${appData.students.length}</div>
						<div class="stat-label">–£—á–∞—â–∏—Ö—Å—è</div>
					</div>
				</div>
				
				${vprCriteriaAnalysis}
				
				<div class="section-title">üéØ –û—Ü–µ–Ω–∫–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</div>
				${document.getElementById('specializedAnalysis').innerHTML}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üìã –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
					<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –í–ü–† —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>
					<ul>
						<li>–í–∫–ª—é—á–∏—Ç—å –≤ —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–≥—É–ª—è—Ä–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ –í–ü–†</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —É—á–∞—â–∏—Ö—Å—è —Å –Ω–∏–∑–∫–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</li>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫—É—é —Ä–∞–±–æ—Ç—É –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –í–ü–†</li>
						<li>–û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏</li>
					</ul>
				</div>
			`;
		}

		// –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –í–ü–†
		function analyzeVPRCriteria() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const avgPercentage = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üìà –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –í–ü–†</h4>';
			
			if (avgPercentage >= 80) {
				html += '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–ö–ª–∞—Å—Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –í–ü–†. ';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç —Å—Ä–µ–¥–Ω–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏.';
			} else if (avgPercentage >= 60) {
				html += '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–ö–ª–∞—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–∞–∑–æ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –í–ü–†. ';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ä–µ–¥–Ω–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π.';
			} else if (avgPercentage >= 40) {
				html += '<strong>üü† –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å–∏–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–µ–ª—ã –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –í–ü–†. ';
				html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏.';
			} else {
				html += '<strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. ';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ –±–∞–∑–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –í–ü–†.';
			}
			
			html += `<br><strong>–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${avgPercentage.toFixed(1)}%`;
			html += '</div>';
			
			return html;
		}

		function generateLiteracySpecializedReport() {
			updateLiteracyAnalysis();
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const avgPercentage = (avgScore / maxPossible) * 100;
			
			// –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			const overallLevel = analyzeOverallLiteracyLevel(avgPercentage);
			
			return `
				<h3>üéØ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h3>
				<p>–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –∂–∏–∑–Ω–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –æ–±—â–µ—Å—Ç–≤–µ.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${avgPercentage.toFixed(1)}%</div>
						<div class="stat-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${overallLevel.level}</div>
						<div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${appData.tasks.length}</div>
						<div class="stat-label">–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –æ—Ü–µ–Ω–µ–Ω–æ</div>
					</div>
				</div>
				
				<div class="recommendation-card">
					<h4>üìà –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —É—Ä–æ–≤–Ω—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
					<p><strong>${overallLevel.title}</strong></p>
					<p>${overallLevel.description}</p>
					<p><strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:</strong> ${overallLevel.interpretation}</p>
				</div>
				
				<div class="section-title">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</div>
				${document.getElementById('specializedAnalysis').innerHTML}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üìã –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–∏—Ç–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
					<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>
					<ul>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≤–∏—Ç–∏—è –¥–ª—è —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –ø–µ–¥–∞–≥–æ–≥–æ–≤</li>
						<li>–°–æ–∑–¥–∞—Ç—å –±–∞–Ω–∫ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</li>
						<li>–û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏</li>
					</ul>
				</div>
			`;
		}
		
		// ==================== –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• ====================
		
		// 1. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª JSON
		function exportToFile() {
			try {
				// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
				const dataToExport = {
					appData: appData,
					timestamp: new Date().toISOString(),
					version: '1.0',
					metadata: {
						exportedBy: '–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
						exportedAt: new Date().toLocaleString('ru-RU'),
						subject: appData.test.subject,
						class: appData.test.class,
						workType: appData.test.workType,
						studentCount: appData.students.length,
						taskCount: appData.tasks.length,
						theme: appData.test.theme
					}
				};
				
				const dataStr = JSON.stringify(dataToExport, null, 2);
				const blob = new Blob([dataStr], { type: 'application/json' });
				const url = URL.createObjectURL(blob);
				
				const a = document.createElement('a');
				a.href = url;
				a.download = generateExportFilename();
				a.click();
				
				URL.revokeObjectURL(url);
				
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª', 'success');
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º —ç–∫—Å–ø–æ—Ä—Ç–µ
				saveExportHistory();
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
			}
		}

		// –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
		function createTestImportFile() {
			const testData = {
				test: {
					subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
					class: "5–ê",
					testDate: new Date().toISOString().split('T')[0],
					theme: "–¢–µ—Å—Ç–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞",
					goals: "–¢–µ—Å—Ç–æ–≤—ã–µ —Ü–µ–ª–∏",
					workType: "current",
					workFormat: "mixed",
					timeLimit: 45,
					totalStudents: 25,
					presentStudents: 23,
					absentReason: "",
					criteria: {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					}
				},
				tasks: [
					{ type: "–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1", maxScore: 2, level: 1, knowledge: "—Ç–µ—Å—Ç" },
					{ type: "–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2", maxScore: 3, level: 2, knowledge: "—Ç–µ—Å—Ç" }
				],
				students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î."],
				results: [
					[2, 3],
					[1, 2],
					[2, 3]
				],
				errors: [],
				_metadata: {
					exportedAt: new Date().toLocaleString('ru-RU'),
					system: '–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
					version: '1.0'
				}
			};
			
			const dataStr = JSON.stringify(testData, null, 2);
			
			// –î–æ–±–∞–≤–ª—è–µ–º BOM –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8
			const BOM = '\uFEFF';
			const blob = new Blob([BOM + dataStr], { 
				type: 'application/json;charset=utf-8' 
			});
			
			const url = URL.createObjectURL(blob);
			
			const a = document.createElement('a');
			a.href = url;
			a.download = '—Ç–µ—Å—Ç–æ–≤—ã–π_—Ñ–∞–π–ª_–¥–ª—è_–∏–º–ø–æ—Ä—Ç–∞.json';
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			
			URL.revokeObjectURL(url);
			
			showNotification('–¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω', 'success');
		}

		// –ó–ê–ú–ï–ù–ò–¢–ï –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ
		//document.addEventListener('DOMContentLoaded', function() {
		//	setTimeout(() => {
		//		addFixedTransferButtons();
		//	}, 1000);
		//});

		// 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
		function generateExportFilename() {
			const date = new Date().toISOString().split('T')[0];
			const time = new Date().toTimeString().split(' ')[0].replace(/:/g, '-');
			const subject = appData.test.subject || '–ø—Ä–µ–¥–º–µ—Ç';
			const className = appData.test.class || '–∫–ª–∞—Å—Å';
			
			return `–∞–Ω–∞–ª–∏–∑_${subject}_${className}_${date}_${time}.json`;
		}

		// 3. –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
		function importFromFile() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json,.txt,application/json';
			
			input.onchange = function(event) {
				const file = event.target.files[0];
				if (!file) return;
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
				showNotification('–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...', 'info');
				
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const content = e.target.result;
						console.log('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:', content.length, '—Å–∏–º–≤–æ–ª–æ–≤');
						
						const importedData = JSON.parse(content);
						console.log('–ü–∞—Ä—Å–∏–Ω–≥ JSON —É—Å–ø–µ—à–µ–Ω');
						
						// –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
						if (validateImportedData(importedData)) {
							console.log('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é');
							showImportConfirmationDialog(importedData);
						} else {
							console.error('–î–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é');
							
							// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
							if (alternativeValidate(importedData)) {
								console.log('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—à–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é');
								showImportConfirmationDialog(importedData);
								return;
							}
							
							// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
							let errorHtml = `
								<h3>‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
								<p>–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞.</p>
								
								<div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 15px 0;">
									<h4>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:</h4>
									<ol>
										<li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –±—ã–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã</li>
										<li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é</li>
										<li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–Ω–æ–≤–∞</li>
										<li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å UTF-8)</li>
									</ol>
								</div>
							`;
							
							// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
							errorHtml += `
								<div class="form-group">
									<h4>–ü–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤ —Ñ–∞–π–ª–∞:</h4>
									<div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 10px;">
										${content.substring(0, 1000).replace(/</g, '&lt;').replace(/>/g, '&gt;')}
									</div>
								</div>
							`;
							
							errorHtml += `
								<div style="margin-top: 20px;">
									<button class="btn btn-warning" onclick="tryForceImport('${content.replace(/\\/g, '\\\\').replace(/'/g, "\\'").substring(0, 5000)}')">
										–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç
									</button>
									<button class="btn" onclick="hideModal()" style="margin-left: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
								</div>
							`;
							
							showModal('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞', errorHtml);
						}
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error);
						
						let errorMessage = `
							<h3>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞</h3>
							<p><strong>${error.name}:</strong> ${error.message}</p>
							
							<div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 15px 0;">
								<h4>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</h4>
								<ul>
									<li>–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω</li>
									<li>–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (–Ω–µ JSON)</li>
									<li>–§–∞–π–ª –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é</li>
									<li>–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å UTF-8)</li>
								</ul>
							</div>
							
							<div class="form-group">
								<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞:</h4>
								<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 10px;">
									${file.name}<br>
									–†–∞–∑–º–µ—Ä: ${file.size} –±–∞–π—Ç<br>
									–¢–∏–ø: ${file.type || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}
								</div>
							</div>
						`;
						
						errorMessage += `
							<div style="margin-top: 20px;">
								<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
							</div>
						`;
						
						showModal('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞', errorMessage);
					}
				};
				
				reader.onerror = function(e) {
					console.error('–û—à–∏–±–∫–∞ FileReader:', e);
					showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
				};
				
				reader.readAsText(file, 'UTF-8');
			};
			
			input.click();
		}

		// –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø (–±–æ–ª–µ–µ –º—è–≥–∫–∞—è)
		function alternativeValidate(data) {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
				if (!data) return false;
				
				// –í–∞—Ä–∏–∞–Ω—Ç 1: –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å appData
				if (data.appData && typeof data.appData === 'object') {
					const appData = data.appData;
					if (appData.test && appData.tasks && appData.students && appData.results) {
						return true;
					}
				}
				
				// –í–∞—Ä–∏–∞–Ω—Ç 2: —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –±–µ–∑ appData
				if (data.test && data.tasks && data.students && data.results) {
					return true;
				}
				
				// –í–∞—Ä–∏–∞–Ω—Ç 3: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
				if (Array.isArray(data.tasks) && Array.isArray(data.students)) {
					return true;
				}
				
				return false;
			} catch (error) {
				return false;
			}
		}

		// –§–£–ù–ö–¶–ò–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –ò–ú–ü–û–†–¢–ê
		function tryForceImport(content) {
			try {
				// –ü—Ä–æ–±—É–µ–º –æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
				let cleanedContent = content;
				
				// –£–¥–∞–ª—è–µ–º BOM (–±–∞–π—Ç–æ–≤—É—é –º–µ—Ç–∫—É –ø–æ—Ä—è–¥–∫–∞)
				if (cleanedContent.charCodeAt(0) === 0xFEFF) {
					cleanedContent = cleanedContent.substring(1);
				}
				
				// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
				let importedData;
				
				try {
					// –ú–µ—Ç–æ–¥ 1: –æ–±—ã—á–Ω—ã–π JSON.parse
					importedData = JSON.parse(cleanedContent);
				} catch (e1) {
					try {
						// –ú–µ—Ç–æ–¥ 2: –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
						cleanedContent = cleanedContent
							.replace(/\r\n/g, '\n') // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫
							.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, ''); // –£–¥–∞–ª—è–µ–º —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã
						
						importedData = JSON.parse(cleanedContent);
					} catch (e2) {
						try {
							// –ú–µ—Ç–æ–¥ 3: –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ JSON –≤ —Ç–µ–∫—Å—Ç–µ
							const jsonMatch = cleanedContent.match(/\{.*\}/s);
							if (jsonMatch) {
								importedData = JSON.parse(jsonMatch[0]);
							} else {
								throw new Error('JSON –Ω–µ –Ω–∞–π–¥–µ–Ω');
							}
						} catch (e3) {
							showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞–Ω–Ω—ã–µ', 'error');
							return;
						}
					}
				}
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞
				hideModal();
				setTimeout(() => {
					showImportConfirmationDialog(importedData);
				}, 100);
				
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ: ' + error.message, 'error');
			}
		}


		// –£–ü–†–û–©–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –≠–ö–°–ü–û–†–¢–ê/–ò–ú–ü–û–†–¢–ê (–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
		function simpleImport() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json';
			
			input.onchange = function(e) {
				const file = e.target.files[0];
				const reader = new FileReader();
				
				reader.onload = function(event) {
					try {
						// –ò–°–ü–†–ê–í–õ–Ø–ï–ú: –æ—á–∏—â–∞–µ–º JSON
						const cleanedContent = cleanJSON(event.target.result);
						const importedData = JSON.parse(cleanedContent);
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ —à–∞–±–ª–æ–Ω –∏–ª–∏ –æ–±—ã—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
						if (importedData.test && importedData.tasks) {
							if (importedData.test.workType && importedData.tasks.length > 0) {
								// –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —à–∞–±–ª–æ–Ω - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞
								showImportOptions(importedData, file.name);
							} else {
								// –û–±—ã—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
								showImportConfirmationSimple(importedData);
							}
						} else {
							showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
						}
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', error);
						showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message, 'error');
					}
				};
				
				reader.onerror = function() {
					showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
				};
				
				reader.readAsText(file);
			};
			
			input.click();
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JSON —Ñ–∞–π–ª–∞
		function debugJSONFile(file) {
			const reader = new FileReader();
			reader.onload = function(e) {
				console.log('=== DEBUG JSON FILE ===');
				console.log('–ò–º—è —Ñ–∞–π–ª–∞:', file.name);
				console.log('–†–∞–∑–º–µ—Ä:', file.size, '–±–∞–π—Ç');
				console.log('–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤:', e.target.result.substring(0, 200));
				console.log('–ü–æ—Å–ª–µ–¥–Ω–∏–µ 200 —Å–∏–º–≤–æ–ª–æ–≤:', e.target.result.substring(e.target.result.length - 200));
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
				const content = e.target.result;
				for (let i = 0; i < content.length; i++) {
					if (content.charCodeAt(i) > 127 && content.charCodeAt(i) < 256) {
						console.log(`–°–∏–º–≤–æ–ª ${i}: '${content[i]}' (–∫–æ–¥: ${content.charCodeAt(i)})`);
					}
				}
				
				try {
					const cleaned = cleanJSON(e.target.result);
					const parsed = JSON.parse(cleaned);
					console.log('‚úÖ JSON –≤–∞–ª–∏–¥–µ–Ω –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏');
					console.log('–°—Ç—Ä—É–∫—Ç—É—Ä–∞:', {
						test: !!parsed.test,
						tasks: parsed.tasks?.length || 0,
						students: parsed.students?.length || 0
					});
				} catch (error) {
					console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', error.message);
				}
			};
			reader.readAsText(file);
		}

		// –ü–†–û–°–¢–û–ô –≠–ö–°–ü–û–†–¢
		function simpleExport() {
			try {
				const data = {
					test: appData.test,
					tasks: appData.tasks,
					students: appData.students,
					results: appData.results,
					errors: appData.errors,
					timestamp: new Date().toISOString()
				};
				
				const dataStr = JSON.stringify(data, null, 2);
				const blob = new Blob([dataStr], { type: 'application/json' });
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = `–¥–∞–Ω–Ω—ã–µ_${appData.test.subject || '–ø—Ä–µ–¥–º–µ—Ç'}_${new Date().toLocaleDateString()}.json`;
				a.click();
				URL.revokeObjectURL(url);
				
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message, 'error');
			}
		}

		// –ü–†–û–°–¢–û–ô –ò–ú–ü–û–†–¢
		function simpleImport() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json';
			
			input.onchange = function(e) {
				const file = e.target.files[0];
				const reader = new FileReader();
				
				reader.onload = function(event) {
					try {
						const importedData = JSON.parse(event.target.result);
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ —à–∞–±–ª–æ–Ω –∏–ª–∏ –æ–±—ã—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
						if (importedData.test && importedData.tasks) {
							if (importedData.test.workType && importedData.tasks.length > 0) {
								// –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —à–∞–±–ª–æ–Ω - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞
								showImportOptions(importedData, file.name);
							} else {
								// –û–±—ã—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
								showImportConfirmationSimple(importedData);
							}
						} else {
							showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
						}
					} catch (error) {
						showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message, 'error');
					}
				};
				
				reader.readAsText(file);
			};
			
			input.click();
		}
		
		// 5. –î–ò–ê–õ–û–ì –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ò–ú–ü–û–†–¢–ê
		function showImportConfirmationSimple(dataToImport, exportInfo = {}) {
			const studentCount = dataToImport.students?.length || 0;
			const taskCount = dataToImport.tasks?.length || 0;
			const subject = dataToImport.test?.subject || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const className = dataToImport.test?.class || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const exportDate = exportInfo.date || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
			
			const html = `
				<div style="max-width: 600px;">
					<h3>üîÑ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${subject}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${studentCount}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${taskCount}</p>
						<p><strong>–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:</strong> ${exportDate}</p>
						<p><strong>–í–µ—Ä—Å–∏—è:</strong> ${exportInfo.version || '1.0'}</p>
					</div>
					
					<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
						<h4>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h4>
						<p>–í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					</div>
					
					<div class="form-group">
						<label>
							<input type="radio" name="importMode" value="replace" checked>
							–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
						</label>
						<small style="display: block; color: #666; margin-left: 20px;">
							–ó–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
						</small>
					</div>
					
					<div class="form-group">
						<label>
							<input type="radio" name="importMode" value="merge">
							–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ)
						</label>
						<small style="display: block; color: #666; margin-left: 20px;">
							–ü–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
						</small>
					</div>
				</div>
			`;
			
			showModal('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="performImport('${encodeURIComponent(JSON.stringify(dataToImport))}')">
						–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
					</button>
				</div>
			`);
		}

		// 6. –í–´–ü–û–õ–ù–ï–ù–ò–ï –ò–ú–ü–û–†–¢–ê
		function performImport(encodedData) {
			try {
				// –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
				const jsonString = decodeURIComponent(encodedData);
				const dataToImport = JSON.parse(jsonString);
				
				// –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
				const importMode = document.querySelector('input[name="importMode"]:checked').value;
				
				if (importMode === 'replace') {
					// –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞
					appData = JSON.parse(JSON.stringify(dataToImport));
				} else if (importMode === 'merge') {
					// –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
					smartMergeData(dataToImport);
				}
				
				// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã
				robustSyncData();
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º
				saveData();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
				renderAll();
				
				// –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
				hideModal();
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
				showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:', error);
				showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ: ' + error.message, 'error');
			}
		}
		function smartMergeData(newData) {
			const oldData = JSON.parse(JSON.stringify(appData));
			
			// 1. –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ (–Ω–æ–≤—ã–µ –≤–∞–∂–Ω–µ–µ)
			appData.test = { ...oldData.test, ...newData.test };
			
			// 2. –£–º–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ –∑–∞–¥–∞—á
			// –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á –ø–æ ID –∏–ª–∏ —Ç–µ–∫—Å—Ç—É (–µ—Å–ª–∏ ID –Ω–µ—Ç)
			const existingTasksMap = new Map();
			oldData.tasks.forEach((t, i) => existingTasksMap.set(t.id || t.type + t.maxScore, i));

			newData.tasks.forEach(newTask => {
				const key = newTask.id || newTask.type + newTask.maxScore;
				if (!existingTasksMap.has(key)) {
					// –≠—Ç–æ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ - –¥–æ–±–∞–≤–ª—è–µ–º
					appData.tasks.push(newTask);
				}
			});

			// 3. –£–º–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
			const existingStudentsMap = new Map(); // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è -> –ò–Ω–¥–µ–∫—Å
			appData.students.forEach((s, i) => existingStudentsMap.set(s.trim().toLowerCase(), i));

			// –ö–∞—Ä—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–º–ø–æ—Ä—Ç–∞ -> —Ç–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
			const importIndexToCurrentIndex = {};

			newData.students.forEach((newStudentName, importIdx) => {
				const normName = newStudentName.trim().toLowerCase();
				
				if (existingStudentsMap.has(normName)) {
					// –°—Ç—É–¥–µ–Ω—Ç —É–∂–µ –µ—Å—Ç—å, –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –µ–≥–æ —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å
					importIndexToCurrentIndex[importIdx] = existingStudentsMap.get(normName);
				} else {
					// –°—Ç—É–¥–µ–Ω—Ç–∞ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º
					appData.students.push(newStudentName);
					const newIndex = appData.students.length - 1;
					importIndexToCurrentIndex[importIdx] = newIndex;
					// –°–æ–∑–¥–∞–µ–º –µ–º—É –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–∏—Ç –ø–æ–∑–∂–µ, –Ω–æ –ª—É—á—à–µ —Å—Ä–∞–∑—É)
					appData.results[newIndex] = new Array(appData.tasks.length).fill(0);
				}
			});

			// 4. –°–ª–∏—è–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			// –°–Ω–∞—á–∞–ª–∞ –≤—ã–∑–æ–≤–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é, —á—Ç–æ–±—ã –≤—ã—Ä–æ–≤–Ω—è—Ç—å –º–∞—Ç—Ä–∏—Ü—ã –ø–æ–¥ –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
			robustSyncData();

			// –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–Ω–æ—Å–∏–º –æ—Ü–µ–Ω–∫–∏ –∏–∑ –∏–º–ø–æ—Ä—Ç–∞
			newData.results.forEach((scoresRow, importStudentIdx) => {
				const targetStudentIdx = importIndexToCurrentIndex[importStudentIdx];
				
				if (targetStudentIdx !== undefined) {
					scoresRow.forEach((score, taskIdx) => {
						// –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞, –ø–µ—Ä–µ–Ω–æ—Å–∏–º –æ—Ü–µ–Ω–∫—É
						// –í–ê–ñ–ù–û: –¢—É—Ç –Ω—É–∂–Ω–æ —Å–ª–æ–∂–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á, –µ—Å–ª–∏ –∏—Ö –ø–æ—Ä—è–¥–æ–∫ —Ä–∞–∑–Ω—ã–π.
						// –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü.
						// –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ > 0, –æ–±–Ω–æ–≤–ª—è–µ–º (–Ω–µ –∑–∞—Ç–∏—Ä–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω—É–ª—è–º–∏)
						if (score > 0 && appData.results[targetStudentIdx][taskIdx] === 0) {
							appData.results[targetStudentIdx][taskIdx] = parseInt(score) || 0;
						}
					});
				}
			});
			
			// 5. –°–ª–∏—è–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (–ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ —Å–º–µ—à–∏–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è –Ω–µ–ª—å–∑—è)
			if (newData.test.criteria) {
				appData.test.criteria = JSON.parse(JSON.stringify(newData.test.criteria));
				appData.test.criteriaType = newData.test.criteriaType;
				appData.test.criteriaSystem = newData.test.criteriaSystem;
				
				// –û–±–Ω–æ–≤–ª—è–µ–º UI —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
				const typeSelect = document.getElementById('criteriaType');
				if(typeSelect) typeSelect.value = appData.test.criteriaType;
			}

			saveData();
			renderAll();
			showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã', 'success');
		}
		// 7. –û–ë–™–ï–î–ò–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•
		function mergeData(newData) {
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
			const oldData = JSON.parse(JSON.stringify(appData));
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ (–Ω–æ–≤—ã–µ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
			appData.test = { ...oldData.test, ...newData.test };
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏
			if (newData.test.criteria) {
				appData.test.criteria = { ...oldData.test.criteria, ...newData.test.criteria };
			}
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –∑–∞–¥–∞–Ω–∏—è (–¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ)
			const oldTaskKeys = oldData.tasks.map(t => `${t.type}|${t.maxScore}|${t.level}`).join('|');
			newData.tasks.forEach(newTask => {
				const newTaskKey = `${newTask.type}|${newTask.maxScore}|${newTask.level}`;
				if (!oldTaskKeys.includes(newTaskKey)) {
					appData.tasks.push(newTask);
				}
			});
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º —É—á–∞—â–∏—Ö—Å—è (–¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö)
			const oldStudentsLower = oldData.students.map(s => s.toLowerCase().trim());
			newData.students.forEach(newStudent => {
				if (!oldStudentsLower.includes(newStudent.toLowerCase().trim())) {
					appData.students.push(newStudent);
					// –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
			});
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ—à–∏–±–∫–∏
			appData.errors = [...oldData.errors, ...(newData.errors || [])];
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞)
			mergeResults(oldData, newData);
		}

		// 8. –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ê–°–°–ò–í–û–í
		function syncDataArrays() {
			// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—â–∏—Ö—Å—è
			while (appData.results.length < appData.students.length) {
				appData.results.push(new Array(appData.tasks.length).fill(0));
			}
			
			// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			if (appData.results.length > appData.students.length) {
				appData.results = appData.results.slice(0, appData.students.length);
			}
			
			// –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–ª–∏–Ω—É –∫–∞–∂–¥–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			appData.results.forEach((studentResults, index) => {
				while (studentResults.length < appData.tasks.length) {
					studentResults.push(0);
				}
				if (studentResults.length > appData.tasks.length) {
					appData.results[index] = studentResults.slice(0, appData.tasks.length);
				}
			});
		}
		// 9. –ú–ï–ù–Æ –ò–ú–ü–û–†–¢–ê/–≠–ö–°–ü–û–†–¢–ê
		function showImportExportMenu() {
			// –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ templates —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
			if (!appData.templates) {
				appData.templates = {
					loadedTemplates: [],
					lastTemplatePath: "",
					lastTemplateName: "",
					availableSubjects: []
				};
			}
			
			const hasLastTemplate = appData.templates.lastTemplatePath && appData.templates.lastTemplatePath.trim() !== "";
			
			const html = `
				<div style="text-align: center; padding: 20px;">
					<h3>üîÑ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
						<div style="background: #d4edda; padding: 20px; border-radius: 10px; text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì§</div>
							<h4>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª JSON</p>
							<button class="btn btn-success" onclick="simpleExport()" style="width: 100%; margin-top: 10px;">
								–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
							</button>
						</div>
						
						<div style="background: #fff3cd; padding: 20px; border-radius: 10px; text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì•</div>
							<h4>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ JSON</p>
							<button class="btn btn-warning" onclick="simpleImport()" style="width: 100%; margin-top: 10px;">
								–ü—Ä–æ—Å—Ç–æ–π –∏–º–ø–æ—Ä—Ç
							</button>
						</div>
					</div>
					
					<!-- –ù–û–í–´–ô –ë–õ–û–ö: –ò–ú–ü–û–†–¢ –ò–ó –®–ê–ë–õ–û–ù–û–í -->
					<div style="background: #d6eaf8; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0;">
						<div style="font-size: 3em; margin-bottom: 10px;">üéØ</div>
						<h4>–ò–º–ø–æ—Ä—Ç –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ DeepSeek</h4>
						<p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ —Å —à–∞–±–ª–æ–Ω–∞–º–∏</p>
						
						<div style="display: flex; gap: 10px; margin-top: 15px;">
							<button class="btn btn-primary" onclick="scanTemplateFolder()" style="flex: 1; padding: 12px;">
								üìÅ –í—ã–±—Ä–∞—Ç—å/–°–º–µ–Ω–∏—Ç—å –ø–∞–ø–∫—É
							</button>
							<button class="btn btn-success" onclick="showTemplateSelection()" style="flex: 1; padding: 12px;">
								üìã –ü–æ–∫–∞–∑–∞—Ç—å —à–∞–±–ª–æ–Ω—ã
							</button>
						</div>
						
						<small style="display: block; margin-top: 10px; color: #666;">
							–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: –û–ì–≠, –ï–ì–≠, –í–ü–†, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
						</small>
						
						${hasLastTemplate ? `
						<div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">
							<small>–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–±–ª–æ–Ω: <strong>${appData.templates.lastTemplateName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong></small>
							<button class="btn btn-sm btn-outline-primary" onclick="importLastTemplate()" style="margin-left: 10px;">
								–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç
							</button>
						</div>
						` : ''}
						
						<!-- –°—Ç–∞—Ç—É—Å —Å–∫–∞–Ω–µ—Ä–∞ -->
						<div id="templateScannerStatus" style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.8); border-radius: 6px; font-size: 0.85em;">
							<small>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞–Ω–µ—Ä–∞...</small>
						</div>
					</div>
					
					<div style="background: #d1ecf1; padding: 15px; border-radius: 8px; text-align: left; margin-top: 20px;">
						<h5>üì± –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —à–∞–±–ª–æ–Ω–∞–º–∏:</h5>
						<ol>
							<li><strong>–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω—ã</strong> –≤ DeepSeek –¥–ª—è –Ω—É–∂–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤</li>
							<li><strong>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ JSON —Ñ–∞–π–ª—ã</strong> –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É</li>
							<li><strong>–ù–∞–∂–º–∏—Ç–µ "–í—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É"</strong> –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —ç—Ç—É –ø–∞–ø–∫—É</li>
							<li><strong>–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —à–∞–±–ª–æ–Ω</strong> –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ</li>
						</ol>
					</div>
					
					<div style="margin-top: 20px; text-align: left;">
						<h5>üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</h5>
						<button class="btn" onclick="createSampleFile()" style="margin-right: 10px;">
							üß™ –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞
						</button>
						<button class="btn" onclick="checkDataStructure()">
							üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
						</button>
					</div>
				</div>
			`;
			
			showModal('–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö', html);
		}
		// 12. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–ù–û–ü–û–ö –í –ò–ù–¢–ï–†–§–ï–ô–°
		function addImportExportButtons() {
			// –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞
			const exportSection = document.getElementById('export');
			if (!exportSection) return;
			<!--
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –Ω–∞—á–∞–ª–æ
			const buttonsContainer = exportSection.querySelector('.export-buttons');
			if (buttonsContainer) {
				buttonsContainer.innerHTML = `
					<button class="btn btn-success" onclick="simpleExport()">
						üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)
					</button>
					<button class="btn btn-warning" onclick="simpleImport()">
						üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)  
					</button>
					<button class="btn" onclick="showImportExportMenu()">
						üîÑ –ú–µ–Ω—é –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞
					</button>
					<button class="btn" onclick="createSampleFile()">
						üß™ –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞
					</button>
					${buttonsContainer.innerHTML}
				`;
			}
			-->
			// –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å
			const tabsContainer = document.querySelector('.tabs');
			if (tabsContainer && !document.querySelector('.tab-btn[onclick*="showImportExportMenu"]')) {
				const transferTab = document.createElement('button');
				transferTab.className = 'tab-btn';
				transferTab.innerHTML = 'üîÑ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç';
				transferTab.onclick = showImportExportMenu;
				tabsContainer.appendChild(transferTab);
			}
		}
		
		// 10. –°–û–ó–î–ê–ù–ò–ï –ü–†–ò–ú–ï–†–ù–û–ì–û –§–ê–ô–õ–ê
		function createSampleFile() {
			// –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
			const sampleData = {
				test: {
					subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
					class: "5–ê",
					testDate: new Date().toISOString().split('T')[0],
					theme: "–î—Ä–æ–±–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã",
					goals: "–ü—Ä–∏–º–µ—Ä —Ü–µ–ª–µ–π –æ–±—É—á–µ–Ω–∏—è",
					workType: "current",
					workFormat: "mixed",
					timeLimit: 45,
					totalStudents: 25,
					presentStudents: 23,
					absentReason: "",
					criteria: {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					}
				},
				tasks: [
					{ type: "–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è 1", maxScore: 2, level: 1, knowledge: "" },
					{ type: "–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è 2", maxScore: 3, level: 2, knowledge: "" }
				],
				students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î."],
				results: [[1, 2], [2, 2], [0, 1]],
				errors: [],
				instructions: "–≠—Ç–æ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏."
			};
			
			const dataStr = JSON.stringify(sampleData, null, 2);
			const blob = new Blob([dataStr], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = "–ø—Ä–∏–º–µ—Ä_—Ñ–∞–π–ª–∞_–¥–∞–Ω–Ω—ã—Ö.json";
			a.click();
			URL.revokeObjectURL(url);
			
			showNotification('–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω', 'success');
		}

		// 11. –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•
		function checkDataStructure() {
			const html = `
				<div style="max-width: 800px;">
					<h3>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:</h4>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${appData.students.length}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${appData.tasks.length}</p>
						<p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> ${appData.results.length} √ó ${appData.results[0]?.length || 0}</p>
						<p><strong>–û—à–∏–±–æ–∫:</strong> ${appData.errors.length}</p>
					</div>
					
					<div style="background: #e8f4fc; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:</h4>
						<pre style="background: white; padding: 10px; border-radius: 4px; font-size: 10px; max-height: 300px; overflow: auto;">
							${JSON.stringify({
								test: { subject: "...", class: "..." },
								tasks: ["...", "..."],
								students: ["...", "..."],
								results: [["..."], ["..."]]
							}, null, 2)}
						</pre>
					</div>
					
					<div style="margin-top: 20px;">
						<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
					</div>
				</div>
			`;
			
			showModal('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö', html);
		}

		// 3. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞
		function readFileAsText(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = function(e) {
					resolve(e.target.result);
				};
				
				reader.onerror = function(e) {
					reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª'));
				};
				
				// –ß–∏—Ç–∞–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç —Å UTF-8
				reader.readAsText(file, 'UTF-8');
			});
		}
		
		// 4. –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø –¥–∞–Ω–Ω—ã—Ö
		function validateImportData(data) {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
				if (!data || typeof data !== 'object') {
					return false;
				}
				
				// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–Ω–æ–≤—ã–π –∏–ª–∏ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
				const appData = data.appData || data;
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
				if (!appData.test || typeof appData.test !== 'object') {
					return false;
				}
				
				if (!Array.isArray(appData.tasks)) {
					return false;
				}
				
				if (!Array.isArray(appData.students)) {
					return false;
				}
				
				if (!Array.isArray(appData.results)) {
					return false;
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –º–∞—Å—Å–∏–≤–æ–≤
				if (appData.results.length !== appData.students.length) {
					console.warn('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—â–∏—Ö—Å—è');
					// –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∏–º–ø–æ—Ä—Ç, –Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
				}
				
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error);
				return false;
			}
		}

		
		// –î–û–ë–ê–í–¨–¢–ï –≠–¢–ò –ö–ù–û–ü–ö–ò –í –ò–ù–¢–ï–†–§–ï–ô–°
		function addFixedTransferButtons() {
			// –í —Ä–∞–∑–¥–µ–ª —ç–∫—Å–ø–æ—Ä—Ç–∞
			const exportTab = document.querySelector('#export .export-buttons');
			if (exportTab) {
				// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
				exportTab.innerHTML += `
					<button class="btn btn-success" onclick="simpleExport()">üíæ –≠–∫—Å–ø–æ—Ä—Ç (–ø—Ä–æ—Å—Ç–æ–π)</button>
					<button class="btn btn-warning" onclick="simpleImport()">üì• –ò–º–ø–æ—Ä—Ç (–ø—Ä–æ—Å—Ç–æ–π)</button>
					<button class="btn" onclick="simpleImportExport()">üîÑ –ü—Ä–æ—Å—Ç–æ–π –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç</button>
					<button class="btn" onclick="createTestImportFile()">üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</button>
					<button class="btn btn-danger" onclick="showResetDialog()">‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
				`;
			}
		}
		
		function printPsychologyReport() {
			if (appData.test.workType !== 'psychology') {
				showNotification('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤', 'warning');
				return;
			}
			
			const psychologyReport = generatePsychologyPrintReport();
			const fullReport = `
				<div class="header">
					<h1>üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ</h1>
					<h2>${appData.test.subject || '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞'}, ${appData.test.class || '–ö–ª–∞—Å—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</h2>
					<p><strong>–ú–µ—Ç–æ–¥–∏–∫–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'} | <strong>–î–∞—Ç–∞:</strong> ${appData.test.testDate ? new Date(appData.test.testDate).toLocaleDateString() : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
				</div>
				${psychologyReport}
				<div class="section small-text text-center">
					<p><em>–ó–∞–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–æ ${new Date().toLocaleDateString()}. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.</em></p>
				</div>
			`;
			
			const printWindow = window.open('', '_blank');
			printWindow.document.write(`
				<!DOCTYPE html>
				<html>
				<head>
					<title>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ - ${appData.test.theme}</title>
					<meta charset="UTF-8">
					<style>
						body { 
							font-family: 'Arial', sans-serif; 
							margin: 0; 
							padding: 15mm; 
							line-height: 1.5;
							color: #333;
							font-size: 11pt;
						}
						@page {
							size: A4;
							margin: 20mm;
						}
						.header { 
							text-align: center; 
							margin-bottom: 25px;
							padding-bottom: 15px;
							border-bottom: 2px solid #9b59b6;
							background: linear-gradient(135deg, #8e44ad, #9b59b6);
							color: white;
							padding: 20px;
							border-radius: 8px;
						}
						.section { 
							margin: 25px 0; 
							page-break-inside: avoid;
						}
						.section-title {
							color: #8e44ad;
							margin: 20px 0 15px 0;
							padding-bottom: 8px;
							border-bottom: 1px solid #9b59b6;
							font-size: 1.3em;
							font-weight: bold;
						}
						table { 
							width: 100%; 
							border-collapse: collapse; 
							margin: 15px 0;
							font-size: 10pt;
							page-break-inside: avoid;
						}
						th, td { 
							border: 1px solid #ddd; 
							padding: 8px; 
							text-align: left; 
							vertical-align: top;
						}
						th { 
							background-color: #8e44ad; 
							color: white; 
							font-weight: bold;
						}
						.recommendation-card {
							background: #f5eef8;
							padding: 15px;
							margin: 15px 0;
							border-radius: 6px;
							border-left: 4px solid #9b59b6;
						}
						.print-break { 
							page-break-before: always; 
						}
						.small-text { font-size: 9pt; }
						.text-center { text-align: center; }
						ul {
							margin: 10px 0;
							padding-left: 25px;
						}
						li {
							margin: 6px 0;
						}
						.level-indicator {
							display: inline-block;
							padding: 3px 10px;
							border-radius: 12px;
							font-size: 10pt;
							margin: 2px;
							color: white;
							font-weight: bold;
						}
						.psychology-note {
							background: #fff8e1;
							border: 1px solid #ffd54f;
							padding: 10px;
							margin: 15px 0;
							border-radius: 4px;
							font-size: 10pt;
						}
					</style>
				</head>
				<body>
					${fullReport}
				</body>
				</html>
			`);
			
			printWindow.document.close();
			
			setTimeout(() => {
				printWindow.print();
				setTimeout(() => {
					printWindow.close();
				}, 500);
			}, 500);
			
			showNotification('–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –ø–µ—á–∞—Ç–∏', 'success');
		}
		
		// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑–∞—Ç—å —Å—ã—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
		function showRawFileContent(encodedContent) {
			try {
				const content = atob(encodedContent);
				
				let html = `
					<h3>üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞</h3>
					<div style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<pre style="font-size: 10px; white-space: pre-wrap; word-break: break-all;">${content}</pre>
					</div>
					<div style="margin-top: 15px;">
						<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
					</div>
				`;
				
				showModal('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞', html);
				
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ', 'error');
			}
		}


		// 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function validateImportedData(data) {
			// –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
			if (!data || typeof data !== 'object') {
				console.error('–î–∞–Ω–Ω—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º:', data);
				return false;
			}
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ appData –∏–ª–∏ –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
			if (!data.appData && !data.test) {
				console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç appData –∏–ª–∏ test:', data);
				return false;
			}
			
			// –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö
			const importedAppData = data.appData || data;
			
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
				const requiredKeys = ['test', 'tasks', 'students', 'results'];
				
				for (const key of requiredKeys) {
					if (!(key in importedAppData)) {
						console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á:', key);
						return false;
					}
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
				if (!Array.isArray(importedAppData.tasks)) {
					console.error('tasks –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.tasks);
					return false;
				}
				
				if (!Array.isArray(importedAppData.students)) {
					console.error('students –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.students);
					return false;
				}
				
				if (!Array.isArray(importedAppData.results)) {
					console.error('results –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.results);
					return false;
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ test –æ–±—ä–µ–∫—Ç–∞
				if (!importedAppData.test || typeof importedAppData.test !== 'object') {
					console.error('test –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º:', importedAppData.test);
					return false;
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º errors (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)
				if (importedAppData.errors && !Array.isArray(importedAppData.errors)) {
					console.error('errors –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.errors);
					return false;
				}
				
				// –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
				if (importedAppData.results.length > 0) {
					const firstResult = importedAppData.results[0];
					if (!Array.isArray(firstResult) && typeof firstResult !== 'number') {
						console.error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ results:', firstResult);
						return false;
					}
				}
				
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				return false;
			}
		}

		// 5. –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞ - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function showImportConfirmationDialog(importedData) {
			// –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
			const actualData = importedData.appData || importedData;
			const metadata = importedData.metadata || {};
			
			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
			const subject = metadata.subject || actualData.test?.subject || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const className = metadata.class || actualData.test?.class || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const studentCount = metadata.studentCount || actualData.students?.length || 0;
			const taskCount = metadata.taskCount || actualData.tasks?.length || 0;
			const exportDate = metadata.exportedAt || importedData.timestamp || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
			
			// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏
			const encodedData = safeEncode(importedData);
			
			const html = `
				<div style="max-width: 600px;">
					<h3>üîÑ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${subject}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
						<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${actualData.test?.workType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${studentCount}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${taskCount}</p>
						<p><strong>–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:</strong> ${exportDate}</p>
						<p><strong>–í–µ—Ä—Å–∏—è —Ñ–∞–π–ª–∞:</strong> ${importedData.version || '1.0'}</p>
					</div>
					
					<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
						<h4>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h4>
						<p>–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					</div>
					
					<div class="form-group">
						<label>
							<input type="checkbox" id="mergeData" checked>
							–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
						</label>
						<small style="display: block; color: #666; margin-top: 5px;">
							–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏: –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º, –∞ –Ω–µ –∑–∞–º–µ–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
						</small>
					</div>
					
					<div class="form-group">
						<label>–î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö:</label>
						<select id="conflictResolution">
							<option value="replace">–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</option>
							<option value="keep">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</option>
							<option value="merge">–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</option>
						</select>
					</div>
					
					<div class="form-group">
						<button class="btn" onclick="showDataPreview('${encodedData}')">
							üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
						</button>
					</div>
				</div>
			`;
			
			showModal('–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="confirmImport(true, '${encodedData}')">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
				</div>
			`);
		}

		// –í —Ä–∞–∑–¥–µ–ª —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
		function addDebugButtons() {
			const exportTab = document.querySelector('#export .export-buttons');
			if (exportTab) {
				exportTab.innerHTML += `
					<button class="btn btn-warning" onclick="createTestImportFile()">üß™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</button>
					<button class="btn btn-info" onclick="testDataStructure()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö</button>
				`;
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
		function testDataStructure() {
			console.log('–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ appData:', appData);
			console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:', validateImportedData({appData: appData}));
			
			let html = `
				<h3>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö</h3>
				<div style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
					<pre style="font-size: 10px; white-space: pre-wrap;">${JSON.stringify(appData, null, 2)}</pre>
				</div>
				<div style="margin-top: 15px;">
					<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
				</div>
			`;
			
			showModal('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö', html);
		}


		// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
		function showDataPreview(encodedData) {
			try {
				const importedData = safeDecode(encodedData);
				
				if (!importedData) {
					showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
					return;
				}
				
				const actualData = importedData.appData || importedData;
				
				let html = `
					<h3>üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
					<div style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<pre style="font-size: 10px; white-space: pre-wrap;">${JSON.stringify(actualData, null, 2)}</pre>
					</div>
					<div style="margin-top: 15px;">
						<button class="btn" 
								onclick="hideModal(); showImportConfirmationDialog(this)"
								data-import='${JSON.stringify(importedData).replace(/'/g, "&apos;")}'>
							–ù–∞–∑–∞–¥
						</button>
					</div>
				`;
				
				showModal('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö', html);
				
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
			}
		}

		// 6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function confirmImport(shouldImport, encodedData) {
			if (!shouldImport) {
				hideModal();
				return;
			}
			
			try {
				const importedData = JSON.parse(atob(encodedData));
				const mergeData = document.getElementById('mergeData')?.checked || false;
				const conflictResolution = document.getElementById('conflictResolution')?.value || 'replace';
				
				// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
				console.log('–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:', importedData);
				
				applyImportedData(importedData, mergeData, conflictResolution);
				
				hideModal();
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–º–ø–æ—Ä—Ç–µ
				if (importedData.metadata) {
					saveImportHistory(importedData.metadata);
				}
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
			}
		}

		// 7. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function applyImportedData(importedData, mergeData, conflictResolution) {
			const newData = importedData.appData || importedData;
			
			console.log('–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:', newData);
			console.log('–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:', conflictResolution);
			console.log('–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:', mergeData);
			
			if (!mergeData || conflictResolution === 'replace') {
				// –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö
				appData = JSON.parse(JSON.stringify(newData));
				console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–µ–Ω—ã');
				
			} else if (conflictResolution === 'merge') {
				console.log('–ù–∞—á–∏–Ω–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
        
				// 1. –û–±—ä–µ–¥–∏–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –Ω–æ–≤—ã—Ö)
				appData.test = { ...appData.test, ...newData.test };
				if (newData.test.criteria) {
					appData.test.criteria = { ...appData.test.criteria, ...newData.test.criteria };
				}

				// 2. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –ù–û–í–´–ï –∑–∞–¥–∞–Ω–∏—è –≤ –∫–æ–Ω–µ—Ü, –µ—Å–ª–∏ —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
				// –í–ê–ñ–ù–û: –ï—Å–ª–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞, –∑–∞–¥–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ù–ï–õ–¨–ó–Ø.
				// –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ —Ç–æ—Ç –∂–µ —Ç–µ—Å—Ç.
				if (newData.tasks.length > appData.tasks.length) {
					 const newTasksToAdd = newData.tasks.slice(appData.tasks.length);
					 appData.tasks = [...appData.tasks, ...newTasksToAdd];
				}

				// 3. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤
				const existingStudents = new Set(appData.students.map(s => s.toLowerCase().trim()));
				newData.students.forEach(student => {
					if (!existingStudents.has(student.toLowerCase().trim())) {
						appData.students.push(student);
						// –°—Ä–∞–∑—É —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
						appData.results.push(new Array(appData.tasks.length).fill(0));
					}
				});

				// 4. –í–ê–ñ–ù–û: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –º–∞—Å—Å–∏–≤–æ–≤ –ü–ï–†–ï–î –∑–∞–ª–∏–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
				adjustResultsArray();

				// 5. –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥–æ—Ç–æ–≤—ã, –∑–∞–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
				mergeResults(newData); // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—à—É –Ω–æ–≤—É—é —É–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ—à–∏–±–∫–∏
				if (newData.errors) {
					// –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏, –Ω–æ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –ø–æ—Ç–µ—Ä–∏
					appData.errors = [...appData.errors, ...newData.errors];
				}

				console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã');
				
			} else if (conflictResolution === 'keep') {
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–µ
				console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ...');
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö —É—á–∞—â–∏—Ö—Å—è
				const existingStudents = new Set(appData.students.map(s => s.toLowerCase().trim()));
				
				newData.students?.forEach(student => {
					const normalizedStudent = student.toLowerCase().trim();
					if (!existingStudents.has(normalizedStudent)) {
						appData.students.push(student);
						existingStudents.add(normalizedStudent);
						// –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
						appData.results.push(new Array(appData.tasks.length).fill(0));
					}
				});
				
				console.log('–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —É—á–∞—â–∏–µ—Å—è');
			}
			
			// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è
			adjustResultsArray();
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
			saveData();
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
			renderAll();
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–º–ø–æ—Ä—Ç–∞
			showImportStatistics(newData);
		}
		function renderPointsCriteria(system, count) {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			let html = `<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (–≤ –±–∞–ª–ª–∞—Ö)</h4>
						<p style="font-size: 12px; color: #666; margin-bottom: 15px;">
							–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–∞–ª–ª: <strong>${maxPossible}</strong>
						</p>`;
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				
				// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫–∏ 2-5
				const displayLevel = getDisplayLevel(system, i);
				const description = getLevelDescription(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayLevel} ${description}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-min" 
								   style="flex: 1;"
								   placeholder="–ú–∏–Ω. –±–∞–ª–ª—ã">
							<span>‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-max" 
								   style="flex: 1;"
								   placeholder="–ú–∞–∫—Å. –±–∞–ª–ª—ã">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function getDisplayLevel(system, levelIndex) {
			switch(system) {
				case 'standard':
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 2-5 –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
					return levelIndex === 1 ? '2 (–ù–µ—É–¥–æ–≤–ª.)' : 
						   levelIndex === 2 ? '3 (–£–¥–æ–≤–ª.)' : 
						   levelIndex === 3 ? '4 (–•–æ—Ä–æ—à–æ)' : 
						   levelIndex === 4 ? '5 (–û—Ç–ª–∏—á–Ω–æ)' : 
						   `–£—Ä–æ–≤–µ–Ω—å ${levelIndex + 1}`;
				
				case 'five_point':
					return levelIndex === 1 ? '1 (–û—á–µ–Ω—å –ø–ª–æ—Ö–æ)' :
						   levelIndex === 2 ? '2 (–ü–ª–æ—Ö–æ)' :
						   levelIndex === 3 ? '3 (–°—Ä–µ–¥–Ω–µ)' :
						   levelIndex === 4 ? '4 (–•–æ—Ä–æ—à–æ)' :
						   levelIndex === 5 ? '5 (–û—Ç–ª–∏—á–Ω–æ)' :
						   `–£—Ä–æ–≤–µ–Ω—å ${levelIndex}`;
				
				case 'ten_point':
					return levelIndex === 10 ? '10 (–ë–µ–∑—É–ø—Ä–µ—á–Ω–æ)' :
						   levelIndex >= 8 ? `${levelIndex} (–û—Ç–ª–∏—á–Ω–æ)` :
						   levelIndex >= 6 ? `${levelIndex} (–•–æ—Ä–æ—à–æ)` :
						   levelIndex >= 4 ? `${levelIndex} (–£–¥–æ–≤–ª.)` :
						   `${levelIndex} (–ü–ª–æ—Ö–æ)`;
				
				default:
					return `–£—Ä–æ–≤–µ–Ω—å ${levelIndex}`;
			}
		}

		function getLevelDescription(system, levelIndex) {
			// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
			if (system === 'standard') {
				return '(–î–∏–∞–ø–∞–∑–æ–Ω %)';
			}
			return '';
		}

		function setupCriteriaListeners() {
			// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏–º—É–º—ã/–º–∞–∫—Å–∏–º—É–º—ã
			document.querySelectorAll('.criteria-min').forEach(input => {
				input.addEventListener('change', function() {
					const level = this.id.replace('criteria', '').replace('min', '');
					const maxInput = document.getElementById(`criteria${level}max`);
					
					if (maxInput && parseInt(this.value) > parseInt(maxInput.value)) {
						maxInput.value = this.value;
					}
				});
			});
			
			document.querySelectorAll('.criteria-max').forEach(input => {
				input.addEventListener('change', function() {
					const level = this.id.replace('criteria', '').replace('max', '');
					const minInput = document.getElementById(`criteria${level}min`);
					
					if (minInput && parseInt(this.value) < parseInt(minInput.value)) {
						minInput.value = this.value;
					}
				});
			});
		}

		// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
		function updateCriteriaSystem() {
			const type = document.getElementById('criteriaType').value;
			const system = document.getElementById('criteriaSystem').value;
			let count = parseInt(document.getElementById('criteriaCount').value) || 4;
			
			// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã
			if (system === 'standard') {
				count = 4; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç 4 —É—Ä–æ–≤–Ω—è
				document.getElementById('criteriaCount').value = 4;
			} else if (system === 'five_point') {
				count = 5; // –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç 5 —É—Ä–æ–≤–Ω–µ–π
				document.getElementById('criteriaCount').value = 5;
			} else if (system === 'ten_point') {
				count = 10; // –î–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç 10 —É—Ä–æ–≤–Ω–µ–π
				document.getElementById('criteriaCount').value = 10;
			}
			
			appData.test.criteriaType = type;
			appData.test.criteriaSystem = system;
			appData.test.criteriaCount = count;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
			if (!appData.test.criteria || Object.keys(appData.test.criteria).length === 0) {
				initializeDefaultCriteria();
			}
			
			renderCriteriaSettings();
		}

		function initializeDefaultCriteria() {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			appData.test.criteria = {};
			
			if (system === 'standard') {
				// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (2-5): 4 —É—Ä–æ–≤–Ω—è
				appData.test.criteria = {
					1: { min: 0, max: Math.round(maxPossible * 0.49) },         // 2
					2: { min: Math.round(maxPossible * 0.5), max: Math.round(maxPossible * 0.69) }, // 3
					3: { min: Math.round(maxPossible * 0.7), max: Math.round(maxPossible * 0.84) }, // 4
					4: { min: Math.round(maxPossible * 0.85), max: maxPossible } // 5
				};
			} else if (system === 'five_point') {
				// –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (1-5): 5 —É—Ä–æ–≤–Ω–µ–π
				appData.test.criteria = {
					1: { min: 0, max: Math.round(maxPossible * 0.2) },          // 1
					2: { min: Math.round(maxPossible * 0.21), max: Math.round(maxPossible * 0.4) }, // 2
					3: { min: Math.round(maxPossible * 0.41), max: Math.round(maxPossible * 0.6) }, // 3
					4: { min: Math.round(maxPossible * 0.61), max: Math.round(maxPossible * 0.8) }, // 4
					5: { min: Math.round(maxPossible * 0.81), max: maxPossible } // 5
				};
			} else if (system === 'ten_point') {
				// –î–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (1-10): 10 —É—Ä–æ–≤–Ω–µ–π
				const step = maxPossible / 10;
				for (let i = 1; i <= 10; i++) {
					appData.test.criteria[i] = {
						min: Math.round((i - 1) * step),
						max: Math.round(i * step)
					};
				}
			}
		}

		// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
		function renderCriteriaSettings() {
			const container = document.getElementById('criteriaSettingsContainer');
			if (!container) return;
			
			const type = appData.test.criteriaType || 'points';
			const system = appData.test.criteriaSystem || 'standard';
			let count = appData.test.criteriaCount || 4;
			
			// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤—Å–µ–≥–¥–∞ 4 —É—Ä–æ–≤–Ω—è
			if (system === 'standard') {
				count = 4;
			}
			
			console.log('renderCriteriaSettings:', { type, system, count });
			
			let html = `
				<div class="form-group">
					<label>–¢–∏–ø –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è:</label>
					<select id="criteriaType" onchange="updateCriteriaSystem()">
						<option value="points" ${type === 'points' ? 'selected' : ''}>–ë–∞–ª–ª—ã</option>
						<option value="percentage" ${type === 'percentage' ? 'selected' : ''}>–ü—Ä–æ—Ü–µ–Ω—Ç—ã (%)</option>
						<option value="custom" ${type === 'custom' ? 'selected' : ''}>–°–≤–æ—è —à–∫–∞–ª–∞</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è:</label>
					<select id="criteriaSystem" onchange="updateCriteriaSystem()">
						<option value="standard" ${system === 'standard' ? 'selected' : ''}>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)</option>
						<option value="five_point" ${system === 'five_point' ? 'selected' : ''}>–ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)</option>
						<option value="ten_point" ${system === 'ten_point' ? 'selected' : ''}>–î–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-10)</option>
						<option value="custom" ${system === 'custom' ? 'selected' : ''}>–°–≤–æ—è —Å–∏—Å—Ç–µ–º–∞</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π:</label>
					<input type="number" id="criteriaCount" min="2" max="10" 
						   value="${count}" ${system === 'standard' ? 'disabled' : ''} 
						   onchange="updateCriteriaSystem()"
						   style="${system === 'standard' ? 'background: #f0f0f0;' : ''}">
					${system === 'standard' ? '<small style="color: #666;">–î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 4 —É—Ä–æ–≤–Ω—è</small>' : ''}
				</div>
			`;
			
			// –î–æ–±–∞–≤–ª—è–µ–º –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã
			html += addCriteriaPresets();
			
			// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏
			html += '<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">';
			
			if (type === 'percentage') {
				html += '<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)</h4>';
				html += renderPercentageCriteria(system, count);
			} else if (type === 'points') {
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				html += `<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (–≤ –±–∞–ª–ª–∞—Ö)</h4>
						 <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
							–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–∞–ª–ª: <strong>${maxPossible}</strong>
						 </p>`;
				html += renderPointsCriteria(system, count, maxPossible);
			} else {
				html += '<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —à–∫–∞–ª—ã</h4>';
				html += '<p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Å–µ—Ç—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É</p>';
			}
			
			html += '</div>';
			
			container.innerHTML = html;
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
			setupCriteriaListeners();
		}
		
		function debugCriteria() {
			console.log('=== –û–¢–õ–ê–î–ö–ê –ö–†–ò–¢–ï–†–ò–ï–í ===');
			console.log('–¢–∏–ø:', appData.test.criteriaType);
			console.log('–°–∏—Å—Ç–µ–º–∞:', appData.test.criteriaSystem);
			console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:', appData.test.criteriaCount);
			console.log('–ö—Ä–∏—Ç–µ—Ä–∏–∏:', appData.test.criteria);
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —É—Ä–æ–≤–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
			const count = appData.test.criteriaCount || 0;
			for (let i = 1; i <= count; i++) {
				if (!appData.test.criteria[i]) {
					console.error(`‚ùå –ö—Ä–∏—Ç–µ—Ä–∏–π ${i} –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!`);
				}
			}
		}

		function renderPercentageCriteria(system, count) {
			let html = '';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const displayName = getCriteriaDisplayName(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayName}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="100" step="1"
								   class="criteria-input"
								   placeholder="–ú–∏–Ω. %">
							<span style="color: #666;">‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="100" step="1"
								   class="criteria-input"
								   placeholder="–ú–∞–∫—Å. %">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function renderPointsCriteria(system, count, maxPossible) {
			let html = '';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const displayName = getCriteriaDisplayName(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayName}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-input"
								   placeholder="–ú–∏–Ω. –±–∞–ª–ª—ã">
							<span style="color: #666;">‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-input"
								   placeholder="–ú–∞–∫—Å. –±–∞–ª–ª—ã">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function getCriteriaDisplayName(system, level) {
			if (system === 'standard') {
				const names = ['2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', 
							   '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
				return names[level - 1] || `–£—Ä–æ–≤–µ–Ω—å ${level + 1}`;
			} else if (system === 'five_point') {
				const names = ['1 (–û—á–µ–Ω—å –ø–ª–æ—Ö–æ)', '2 (–ü–ª–æ—Ö–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', 
							   '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
				return names[level - 1] || `–£—Ä–æ–≤–µ–Ω—å ${level}`;
			} else {
				return `–£—Ä–æ–≤–µ–Ω—å ${level}`;
			}
		}
		
		function renderSimplePercentageCriteria(count) {
			let html = '<h4>üéØ –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏</h4><div class="criteria-grid">';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const levelName = i === 1 ? '2' : i === 2 ? '3' : i === 3 ? '4' : '5';
				
				html += `
					<div class="criteria-item">
						<label>–û—Ü–µ–Ω–∫–∞ ${levelName}:</label>
						<input type="number" id="criteria${i}min" placeholder="–ú–∏–Ω" 
							   value="${criteria.min}" min="0" max="100" 
							   oninput="updateSimpleCriteria(${i}, 'min', this.value)">
						<input type="number" id="criteria${i}max" placeholder="–ú–∞–∫—Å" 
							   value="${criteria.max}" min="0" max="100"
							   oninput="updateSimpleCriteria(${i}, 'max', this.value)">
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}
		
		function renderSimplePointsCriteria(count) {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			let html = `<h4>üìä –ë–∞–ª–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–º–∞–∫—Å–∏–º—É–º: ${maxPossible})</h4><div class="criteria-grid">`;
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const levelName = i === 1 ? '2' : i === 2 ? '3' : i === 3 ? '4' : '5';
				
				html += `
					<div class="criteria-item">
						<label>–û—Ü–µ–Ω–∫–∞ ${levelName}:</label>
						<input type="number" id="criteria${i}min" placeholder="–ú–∏–Ω" 
							   value="${criteria.min}" min="0" max="${maxPossible}" 
							   oninput="updateSimpleCriteria(${i}, 'min', this.value)">
						<input type="number" id="criteria${i}max" placeholder="–ú–∞–∫—Å" 
							   value="${criteria.max}" min="0" max="${maxPossible}"
							   oninput="updateSimpleCriteria(${i}, 'max', this.value)">
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}		
		
		function updateSimpleCriteria(level, field, value) {
			if (!appData.test.criteria[level]) {
				appData.test.criteria[level] = { min: 0, max: 0 };
			}
			appData.test.criteria[level][field] = parseInt(value) || 0;
			saveData();
		}
		
		function renderPercentageCriteria() {
			const count = appData.test.criteriaCount;
			const system = appData.test.criteriaSystem;
			
			let labels = [];
			if (system === 'standard') {
				labels = ['2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
			} else if (system === 'five_point') {
				labels = ['1 (–û—á–µ–Ω—å –ø–ª–æ—Ö–æ)', '2 (–ü–ª–æ—Ö–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
			} else if (system === 'ten_point') {
				labels = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
			} else {
				labels = appData.test.customCriteria.map(c => c.name) || Array.from({length: count}, (_, i) => `–£—Ä–æ–≤–µ–Ω—å ${i+1}`);
			}
			
			let html = '<h4>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤</h4>';
			html += '<div class="criteria-grid">';
			
			for (let i = 0; i < count; i++) {
				const label = labels[i] || `–£—Ä–æ–≤–µ–Ω—å ${i+1}`;
				const min = appData.test.criteria[i+1]?.min || 0;
				const max = appData.test.criteria[i+1]?.max || 100;
				
				html += `
					<div class="criteria-item">
						<label>${label}:</label>
						<div style="display: flex; gap: 5px; align-items: center;">
							<input type="number" 
								   id="criteria${i+1}min" 
								   placeholder="–ú–∏–Ω %" 
								   value="${min}" 
								   min="0" max="100"
								   oninput="updatePercentageCriteria(${i+1}, 'min', this.value)">
							<span>-</span>
							<input type="number" 
								   id="criteria${i+1}max" 
								   placeholder="–ú–∞–∫—Å %" 
								   value="${max}" 
								   min="0" max="100"
								   oninput="updatePercentageCriteria(${i+1}, 'max', this.value)">
						</div>
						<div style="margin-top: 5px;">
							<input type="text" 
								   id="criteria${i+1}label" 
								   placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è"
								   value="${appData.test.customCriteria[i]?.description || ''}"
								   oninput="updateCriteriaLabel(${i+1}, this.value)"
								   style="width: 100%; font-size: 12px;">
						</div>
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}

		function renderPercentageCriteria(system, count) {
			let html = '<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)</h4>';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				
				// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫–∏ 2-5
				const displayLevel = getDisplayLevel(system, i);
				const description = getLevelDescription(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayLevel} ${description}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="100" step="1"
								   class="criteria-min" 
								   style="flex: 1;"
								   placeholder="–ú–∏–Ω. %">
							<span>‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="100" step="1"
								   class="criteria-max" 
								   style="flex: 1;"
								   placeholder="–ú–∞–∫—Å. %">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function calculatePercentageRange(min, max, total) {
			if (total === 0) return '';
			const minPercent = Math.round((min / total) * 100);
			const maxPercent = Math.round((max / total) * 100);
			return `(${minPercent}% - ${maxPercent}%)`;
		}

		function renderCustomScaleCriteria() {
			const count = appData.test.criteriaCount;
			
			let html = '<h4>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–≤–æ–µ–π —à–∫–∞–ª—ã</h4>';
			html += '<p><small>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</small></p>';
			html += '<div class="criteria-grid">';
			
			for (let i = 0; i < count; i++) {
				const criterion = appData.test.customCriteria[i] || {
					name: `–£—Ä–æ–≤–µ–Ω—å ${i+1}`,
					min: 0,
					max: 0,
					description: '',
					color: getDefaultColor(i, count)
				};
				
				html += `
					<div class="criteria-item" style="border-left-color: ${criterion.color}">
						<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
							<input type="color" 
								   value="${criterion.color}"
								   onchange="updateCriteriaColor(${i}, this.value)"
								   style="width: 30px; height: 30px;">
							<input type="text" 
								   value="${criterion.name}"
								   onchange="updateCriteriaName(${i}, this.value)"
								   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è"
								   style="flex: 1;">
						</div>
						
						<div style="margin: 5px 0;">
							<label>–î–∏–∞–ø–∞–∑–æ–Ω:</label>
							<div style="display: flex; gap: 5px; align-items: center;">
								<input type="number" 
									   value="${criterion.min}"
									   onchange="updateCustomCriteria(${i}, 'min', this.value)"
									   placeholder="–ú–∏–Ω">
								<span>-</span>
								<input type="number" 
									   value="${criterion.max}"
									   onchange="updateCustomCriteria(${i}, 'max', this.value)"
									   placeholder="–ú–∞–∫—Å">
								<select onchange="updateCustomCriteria(${i}, 'type', this.value)" style="flex: 1;">
									<option value="points" ${criterion.type === 'points' ? 'selected' : ''}>–±–∞–ª–ª–æ–≤</option>
									<option value="percentage" ${criterion.type === 'percentage' ? 'selected' : ''}>%</option>
								</select>
							</div>
						</div>
						
						<div>
							<textarea 
								placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è (—á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å?)"
								onchange="updateCustomCriteria(${i}, 'description', this.value)"
								style="width: 100%; height: 60px; font-size: 12px; margin-top: 5px;">${criterion.description || ''}</textarea>
						</div>
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}

		function getDefaultColor(index, total) {
			const colors = [
				'#e74c3c', '#f39c12', '#3498db', '#27ae60',
				'#9b59b6', '#e67e22', '#1abc9c', '#d35400'
			];
			return colors[index % colors.length];
		}

		// –§—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
		function updatePercentageCriteria(level, field, value) {
			if (!appData.test.criteria[level]) {
				appData.test.criteria[level] = { min: 0, max: 0 };
			}
			appData.test.criteria[level][field] = parseInt(value) || 0;
			saveData();
		}

		function updatePointsCriteria(level, field, value) {
			if (!appData.test.criteria[level]) {
				appData.test.criteria[level] = { min: 0, max: 0 };
			}
			appData.test.criteria[level][field] = parseInt(value) || 0;
			saveData();
		}

		function updateCustomCriteria(index, field, value) {
			if (!appData.test.customCriteria[index]) {
				appData.test.customCriteria[index] = {
					name: `–£—Ä–æ–≤–µ–Ω—å ${index+1}`,
					min: 0,
					max: 0,
					description: '',
					color: getDefaultColor(index, appData.test.criteriaCount),
					type: 'points'
				};
			}
			appData.test.customCriteria[index][field] = value;
			saveData();
		}

		function updateCriteriaLabel(level, value) {
			if (!appData.test.customCriteria[level-1]) {
				appData.test.customCriteria[level-1] = {
					name: `–£—Ä–æ–≤–µ–Ω—å ${level}`,
					description: '',
					color: getDefaultColor(level-1, appData.test.criteriaCount)
				};
			}
			appData.test.customCriteria[level-1].description = value;
			saveData();
		}

		function updateCriteriaName(index, value) {
			if (!appData.test.customCriteria[index]) {
				appData.test.customCriteria[index] = {
					name: value,
					min: 0,
					max: 0,
					description: '',
					color: getDefaultColor(index, appData.test.criteriaCount)
				};
			}
			appData.test.customCriteria[index].name = value;
			saveData();
		}

		function updateCriteriaColor(index, value) {
			if (!appData.test.customCriteria[index]) {
				appData.test.customCriteria[index] = {
					name: `–£—Ä–æ–≤–µ–Ω—å ${index+1}`,
					min: 0,
					max: 0,
					description: '',
					color: value
				};
			}
			appData.test.customCriteria[index].color = value;
			saveData();
			renderCriteriaSettings();
		}

		function updateCustomLevels(value) {
			const levels = value.split(',').map(l => l.trim()).filter(l => l.length > 0);
			appData.test.customCriteria = levels.map((name, index) => ({
				name: name,
				min: 0,
				max: 0,
				description: '',
				color: getDefaultColor(index, levels.length),
				type: 'points'
			}));
			appData.test.criteriaCount = levels.length;
			saveData();
			renderCriteriaSettings();
		}

		// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –æ—Ü–µ–Ω–∫–∏
		function calculateGradeByPercentage(percentage) {
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			console.log('calculateGradeByPercentage:', { percentage, system, count });
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i];
				console.log(`Checking criteria ${i}:`, criteria);
				
				if (criteria && percentage >= criteria.min && percentage <= criteria.max) {
					console.log(`Found in criteria ${i}`);
					
					if (system === 'standard') {
						// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º 1-4 –≤ 2-5 –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
						const grade = i === 1 ? 2 : i + 1;
						console.log('Standard system grade:', grade);
						return grade;
					} else if (system === 'five_point' || system === 'ten_point') {
						console.log('Five/Ten point system grade:', i);
						return i;
					} else if (system === 'custom') {
						const customCriterion = appData.test.customCriteria[i-1];
						const grade = customCriterion ? customCriterion.name : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
						console.log('Custom system grade:', grade);
						return grade;
					} else {
						console.log('Default grade:', i);
						return i;
					}
				}
			}
			
			// –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –Ω–∏ –≤ –æ–¥–∏–Ω –¥–∏–∞–ø–∞–∑–æ–Ω
			console.log('Not found in any criteria');
			return system === 'standard' ? 2 : '?';
		}

		function calculateGradeByPercentage(percentage) {
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i];
				if (criteria && percentage >= criteria.min && percentage <= criteria.max) {
					if (system === 'standard') {
						// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º 1-4 –≤ 2-5 –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
						return i === 1 ? 2 : i + 1;
					} else if (system === 'five_point') {
						return i;
					} else if (system === 'ten_point') {
						return i;
					} else {
						// –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
						const customCriterion = appData.test.customCriteria[i-1];
						return customCriterion ? customCriterion.name : i;
					}
				}
			}
			
			return appData.test.criteriaSystem === 'standard' ? 2 : 1;
		}

		function calculateGradeByPoints(totalScore) {
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			console.log('calculateGradeByPoints:', { totalScore, system, count });
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i];
				console.log(`Checking criteria ${i}:`, criteria);
				
				if (criteria && totalScore >= criteria.min && totalScore <= criteria.max) {
					console.log(`Found in criteria ${i}`);
					
					if (system === 'standard') {
						const grade = i === 1 ? 2 : i + 1;
						console.log('Standard system grade:', grade);
						return grade;
					} else if (system === 'five_point' || system === 'ten_point') {
						console.log('Five/Ten point system grade:', i);
						return i;
					} else if (system === 'custom') {
						const customCriterion = appData.test.customCriteria[i-1];
						const grade = customCriterion ? customCriterion.name : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
						console.log('Custom system grade:', grade);
						return grade;
					} else {
						console.log('Default grade:', i);
						return i;
					}
				}
			}
			
			console.log('Not found in any criteria');
			return system === 'standard' ? 2 : '?';
		}


		function calculateGradeByCustomScale(totalScore, maxPossible) {
			const criteria = appData.test.customCriteria;
			
			if (!criteria || criteria.length === 0) {
				console.log('No custom criteria found');
				return '?';
			}
			
			console.log('calculateGradeByCustomScale:', { totalScore, maxPossible, criteria });
			
			const percentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			console.log('Percentage for custom scale:', percentage);
			
			for (let i = 0; i < criteria.length; i++) {
				const criterion = criteria[i];
				console.log(`Checking custom criterion ${i}:`, criterion);
				
				if (!criterion) continue;
				
				let valueToCheck = totalScore;
				if (criterion.type === 'percentage') {
					valueToCheck = percentage;
				}
				
				console.log(`Value to check for criterion ${i}:`, valueToCheck);
				
				if (valueToCheck >= criterion.min && valueToCheck <= criterion.max) {
					console.log(`Found in custom criterion ${i}:`, criterion.name);
					return criterion.name;
				}
			}
			
			console.log('Not found in any custom criteria');
			return criteria.length > 0 ? criteria[criteria.length-1].name : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
		}

		// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
		function showImportStatistics(newData) {
			const importedStudents = newData.students?.length || 0;
			const importedTasks = newData.tasks?.length || 0;
			const importedErrors = newData.errors?.length || 0;
			
			console.log(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${importedStudents} —É—á–∞—â–∏—Ö—Å—è, ${importedTasks} –∑–∞–¥–∞–Ω–∏–π, ${importedErrors} –æ—à–∏–±–æ–∫`);
		}

		// 8. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
		function mergeResults(newData) {
			// 1. –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —É—á–µ–Ω–∏–∫–æ–≤: "–§–ò–û" -> –ò–Ω–¥–µ–∫—Å –≤ —Ç–µ–∫—É—â–µ–π —Ç–∞–±–ª–∏—Ü–µ
			const studentMap = {};
			appData.students.forEach((student, index) => {
				studentMap[student.toLowerCase().trim()] = index;
			});

			// 2. –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π (–ò–º–ø–æ—Ä—Ç -> –¢–µ–∫—É—â–µ–µ)
			const taskMapping = new Map();
			
			// –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è
			newData.tasks.forEach((newTask, newIndex) => {
				// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ï—Å–ª–∏ –µ—Å—Ç—å ID (–±—É–¥—É—â–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
				if (newTask.id) {
					const existingIndex = appData.tasks.findIndex(t => t.id === newTask.id);
					if (existingIndex !== -1) {
						taskMapping.set(newIndex, existingIndex);
						return;
					}
				}

				// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –°—Ç—Ä–æ–≥–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º 
				// (–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã)
				if (appData.tasks[newIndex] && 
					appData.tasks[newIndex].type === newTask.type &&
					appData.tasks[newIndex].maxScore === newTask.maxScore) {
					taskMapping.set(newIndex, newIndex);
					return;
				}

				// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è (–¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π)
				// –ò—â–µ–º –ø–µ—Ä–≤–æ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –µ—â–µ –Ω–µ –±—ã–ª–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
				const foundIndex = appData.tasks.findIndex((t, i) => 
					!Array.from(taskMapping.values()).includes(i) && // –ï—â–µ –Ω–µ –∑–∞–Ω—è—Ç–æ
					t.type === newTask.type && 
					t.maxScore === newTask.maxScore && 
					t.level === newTask.level
				);

				if (foundIndex !== -1) {
					taskMapping.set(newIndex, foundIndex);
				}
			});

			console.log('–ö–∞—Ä—Ç–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π:', taskMapping);

			// 3. –ü–µ—Ä–µ–Ω–æ—Å–∏–º –æ—Ü–µ–Ω–∫–∏
			newData.students.forEach((studentName, sourceStudentIndex) => {
				const targetStudentIndex = studentMap[studentName.toLowerCase().trim()];
				
				// –ï—Å–ª–∏ —Ç–∞–∫–æ–π —É—á–µ–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π —Ç–∞–±–ª–∏—Ü–µ
				if (targetStudentIndex !== undefined) {
					const sourceScores = newData.results[sourceStudentIndex] || [];
					
					sourceScores.forEach((score, sourceTaskIndex) => {
						const targetTaskIndex = taskMapping.get(sourceTaskIndex);
						
						// –ï—Å–ª–∏ –º—ã –Ω–∞—à–ª–∏, –∫—É–¥–∞ –ø–æ–ª–æ–∂–∏—Ç—å —ç—Ç—É –æ—Ü–µ–Ω–∫—É
						if (targetTaskIndex !== undefined) {
							const currentScore = appData.results[targetStudentIndex][targetTaskIndex] || 0;
							// –ï—Å–ª–∏ –Ω–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –±–æ–ª—å—à–µ 0 –∏–ª–∏ –≤ —Ç–µ–∫—É—â–µ–π –ø—É—Å—Ç–æ - –æ–±–Ω–æ–≤–ª—è–µ–º
							// (–õ–æ–≥–∏–∫–∞: –Ω–µ –∑–∞—Ç–∏—Ä–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω—É–ª—è–º–∏, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∑–∞–º–µ–Ω–∞)
							if (score > 0 || (currentScore === 0 && score === 0)) {
								appData.results[targetStudentIndex][targetTaskIndex] = score;
							}
						}
					});
				}
			});
		}

		// 9. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Å–∏–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
		function adjustResultsArray() {
			const expectedLength = appData.students.length;
			const taskCount = appData.tasks.length;
			
			// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			if (appData.results.length > expectedLength) {
				appData.results = appData.results.slice(0, expectedLength);
			}
			
			// –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			while (appData.results.length < expectedLength) {
				appData.results.push(new Array(taskCount).fill(0));
			}
			
			// –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–ª–∏–Ω—É –∫–∞–∂–¥–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			appData.results.forEach((studentResults, index) => {
				if (studentResults.length > taskCount) {
					appData.results[index] = studentResults.slice(0, taskCount);
				} else if (studentResults.length < taskCount) {
					const missing = taskCount - studentResults.length;
					for (let i = 0; i < missing; i++) {
						studentResults.push(0);
					}
				}
			});
		}

		// 10. –ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
		function saveExportHistory() {
			const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
			history.push({
				timestamp: new Date().toISOString(),
				filename: generateExportFilename(),
				subject: appData.test.subject,
				class: appData.test.class,
				studentCount: appData.students.length,
				taskCount: appData.tasks.length
			});
			
			// –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∑–∞–ø–∏—Å–µ–π
			localStorage.setItem('exportHistory', JSON.stringify(history.slice(-20)));
		}

		function saveImportHistory(metadata) {
			const history = JSON.parse(localStorage.getItem('importHistory') || '[]');
			history.push({
				timestamp: new Date().toISOString(),
				metadata: metadata,
				subject: appData.test.subject,
				class: appData.test.class
			});
			
			// –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∑–∞–ø–∏—Å–µ–π
			localStorage.setItem('importHistory', JSON.stringify(history.slice(-20)));
		}

		// 11. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
		function showTransferHistory() {
			const exportHistory = JSON.parse(localStorage.getItem('exportHistory') || '[]');
			const importHistory = JSON.parse(localStorage.getItem('importHistory') || '[]');
			
			let html = `
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
					<div>
						<h4>üì§ –ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞</h4>
						${exportHistory.length > 0 ? 
							exportHistory.reverse().map(item => `
								<div class="backup-item">
									<strong>${new Date(item.timestamp).toLocaleString()}</strong><br>
									<small>${item.filename}</small><br>
									<small>${item.subject} - ${item.class} (${item.studentCount} —É—á., ${item.taskCount} –∑–∞–¥.)</small>
								</div>
							`).join('') : 
							'<p>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</p>'
						}
					</div>
					
					<div>
						<h4>üì• –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–∞</h4>
						${importHistory.length > 0 ? 
							importHistory.reverse().map(item => `
								<div class="backup-item">
									<strong>${new Date(item.timestamp).toLocaleString()}</strong><br>
									<small>${item.metadata?.subject || item.subject} - ${item.metadata?.class || item.class}</small><br>
									<small>${item.metadata?.exportedAt || ''}</small>
								</div>
							`).join('') : 
							'<p>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–º–ø–æ—Ä—Ç–∞</p>'
						}
					</div>
				</div>
				
				<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
					<h4>üí° –°–æ–≤–µ—Ç—ã –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É –¥–∞–Ω–Ω—ã—Ö</h4>
					<ul>
						<li>–†–µ–≥—É–ª—è—Ä–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π</li>
						<li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (Google Drive, –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
						<li>–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤—ã–±–∏—Ä–∞–π—Ç–µ —Ä–µ–∂–∏–º "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
						<li>–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞</li>
					</ul>
				</div>
			`;
			
			showModal('–ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∏–º–ø–æ—Ä—Ç–∞', html);
		}

		// 12. –ë—ã—Å—Ç—Ä–æ–µ –º–µ–Ω—é —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
		function showQuickTransferMenu() {
			const html = `
				<div style="text-align: center; padding: 20px;">
					<h3>üîÑ –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</h3>
					<p>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</p>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
						<div style="text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì§</div>
							<h4>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</p>
							<button class="btn btn-success" onclick="exportToFile()" style="width: 100%;">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–π–ª</button>
							<button class="btn" onclick="showExportOptions()" style="width: 100%; margin-top: 10px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
						</div>
						
						<div style="text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì•</div>
							<h4>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞</p>
							<button class="btn btn-warning" onclick="importFromFile()" style="width: 100%;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</button>
							<button class="btn" onclick="showImportOptions()" style="width: 100%; margin-top: 10px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
						</div>
					</div>
					
					<div style="background: #e8f4fc; padding: 15px; border-radius: 8px; text-align: left;">
						<h4>üì± –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:</h4>
						<ol>
							<li>–ù–∞ —Ä–∞–±–æ—Ç–µ: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ —Ñ–∞–π–ª</li>
							<li>–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π –∫–æ–º–ø—å—é—Ç–µ—Ä (—Ñ–ª–µ—à–∫–∞, –æ–±–ª–∞–∫–æ, email)</li>
							<li>–î–æ–º–∞: –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–∞–±–æ—Ç—É</li>
							<li>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –¥–æ–º–∞ —Å–Ω–æ–≤–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ</li>
							<li>–ù–∞ —Ä–∞–±–æ—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
						</ol>
					</div>
				</div>
			`;
			
			showModal('–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏', html);
		}

		// 13. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
		function showExportOptions() {
			const html = `
				<h3>üì§ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
				
				<div class="form-group">
					<label>–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
					<select id="exportFormat">
						<option value="json">–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON) - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</option>
						<option value="json_min">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)</option>
						<option value="csv">–¢–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (CSV)</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:</label>
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
						<label><input type="checkbox" id="exportSettings" checked> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</label>
						<label><input type="checkbox" id="exportTasks" checked> –ó–∞–¥–∞–Ω–∏—è</label>
						<label><input type="checkbox" id="exportStudents" checked> –£—á–∞—â–∏—Ö—Å—è</label>
						<label><input type="checkbox" id="exportResults" checked> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</label>
						<label><input type="checkbox" id="exportErrors" checked> –û—à–∏–±–∫–∏</label>
						<label><input type="checkbox" id="exportHistory"> –ò—Å—Ç–æ—Ä–∏—é</label>
					</div>
				</div>
				
				<div class="form-group">
					<label>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:</label>
					<input type="password" id="exportPassword" placeholder="–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" style="width: 100%;">
					<small style="color: #666;">–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞—Ä–æ–ª—è –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã</small>
				</div>
				
				<button class="btn btn-success" onclick="performCustomExport()">–í—ã–ø–æ–ª–Ω–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç</button>
			`;
			
			showModal('–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞', html);
		}

		// 14. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞
		function showImportOptions(data, fileName) {
			const html = `
				<div style="max-width: 600px;">
					<h3>üìÇ –û–±–Ω–∞—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω —Ä–∞–±–æ—Ç—ã</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>${data.test.theme || '–®–∞–±–ª–æ–Ω'}</h4>
						<p><strong>–¢–∏–ø:</strong> ${workTypes[data.test.workType]?.name || data.test.workType}</p>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${data.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${data.tasks.length}</p>
					</div>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
						<div style="background: #fff3cd; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer;"
							 onclick="importAsTemplate('${encodeURIComponent(JSON.stringify(data))}', '${fileName}')">
							<div style="font-size: 2em;">üéØ</div>
							<h5>–ò–º–ø–æ—Ä—Ç –∫–∞–∫ —à–∞–±–ª–æ–Ω</h5>
							<p><small>–°–æ—Ö—Ä–∞–Ω–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–¥–∞–Ω–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫</small></p>
						</div>
						
						<div style="background: #d1ecf1; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer;"
							 onclick="importAsData('${encodeURIComponent(JSON.stringify(data))}')">
							<div style="font-size: 2em;">üìä</div>
							<h5>–ò–º–ø–æ—Ä—Ç –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ</h5>
							<p><small>–¢–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —à–∞–±–ª–æ–Ω–∞</small></p>
						</div>
					</div>
				</div>
			`;
			
			showModal('–í—ã–±–æ—Ä —Ç–∏–ø–∞ –∏–º–ø–æ—Ä—Ç–∞', html);
		}

		function importAsTemplate(encodedData, fileName) {
			const templateData = {
				file: { name: fileName },
				data: JSON.parse(decodeURIComponent(encodedData))
			};
			
			window.templateFilesData = [templateData];
			selectTemplate(0);
		}

		function importAsData(encodedData) {
			const data = JSON.parse(decodeURIComponent(encodedData));
			showImportConfirmationSimple(data);
		}
		
		// 15. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
		function previewImportFile() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json,.txt,application/json';
			
			input.onchange = function(event) {
				const file = event.target.files[0];
				if (!file) return;
				
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const content = e.target.result;
						const importedData = JSON.parse(content);
						
						if (validateImportedData(importedData)) {
							showImportPreview(importedData);
						} else {
							showNotification('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª', 'error');
						}
					} catch (error) {
						showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
					}
				};
				
				reader.readAsText(file);
			};
			
			input.click();
		}

		// 16. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
		function showImportPreview(importedData) {
			const data = importedData.appData;
			
			let html = `
				<h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
				
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${data.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${data.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–¢–µ–º–∞:</strong> ${data.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[data.test.workType]?.name || data.test.workType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
					</div>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${data.tasks.length}</p>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${data.students.length}</p>
						<p><strong>–û—à–∏–±–æ–∫:</strong> ${data.errors.length}</p>
						<p><strong>–î–∞—Ç–∞:</strong> ${data.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
					</div>
				</div>
				
				<h4>üë• –£—á–∞—â–∏–µ—Å—è (–ø–µ—Ä–≤—ã–µ 5):</h4>
				<div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 6px;">
					<ul>
						${data.students.slice(0, 5).map(student => `<li>${student}</li>`).join('')}
						${data.students.length > 5 ? `<li>... –∏ –µ—â–µ ${data.students.length - 5} —É—á–∞—â–∏—Ö—Å—è</li>` : ''}
					</ul>
				</div>
				
				<h4 style="margin-top: 20px;">üìù –ó–∞–¥–∞–Ω–∏—è (–ø–µ—Ä–≤—ã–µ 5):</h4>
				<div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 6px;">
					<ul>
						${data.tasks.slice(0, 5).map(task => `<li>${task.type} (–º–∞–∫—Å. ${task.maxScore} –±–∞–ª–ª–æ–≤, —É—Ä–æ–≤–µ–Ω—å ${task.level})</li>`).join('')}
						${data.tasks.length > 5 ? `<li>... –∏ –µ—â–µ ${data.tasks.length - 5} –∑–∞–¥–∞–Ω–∏–π</li>` : ''}
					</ul>
				</div>
				
				<div style="margin-top: 20px; background: #fff3cd; padding: 15px; border-radius: 8px;">
					<h4>‚ö†Ô∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</h4>
					<p><strong>–¢–µ–∫—É—â–∏–µ —É—á–∞—â–∏–µ—Å—è:</strong> ${appData.students.length}</p>
					<p><strong>–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ —É—á–∞—â–∏–µ—Å—è:</strong> ${data.students.length}</p>
					<p><strong>–°–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –∏–º–µ–Ω:</strong> ${countCommonStudents(data.students)}</p>
				</div>
				
				<div style="margin-top: 20px; display: flex; gap: 10px;">
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="confirmImportPreview('${btoa(JSON.stringify(importedData))}')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–º–ø–æ—Ä—Ç</button>
				</div>
			`;
			
			showModal('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö', html);
		}

		// 17. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function countCommonStudents(newStudents) {
			const currentStudentsSet = new Set(appData.students);
			return newStudents.filter(student => currentStudentsSet.has(student)).length;
		}

		function confirmImportPreview(encodedData) {
			hideModal();
			setTimeout(() => {
				confirmImport(true, encodedData);
			}, 300);
		}
		let autoBackupInterval = null; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID —Ç–∞–π–º–µ—Ä–∞
		// 18. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
		function setupAutoBackup() {
			// –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª—É—à–∞—Ç–µ–ª—è beforeunload
			// (–ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω–æ, –Ω–æ –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
			if (!window.hasBackupListener) {
				window.addEventListener('beforeunload', function() {
					createBackup();
					localStorage.setItem('lastAutoBackup', new Date().toISOString());
				});
				window.hasBackupListener = true;
			}
			
			// –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
			if (autoBackupInterval) {
				clearInterval(autoBackupInterval);
			}
			
			// –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π
			autoBackupInterval = setInterval(function() {
				if (document.hasFocus()) { 
					createBackup();
					console.log('–ê–≤—Ç–æ—Ä–µ–∑–µ—Ä–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞');
				}
			}, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
			
			showNotification('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ', 'success');
		}

		// 19. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
		function restoreLastBackup() {
			const backups = Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.sort()
				.reverse();
			
			if (backups.length > 0) {
				restoreBackup(backups[0]);
			} else {
				showNotification('–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning');
			}
		}

		// ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================

		// 20. –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
		
		function addTransferButtonsToUI() {
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
			
			// –í —Ä–∞–∑–¥–µ–ª —ç–∫—Å–ø–æ—Ä—Ç–∞
			const exportTab = document.querySelector('#export .export-buttons');
			if (exportTab) {
				exportTab.innerHTML += `
					<button class="btn" onclick="exportToFile()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª</button>
					<button class="btn" onclick="importFromFile()">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞</button>
					<button class="btn" onclick="showQuickTransferMenu()">üîÑ –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–Ω–æ—Å</button>
					<button class="btn" onclick="showTransferHistory()">üìã –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤</button>
				`;
			}
			
			// –í –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–∫–ª–∞–¥–∫—É
			const tabs = document.querySelector('.tabs');
			if (tabs) {
				const transferTab = document.createElement('button');
				transferTab.className = 'tab-btn';
				transferTab.innerHTML = 'üîÑ –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö';
				transferTab.onclick = () => showTab('transfer');
				tabs.appendChild(transferTab);
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
				const container = document.querySelector('.container');
				const transferContent = document.createElement('div');
				transferContent.id = 'transfer';
				transferContent.className = 'tab-content';
				transferContent.innerHTML = `
					<h2>üîÑ –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</h2>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 30px 0;">
						<div class="chart-container" style="text-align: center;">
							<h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
							<div style="font-size: 4em; margin: 20px;">üì§</div>
							<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</p>
							<button class="btn btn-success" onclick="exportToFile()" style="width: 100%; margin: 10px 0;">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–π–ª</button>
							<button class="btn" onclick="showExportOptions()" style="width: 100%;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
							
							<div style="margin-top: 30px; text-align: left;">
								<h4>üì± –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:</h4>
								<ol>
									<li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
									<li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª</li>
									<li>–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ –¥—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</li>
									<li>–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–æ–≤–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
									<li>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</li>
								</ol>
							</div>
						</div>
						
						<div class="chart-container" style="text-align: center;">
							<h3>üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
							<div style="font-size: 4em; margin: 20px;">üì•</div>
							<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã</p>
							<button class="btn btn-warning" onclick="importFromFile()" style="width: 100%; margin: 10px 0;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</button>
							<button class="btn" onclick="showImportOptions()" style="width: 100%;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
							
							<div style="margin-top: 30px; text-align: left;">
								<h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
								<ul>
									<li>–†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</li>
									<li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
									<li>–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞</li>
									<li>–•—Ä–∞–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π —Ñ–∞–π–ª–æ–≤</li>
								</ul>
							</div>
						</div>
					</div>
					
					<div class="chart-container">
						<h3>üìã –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
						<div style="display: flex; gap: 10px; flex-wrap: wrap;">
							<button class="btn" onclick="showTransferHistory()">üìú –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
							<button class="btn" onclick="restoreLastBackup()">üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button>
							<button class="btn" onclick="setupAutoBackup()">‚è∞ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ—Ä–µ–∑–µ—Ä–≤–∫—É</button>
							<button class="btn" onclick="showBackupManagement()">üóÉÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏</button>
						</div>
					</div>
					
					<div class="chart-container">
						<h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
						<div class="kpi-grid">
							<div class="kpi-card">
								<div class="kpi-value">${appData.students.length}</div>
								<div class="kpi-label">–£—á–∞—â–∏—Ö—Å—è</div>
							</div>
							<div class="kpi-card">
								<div class="kpi-value">${appData.tasks.length}</div>
								<div class="kpi-label">–ó–∞–¥–∞–Ω–∏–π</div>
							</div>
							<div class="kpi-card">
								<div class="kpi-value">${appData.errors.length}</div>
								<div class="kpi-label">–û—à–∏–±–æ–∫</div>
							</div>
							<div class="kpi-card">
								<div class="kpi-value">${new Date().toLocaleDateString()}</div>
								<div class="kpi-label">–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞</div>
							</div>
						</div>
					</div>
				`;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏
				const lastTab = document.querySelector('.tab-content:last-of-type');
				if (lastTab) {
					lastTab.parentNode.insertBefore(transferContent, lastTab.nextSibling);
				} else {
					container.appendChild(transferContent);
				}
			}
		}


		// 21. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
			//setTimeout(() => {
			//	addTransferButtonsToUI();
			//}, 1000);
			//setTimeout(() => {
			//	addDebugButtons();
			//}, 1000);
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è)
			setTimeout(() => {
				addImportExportButtons();
			}, 500);
			
			
			    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
			setTimeout(() => {
				if (appData.students.length === 0 && appData.tasks.length === 0) {
					// –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
					console.log('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞.');
				}
			}, 1000);
			
			// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–≤—Ç–æ—Ä–µ–∑–µ—Ä–≤–∫—É
			setupAutoBackup();
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
			checkForUnsavedData();
		});
		// –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–∏ 2 —Ñ—É–Ω–∫—Ü–∏–∏ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
		function workingExport() {
			const data = JSON.stringify(appData, null, 2);
			const blob = new Blob([data], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = '–¥–∞–Ω–Ω—ã–µ.json';
			a.click();
			showNotification('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
		}
		
		// 14. –≠–ö–°–¢–†–ï–ù–ù–´–ô –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
		function emergencyExport() {
			// –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
			let exportText = `–≠–ö–°–¢–†–ï–ù–ù–´–ô –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–•\n`;
			exportText += `–ü—Ä–µ–¥–º–µ—Ç: ${appData.test.subject}\n`;
			exportText += `–ö–ª–∞—Å—Å: ${appData.test.class}\n`;
			exportText += `–î–∞—Ç–∞: ${new Date().toLocaleString()}\n\n`;
			
			exportText += `–£–ß–ê–©–ò–ï–°–Ø –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´:\n`;
			appData.students.forEach((student, index) => {
				const totalScore = appData.results[index]?.reduce((sum, score) => sum + score, 0) || 0;
				const grade = calculateGrade(totalScore);
				exportText += `${student}: ${totalScore} –±–∞–ª–ª–æ–≤ (–æ—Ü–µ–Ω–∫–∞ ${grade})\n`;
			});
			
			const blob = new Blob([exportText], { type: 'text/plain' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `—ç–∫—Å–ø–æ—Ä—Ç_${new Date().toISOString().slice(0, 10)}.txt`;
			a.click();
			URL.revokeObjectURL(url);
			
			showNotification('–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
		}


		function emergencyImport() {
			if (confirm('–≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
				loadStandardSample();
			}
		}

		// –î–æ–±–∞–≤–ª—è–µ–º —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
		console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:');
		console.log('- simpleExport() - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö');
		console.log('- simpleImport() - –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö');
		console.log('- emergencyExport() - —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç');
		console.log('- emergencyImport() - —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç');
		console.log('- createSampleFile() - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞');		
		
		
		// –£–¢–ò–õ–ò–¢–ê–†–ù–´–ï –§–£–ù–ö–¶–ò–ò –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏
		function safeEncode(data) {
			try {
				// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –∏ –∫–æ–¥–∏—Ä—É–µ–º
				const str = JSON.stringify(data);
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É URI –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏
				return encodeURIComponent(str);
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				return '';
			}
		}
		
		function safeDecode(encodedData) {
			try {
				// –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∏–∑ URI
				const str = decodeURIComponent(encodedData);
				return JSON.parse(str);
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				return null;
			}
		}

		function workingImport() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json';
			input.onchange = function(e) {
				const file = e.target.files[0];
				const reader = new FileReader();
				reader.onload = function(e) {
					try {
						appData = JSON.parse(e.target.result);
						saveData();
						renderAll();
						showNotification('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
					} catch (err) {
						showNotification('–û—à–∏–±–∫–∞: ' + err.message, 'error');
					}
				};
				reader.readAsText(file);
			};
			input.click();
		}
		// 22. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
		function checkForUnsavedData() {
			const lastSave = localStorage.getItem('lastAutoSave');
			const lastBackup = localStorage.getItem('lastAutoBackup');
			
			if (lastSave && lastBackup) {
				const saveTime = new Date(lastSave);
				const backupTime = new Date(lastBackup);
				const now = new Date();
				
				// –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 30 –º–∏–Ω—É—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
				if ((now - saveTime) > 30 * 60 * 1000) {
					showNotification('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö', 'warning');
				}
			}
		}

		// 23. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
		function showBackupManagement() {
			const backups = Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.map(key => ({
					key,
					data: JSON.parse(localStorage.getItem(key)),
					size: JSON.stringify(localStorage.getItem(key)).length
				}))
				.sort((a, b) => new Date(b.data.timestamp) - new Date(a.data.timestamp));
			
			let html = `
				<h3>üóÉÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏</h3>
				<p>–í—Å–µ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π: ${backups.length}</p>
				
				<div style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
					${backups.map((backup, index) => `
						<div class="backup-item" style="display: flex; justify-content: space-between; align-items: center;">
							<div>
								<strong>${backup.data.timestamp}</strong><br>
								<small>${backup.data.data.test.subject} - ${backup.data.data.test.class}</small><br>
								<small>${Math.round(backup.size / 1024)} –ö–ë</small>
							</div>
							<div style="display: flex; gap: 5px;">
								<button class="btn btn-sm" onclick="restoreBackup('${backup.key}')">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
								<button class="btn btn-sm btn-danger" onclick="deleteBackup('${backup.key}')">–£–¥–∞–ª–∏—Ç—å</button>
								<button class="btn btn-sm" onclick="exportBackup('${backup.key}')">–≠–∫—Å–ø–æ—Ä—Ç</button>
							</div>
						</div>
					`).join('')}
				</div>
				
				<div style="display: flex; gap: 10px; margin-top: 20px;">
					<button class="btn btn-danger" onclick="deleteAllBackups()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–ø–∏–∏</button>
					<button class="btn" onclick="createBackup()">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–ø–∏—é</button>
					<button class="btn" onclick="exportAllBackups()">üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</button>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏', html);
		}
		// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Å–∫—Ä–∏–ø—Ç–∞
		document.addEventListener('DOMContentLoaded', function() {
			console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏...');
			setTimeout(updateVisualization, 1000);
		});
		// 24. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
		function deleteBackup(key) {
			if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é?')) {
				localStorage.removeItem(key);
				showBackupManagement();
				showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
			}
		}

		function deleteAllBackups() {
			if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
				Object.keys(localStorage)
					.filter(key => key.startsWith('backup_'))
					.forEach(key => localStorage.removeItem(key));
				showBackupManagement();
				showNotification('–í—Å–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —É–¥–∞–ª–µ–Ω—ã', 'success');
			}
		}

		function exportBackup(key) {
			const backup = localStorage.getItem(key);
			const blob = new Blob([backup], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			
			const a = document.createElement('a');
			a.href = url;
			a.download = key + '.json';
			a.click();
			
			URL.revokeObjectURL(url);
		}

		function exportAllBackups() {
			const allBackups = {};
			Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.forEach(key => {
					allBackups[key] = JSON.parse(localStorage.getItem(key));
				});
			
			const dataStr = JSON.stringify(allBackups, null, 2);
			const blob = new Blob([dataStr], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			
			const a = document.createElement('a');
			a.href = url;
			a.download = `–≤—Å–µ_—Ä–µ–∑–µ—Ä–≤–Ω—ã–µ_–∫–æ–ø–∏–∏_${new Date().toISOString().split('T')[0]}.json`;
			a.click();
			
			URL.revokeObjectURL(url);
			showNotification('–í—Å–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
		}
		
		// –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
		function analyzeOverallLiteracyLevel(percentage) {
			if (percentage >= 80) {
				return {
					level: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
					title: '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–£—á–∞—â–∏–µ—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.',
					interpretation: '–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ, –ø–æ–∑–≤–æ–ª—è—é—â–µ–º —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏'
				};
			} else if (percentage >= 60) {
				return {
					level: '–ë–∞–∑–æ–≤—ã–π',
					title: '–î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–£—á–∞—â–∏–µ—Å—è –≤–ª–∞–¥–µ—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.',
					interpretation: '–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏'
				};
			} else if (percentage >= 40) {
				return {
					level: '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π',
					title: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.',
					interpretation: '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π'
				};
			} else {
				return {
					level: '–ù–∞—á–∞–ª—å–Ω—ã–π',
					title: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–£—á–∞—â–∏–µ—Å—è –∏—Å–ø—ã—Ç—ã–≤–∞—é—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π.',
					interpretation: '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –≤—Å–µ—Ö –≤–∏–¥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏'
				};
			}
		}
		function generateOGESpecializedReport() {
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞–Ω–∞–ª–∏–∑–∞
			updateGIAnalysis();
			const analysisContent = document.getElementById('specializedAnalysis').innerHTML;
			
			return `
				<h3>üéì –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠</h3>
				<p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculateAverageScore().toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateQualityRate().toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${appData.students.length}</div>
						<div class="stat-label">–£—á–∞—â–∏—Ö—Å—è</div>
					</div>
				</div>
				
				${analysisContent}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üìã –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠</h4>
					<ul>
						<li>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠</li>
						<li>–ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –Ω–∏–º–∏</li>
						<li>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö</li>
						<li>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–∞–Ω–∫–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤</li>
						<li>–ü—Ä–æ–±–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω –∑–∞ 1 –º–µ—Å—è—Ü –¥–æ –û–ì–≠</li>
					</ul>
				</div>
			`;
		}

        function generateEGESpecializedReport() {
            return `<h3>üéì –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ï–ì–≠</h3>
            <p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –µ–¥–∏–Ω–æ–≥–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞.</p>
            ${document.getElementById('specializedAnalysis').innerHTML}`;
        }

        function generateStandardSpecializedReport() {
            return `<h3>üìä –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
            <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã.</p>
            ${document.getElementById('taxonomyAnalysis').innerHTML}
            ${document.getElementById('errorsAnalysis').innerHTML}`;
        }

        function generateSpecializedReportHTML(title, description, content) {
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${title}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px solid #3498db; }
        .section { margin: 30px 0; }
		/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
		#literacyRadarChart {
			max-height: 400px !important;
			width: 100% !important;
			margin: 0 auto;
		}

		/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
		.chart-container {
			position: relative;
			height: 400px;
			min-height: 400px;
		}
    </style>
</head>
<body>
    <div class="header">
        <h1>${title}</h1>
        <h2>${appData.test.subject}, ${appData.test.class}</h2>
        <p>${description}</p>
    </div>
    ${content}
</body>
</html>`;
        }

        // –û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è
        function exportForTeacher() {
            const reportContent = generateTeacherReport();
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–æ—Ç—á–µ—Ç_–¥–ª—è_—É—á–∏—Ç–µ–ª—è_${appData.test.subject}_${new Date().toLocaleDateString()}.html`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification("–û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", "success");
        }

        function generateTeacherReport() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            
            const difficultTasks = appData.tasks
                .map((task, index) => ({ task, index, completion: calculateTaskCompletion(index) }))
                .filter(t => t.completion < 60)
                .slice(0, 5);
            
            const atRiskStudents = appData.students
                .map((student, index) => ({
                    name: student,
                    score: totalScores[index],
                    grade: grades[index],
                    percentage: (totalScores[index] / appData.tasks.reduce((sum, task) => sum + task.maxScore, 0)) * 100
                }))
                .filter(s => s.grade === 2)
                .slice(0, 10);
            
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è - ${appData.test.theme}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
            color: #333;
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            padding-bottom: 20px; 
            border-bottom: 2px solid #3498db; 
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            border-radius: 10px;
        }
        .section { 
            margin: 30px 0; 
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .stat-value { 
            font-size: 2em; 
            font-weight: bold; 
            margin: 10px 0; 
            color: #2c3e50;
        }
        .stat-label { 
            font-size: 0.9em; 
            color: #7f8c8d;
        }
        .alert-card {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .success-card {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .task-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .student-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
		/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
		#literacyRadarChart {
			max-height: 400px !important;
			width: 100% !important;
			margin: 0 auto;
		}

		/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
		.chart-container {
			position: relative;
			height: 400px;
			min-height: 400px;
		}
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã –û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è</h1>
        <h2>${appData.test.subject}, ${appData.test.class}</h2>
        <p><strong>–¢–µ–º–∞ —Ä–∞–±–æ—Ç—ã:</strong> ${appData.test.theme}</p>
        <p><strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
    </div>
    
    <div class="section">
        <h3>üìä –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">${avgScore.toFixed(1)}</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${successRate.toFixed(1)}%</div>
                <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${qualityRate.toFixed(1)}%</div>
                <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${appData.test.presentStudents}</div>
                <div class="stat-label">–ü–∏—Å–∞–ª–æ —Ä–∞–±–æ—Ç—É</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã</h3>
        ${successRate >= 70 ? 
            '<div class="success-card"><strong>‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞:</strong> –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ –æ—Å–≤–æ–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª.</div>' :
            '<div class="alert-card"><strong>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∞—Å—Å–æ–º.</div>'
        }
        
        ${difficultTasks.length > 0 ? `
            <div class="alert-card">
                <strong>üîç –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã:</strong>
                <ul>
                    ${difficultTasks.map(task => 
                        `<li>–ó–∞–¥–∞–Ω–∏–µ ${task.index + 1} "${task.task.type}" - ${task.completion.toFixed(1)}% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</li>`
                    ).join('')}
                </ul>
            </div>
        ` : '<div class="success-card"><strong>‚úÖ –í—Å–µ –∑–∞–¥–∞–Ω–∏—è —É—Å–≤–æ–µ–Ω—ã —Ö–æ—Ä–æ—à–æ</strong></div>'}
    </div>
    
    <div class="section">
        <h3>üë• –£—á–∞—â–∏–µ—Å—è, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è</h3>
        ${atRiskStudents.length > 0 ? `
            <div class="student-list">
                <p><strong>–£—á–∞—â–∏–µ—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (${atRiskStudents.length} —á–µ–ª.):</strong></p>
                <ul>
                    ${atRiskStudents.map(student => 
                        `<li>${student.name} - ${student.score} –±–∞–ª–ª–æ–≤ (${student.percentage.toFixed(1)}%)</li>`
                    ).join('')}
                </ul>
            </div>
        ` : '<div class="success-card"><strong>‚úÖ –ù–µ—Ç —É—á–∞—â–∏—Ö—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</strong></div>'}
    </div>
    
    <div class="section">
        <h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        <div class="task-list">
            <p><strong>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É:</strong></p>
            <ul>
                <li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏</li>
                <li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
                ${difficultTasks.length > 0 ? '<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>' : ''}
                <li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω —É—Ä–æ–∫–∞ —Å —É—á–µ—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π</li>
                <li>–ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ä–∞–±–æ—Ç—ã</li>
            </ul>
        </div>
    </div>

    <div style="text-align: center; margin-top: 40px; color: #7f8c8d; font-size: 0.9em;">
        <p>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()}</p>
        <p>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
    </div>
	<div id="globalError" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #e74c3c; color: white; padding: 15px; border-radius: 8px; z-index: 9999; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
    ‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
</div>
</body>
</html>`;
        }

        function exportJSON() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–¥–∞–Ω–Ω—ã–µ_–∞–Ω–∞–ª–∏–∑–∞_${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification("–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON", "success");
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', function() {
            if (document.getElementById('visualization').classList.contains('active')) {
                setTimeout(() => {
                    updateCharts();
                    updateSolvabilityChart();
                }, 300);
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                hideModal();
            }
        });

    </script>
</body>
</html>