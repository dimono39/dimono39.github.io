<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .tabs {
            background: #34495e;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: none;
            color: white;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            flex: 1;
            min-width: 140px;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab-btn.active {
            background: #3498db;
            box-shadow: inset 0 -3px 0 #2980b9;
        }

        .tab-content {
            display: none;
            padding: 25px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏ */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 12pt;
            }
            
            .container {
                max-width: 100% !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                margin: 0 !important;
            }
            
            .tabs, .tab-btn, .btn, .search-box, input, select, textarea {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
                padding: 10mm !important;
                min-height: auto !important;
                page-break-after: always;
            }
            
            .tab-content:last-child {
                page-break-after: auto;
            }
            
            .header {
                background: #2c3e50 !important;
                padding: 10mm !important;
                margin-bottom: 5mm !important;
                color: white !important;
            }
            
            .chart-container {
                page-break-inside: avoid;
                break-inside: avoid;
                margin: 5mm 0 !important;
                padding: 3mm !important;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 3mm !important;
                margin: 3mm 0 !important;
            }
            
            .kpi-card {
                padding: 3mm !important;
                margin: 2mm 0 !important;
                border-left: 2px solid #3498db !important;
            }
            .kpi-card.success { border-left-color: #27ae60 !important; }
			.kpi-card.warning { border-left-color: #f39c12 !important; }
			.kpi-card.danger { border-left-color: #e74c3c !important; }

			.kpi-card.success .kpi-value { color: #27ae60; }
			.kpi-card.warning .kpi-value { color: #f39c12; }
			.kpi-card.danger .kpi-value { color: #e74c3c; }
            table {
                font-size: 10pt !important;
                margin: 2mm 0 !important;
            }
            
            th, td {
                padding: 1mm 2mm !important;
                border: 0.5pt solid #ddd !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ê4 */
            @page {
                size: A4;
                margin: 15mm;
            }
            
            body, .container {
                width: 210mm;
                height: 297mm;
            }

            .section-title {
                color: #2c3e50 !important;
                margin: 4mm 0 3mm 0 !important;
                padding-bottom: 2mm !important;
                border-bottom: 1pt solid #3498db !important;
                font-size: 14pt !important;
            }

            .recommendation-card {
                background: #f8f9fa !important;
                padding: 3mm !important;
                margin: 2mm 0 !important;
                border-left: 2px solid #3498db !important;
            }

            .heatmap-cell {
                font-size: 8pt !important;
                padding: 1mm !important;
            }
        }

        .print-only {
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin: 3px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-print {
            background: #9b59b6;
        }

        .btn-print:hover {
            background: #8e44ad;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .kpi-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
		
		.kpi-card.success { border-left-color: #27ae60 !important; }
		.kpi-card.warning { border-left-color: #f39c12 !important; }
		.kpi-card.danger { border-left-color: #e74c3c !important; }

		.kpi-card.success .kpi-value { color: #27ae60; }
		.kpi-card.warning .kpi-value { color: #f39c12; }
		.kpi-card.danger .kpi-value { color: #e74c3c; }
		
        .kpi-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #2c3e50;
            margin: 8px 0;
        }

        .kpi-label {
            color: #7f8c8d;
            font-size: 0.85em;
        }

        .table-container {
            overflow-x: auto;
            margin: 15px 0;
            font-size: 13px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 13px;
        }

        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
        }

        th:hover {
            background: #2c3e50;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e8f4fc;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #3498db;
            border-radius: 20px;
            font-size: 14px;
        }

        .chart-container {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 12px 0;
        }

        .criteria-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .task-item {
            background: #f8f9fa;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
        }

        .student-item {
            background: #f8f9fa;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .grade-5 { background-color: #d4edda !important; }
        .grade-4 { background-color: #fff3cd !important; }
        .grade-3 { background-color: #ffeaa7 !important; }
        .grade-2 { background-color: #f8d7da !important; }

        .level-1 { border-left-color: #27ae60 !important; }
        .level-2 { border-left-color: #3498db !important; }
        .level-3 { border-left-color: #f39c12 !important; }
        .level-4 { border-left-color: #e74c3c !important; }

        .zone-green { background-color: #d4edda !important; }
        .zone-yellow { background-color: #fff3cd !important; }
        .zone-red { background-color: #f8d7da !important; }

        .heatmap-cell { 
            text-align: center; 
            font-weight: bold;
            font-size: 11px;
        }
        .heatmap-100 { background-color: #27ae60; color: white; }
        .heatmap-80 { background-color: #87d37c; }
        .heatmap-60 { background-color: #fff3cd; }
        .heatmap-40 { background-color: #f9e79f; }
        .heatmap-20 { background-color: #f5b7b1; }
        .heatmap-0 { background-color: #e74c3c; color: white; }

        .error-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin: 2px;
            color: white;
        }
        .error-factual { background: #e74c3c; }
        .error-conceptual { background: #9b59b6; }
        .error-application { background: #3498db; }
        .error-calculation { background: #f39c12; }
        .error-logical { background: #d35400; }
        .error-attention { background: #16a085; }
        .error-technical { background: #7f8c8d; }

        .recommendation-card {
            background: #e8f4fc;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: 100%;
                font-size: 12px;
                padding: 12px 15px;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin: 2px 0;
            }
        }

        .section-title {
            color: #2c3e50;
            margin: 20px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-size: 1.3em;
        }

        .sub-section {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .print-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .work-type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin: 2px;
            background: #3498db;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
        .notification.warning { background: #f39c12; }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .comparative-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .comparative-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .comparative-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .comparative-value.positive { color: #27ae60; }
        .comparative-value.negative { color: #e74c3c; }

        .comparative-previous {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .comparative-diff {
            font-weight: bold;
            margin-top: 5px;
        }

        .comparative-diff.positive { color: #27ae60; }
        .comparative-diff.negative { color: #e74c3c; }

        .trend {
            font-size: 0.8em;
            margin-left: 5px;
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .backup-item {
            padding: 12px;
            border: 1px solid #ddd;
            margin: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .backup-item:hover {
            background: #e8f4fc;
            border-color: #3498db;
        }

        .smart-recommendation {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .recommendation-critical { 
            background: #f8d7da; 
            border-left-color: #e74c3c; 
        }
        .recommendation-warning { 
            background: #fff3cd; 
            border-left-color: #f39c12; 
        }
        .recommendation-info { 
            background: #d1ecf1; 
            border-left-color: #3498db; 
        }
		
		/* ==================== –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–ï–ß–ê–¢–ò ==================== */
		@media print {
			/* –°–∫—Ä—ã–≤–∞–µ–º –Ω–µ–ø–µ—á–∞—Ç–∞–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
			.no-print, .tabs, .tab-btn, .btn, .search-box, 
			input, select, textarea, .modal-overlay, .notification {
				display: none !important;
			}
			
			/* –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
			@page {
				size: A4;
				margin: 15mm;
				orphans: 3;
				widows: 3;
			}
			
			/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü */
			body {
				font-size: 12pt !important;
				line-height: 1.4 !important;
				color: black !important;
				background: white !important;
				padding: 0 !important;
				margin: 0 !important;
			}
			
			/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ê4 */
			.container {
				width: 210mm !important;
				max-width: 210mm !important;
				min-height: 297mm !important;
				margin: 0 !important;
				padding: 0 !important;
				box-shadow: none !important;
				border: none !important;
				background: white !important;
			}
			
			/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü */
			.page-break-before {
				page-break-before: always;
			}
			
			.page-break-after {
				page-break-after: always;
			}
			
			.avoid-break-inside {
				page-break-inside: avoid;
				break-inside: avoid;
			}
			
			/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
			.header {
				background: #2c3e50 !important;
				color: white !important;
				padding: 10mm !important;
				margin-bottom: 5mm !important;
				text-align: center !important;
				page-break-after: avoid;
			}
			
			.header h1 {
				font-size: 18pt !important;
				margin-bottom: 3mm !important;
			}
			
			/* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
			.tab-content {
				display: block !important;
				padding: 0 !important;
				min-height: auto !important;
				page-break-after: always;
			}
			
			.tab-content:last-of-type {
				page-break-after: auto;
			}
			
			/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ */
			.section-title {
				color: #2c3e50 !important;
				font-size: 14pt !important;
				font-weight: bold !important;
				margin: 8mm 0 4mm 0 !important;
				padding-bottom: 2mm !important;
				border-bottom: 1pt solid #3498db !important;
				page-break-after: avoid;
			}
			
			/* –ì—Ä–∞—Ñ–∏–∫–∏ */
			.chart-container {
				page-break-inside: avoid;
				break-inside: avoid;
				margin: 5mm 0 !important;
				padding: 3mm !important;
				border: 0.5pt solid #ddd !important;
				background: white !important;
			}
			
			canvas {
				max-width: 100% !important;
				height: auto !important;
			}
			
			/* –¢–∞–±–ª–∏—Ü—ã */
			table {
				font-size: 10pt !important;
				page-break-inside: avoid;
				break-inside: avoid;
				width: 100% !important;
				margin: 3mm 0 !important;
			}
			
			th, td {
				padding: 1.5mm 2mm !important;
				border: 0.5pt solid #ddd !important;
				text-align: left !important;
			}
			
			th {
				background: #f8f9fa !important;
				color: black !important;
				font-weight: bold !important;
				border-bottom: 1pt solid #2c3e50 !important;
			}
			
			/* KPI –∫–∞—Ä—Ç–æ—á–∫–∏ */
			.kpi-grid {
				grid-template-columns: repeat(4, 1fr) !important;
				gap: 3mm !important;
				margin: 3mm 0 !important;
				page-break-inside: avoid;
			}
			
			.kpi-card {
				padding: 3mm !important;
				margin: 2mm 0 !important;
				border-left: 3pt solid #3498db !important;
				page-break-inside: avoid;
			}
			
			/* –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ */
			.heatmap-cell {
				font-size: 9pt !important;
				padding: 1mm !important;
				text-align: center !important;
			}
			
			/* –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ */
			.recommendation-card {
				background: #f8f9fa !important;
				padding: 3mm !important;
				margin: 2mm 0 !important;
				border-left: 3pt solid #3498db !important;
				page-break-inside: avoid;
			}
			
			/* –ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü */
			.page-number {
				position: fixed;
				bottom: 10mm;
				right: 15mm;
				font-size: 10pt;
				color: #666;
			}
			
			/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–ª–æ—Ç–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ */
			.compact-table {
				font-size: 9pt !important;
			}
			
			.compact-table th, 
			.compact-table td {
				padding: 1mm !important;
			}
			
			/* –°–∫—Ä—ã—Ç—å –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
			.empty-section {
				display: none !important;
			}
			
			/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ */
			.chart-legend {
				font-size: 9pt !important;
				margin-top: 2mm !important;
			}
			
			.legend-item {
				margin-bottom: 1mm !important;
			}
		}		
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification"></div>

    <div class="container">
        <div class="header">
            <h1>üìä –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö, –í–ü–†, –û–ì–≠, –ï–ì–≠ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</p>
        </div>

        <div class="tabs no-print">
            <button class="tab-btn active" onclick="showTab('setup')">üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—Ç—ã</button>
            <button class="tab-btn" onclick="showTab('tasks')">üìù –¢–∞–∫—Å–æ–Ω–æ–º–∏—è –∑–∞–¥–∞–Ω–∏–π</button>
            <button class="tab-btn" onclick="showTab('students')">üë• –£—á–∞—â–∏–µ—Å—è</button>
            <button class="tab-btn" onclick="showTab('results')">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ—à–∏–±–∫–∏</button>
            <button class="tab-btn" onclick="showTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="showTab('visualization')">üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</button>
            <button class="tab-btn" onclick="showTab('recommendations')">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
            <button class="tab-btn" onclick="showTab('export')">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ -->
        <div id="setup" class="tab-content active">
            <h2>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã</h2>
            
            <div class="form-group">
                <label for="subject">–ü—Ä–µ–¥–º–µ—Ç:</label>
                <input type="text" id="subject" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" oninput="scheduleAutoSave()">
            </div>

            <div class="form-group">
                <label for="class">–ö–ª–∞—Å—Å:</label>
                <input type="text" id="class" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5–ê" oninput="scheduleAutoSave()">
            </div>

            <div class="form-group">
                <label for="testDate">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</label>
                <input type="date" id="testDate" onchange="scheduleAutoSave()">
            </div>

            <div class="form-group">
                <label for="testTheme">–¢–µ–º–∞ —Ä–∞–±–æ—Ç—ã:</label>
                <input type="text" id="testTheme" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î—Ä–æ–±–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã" oninput="scheduleAutoSave()">
            </div>

            <div class="form-group">
                <label for="testGoals">–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ü–µ–ª–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:</label>
                <textarea id="testGoals" rows="3" placeholder="–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∑–Ω–∞–Ω–∏—è, —É–º–µ–Ω–∏—è, –Ω–∞–≤—ã–∫–∏..." oninput="scheduleAutoSave()"></textarea>
            </div>

            <div class="form-group">
                <label for="workType">–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</label>
                <select id="workType" onchange="updateWorkType(); scheduleAutoSave();">
                    <option value="current">–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è</option>
                    <option value="milestone">–†—É–±–µ–∂–Ω–∞—è</option>
                    <option value="final">–ò—Ç–æ–≥–æ–≤–∞—è</option>
                    <option value="oge">–û–ì–≠</option>
                    <option value="ege">–ï–ì–≠</option>
                    <option value="vpr">–í–ü–†</option>
                    <option value="func_literacy">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å</option>
                    <option value="diagnostic">–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è</option>
					<option value="psychology">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</option>
                </select>
            </div>

            <div class="form-group">
                <label for="workFormat">–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã:</label>
                <select id="workFormat" onchange="scheduleAutoSave()">
                    <option value="traditional">–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è</option>
                    <option value="test">–¢–µ—Å—Ç</option>
                    <option value="mixed">–°–º–µ—à–∞–Ω–Ω–∞—è</option>
                    <option value="extended">–° —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º</option>
                </select>
            </div>

            <div class="form-group">
                <label for="timeLimit">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º–∏–Ω—É—Ç):</label>
                <input type="number" id="timeLimit" min="1" value="45" oninput="scheduleAutoSave()">
            </div>

            <div class="form-group">
                <label for="totalStudents">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è –ø–æ —Å–ø–∏—Å–∫—É:</label>
                <input type="number" id="totalStudents" min="1" max="100" value="25" oninput="scheduleAutoSave()">
            </div>

            <div class="form-group">
				<label for="presentStudents">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Å–∞–≤—à–∏—Ö —Ä–∞–±–æ—Ç—É:</label>
				<div style="display: flex; gap: 10px; align-items: center;">
					<input type="number" id="presentStudents" min="1" max="100" value="23" style="flex: 1;" oninput="scheduleAutoSave()">
					<button type="button" class="btn" onclick="syncStudentsCount()" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º —Å–ø–∏—Å–∫–æ–º">üîÑ</button>
				</div>
            </div>

            <div class="form-group">
                <label for="absentReason">–ü—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è:</label>
                <textarea id="absentReason" rows="2" placeholder="–£–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É—á–∞—â–∏—Ö—Å—è..." oninput="scheduleAutoSave()"></textarea>
            </div>
<!-- 
            <h3 class="section-title">üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h3>
			<div id="criteriaSettingsContainer"></div>
			<div class="form-group">
				<label>–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è:</label>
				<div class="criteria-grid">
					<div class="criteria-item">
						<label>5 (–æ—Ç–ª):</label>
						<input type="number" id="criteria5min" min="0" max="100" oninput="scheduleAutoSave()"> - 
						<input type="number" id="criteria5max" min="0" max="100" oninput="scheduleAutoSave()">
					</div>
					<div class="criteria-item">
						<label>4 (—Ö–æ—Ä):</label>
						<input type="number" id="criteria4min" min="0" max="100" oninput="scheduleAutoSave()"> - 
						<input type="number" id="criteria4max" min="0" max="100" oninput="scheduleAutoSave()">
					</div>
					<div class="criteria-item">
						<label>3 (—É–¥–æ–≤):</label>
						<input type="number" id="criteria3min" min="0" max="100" oninput="scheduleAutoSave()"> - 
						<input type="number" id="criteria3max" min="0" max="100" oninput="scheduleAutoSave()">
					</div>
					<div class="criteria-item">
						<label>2 (–Ω–µ—É–¥):</label>
						<input type="number" id="criteria2min" min="0" max="100" oninput="scheduleAutoSave()"> - 
						<input type="number" id="criteria2max" min="0" max="100" oninput="scheduleAutoSave()">
					</div>
				</div>
			</div> -->
			<!-- –î–æ–±–∞–≤–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ -->
			<div id="criteriaSettingsContainer">
				<!-- –°—é–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
			</div>
			
			<!-- –î–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
			<div style="margin-top: 15px;">
				<button class="btn btn-success" onclick="saveCriteriaSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏</button>
				<button class="btn" onclick="loadDefaultCriteria()">üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
				<button class="btn" onclick="generateAutoCriteria()">üéØ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
			</div>
			
			<!-- –î–æ–±–∞–≤–∏–º –ø—Ä–µ—Å–µ—Ç—ã -->
			<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
				<h4 style="margin: 0 0 10px 0;">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</h4>
				<div style="display: flex; flex-wrap: wrap; gap: 5px;">
					<button class="btn" onclick="applyPreset('standard_5')" style="font-size: 12px; padding: 5px 10px;">
						üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)
					</button>
					<button class="btn" onclick="applyPreset('five_point')" style="font-size: 12px; padding: 5px 10px;">
						1Ô∏è‚É£ –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)
					</button>
					<button class="btn" onclick="applyPreset('vpr_percent')" style="font-size: 12px; padding: 5px 10px;">
						üìù –í–ü–† (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
					</button>
					<button class="btn" onclick="applyPreset('psychology_levels')" style="font-size: 12px; padding: 5px 10px;">
						üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è (—É—Ä–æ–≤–Ω–∏)
					</button>
				</div>
			</div>
			
			<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
			<div class="recommendation-card" style="margin-top: 10px; font-size: 13px;">
				<strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong>
				<ul style="margin: 5px 0; padding-left: 20px;">
					<li><strong>–ë–∞–ª–ª—ã</strong> - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</li>
					<li><strong>–ü—Ä–æ—Ü–µ–Ω—Ç—ã</strong> - —É–¥–æ–±–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –í–ü–†</li>
					<li><strong>–°–≤–æ—è —à–∫–∞–ª–∞</strong> - –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</li>
				</ul>
			</div>

            <button class="btn btn-success" onclick="saveTestSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="btn btn-warning" onclick="loadSampleData()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä</button>
            <button class="btn" onclick="restoreBackupDialog()">üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button>
			<button class="btn btn-danger" onclick="showResetDialog()">‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ –∑–∞–¥–∞–Ω–∏–π -->
        <div id="tasks" class="tab-content">
            <h2>üìù –¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π</h2>
            <div id="tasksContainer"></div>
            <button class="btn btn-success" onclick="saveTasks()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —É—á–∞—â–∏—Ö—Å—è -->
        <div id="students" class="tab-content">
            <h2>üë• –°–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è</h2>
            <div id="studentsContainer"></div>
            <button class="btn btn-success" onclick="saveStudents()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫ -->
        <div id="results" class="tab-content">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏</h2>
            <button class="btn btn-warning" onclick="showBulkEditScores()">üìù –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</button>
            <div id="resultsContainer"></div>
            <button class="btn btn-success" onclick="saveResults()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
        <div id="analytics" class="tab-content">
            <h2>üìà –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            
            <div class="export-buttons">
                <button class="btn" onclick="showComparativeAnalysis()">üìà –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</button>
                <button class="btn" onclick="initAdvancedSearch()">üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</button>
                <button class="btn" onclick="showSmartRecommendations()">ü§ñ –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
            </div>
            
            <h3 class="section-title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="kpi-grid" id="kpiDashboard"></div>

            <h3 class="section-title">–¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
            <div id="taxonomyAnalysis"></div>

            <h3 class="section-title">–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h3>
            <div id="errorsAnalysis"></div>

            <h3 class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É—á–∞—â–∏—Ö—Å—è</h3>
            <div id="personalAnalysis"></div>

            <div id="specializedAnalysis"></div>
            
            <div id="smartRecommendationsContainer"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
        <div id="visualization" class="tab-content">
            <h2>üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
            
            <div class="print-controls no-print">
                <h4>üñ®Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—á–∞—Ç—å—é</h4>
                <p>–î–ª—è –ø–µ—á–∞—Ç–∏ –æ—Ç—á–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à Ctrl+P</p>
                <button class="btn btn-print" onclick="printFullReport()">üñ®Ô∏è –ü–µ—á–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞</button>
                <button class="btn" onclick="printOptimizedReport()">üìÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—á–∞—Ç—å</button>
            </div>
            
            <div class="chart-row">
                <div class="chart-container">
                    <h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h3>
                    <canvas id="gradesChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üéØ –ö–æ—Ä–∏–¥–æ—Ä —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π</h3>
                    <canvas id="solvabilityChart"></canvas>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #e74c3c"></div>
                            <span>–ö—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ (&lt;30%) - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f39c12"></div>
                            <span>–ñ–µ–ª—Ç–∞—è –∑–æ–Ω–∞ (30-60%) - —Ç—Ä–µ–±—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2ecc71"></div>
                            <span>–ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ (60-90%) - –º–∞—Ç–µ—Ä–∏–∞–ª —É—Å–≤–æ–µ–Ω —Ö–æ—Ä–æ—à–æ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #27ae60"></div>
                            <span>–û—Ç–ª–∏—á–Ω–∞—è –∑–æ–Ω–∞ (&gt;90%) - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìà –°–≤—è–∑—å —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏</h3>
                <canvas id="complexityChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h3>
                <div id="heatmapContainer"></div>
            </div>

            <div id="specializedCharts"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π -->
        <div id="recommendations" class="tab-content">
            <h2>üí° –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
            
            <div class="print-only">
                <div class="header" style="padding: 15px; margin-bottom: 20px;">
                    <h2 style="font-size: 1.5em; margin: 0;">–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h2>
                    <p style="margin: 5px 0;"><strong id="printSubjectClass"></strong> | <span id="printTheme"></span> | <span id="printDate"></span></p>
                </div>
            </div>
            
            <h3 class="section-title">–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</h3>
            <div id="keyConclusions"></div>

            <h3 class="section-title">–ü–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h3>
            <div id="correctionPlan"></div>

            <h3 class="section-title">–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏</h3>
            <div id="nextSteps"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
        <div id="export" class="tab-content">
            <h2>üíæ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤</h2>
            
            <div class="export-buttons">
                <button class="btn btn-success" onclick="exportHTML()">üìä –ü–æ–ª–Ω—ã–π HTML –æ—Ç—á–µ—Ç</button>
                <button class="btn btn-print" onclick="printFullReport()">üñ®Ô∏è –ü–µ—á–∞—Ç—å –Ω–∞ –ê4</button>
                <button class="btn" onclick="printOptimizedReport()">üìÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—á–∞—Ç—å</button>
                <button class="btn" onclick="exportToExcel()">üìä Excel –æ—Ç—á–µ—Ç</button>
                <button class="btn" onclick="exportToPDF()">üìÑ PDF –æ—Ç—á–µ—Ç</button>
                <button class="btn" onclick="exportJSON()">üíæ –î–∞–Ω–Ω—ã–µ (JSON)</button>
                <button class="btn" onclick="exportSpecializedReport()">üéØ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç</button>
                <button class="btn" onclick="exportForTeacher()">üë©‚Äçüè´ –û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è</button>
                <button class="btn" onclick="exportForEJournal()">üìí –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è —ç–ª.–¥–Ω–µ–≤–Ω–∏–∫–∞</button>
                <button class="btn" onclick="showComparativeAnalysis()">üìà –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</button>
                <button class="btn" onclick="showBulkEditScores()">üìù –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                <button class="btn" onclick="initAdvancedSearch()">üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</button>
				<button class="btn" onclick="printPsychologyReport()">üß† –ü–µ—á–∞—Ç—å –ø—Å–∏—Ö. –∑–∞–∫–ª—é—á–µ–Ω–∏—è</button>
				<button class="btn" onclick="exportAppData('json')">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (JSON)</button>
				<button class="btn btn-danger" onclick="showResetDialog()">‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
				<button class="btn btn-danger" onclick="showResetDialog()">‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>

				<!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
				<input type="file" id="fileImport" accept=".json" style="display: none;" onchange="handleFileImport(event)">
				<button class="btn" onclick="document.getElementById('fileImport').click()">üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            </div>

            <div class="chart-container">
                <h3>üìã –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h3>
                <div id="reportPreview"></div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let appData = {
			test: {
				subject: "",
				class: "",
				testDate: new Date().toISOString().split('T')[0],
				theme: "",
				goals: "",
				workType: "current",
				workFormat: "mixed",
				timeLimit: 45,
				totalStudents: 25,
				presentStudents: 23,
				absentReason: "",
				criteria: {
					5: { min: 18, max: 20 },
					4: { min: 15, max: 17 },
					3: { min: 10, max: 14 },
					2: { min: 0, max: 9 }
				},
				// –î–û–ë–ê–í–õ–Ø–ï–ú –ù–û–í–´–ï –ü–û–õ–Ø –î–õ–Ø –ì–ò–ë–ö–ò–• –ö–†–ò–¢–ï–†–ò–ï–í
				criteriaType: 'points',
				criteriaSystem: 'standard',
				customCriteria: [],
				criteriaCount: 4,
				criteriaScale: '2-5'
			},
			tasks: [],
			students: [],
			results: [],
			errors: [],
			psychologyFeatures: [] // –î–æ–±–∞–≤–ª—è–µ–º –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏
		};
		
		// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		window.gradesChartInstance = null;
		window.complexityChartInstance = null;
		window.solvabilityChartInstance = null;
		window.literacyChartInstance = null;
		window.literacyRadarChartInstance = null;
		window.trendChartInstance = null;
		
        // –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        const complexityLevels = {
            1: { name: "–ë–∞–∑–æ–≤—ã–π/–†–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π", color: "#27ae60", desc: "–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤, –ø—Ä–∞–≤–∏–ª, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π" },
            2: { name: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ", color: "#3498db", desc: "–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏" },
            3: { name: "–ê–Ω–∞–ª–∏–∑/–°–∏–Ω—Ç–µ–∑", color: "#f39c12", desc: "–∞–Ω–∞–ª–∏–∑, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è" },
            4: { name: "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ", color: "#e74c3c", desc: "—Ä–µ—à–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è" }
        };

        // –¢–∏–ø—ã –æ—à–∏–±–æ–∫
        const errorTypes = {
            factual: { name: "–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏", color: "#e74c3c", desc: "–Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞—Ç—ã, –∏–º–µ–Ω–∞, —Ñ–æ—Ä–º—É–ª—ã" },
            conceptual: { name: "–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏", color: "#9b59b6", desc: "–Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–æ—Ä–∏–∏, –∑–∞–∫–æ–Ω–æ–≤, –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤" },
            application: { name: "–û—à–∏–±–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è", color: "#3498db", desc: "–Ω–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —Ä–µ—à–µ–Ω–∏—è" },
            calculation: { name: "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏", color: "#f39c12", desc: "–æ—à–∏–±–∫–∏ –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö" },
            logical: { name: "–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏", color: "#d35400", desc: "–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è—Ö" },
            attention: { name: "–û—à–∏–±–∫–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", color: "#16a085", desc: "–Ω–µ–≤–µ—Ä–Ω–æ –ø—Ä–æ—á–µ–ª —É—Å–ª–æ–≤–∏–µ, –ø—Ä–æ–ø—É—Å—Ç–∏–ª –≤–æ–ø—Ä–æ—Å" },
            technical: { name: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏", color: "#7f8c8d", desc: "–µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ" }
        };

        // –¢–∏–ø—ã —Ä–∞–±–æ—Ç
        const workTypes = {
            current: { name: "–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è", criteria: "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ" },
            milestone: { name: "–†—É–±–µ–∂–Ω–∞—è", criteria: "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ" },
            final: { name: "–ò—Ç–æ–≥–æ–≤–∞—è", criteria: "–∏—Ç–æ–≥–æ–≤—ã–µ" },
            oge: { name: "–û–ì–≠", criteria: "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ" },
            ege: { name: "–ï–ì–≠", criteria: "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ" },
            vpr: { name: "–í–ü–†", criteria: "—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ" },
            func_literacy: { name: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", criteria: "–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–Ω—ã–µ" },
            diagnostic: { name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è", criteria: "–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ" },
			psychology: { 
        name: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", 
			criteria: "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ" 
		}
        };

        // –£—Ä–æ–≤–Ω–∏ –í–ü–†
        const vprLevels = {
            1: { name: "–ë–∞–∑–æ–≤—ã–π", color: "#27ae60" },
            2: { name: "–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π", color: "#3498db" }
        };

        // –ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –í–ü–†
        const vprCompetencies = {
            text_work: "–†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º",
            calculations: "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏", 
            logic: "–õ–æ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ",
            graphics: "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å",
            data_work: "–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏"
        };

        // –í–∏–¥—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
        const functionalLiteracyTypes = {
            reading: { name: "–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#3498db" },
            math: { name: "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#e74c3c" },
            science: { name: "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–Ω–∞—É—á–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#9b59b6" },
            financial: { name: "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#27ae60" },
            global: { name: "–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏", color: "#f39c12" },
            digital: { name: "–¶–∏—Ñ—Ä–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", color: "#34495e" }
        };

        // –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
        const literacyContexts = {
            personal: "–õ–∏—á–Ω—ã–π",
            educational: "–£—á–µ–±–Ω—ã–π", 
            professional: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π",
            social: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π",
            global: "–ì–ª–æ–±–∞–ª—å–Ω—ã–π"
        };

        // ==================== –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –†–ï–®–ï–ù–ò–Ø ====================

		// ==================== –ó–ê–©–ò–¢–ê –û–¢ –û–®–ò–ë–û–ö –í –í–´–ß–ò–°–õ–ï–ù–ò–Ø–• ====================
		function safeCalculateGrade(totalScore) {
			try {
				if (typeof totalScore !== 'number' || isNaN(totalScore)) {
					return 2;
				}
				
				if (!appData.test || !appData.test.criteria) {
					return 2;
				}
				
				// –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –æ—Ü–µ–Ω–∫—É
				for (let grade of [5, 4, 3, 2]) {
					const criteria = appData.test.criteria[grade];
					if (criteria && 
						typeof criteria.min === 'number' && 
						typeof criteria.max === 'number' &&
						totalScore >= criteria.min && 
						totalScore <= criteria.max) {
						return grade;
					}
				}
				
				return 2; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –æ—Ü–µ–Ω–∫–∏:', error);
				return 2;
			}
		}

		function safeCalculatePercentage(score, max) {
			try {
				if (typeof score !== 'number' || isNaN(score) || 
					typeof max !== 'number' || isNaN(max) || max <= 0) {
					return 0;
				}
				
				const percentage = (score / max) * 100;
				return Math.min(Math.max(percentage, 0), 100); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0-100%
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞:', error);
				return 0;
			}
		}

		function safeArrayReduce(arr, callback, initialValue) {
			try {
				if (!Array.isArray(arr) || arr.length === 0) {
					return initialValue || 0;
				}
				
				return arr.reduce(callback, initialValue);
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –≤ reduce:', error);
				return initialValue || 0;
			}
		}

        // 1. –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï –ò –†–ï–ó–ï–†–í–ù–û–ï –ö–û–ü–ò–†–û–í–ê–ù–ò–ï
        let saveTimeout;
        function scheduleAutoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveData();
                createBackup();
                showNotification('–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            }, 2000);
        }

        function createBackup() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const backup = {
                data: JSON.parse(JSON.stringify(appData)),
                timestamp: new Date().toLocaleString(),
                version: '1.0'
            };
            
            localStorage.setItem(`backup_${timestamp}`, JSON.stringify(backup));
            
            // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
            const backups = Object.keys(localStorage)
                .filter(key => key.startsWith('backup_'))
                .sort()
                .reverse()
                .slice(5);
            
            backups.forEach(key => localStorage.removeItem(key));
        }

        function restoreBackupDialog() {
            const backups = Object.keys(localStorage)
                .filter(key => key.startsWith('backup_'))
                .map(key => ({
                    key,
                    data: JSON.parse(localStorage.getItem(key)),
                    date: new Date(key.replace('backup_', '').replace(/-/g, ':'))
                }))
                .sort((a, b) => b.date - a.date);
            
            if (backups.length === 0) {
                alert('–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            let html = '<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:</h3>';
            backups.forEach((backup, index) => {
                html += `
                    <div class="backup-item" onclick="restoreBackup('${backup.key}')">
                        <strong>${backup.data.timestamp}</strong><br>
                        <small>${backup.data.data.test.subject} - ${backup.data.data.test.class}</small>
                    </div>
                `;
            });
            
            showModal('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏', html);
        }

        function restoreBackup(backupKey) {
            const backup = JSON.parse(localStorage.getItem(backupKey));
            if (backup && confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç—É —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                appData = backup.data;
                saveData();
                renderAll();
                hideModal();
                showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'success');
            }
        }

        // 2. –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showModal(title, content) {
            const modalOverlay = document.getElementById('modalOverlay');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <h2>${title}</h2>
                ${content}
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            modalOverlay.classList.add('show');
        }

        function hideModal() {
            document.getElementById('modalOverlay').classList.remove('show');
        }
		
		function renderVisualizationSection() {
			const container = document.getElementById('visualizationContainer');
			if (!container) {
				console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä visualizationContainer –Ω–µ –Ω–∞–π–¥–µ–Ω!');
				return;
			}
			
			console.log('–û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞–∑–¥–µ–ª–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏...');
			
			container.innerHTML = `
				<div style="margin-bottom: 30px;">
					<h2 style="margin-bottom: 20px;">üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
						<button class="btn" onclick="updateVisualization()" style="margin-right: 10px;">
							üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
						</button>
						<button class="btn" onclick="exportCharts()" style="margin-right: 10px;">
							üì• –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤
						</button>
						<button class="btn" onclick="debugCharts()">
							üêõ –û—Ç–ª–∞–¥–∫–∞
						</button>
					</div>
					
					<div class="charts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
						<!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ -->
						<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
							<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
								üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
							</h3>
							<div style="position: relative; height: 300px;">
								<canvas id="gradesChart"></canvas>
							</div>
							<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
								–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—á–∞—â–∏—Ö—Å—è –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –æ—Ü–µ–Ω–∫–∞–º
							</p>
						</div>
						
						<!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π -->
						<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
							<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
								üìà –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π
							</h3>
							<div style="position: relative; height: 300px;">
								<canvas id="solvabilityChart"></canvas>
							</div>
							<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
								–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
							</p>
						</div>
						
						<!-- –ì—Ä–∞—Ñ–∏–∫ —Å–≤—è–∑–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ -->
						<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
							<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
								üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å
							</h3>
							<div style="position: relative; height: 300px;">
								<canvas id="complexityChart"></canvas>
							</div>
							<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
								–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
							</p>
						</div>
					</div>
					
					<!-- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 30px;">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
						</h3>
						<div id="heatmapContainer"></div>
					</div>
				</div>
			`;
			
			console.log('Canvas —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏...');
			
			// –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ DOM
			setTimeout(() => {
				updateVisualization();
				console.log('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
			}, 200);
		}		
        // 3. –ì–†–£–ü–ü–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò –° –û–¶–ï–ù–ö–ê–ú–ò
        function showBulkEditScores() {
            const html = `
                <div class="form-group">
                    <label>–î–µ–π—Å—Ç–≤–∏–µ:</label>
                    <select id="bulkAction">
                        <option value="set">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</option>
                        <option value="add">–î–æ–±–∞–≤–∏—Ç—å –±–∞–ª–ª—ã</option>
                        <option value="multiply">–£–º–Ω–æ–∂–∏—Ç—å –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</option>
                        <option value="round">–û–∫—Ä—É–≥–ª–∏—Ç—å –æ—Ü–µ–Ω–∫–∏</option>
                    </select>
                </div>
                
                <div class="form-group" id="bulkValueContainer">
                    <label>–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                    <input type="number" id="bulkValue" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label>–î–ª—è –∑–∞–¥–∞–Ω–∏–π:</label>
                    <select id="bulkTasks" multiple style="height: 100px;">
                        ${appData.tasks.map((task, index) => 
                            `<option value="${index}" selected>${index + 1}. ${task.type} (–º–∞–∫—Å: ${task.maxScore})</option>`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–î–ª—è —É—á–∞—â–∏—Ö—Å—è:</label>
                    <select id="bulkStudents" multiple style="height: 100px;">
                        ${appData.students.map((student, index) => 
                            `<option value="${index}" selected>${student}</option>`
                        ).join('')}
                    </select>
                </div>
                
                <button class="btn btn-warning" onclick="applyBulkEdit()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button class="btn" onclick="previewBulkEdit()">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            `;
            
            showModal('–ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫', html);
        }

        function applyBulkEdit() {
            const action = document.getElementById('bulkAction').value;
            const value = parseFloat(document.getElementById('bulkValue').value);
            const selectedTasks = Array.from(document.getElementById('bulkTasks').selectedOptions).map(opt => parseInt(opt.value));
            const selectedStudents = Array.from(document.getElementById('bulkStudents').selectedOptions).map(opt => parseInt(opt.value));
            
            let changes = 0;
            
            selectedStudents.forEach(studentIndex => {
                selectedTasks.forEach(taskIndex => {
                    const oldValue = appData.results[studentIndex][taskIndex];
                    let newValue = oldValue;
                    const maxScore = appData.tasks[taskIndex].maxScore;
                    
                    switch(action) {
                        case 'set':
                            newValue = Math.min(value, maxScore);
                            break;
                        case 'add':
                            newValue = Math.min(oldValue + value, maxScore);
                            break;
                        case 'multiply':
                            newValue = Math.min(oldValue * value, maxScore);
                            break;
                        case 'round':
                            newValue = Math.round(oldValue);
                            break;
                    }
                    
                    if (newValue !== oldValue) {
                        appData.results[studentIndex][taskIndex] = Math.max(0, newValue);
                        changes++;
                    }
                });
            });
            
            saveData();
            renderResults();
            hideModal();
            showNotification(`–ò–∑–º–µ–Ω–µ–Ω–æ ${changes} –æ—Ü–µ–Ω–æ–∫`, 'success');
        }

        // 4. –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ò –¢–†–ï–ù–î–´
        function saveHistoricalData() {
            const snapshot = {
                timestamp: new Date().toISOString(),
                data: JSON.parse(JSON.stringify(appData)),
                summary: generateWorkSummary()
            };
            
            const history = JSON.parse(localStorage.getItem('workHistory') || '[]');
            history.push(snapshot);
            localStorage.setItem('workHistory', JSON.stringify(history.slice(-50)));
        }
		
		// ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ê–ú–ò ====================

		function saveCriteriaSettings() {
			saveData();
			showNotification("–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
		}

		function loadDefaultCriteria() {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			appData.test.criteria = {
				1: { min: 0, max: Math.round(maxPossible * 0.49) },
				2: { min: Math.round(maxPossible * 0.5), max: Math.round(maxPossible * 0.69) },
				3: { min: Math.round(maxPossible * 0.7), max: Math.round(maxPossible * 0.84) },
				4: { min: Math.round(maxPossible * 0.85), max: maxPossible }
			};
			
			renderCriteriaSettings();
			showNotification("–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏", "success");
		}

		function generateAutoCriteria() {
			const type = appData.test.criteriaType || 'points';
			const count = appData.test.criteriaCount || 4;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			if (type === 'percentage') {
				const step = 100 / count;
				for (let i = 1; i <= count; i++) {
					appData.test.criteria[i] = {
						min: Math.round((i-1) * step),
						max: Math.round(i * step)
					};
				}
				appData.test.criteria[count].max = 100;
			} else {
				const step = maxPossible / count;
				for (let i = 1; i <= count; i++) {
					appData.test.criteria[i] = {
						min: Math.round((i-1) * step),
						max: Math.round(i * step)
					};
				}
				appData.test.criteria[count].max = maxPossible;
			}
			
			renderCriteriaSettings();
			showNotification("–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏", "success");
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
		function getGradeDisplay(gradeValue) {
			console.log('getGradeDisplay called with:', gradeValue, typeof gradeValue);
			
			// –ï—Å–ª–∏ gradeValue - —Å—Ç—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ customCriteria.name), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
			if (typeof gradeValue === 'string') {
				return gradeValue;
			}
			
			// –ï—Å–ª–∏ gradeValue - —á–∏—Å–ª–æ
			const numericGrade = Number(gradeValue);
			const system = appData.test.criteriaSystem;
			
			// –î–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –µ—Å–ª–∏ grade - —á–∏—Å–ª–æ, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
			if (system === 'custom' && appData.test.customCriteria) {
				const criterion = appData.test.customCriteria[numericGrade - 1];
				if (criterion && criterion.name) {
					return criterion.name;
				}
			}
			
			// –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
			const gradeDescriptions = {
				'1': '1 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)',
				'2': '2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)',
				'3': '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)',
				'4': '4 (–•–æ—Ä–æ—à–æ)',
				'5': '5 (–û—Ç–ª–∏—á–Ω–æ)',
				'6': '6 (–•–æ—Ä–æ—à–æ)',
				'7': '7 (–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ)',
				'8': '8 (–û—Ç–ª–∏—á–Ω–æ)',
				'9': '9 (–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ)',
				'10': '10 (–ë–µ–∑—É–ø—Ä–µ—á–Ω–æ)'
			};
			
			const displayValue = gradeDescriptions[String(numericGrade)] || String(numericGrade);
			console.log('Display value:', displayValue);
			return displayValue;
		}

		// 1. –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ò
		function deleteError(errorIndex) {
			if (errorIndex >= 0 && errorIndex < appData.errors.length) {
				const error = appData.errors[errorIndex];
				const studentName = appData.students[error.studentIndex] || `–£—á–∞—â–∏–π—Å—è ${error.studentIndex + 1}`;
				const taskNumber = error.taskIndex + 1;
				
				if (confirm(`–£–¥–∞–ª–∏—Ç—å –æ—à–∏–±–∫—É?\n\n–£—á–∞—â–∏–π—Å—è: ${studentName}\n–ó–∞–¥–∞–Ω–∏–µ: ${taskNumber}\n–¢–∏–ø: ${errorTypes[error.type]?.name || error.type}`)) {
					appData.errors.splice(errorIndex, 1);
					saveData();
					renderResults();
					showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
				}
			}
		}

		// 2. –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –û–®–ò–ë–ö–ò
		function editError(errorIndex) {
			if (errorIndex >= 0 && errorIndex < appData.errors.length) {
				const error = appData.errors[errorIndex];
				
				const html = `
					<h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏</h3>
					
					<div class="form-group">
						<label>–£—á–∞—â–∏–π—Å—è:</label>
						<select id="editErrorStudent">
							${appData.students.map((student, index) => 
								`<option value="${index}" ${index === error.studentIndex ? 'selected' : ''}>
									${student}
								</option>`
							).join('')}
						</select>
					</div>
					
					<div class="form-group">
						<label>–ó–∞–¥–∞–Ω–∏–µ:</label>
						<select id="editErrorTask">
							${appData.tasks.map((task, index) => 
								`<option value="${index}" ${index === error.taskIndex ? 'selected' : ''}>
									${index + 1}. ${task.type}
								</option>`
							).join('')}
						</select>
					</div>
					
					<div class="form-group">
						<label>–¢–∏–ø –æ—à–∏–±–∫–∏:</label>
						<select id="editErrorType">
							${Object.entries(errorTypes).map(([key, data]) => 
								`<option value="${key}" ${key === error.type ? 'selected' : ''}>
									${data.name}
								</option>`
							).join('')}
						</select>
					</div>
					
					<div class="form-group">
						<label>–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:</label>
						<textarea id="editErrorDescription" rows="3">${error.description || ''}</textarea>
					</div>
					
					<div class="form-group">
						<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π:</label>
						<input type="number" id="editErrorCount" min="1" value="${error.count || 1}">
					</div>
				`;
				
				showModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏', html + `
					<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
						<button class="btn btn-danger" onclick="deleteError(${errorIndex}); hideModal()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
						<button class="btn" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
						<button class="btn btn-success" onclick="saveEditedError(${errorIndex})">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
					</div>
				`);
			}
		}

		// 3. –°–û–•–†–ê–ù–ï–ù–ò–ï –û–¢–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ù–û–ô –û–®–ò–ë–ö–ò
		function saveEditedError(errorIndex) {
			const studentIndex = parseInt(document.getElementById('editErrorStudent').value);
			const taskIndex = parseInt(document.getElementById('editErrorTask').value);
			const type = document.getElementById('editErrorType').value;
			const description = document.getElementById('editErrorDescription').value;
			const count = parseInt(document.getElementById('editErrorCount').value) || 1;
			
			if (!description.trim()) {
				showNotification("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏!", "error");
				return;
			}
			
			appData.errors[errorIndex] = {
				studentIndex,
				taskIndex,
				type,
				description,
				count
			};
			
			saveData();
			renderResults();
			hideModal();
			showNotification("–û—à–∏–±–∫–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞", "success");
		}

		// 4. –ú–ê–°–°–û–í–û–ï –£–î–ê–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö
		function showBulkDeleteErrors() {
			if (appData.errors.length === 0) {
				showNotification("–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è", "info");
				return;
			}
			
			let html = `
				<h3>üóëÔ∏è –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫</h3>
				<p>–í—ã–±–µ—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:</p>
				
				<div style="max-height: 400px; overflow-y: auto; margin: 15px 0;">
					<table style="width: 100%; font-size: 12px;">
						<thead>
							<tr>
								<th><input type="checkbox" id="selectAllErrors" onclick="toggleAllErrors()"></th>
								<th>‚Ññ</th>
								<th>–£—á–∞—â–∏–π—Å—è</th>
								<th>–ó–∞–¥–∞–Ω–∏–µ</th>
								<th>–¢–∏–ø –æ—à–∏–±–∫–∏</th>
								<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
							</tr>
						</thead>
						<tbody>
			`;
			
			appData.errors.forEach((error, index) => {
				const studentName = appData.students[error.studentIndex] || `–£—á. ${error.studentIndex + 1}`;
				const taskInfo = appData.tasks[error.taskIndex] ? `‚Ññ${error.taskIndex + 1}` : '–ó–∞–¥–∞–Ω–∏–µ';
				const errorType = errorTypes[error.type]?.name || error.type;
				
				html += `
					<tr>
						<td><input type="checkbox" class="error-checkbox" value="${index}"></td>
						<td>${index + 1}</td>
						<td>${studentName}</td>
						<td>${taskInfo}</td>
						<td><span class="error-type error-${error.type}">${errorType}</span></td>
						<td>${error.description || ''}</td>
					</tr>
				`;
			});
			
			html += `
						</tbody>
					</table>
				</div>
				
				<div style="margin-top: 15px;">
					<p>–í—ã–±—Ä–∞–Ω–æ: <span id="selectedCount">0</span> –∏–∑ ${appData.errors.length} –æ—à–∏–±–æ–∫</p>
				</div>
				
				<div class="form-group">
					<label>–§–∏–ª—å—Ç—Ä –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞:</label>
					<div style="display: flex; gap: 10px; flex-wrap: wrap;">
						<button class="btn btn-sm" onclick="selectByType('calculation')">–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ</button>
						<button class="btn btn-sm" onclick="selectByType('conceptual')">–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ</button>
						<button class="btn btn-sm" onclick="selectByType('attention')">–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
						<button class="btn btn-sm" onclick="selectAllErrors()">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
						<button class="btn btn-sm" onclick="deselectAllErrors()">–°–Ω—è—Ç—å –≤—Å–µ</button>
					</div>
				</div>
				
				<div class="form-group">
					<label>–£–¥–∞–ª–∏—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è —É—á–∞—â–µ–≥–æ—Å—è:</label>
					<select id="filterStudent" onchange="selectByStudent()">
						<option value="">–í—Å–µ —É—á–∞—â–∏–µ—Å—è</option>
						${appData.students.map((student, index) => 
							`<option value="${index}">${student}</option>`
						).join('')}
					</select>
				</div>
			`;
			
			showModal('–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-danger" onclick="deleteSelectedErrors()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
				</div>
			`);
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
			document.querySelectorAll('.error-checkbox').forEach(checkbox => {
				checkbox.addEventListener('change', updateSelectedCount);
			});
		}

		// 5. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ú–ê–°–°–û–í–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø
		function toggleAllErrors() {
			const selectAll = document.getElementById('selectAllErrors');
			const checkboxes = document.querySelectorAll('.error-checkbox');
			
			checkboxes.forEach(checkbox => {
				checkbox.checked = selectAll.checked;
			});
			
			updateSelectedCount();
		}

		function selectAllErrors() {
			document.querySelectorAll('.error-checkbox').forEach(checkbox => {
				checkbox.checked = true;
			});
			document.getElementById('selectAllErrors').checked = true;
			updateSelectedCount();
		}

		function deselectAllErrors() {
			document.querySelectorAll('.error-checkbox').forEach(checkbox => {
				checkbox.checked = false;
			});
			document.getElementById('selectAllErrors').checked = false;
			updateSelectedCount();
		}

		function selectByType(errorType) {
			appData.errors.forEach((error, index) => {
				if (error.type === errorType) {
					const checkbox = document.querySelector(`.error-checkbox[value="${index}"]`);
					if (checkbox) checkbox.checked = true;
				}
			});
			updateSelectedCount();
		}

		function selectByStudent() {
			const studentIndex = parseInt(document.getElementById('filterStudent').value);
			
			if (isNaN(studentIndex)) {
				selectAllErrors();
				return;
			}
			
			// –°–Ω–∞—á–∞–ª–∞ —Å–Ω–∏–º–∞–µ–º –≤—Å–µ
			deselectAllErrors();
			
			// –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
			appData.errors.forEach((error, index) => {
				if (error.studentIndex === studentIndex) {
					const checkbox = document.querySelector(`.error-checkbox[value="${index}"]`);
					if (checkbox) checkbox.checked = true;
				}
			});
			
			updateSelectedCount();
		}

		function updateSelectedCount() {
			const selected = document.querySelectorAll('.error-checkbox:checked').length;
			document.getElementById('selectedCount').textContent = selected;
		}

		function deleteSelectedErrors() {
			const checkboxes = document.querySelectorAll('.error-checkbox:checked');
			const indexesToDelete = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
			
			if (indexesToDelete.length === 0) {
				showNotification("–ù–µ –≤—ã–±—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏", "warning");
				return;
			}
			
			const count = indexesToDelete.length;
			if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${count} –æ—à–∏–±–æ–∫? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
				return;
			}
			
			// –£–¥–∞–ª—è–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (—á—Ç–æ–±—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–µ —Å–¥–≤–∏–≥–∞–ª–∏—Å—å)
			indexesToDelete.forEach(index => {
				appData.errors.splice(index, 1);
			});
			
			saveData();
			renderResults();
			hideModal();
			showNotification(`–£–¥–∞–ª–µ–Ω–æ ${count} –æ—à–∏–±–æ–∫`, "success");
		}

		// 6. –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–• –û–®–ò–ë–û–ö –£–ß–ê–©–ï–ì–û–°–Ø
		function deleteAllStudentErrors(studentIndex) {
			const studentName = appData.students[studentIndex];
			const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
			
			if (studentErrors.length === 0) {
				showNotification(`–£ —É—á–∞—â–µ–≥–æ—Å—è ${studentName} –Ω–µ—Ç –æ—à–∏–±–æ–∫`, "info");
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è ${studentName}? (${studentErrors.length} –æ—à–∏–±–æ–∫)`)) {
				appData.errors = appData.errors.filter(e => e.studentIndex !== studentIndex);
				saveData();
				renderResults();
				showNotification(`–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è ${studentName}`, "success");
			}
		}

		// 7. –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–• –û–®–ò–ë–û–ö –ü–û –¢–ò–ü–£
		function deleteAllErrorsByType(errorType) {
			const typeName = errorTypes[errorType]?.name || errorType;
			const typeErrors = appData.errors.filter(e => e.type === errorType);
			
			if (typeErrors.length === 0) {
				showNotification(`–ù–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "${typeName}"`, "info");
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "${typeName}"? (${typeErrors.length} –æ—à–∏–±–æ–∫)`)) {
				appData.errors = appData.errors.filter(e => e.type !== errorType);
				saveData();
				renderResults();
				showNotification(`–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "${typeName}"`, "success");
			}
		}

		// 8. –ú–ï–ù–Æ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ê–ú–ò
		function showErrorsManagement() {
			let html = `
				<h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏</h3>
				
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üë§ –ü–æ —É—á–∞—â–∏–º—Å—è</h4>
						<select id="studentForErrors" onchange="updateStudentErrorsInfo()" style="width: 100%; margin-bottom: 10px;">
							<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—â–µ–≥–æ—Å—è</option>
							${appData.students.map((student, index) => 
								`<option value="${index}">${student}</option>`
							).join('')}
						</select>
						<div id="studentErrorsInfo" style="min-height: 60px;"></div>
						<button class="btn btn-danger btn-sm" onclick="deleteAllStudentErrors(parseInt(document.getElementById('studentForErrors').value))" disabled id="deleteStudentErrorsBtn">
							üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
						</button>
					</div>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üìä –ü–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫</h4>
						<select id="errorTypeFilter" onchange="updateTypeErrorsInfo()" style="width: 100%; margin-bottom: 10px;">
							<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—à–∏–±–∫–∏</option>
							${Object.entries(errorTypes).map(([key, data]) => 
								`<option value="${key}">${data.name}</option>`
							).join('')}
						</select>
						<div id="typeErrorsInfo" style="min-height: 60px;"></div>
						<button class="btn btn-danger btn-sm" onclick="deleteAllErrorsByType(document.getElementById('errorTypeFilter').value)" disabled id="deleteTypeErrorsBtn">
							üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
						</button>
					</div>
				</div>
				
				<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫</h4>
					<p>–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${appData.errors.length}</p>
					<p>–£—á–∞—â–∏—Ö—Å—è —Å –æ—à–∏–±–∫–∞–º–∏: ${new Set(appData.errors.map(e => e.studentIndex)).size}</p>
					<p>–ó–∞–¥–∞–Ω–∏–π —Å –æ—à–∏–±–∫–∞–º–∏: ${new Set(appData.errors.map(e => e.taskIndex)).size}</p>
				</div>
				
				<div style="margin-top: 20px;">
					<button class="btn btn-warning" onclick="showBulkDeleteErrors()">
						üóëÔ∏è –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
					</button>
					<button class="btn btn-danger" onclick="deleteAllErrors()" style="margin-left: 10px;">
						‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
					</button>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏', html + `
				<div style="margin-top: 20px;">
					<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
				</div>
			`);
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
			updateStudentErrorsInfo();
			updateTypeErrorsInfo();
		}

		function updateStudentErrorsInfo() {
			const studentIndex = parseInt(document.getElementById('studentForErrors').value);
			const infoDiv = document.getElementById('studentErrorsInfo');
			const deleteBtn = document.getElementById('deleteStudentErrorsBtn');
			
			if (isNaN(studentIndex)) {
				infoDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—â–µ–≥–æ—Å—è</p>';
				deleteBtn.disabled = true;
				return;
			}
			
			const studentName = appData.students[studentIndex];
			const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
			
			if (studentErrors.length === 0) {
				infoDiv.innerHTML = `<p>–£ —É—á–∞—â–µ–≥–æ—Å—è <strong>${studentName}</strong> –Ω–µ—Ç –æ—à–∏–±–æ–∫</p>`;
				deleteBtn.disabled = true;
			} else {
				const errorTypesCount = {};
				studentErrors.forEach(error => {
					errorTypesCount[error.type] = (errorTypesCount[error.type] || 0) + 1;
				});
				
				const typesList = Object.entries(errorTypesCount)
					.map(([type, count]) => `${errorTypes[type]?.name}: ${count}`)
					.join(', ');
				
				infoDiv.innerHTML = `
					<p>–£—á–∞—â–∏–π—Å—è: <strong>${studentName}</strong></p>
					<p>–û—à–∏–±–æ–∫: ${studentErrors.length}</p>
					<small>${typesList}</small>
				`;
				deleteBtn.disabled = false;
			}
		}

		function updateTypeErrorsInfo() {
			const errorType = document.getElementById('errorTypeFilter').value;
			const infoDiv = document.getElementById('typeErrorsInfo');
			const deleteBtn = document.getElementById('deleteTypeErrorsBtn');
			
			if (!errorType) {
				infoDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—à–∏–±–∫–∏</p>';
				deleteBtn.disabled = true;
				return;
			}
			
			const typeName = errorTypes[errorType]?.name || errorType;
			const typeErrors = appData.errors.filter(e => e.type === errorType);
			
			if (typeErrors.length === 0) {
				infoDiv.innerHTML = `<p>–ù–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ <strong>${typeName}</strong></p>`;
				deleteBtn.disabled = true;
			} else {
				const studentsWithErrors = new Set(typeErrors.map(e => e.studentIndex)).size;
				
				infoDiv.innerHTML = `
					<p>–¢–∏–ø –æ—à–∏–±–∫–∏: <strong>${typeName}</strong></p>
					<p>–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${typeErrors.length}</p>
					<p>–£—á–∞—â–∏—Ö—Å—è —Å —Ç–∞–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏: ${studentsWithErrors}</p>
				`;
				deleteBtn.disabled = false;
			}
		}

		// 9. –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–• –û–®–ò–ë–û–ö
		function deleteAllErrors() {
			if (appData.errors.length === 0) {
				showNotification("–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è", "info");
				return;
			}
			
			if (confirm(`–£–¥–∞–ª–∏—Ç—å –í–°–ï –æ—à–∏–±–∫–∏? (${appData.errors.length} –æ—à–∏–±–æ–∫)\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
				appData.errors = [];
				saveData();
				renderResults();
				hideModal();
				showNotification("–í—Å–µ –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω—ã", "success");
			}
		}

		// 10. –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø renderResults() –° –ö–ù–û–ü–ö–ê–ú–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø
		function renderResults() {
			const container = document.getElementById('resultsContainer');
			container.innerHTML = '';
			
			// –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏
			const errorControls = document.createElement('div');
			errorControls.style.marginBottom = '20px';
			errorControls.style.padding = '15px';
			errorControls.style.background = '#f8f9fa';
			errorControls.style.borderRadius = '8px';
			errorControls.innerHTML = `
				<h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏</h4>
				<div style="display: flex; gap: 10px; flex-wrap: wrap;">
					<button class="btn btn-success" onclick="showErrorsManagement()">
						üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∞–º–∏
					</button>
					<button class="btn btn-warning" onclick="showBulkDeleteErrors()">
						üóëÔ∏è –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
					</button>
					<button class="btn" onclick="exportErrorsToCSV()">
						üì• –≠–∫—Å–ø–æ—Ä—Ç –æ—à–∏–±–æ–∫
					</button>
					${appData.errors.length > 0 ? `
						<button class="btn btn-danger" onclick="deleteAllErrors()">
							‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
						</button>
					` : ''}
				</div>
				<p style="margin-top: 10px; color: #666; font-size: 13px;">
					–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${appData.errors.length} | 
					–£—á–∞—â–∏—Ö—Å—è —Å –æ—à–∏–±–∫–∞–º–∏: ${new Set(appData.errors.map(e => e.studentIndex)).size}
				</p>
			`;
			container.appendChild(errorControls);
				
			if (appData.results.length === 0) {
				for (let i = 0; i < appData.test.presentStudents; i++) {
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
			}
			
			let html = '<div class="table-container"><table>';
			
			html += '<thead><tr><th>–£—á–∞—â–∏–π—Å—è</th>';
			for (let i = 0; i < appData.tasks.length; i++) {
				const task = appData.tasks[i];
				html += `<th title="–£—Ä. ${task.level}: ${task.type}">${i+1}</th>`;
			}
			html += '<th>‚àë</th><th>–û—Ü–µ–Ω–∫–∞</th><th>–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
			
			appData.students.forEach((student, studentIndex) => {
				const scores = appData.results[studentIndex] || [];
				const totalScore = scores.reduce((sum, score) => sum + score, 0);
				const grade = calculateGrade(totalScore);
				console.log(`Student ${studentIndex}: totalScore=${totalScore}, grade=${grade}`);
				const gradeClass = typeof grade === 'string' ? grade.replace(/\s+/g, '-').toLowerCase() : `grade-${grade}`;
				const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
				
				html += `<tr>
					<td><strong>${student}</strong></td>`;
				
				for (let taskIndex = 0; taskIndex < appData.tasks.length; taskIndex++) {
					const maxScore = appData.tasks[taskIndex].maxScore;
					const score = scores[taskIndex] || 0;
					const percentage = (score / maxScore) * 100;
					const heatmapClass = `heatmap-${Math.floor(percentage / 20) * 20}`;
					
					html += `<td class="heatmap-cell ${heatmapClass}">
						<input type="number" min="0" max="${maxScore}" value="${score}" 
							   style="width: 50px; text-align: center; border: none; background: transparent;"
							   onchange="updateResult(${studentIndex}, ${taskIndex}, parseInt(this.value))">
					</td>`;
				}
				
				html += `<td><strong>${totalScore}</strong></td>`;
				//	<td class="grade-${grade}"><strong>${grade}</strong></td>`;
				//html += `<td class="grade-${grade}"><strong>${getGradeDisplay(grade)}</strong></td>`; //–¥–æ–±–∞–≤–∏–ª —Ç—É—Ç –¥–ª—è —Ç–µ—Å—Ç–∞
				html += `<td class="${gradeClass}"><strong>${getGradeDisplay(grade)}</strong><small style="display: block; font-size: 10px; color: #666;">${totalScore} –±–∞–ª–ª–æ–≤</small></td>`;
				// –ö–æ–ª–æ–Ω–∫–∞ —Å –æ—à–∏–±–∫–∞–º–∏
				html += `<td><small>`;
				if (studentErrors.length > 0) {
					studentErrors.forEach((error, errorIndex) => {
						html += `
							<span class="error-type error-${error.type}" 
								  title="${error.description || errorTypes[error.type].desc}"
								  onclick="editError(${appData.errors.indexOf(error)})"
								  style="cursor: pointer; margin: 2px; display: inline-block;">
								${errorTypes[error.type].name}
								<small style="font-size: 9px;">[${error.taskIndex + 1}]</small>
							</span>
						`;
					});
				} else {
					html += '‚Äî';
				}
				html += `</small></td>`;
				
				// –ö–æ–ª–æ–Ω–∫–∞ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏
				html += `<td>
					<button class="btn btn-sm" onclick="showStudentErrors(${studentIndex})" title="–û—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è">
						üìä
					</button>
					${studentErrors.length > 0 ? `
						<button class="btn btn-sm btn-danger" onclick="deleteAllStudentErrors(${studentIndex})" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏">
							üóëÔ∏è
						</button>
					` : ''}
				</td></tr>`;
			});
			
			html += '</tbody></table></div>';
			
			// –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫
			html += `
				<div class="chart-container">
					<h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h3>
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
						<div>
							<div class="form-group">
								<label>–£—á–∞—â–∏–π—Å—è:</label>
								<select id="errorStudent">
									${appData.students.map((student, index) => 
										`<option value="${index}">${student}</option>`
									).join('')}
								</select>
							</div>
							<div class="form-group">
								<label>–ó–∞–¥–∞–Ω–∏–µ:</label>
								<select id="errorTask">
									${appData.tasks.map((task, index) => 
										`<option value="${index}">${index + 1}. ${task.type}</option>`
									).join('')}
								</select>
							</div>
						</div>
						<div>
							<div class="form-group">
								<label>–¢–∏–ø –æ—à–∏–±–∫–∏:</label>
								<select id="errorType">
									${Object.entries(errorTypes).map(([key, data]) => 
										`<option value="${key}">${data.name}</option>`
									).join('')}
								</select>
							</div>
							<div class="form-group">
								<label>–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:</label>
								<input type="text" id="errorDescription" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏...">
							</div>
						</div>
					</div>
					<button class="btn btn-warning" onclick="addError()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É</button>
					<button class="btn" onclick="showQuickErrorAdd()" style="margin-left: 10px;">‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</button>
				</div>
			`;
			
			container.innerHTML += html;
		}
		
		function generateCriteriaSummary() {
			const type = appData.test.criteriaType;
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üéØ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h4>';
			
			if (type === 'percentage') {
				html += '<p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è</p>';
				html += '<table style="width: 100%; font-size: 11pt;">';
				html += '<tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>';
				
				for (let i = 1; i <= count; i++) {
					const criteria = appData.test.criteria[i];
					const customInfo = appData.test.customCriteria[i-1];
					const levelName = system === 'custom' && customInfo ? customInfo.name : 
									system === 'standard' ? (i === 1 ? '2' : i+1) :
									system === 'five_point' ? i :
									system === 'ten_point' ? i : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
					
					html += `<tr>
						<td><strong>${levelName}</strong></td>
						<td>${criteria?.min || 0}% - ${criteria?.max || 0}%</td>
						<td>${customInfo?.description || ''}</td>
					</tr>`;
				}
				
				html += '</table>';
			} else if (type === 'points') {
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				html += `<p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –ë–∞–ª–ª—å–Ω–∞—è (–º–∞–∫—Å–∏–º—É–º: ${maxPossible} –±–∞–ª–ª–æ–≤)</p>`;
				html += '<table style="width: 100%; font-size: 11pt;">';
				html += '<tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>';
				
				for (let i = 1; i <= count; i++) {
					const criteria = appData.test.criteria[i];
					const customInfo = appData.test.customCriteria[i-1];
					const levelName = system === 'custom' && customInfo ? customInfo.name : 
									system === 'standard' ? (i === 1 ? '2' : i+1) :
									system === 'five_point' ? i :
									system === 'ten_point' ? i : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
					
					const minPercent = maxPossible > 0 ? Math.round((criteria?.min || 0) / maxPossible * 100) : 0;
					const maxPercent = maxPossible > 0 ? Math.round((criteria?.max || 0) / maxPossible * 100) : 0;
					
					html += `<tr>
						<td><strong>${levelName}</strong></td>
						<td>${criteria?.min || 0} - ${criteria?.max || 0} –±–∞–ª–ª–æ–≤</td>
						<td>${minPercent}% - ${maxPercent}%</td>
						<td>${customInfo?.description || ''}</td>
					</tr>`;
				}
				
				html += '</table>';
			} else if (type === 'custom') {
				html += '<p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —à–∫–∞–ª–∞</p>';
				html += '<table style="width: 100%; font-size: 11pt;">';
				html += '<tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–¶–≤–µ—Ç</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>';
				
				appData.test.customCriteria.forEach((criterion, index) => {
					html += `<tr>
						<td><strong>${criterion.name}</strong></td>
						<td>${criterion.min} - ${criterion.max} ${criterion.type === 'percentage' ? '%' : '–±–∞–ª–ª–æ–≤'}</td>
						<td><div style="width: 20px; height: 20px; background: ${criterion.color}; border: 1px solid #ccc;"></div></td>
						<td>${criterion.description}</td>
					</tr>`;
				});
				
				html += '</table>';
			}
			
			html += '</div>';
			return html;
		}		
		
		// 11. –ü–†–û–°–ú–û–¢–† –û–®–ò–ë–û–ö –£–ß–ê–©–ï–ì–û–°–Ø
		function showStudentErrors(studentIndex) {
			const studentName = appData.students[studentIndex];
			const studentErrors = appData.errors.filter(e => e.studentIndex === studentIndex);
			
			if (studentErrors.length === 0) {
				showNotification(`–£ —É—á–∞—â–µ–≥–æ—Å—è ${studentName} –Ω–µ—Ç –æ—à–∏–±–æ–∫`, "info");
				return;
			}
			
			let html = `
				<h3>üìä –û—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è: ${studentName}</h3>
				<p>–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${studentErrors.length}</p>
				
				<div style="max-height: 400px; overflow-y: auto; margin: 15px 0;">
					<table style="width: 100%; font-size: 12px;">
						<thead>
							<tr>
								<th>‚Ññ</th>
								<th>–ó–∞–¥–∞–Ω–∏–µ</th>
								<th>–¢–∏–ø –æ—à–∏–±–∫–∏</th>
								<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
								<th>–î–µ–π—Å—Ç–≤–∏—è</th>
							</tr>
						</thead>
						<tbody>
			`;
			
			studentErrors.forEach((error, index) => {
				const taskInfo = appData.tasks[error.taskIndex] ? 
					`‚Ññ${error.taskIndex + 1}. ${appData.tasks[error.taskIndex].type}` : 
					`–ó–∞–¥–∞–Ω–∏–µ ${error.taskIndex + 1}`;
				const errorType = errorTypes[error.type]?.name || error.type;
				const globalErrorIndex = appData.errors.indexOf(error);
				
				html += `
					<tr>
						<td>${index + 1}</td>
						<td>${taskInfo}</td>
						<td><span class="error-type error-${error.type}">${errorType}</span></td>
						<td>${error.description || '‚Äî'}</td>
						<td>
							<button class="btn btn-sm" onclick="editError(${globalErrorIndex})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
								‚úèÔ∏è
							</button>
							<button class="btn btn-sm btn-danger" onclick="deleteError(${globalErrorIndex})" title="–£–¥–∞–ª–∏—Ç—å">
								üóëÔ∏è
							</button>
						</td>
					</tr>
				`;
			});
			
			html += `
						</tbody>
					</table>
				</div>
				
				<div style="margin-top: 20px;">
					<button class="btn btn-danger" onclick="deleteAllStudentErrors(${studentIndex})">
						üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è
					</button>
					<button class="btn" onclick="hideModal()" style="margin-left: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
				</div>
			`;
			
			showModal(`–û—à–∏–±–∫–∏ —É—á–∞—â–µ–≥–æ—Å—è: ${studentName}`, html);
		}

		// 12. –ë–´–°–¢–†–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö
		function showQuickErrorAdd() {
			const html = `
				<h3>‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫</h3>
				<p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—â–∏—Ö—Å—è –∏ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫</p>
				
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
					<div>
						<h4>üë• –£—á–∞—â–∏–µ—Å—è:</h4>
						<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
							${appData.students.map((student, index) => `
								<label style="display: block; margin: 5px 0;">
									<input type="checkbox" class="quick-student" value="${index}">
									${student}
								</label>
							`).join('')}
						</div>
						<button class="btn btn-sm" onclick="selectAllQuickStudents()" style="margin-top: 5px;">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö</button>
					</div>
					
					<div>
						<h4>üìù –ó–∞–¥–∞–Ω–∏—è:</h4>
						<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
							${appData.tasks.map((task, index) => `
								<label style="display: block; margin: 5px 0;">
									<input type="checkbox" class="quick-task" value="${index}">
									${index + 1}. ${task.type}
								</label>
							`).join('')}
						</div>
						<button class="btn btn-sm" onclick="selectAllQuickTasks()" style="margin-top: 5px;">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
					</div>
				</div>
				
				<div class="form-group">
					<label>–¢–∏–ø –æ—à–∏–±–∫–∏:</label>
					<select id="quickErrorType">
						${Object.entries(errorTypes).map(([key, data]) => 
							`<option value="${key}">${data.name}</option>`
						).join('')}
					</select>
				</div>
				
				<div class="form-group">
					<label>–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:</label>
					<input type="text" id="quickErrorDescription" placeholder="–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫...">
				</div>
			`;
			
			showModal('–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="addQuickErrors()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏</button>
				</div>
			`);
		}

		function selectAllQuickStudents() {
			document.querySelectorAll('.quick-student').forEach(cb => cb.checked = true);
		}

		function selectAllQuickTasks() {
			document.querySelectorAll('.quick-task').forEach(cb => cb.checked = true);
		}

		function addQuickErrors() {
			const selectedStudents = Array.from(document.querySelectorAll('.quick-student:checked'))
				.map(cb => parseInt(cb.value));
			const selectedTasks = Array.from(document.querySelectorAll('.quick-task:checked'))
				.map(cb => parseInt(cb.value));
			const type = document.getElementById('quickErrorType').value;
			const description = document.getElementById('quickErrorDescription').value;
			
			if (selectedStudents.length === 0 || selectedTasks.length === 0) {
				showNotification("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è –∏ –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ", "error");
				return;
			}
			
			if (!description.trim()) {
				showNotification("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏", "error");
				return;
			}
			
			let addedCount = 0;
			
			selectedStudents.forEach(studentIndex => {
				selectedTasks.forEach(taskIndex => {
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –æ—à–∏–±–∫–∏
					const exists = appData.errors.some(e => 
						e.studentIndex === studentIndex && 
						e.taskIndex === taskIndex && 
						e.type === type
					);
					
					if (!exists) {
						appData.errors.push({
							studentIndex,
							taskIndex,
							type,
							description,
							count: 1
						});
						addedCount++;
					}
				});
			});
			
			saveData();
			renderResults();
			hideModal();
			showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} –æ—à–∏–±–æ–∫`, "success");
		}

		// 13. –≠–ö–°–ü–û–†–¢ –û–®–ò–ë–û–ö –í CSV
		function exportErrorsToCSV() {
			if (appData.errors.length === 0) {
				showNotification("–ù–µ—Ç –æ—à–∏–±–æ–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞", "info");
				return;
			}
			
			let csvContent = "–£—á–∞—â–∏–π—Å—è;–ó–∞–¥–∞–Ω–∏–µ;–¢–∏–ø –æ—à–∏–±–∫–∏;–û–ø–∏—Å–∞–Ω–∏–µ;–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ\n";
			
			appData.errors.forEach(error => {
				const studentName = appData.students[error.studentIndex] || `–£—á. ${error.studentIndex + 1}`;
				const taskInfo = appData.tasks[error.taskIndex] ? 
					`‚Ññ${error.taskIndex + 1}. ${appData.tasks[error.taskIndex].type}` : 
					`–ó–∞–¥–∞–Ω–∏–µ ${error.taskIndex + 1}`;
				const errorType = errorTypes[error.type]?.name || error.type;
				const description = error.description || '';
				const count = error.count || 1;
				
				// –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π –∏ –∫–∞–≤—ã—á–∫–∏
				const safeDescription = description.replace(/;/g, ',').replace(/"/g, "'");
				
				csvContent += `"${studentName}";"${taskInfo}";"${errorType}";"${safeDescription}";${count}\n`;
			});
			
			const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
			const url = URL.createObjectURL(blob);
			const link = document.createElement('a');
			link.href = url;
			link.download = `–æ—à–∏–±–∫–∏_${appData.test.subject || '–ø—Ä–µ–¥–º–µ—Ç'}_${new Date().toISOString().slice(0, 10)}.csv`;
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			URL.revokeObjectURL(url);
			
			showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${appData.errors.length} –æ—à–∏–±–æ–∫ –≤ CSV`, "success");
		}

		// 14. –û–ë–ù–û–í–ò–¢–¨ –°–¢–ò–õ–ò CSS –î–õ–Ø –ö–ù–û–ü–û–ö
		const additionalStyles = `
			.btn-sm {
				padding: 4px 8px !important;
				font-size: 12px !important;
			}
			
			.error-type {
				cursor: pointer !important;
				transition: opacity 0.2s !important;
			}
			
			.error-type:hover {
				opacity: 0.8 !important;
				transform: translateY(-1px) !important;
			}
			
			.error-management-panel {
				background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
				border-radius: 10px !important;
				padding: 15px !important;
				margin-bottom: 20px !important;
				border-left: 4px solid #3498db !important;
			}
		`;

		// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤ head
		const styleSheet = document.createElement("style");
		styleSheet.type = "text/css";
		styleSheet.innerText = additionalStyles;
		document.head.appendChild(styleSheet);		
		
		
        function generateWorkSummary() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            
            return {
                subject: appData.test.subject,
                class: appData.test.class,
                theme: appData.test.theme,
                date: appData.test.testDate,
                avgScore: totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length,
                successRate: (grades.filter(grade => grade >= 3).length / grades.length * 100),
                qualityRate: (grades.filter(grade => grade >= 4).length / grades.length * 100),
                totalStudents: appData.students.length
            };
        }

        function showComparativeAnalysis() {
            const history = JSON.parse(localStorage.getItem('workHistory') || '[]')
                .filter(item => item.data.test.subject === appData.test.subject && item.data.test.class === appData.test.class)
                .sort((a, b) => new Date(a.data.test.testDate) - new Date(b.data.test.testDate));
            
            if (history.length < 2) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞');
                return;
            }
            
            const currentSummary = generateWorkSummary();
            const previousSummary = history[history.length - 2].summary;
            
            const html = `
                <div class="comparative-grid">
                    <div class="comparative-card">
                        <h4>üìä –î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∞–ª–ª–∞</h4>
                        <div class="comparative-value ${currentSummary.avgScore > previousSummary.avgScore ? 'positive' : 'negative'}">
                            ${currentSummary.avgScore.toFixed(1)} 
                            <span class="trend">${currentSummary.avgScore > previousSummary.avgScore ? '‚Üó' : '‚Üò'}</span>
                        </div>
                        <div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.avgScore.toFixed(1)}</div>
                        <div class="comparative-diff ${currentSummary.avgScore > previousSummary.avgScore ? 'positive' : 'negative'}">
                            ${(currentSummary.avgScore - previousSummary.avgScore).toFixed(1)}
                        </div>
                    </div>
                    
                    <div class="comparative-card">
                        <h4>üéØ –î–∏–Ω–∞–º–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h4>
                        <div class="comparative-value ${currentSummary.successRate > previousSummary.successRate ? 'positive' : 'negative'}">
                            ${currentSummary.successRate.toFixed(1)}%
                            <span class="trend">${currentSummary.successRate > previousSummary.successRate ? '‚Üó' : '‚Üò'}</span>
                        </div>
                        <div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.successRate.toFixed(1)}%</div>
                        <div class="comparative-diff ${currentSummary.successRate > previousSummary.successRate ? 'positive' : 'negative'}">
                            ${(currentSummary.successRate - previousSummary.successRate).toFixed(1)}%
                        </div>
                    </div>
                    
                    <div class="comparative-card">
                        <h4>‚≠ê –î–∏–Ω–∞–º–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞</h4>
                        <div class="comparative-value ${currentSummary.qualityRate > previousSummary.qualityRate ? 'positive' : 'negative'}">
                            ${currentSummary.qualityRate.toFixed(1)}%
                            <span class="trend">${currentSummary.qualityRate > previousSummary.qualityRate ? '‚Üó' : '‚Üò'}</span>
                        </div>
                        <div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.qualityRate.toFixed(1)}%</div>
                        <div class="comparative-diff ${currentSummary.qualityRate > previousSummary.qualityRate ? 'positive' : 'negative'}">
                            ${(currentSummary.qualityRate - previousSummary.qualityRate).toFixed(1)}%
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="trendChart" height="200"></canvas>
                </div>
            `;
            
            showModal('–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑', html);
            
            setTimeout(() => initTrendChart(history), 100);
        }

        function initTrendChart(history) {
            if (window.trendChartInstance) {
                window.trendChartInstance.destroy();
            }
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            const labels = history.map(item => new Date(item.data.test.testDate).toLocaleDateString());
            const avgScores = history.map(item => item.summary.avgScore);
            const successRates = history.map(item => item.summary.successRate);
            
            window.trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª',
                            data: avgScores,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å %',
                            data: successRates,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                    }
                }
            });
        }

        // 5. –†–ê–°–®–ò–†–ï–ù–ù–´–ô –≠–ö–°–ü–û–†–¢
        function exportToExcel() {
            try {
                const wb = XLSX.utils.book_new();
                
                // –õ–∏—Å—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                const resultsData = [
                    ['–£—á–∞—â–∏–π—Å—è', ...appData.tasks.map((t, i) => `–ó–∞–¥–∞–Ω–∏–µ ${i+1}`), '–°—É–º–º–∞', '–û—Ü–µ–Ω–∫–∞']
                ];
                
                appData.students.forEach((student, index) => {
                    const scores = appData.results[index];
                    const total = scores.reduce((sum, score) => sum + score, 0);
                    const grade = calculateGrade(total);
                    resultsData.push([student, ...scores, total, grade]);
                });
                
                const wsResults = XLSX.utils.aoa_to_sheet(resultsData);
                XLSX.utils.book_append_sheet(wb, wsResults, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã');
                
                // –õ–∏—Å—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º
                const analysisData = [
                    ['–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å', '–ó–Ω–∞—á–µ–Ω–∏–µ'],
                    ['–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', calculateAverageScore()],
                    ['–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å', calculateSuccessRate() + '%'],
                    ['–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π', calculateQualityRate() + '%'],
                    ['–°–û–£', calculateSou() + '%']
                ];
                
                const wsAnalysis = XLSX.utils.aoa_to_sheet(analysisData);
                XLSX.utils.book_append_sheet(wb, wsAnalysis, '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞');
                
                XLSX.writeFile(wb, `–∞–Ω–∞–ª–∏–∑_${appData.test.subject}_${appData.test.class}_${new Date().toLocaleDateString()}.xlsx`);
                showNotification('Excel —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ Excel: ' + error.message, 'error');
            }
        }

		// –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - —Å–æ–∑–¥–∞–Ω–∏–µ PDF —á–µ—Ä–µ–∑ canvas
		function exportToPDFCanvas() {
			try {
				// –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
				const tempDiv = document.createElement('div');
				tempDiv.style.cssText = `
					position: fixed;
					left: -10000px;
					top: -10000px;
					width: 210mm;
					padding: 20mm;
					background: white;
					font-family: Arial, sans-serif;
					font-size: 12pt;
					line-height: 1.4;
				`;
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è PDF
				tempDiv.innerHTML = generatePDFContent();
				document.body.appendChild(tempDiv);
				
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º html2canvas –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
				html2canvas(tempDiv).then(canvas => {
					const imgData = canvas.toDataURL('image/png');
					const { jsPDF } = window.jspdf;
					const pdf = new jsPDF('p', 'mm', 'a4');
					
					const imgWidth = 210;
					const pageHeight = 295;
					const imgHeight = canvas.height * imgWidth / canvas.width;
					let heightLeft = imgHeight;
					let position = 0;
					
					pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
					heightLeft -= pageHeight;
					
					while (heightLeft >= 0) {
						position = heightLeft - imgHeight;
						pdf.addPage();
						pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
						heightLeft -= pageHeight;
					}
					
					pdf.save(`–æ—Ç—á–µ—Ç_${appData.test.subject}_${new Date().toLocaleDateString()}.pdf`);
					document.body.removeChild(tempDiv);
					showNotification('PDF —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
				});
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF: ' + error.message, 'error');
			}
		}

		function generatePDFContent() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
			
			const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
			grades.forEach(grade => gradeCounts[grade]++);
			
			return `
				<div style="text-align: center; margin-bottom: 20px;">
					<h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
					<h2>${appData.test.subject}, ${appData.test.class}</h2>
					<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme}</p>
					<p><strong>–î–∞—Ç–∞:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
				</div>
				
				<div style="margin-bottom: 20px;">
					<h3>–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
					<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
						<div style="background: #667eea; color: white; padding: 15px; border-radius: 8px; text-align: center;">
							<div style="font-size: 1.6em; font-weight: bold;">${avgScore.toFixed(1)}</div>
							<div>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
						</div>
						<div style="background: #764ba2; color: white; padding: 15px; border-radius: 8px; text-align: center;">
							<div style="font-size: 1.6em; font-weight: bold;">${successRate.toFixed(1)}%</div>
							<div>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
						</div>
					</div>
				</div>
				
				<div style="margin-bottom: 20px;">
					<h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h3>
					<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #27ae60;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[5]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 5</div>
						</div>
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #3498db;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[4]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 4</div>
						</div>
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #f39c12;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[3]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 3</div>
						</div>
						<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #e74c3c;">
							<div style="font-size: 1.4em; font-weight: bold;">${gradeCounts[2]}</div>
							<div>–û—Ü–µ–Ω–∫–∞ 2</div>
						</div>
					</div>
				</div>
				
				<div style="margin-bottom: 20px;">
					<h3>–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</h3>
					<div style="background: #e8f4fc; padding: 15px; border-radius: 6px; border-left: 4px solid #3498db;">
						${generateKeyConclusionsText()}
					</div>
				</div>
				
				<div style="text-align: center; color: #7f8c8d; font-size: 10pt; margin-top: 30px;">
					<p>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()}</p>
					<p>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
				</div>
			`;
		}

		// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pdfmake (–µ—Å–ª–∏ jsPDF –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–æ—Ö–æ)
		function exportToPDFWithPDFMake() {
			// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è pdfmake
			if (typeof pdfMake === 'undefined') {
				showNotification('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ pdfmake –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞', 'error');
				return;
			}
			
			try {
				const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
				const grades = totalScores.map(score => calculateGrade(score));
				const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
				const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
				const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
				
				const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
				grades.forEach(grade => gradeCounts[grade]++);
				
				// –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
				const taskAnalysis = appData.tasks.map((task, index) => {
					const completion = calculateTaskCompletion(index);
					let zone = '';
					if (completion >= 90) zone = '–û—Ç–ª–∏—á–Ω–∞—è';
					else if (completion >= 60) zone = '–ó–µ–ª–µ–Ω–∞—è';
					else if (completion >= 30) zone = '–ñ–µ–ª—Ç–∞—è';
					else zone = '–ö—Ä–∞—Å–Ω–∞—è';
					
					return [
						(index + 1).toString(),
						task.type,
						`${task.level}. ${complexityLevels[task.level].name}`,
						`${completion.toFixed(1)}%`,
						zone
					];
				});
				
				const documentDefinition = {
					content: [
						{
							text: '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ',
							style: 'header'
						},
						{
							text: `${appData.test.subject}, ${appData.test.class}`,
							style: 'subheader'
						},
						{
							text: `–¢–µ–º–∞: ${appData.test.theme}`,
							style: 'normal'
						},
						{
							text: `–î–∞—Ç–∞: ${new Date(appData.test.testDate).toLocaleDateString()}`,
							style: 'normal'
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:',
							style: 'sectionHeader'
						},
						{
							ul: [
								`–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${avgScore.toFixed(1)}`,
								`–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å: ${successRate.toFixed(1)}%`,
								`–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π: ${qualityRate.toFixed(1)}%`,
								`–û—Ü–µ–Ω–∫–∞ 5: ${gradeCounts[5]} —É—á–∞—â–∏—Ö—Å—è`,
								`–û—Ü–µ–Ω–∫–∞ 4: ${gradeCounts[4]} —É—á–∞—â–∏—Ö—Å—è`, 
								`–û—Ü–µ–Ω–∫–∞ 3: ${gradeCounts[3]} —É—á–∞—â–∏—Ö—Å—è`,
								`–û—Ü–µ–Ω–∫–∞ 2: ${gradeCounts[2]} —É—á–∞—â–∏—Ö—Å—è`
							],
							style: 'list'
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π:',
							style: 'sectionHeader'
						},
						{
							table: {
								headerRows: 1,
								widths: [15, '*', 40, 40, 40],
								body: [
									[
										{text: '‚Ññ', style: 'tableHeader'},
										{text: '–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è', style: 'tableHeader'},
										{text: '–£—Ä–æ–≤–µ–Ω—å', style: 'tableHeader'},
										{text: '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', style: 'tableHeader'},
										{text: '–ó–æ–Ω–∞', style: 'tableHeader'}
									],
									...taskAnalysis
								]
							}
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:',
							style: 'sectionHeader'
						},
						{
							text: generateKeyConclusionsText(),
							style: 'conclusions'
						},
						{
							text: ' ',
							style: 'spacer'
						},
						{
							text: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:',
							style: 'sectionHeader'
						},
						{
							ul: [
								'–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏',
								'–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è',
								'–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º',
								'–ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ä–∞–±–æ—Ç—ã',
								'–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏'
							],
							style: 'list'
						}
					],
					styles: {
						header: {
							fontSize: 18,
							bold: true,
							alignment: 'center',
							margin: [0, 0, 0, 10]
						},
						subheader: {
							fontSize: 14,
							bold: true,
							alignment: 'center',
							margin: [0, 0, 0, 10]
						},
						sectionHeader: {
							fontSize: 12,
							bold: true,
							margin: [0, 10, 0, 5]
						},
						normal: {
							fontSize: 10,
							margin: [0, 2, 0, 2]
						},
						list: {
							fontSize: 10,
							margin: [0, 5, 0, 5]
						},
						conclusions: {
							fontSize: 10,
							margin: [0, 5, 0, 5],
							lineHeight: 1.3
						},
						tableHeader: {
							bold: true,
							fontSize: 8,
							fillColor: '#34495e',
							color: 'white'
						},
						spacer: {
							margin: [0, 10, 0, 0]
						}
					},
					defaultStyle: {
						font: 'Helvetica'
					}
				};
				
				pdfMake.createPdf(documentDefinition).download(`–æ—Ç—á–µ—Ç_${appData.test.subject}_${new Date().toLocaleDateString()}.pdf`);
				showNotification('PDF —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF: ' + error.message, 'error');
			}
		}


        function exportToPDF() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ jsPDF –∑–∞–≥—Ä—É–∂–µ–Ω
				if (typeof jspdf === 'undefined') {
					showNotification('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ jsPDF –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'error');
					return;
				}

				const { jsPDF } = window.jspdf;
				const doc = new jsPDF();
				
				// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
				doc.setFont('helvetica');
				
				// –ó–∞–≥–æ–ª–æ–≤–æ–∫
				doc.setFontSize(16);
				doc.text(`–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: ${appData.test.subject}, ${appData.test.class}`, 20, 20);
				doc.setFontSize(12);
				doc.text(`–¢–µ–º–∞: ${appData.test.theme}`, 20, 30);
				doc.text(`–î–∞—Ç–∞: ${new Date(appData.test.testDate).toLocaleDateString()}`, 20, 37);
				
				// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
				let y = 50;
				doc.setFontSize(14);
				doc.text('–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:', 20, y);
				y += 10;
				
				doc.setFontSize(10);
				
				// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
				const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
				const grades = totalScores.map(score => calculateGrade(score));
				const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
				const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
				const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
				
				doc.text(`‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${avgScore.toFixed(1)}`, 25, y); y += 7;
				doc.text(`‚Ä¢ –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å: ${successRate.toFixed(1)}%`, 25, y); y += 7;
				doc.text(`‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π: ${qualityRate.toFixed(1)}%`, 25, y); y += 7;
				
				// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
				const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
				grades.forEach(grade => gradeCounts[grade]++);
				
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 5: ${gradeCounts[5]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 4: ${gradeCounts[4]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 3: ${gradeCounts[3]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				doc.text(`‚Ä¢ –û—Ü–µ–Ω–∫–∞ 2: ${gradeCounts[2]} —É—á–∞—â–∏—Ö—Å—è`, 25, y); y += 7;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
				if (y > 250) {
					doc.addPage();
					y = 20;
				}
				
				// –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π
				doc.setFontSize(14);
				doc.text('–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π:', 20, y);
				y += 10;
				
				doc.setFontSize(8); // –£–º–µ–Ω—å—à–∞–µ–º —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
				
				// –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
				doc.text('‚Ññ', 25, y);
				doc.text('–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è', 35, y);
				doc.text('–£—Ä–æ–≤–µ–Ω—å', 100, y);
				doc.text('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', 140, y);
				doc.text('–ó–æ–Ω–∞', 180, y);
				
				y += 5;
				doc.line(20, y, 190, y);
				y += 5;
				
				// –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏–π
				appData.tasks.forEach((task, index) => {
					if (y > 270) {
						doc.addPage();
						y = 20;
						// –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
						doc.setFontSize(8);
						doc.text('‚Ññ', 25, y);
						doc.text('–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è', 35, y);
						doc.text('–£—Ä–æ–≤–µ–Ω—å', 100, y);
						doc.text('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', 140, y);
						doc.text('–ó–æ–Ω–∞', 180, y);
						y += 5;
						doc.line(20, y, 190, y);
						y += 5;
					}
					
					const completion = calculateTaskCompletion(index);
					let zone = '';
					if (completion >= 90) zone = '–û—Ç–ª–∏—á–Ω–∞—è';
					else if (completion >= 60) zone = '–ó–µ–ª–µ–Ω–∞—è';
					else if (completion >= 30) zone = '–ñ–µ–ª—Ç–∞—è';
					else zone = '–ö—Ä–∞—Å–Ω–∞—è';
					
					doc.text(`${index + 1}`, 25, y);
					
					// –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
					let taskType = task.type;
					if (taskType.length > 25) {
						taskType = taskType.substring(0, 22) + '...';
					}
					doc.text(taskType, 35, y);
					
					doc.text(`${task.level}. ${complexityLevels[task.level].name}`, 100, y);
					doc.text(`${completion.toFixed(1)}%`, 140, y);
					doc.text(zone, 180, y);
					
					y += 6;
				});
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
				doc.addPage();
				y = 20;
				
				doc.setFontSize(14);
				doc.text('–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:', 20, y);
				y += 15;
				
				doc.setFontSize(10);
				
				// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—ã–≤–æ–¥—ã
				const conclusions = generateKeyConclusionsText();
				const conclusionLines = doc.splitTextToSize(conclusions, 170);
				conclusionLines.forEach(line => {
					if (y > 270) {
						doc.addPage();
						y = 20;
					}
					doc.text(line, 20, y);
					y += 7;
				});
				
				y += 10;
				
				// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
				doc.setFontSize(12);
				doc.text('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:', 20, y);
				y += 10;
				
				doc.setFontSize(10);
				const recommendations = [
					'‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏',
					'‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏',
					'‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è',
					'‚Ä¢ –ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö',
					'‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏'
				];
				
				recommendations.forEach(rec => {
					if (y > 270) {
						doc.addPage();
						y = 20;
					}
					doc.text(rec, 25, y);
					y += 7;
				});
				
				// –§—É—Ç–µ—Ä
				doc.setFontSize(8);
				doc.text(`–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()}`, 20, 280);
				doc.text('–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', 120, 280);
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
				doc.save(`–æ—Ç—á–µ—Ç_${appData.test.subject}_${new Date().toLocaleDateString()}.pdf`);
				showNotification('PDF —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ PDF: ' + error.message, 'error');
			}
		}

        // 2. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø showSmartRecommendations
		function showSmartRecommendations() {
			const recommendations = generateSmartRecommendations();
			
			let html = '<h3>ü§ñ –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>';
			
			if (recommendations.length === 0) {
				html += '<div class="recommendation-card"><p>‚úÖ –í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –Ω–æ—Ä–º–µ. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!</p></div>';
			} else {
				recommendations.forEach(rec => {
					html += `
						<div class="smart-recommendation recommendation-${rec.type}">
							<strong>${rec.title}</strong>
							<p>${rec.message}</p>
							<small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${getActionDescription(rec.action)}</small>
						</div>
					`;
				});
			}
			
			document.getElementById('smartRecommendationsContainer').innerHTML = html;
		}

        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø generateSmartRecommendations
		function generateSmartRecommendations() {
			const analysis = analyzePerformancePatterns();
			const totalErrors = appData.errors.length;
			
			// –ü–†–û–í–ï–†–Ø–ï–ú, –ï–°–¢–¨ –õ–ò –û–®–ò–ë–ö–ò
			let recommendations = [];
			
			// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–æ–Ω
			if (analysis.lowCompletionTasks && analysis.lowCompletionTasks.length > 0) {
				recommendations.push({
					type: 'critical',
					title: '–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è',
					message: `–ó–∞–¥–∞–Ω–∏—è ${analysis.lowCompletionTasks.map(t => t.index + 1).join(', ')} —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ < 50%)`,
					action: 'review_content'
				});
			}
			
			// –ê–Ω–∞–ª–∏–∑ –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞
			if (analysis.atRiskStudents && analysis.atRiskStudents.length > 0) {
				recommendations.push({
					type: 'warning',
					title: '–ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–∞',
					message: `${analysis.atRiskStudents.length} —É—á–∞—â–∏—Ö—Å—è —Ç—Ä–µ–±—É—é—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞`,
					action: 'individual_work'
				});
			}
			
			// –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ (–¢–ï–ü–ï–†–¨ –° –ü–†–û–í–ï–†–ö–û–ô)
			if (analysis.commonErrors && analysis.commonErrors.length > 0 && totalErrors > 0) {
				const topError = analysis.commonErrors[0];
				const percentage = Math.round((topError.count / totalErrors) * 100);
				
				recommendations.push({
					type: 'info',
					title: '–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏',
					message: `–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç ${errorTypes[topError.type]?.name?.toLowerCase() || topError.type} (${topError.count} —Å–ª—É—á–∞–µ–≤, ${percentage}% –≤—Å–µ—Ö –æ—à–∏–±–æ–∫)`,
					action: 'error_analysis'
				});
			}
			
			return recommendations;
		}

        // 3. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø analyzePerformancePatterns
		function analyzePerformancePatterns() {
			const result = {
				lowCompletionTasks: [],
				atRiskStudents: [],
				commonErrors: []
			};
			
			// –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π —Å –Ω–∏–∑–∫–æ–π —Ä–µ—à–∞–µ–º–æ—Å—Ç—å—é
			if (appData.tasks && appData.tasks.length > 0) {
				result.lowCompletionTasks = appData.tasks
					.map((task, index) => ({ 
						task, 
						index, 
						completion: calculateTaskCompletion(index) 
					}))
					.filter(t => t.completion < 50)
					.slice(0, 3);
			}
			
			// –ê–Ω–∞–ª–∏–∑ —É—á–∞—â–∏—Ö—Å—è –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞
			if (appData.results && appData.results.length > 0) {
				const totalScores = appData.results.map(scores => 
					scores.reduce((sum, score) => sum + score, 0)
				);
				
				result.atRiskStudents = appData.students
					.map((student, index) => ({ 
						student, 
						index, 
						score: totalScores[index] 
					}))
					.filter(s => s.score < appData.test.criteria[3].min)
					.slice(0, 5);
			}
			
			// –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ (–° –ó–ê–©–ò–¢–û–ô –û–¢ –ü–£–°–¢–û–ì–û –ú–ê–°–°–ò–í–ê)
			if (appData.errors && appData.errors.length > 0) {
				const errorStats = {};
				
				appData.errors.forEach(error => {
					if (error && error.type) {
						errorStats[error.type] = (errorStats[error.type] || 0) + 1;
					}
				});
				
				result.commonErrors = Object.entries(errorStats)
					.sort(([,a], [,b]) => b - a)
					.slice(0, 2)
					.map(([type, count]) => ({ type, count }));
			}
			
			return result;
		}


		// –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –§–£–ù–ö–¶–ò–Æ –î–õ–Ø –ë–ï–ó–û–ü–ê–°–ù–û–ì–û –î–û–°–¢–£–ü–ê –ö –î–ê–ù–ù–´–ú
		function safeGet(object, path, defaultValue = null) {
			try {
				const value = path.split('.').reduce((obj, key) => 
					obj && obj[key] !== undefined ? obj[key] : undefined, 
					object
				);
				return value !== undefined ? value : defaultValue;
			} catch (error) {
				console.warn('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:', error);
				return defaultValue;
			}
		}

		// –ü–ï–†–ï–ü–ò–®–ï–ú –ù–ï–ö–û–¢–û–†–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò –° –ó–ê–©–ò–¢–û–ô:
        function getActionDescription(action) {
            const actions = {
                'review_content': '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞',
                'individual_work': '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —É—á–∞—â–∏–º–∏—Å—è',
                'error_analysis': '–ê–Ω–∞–ª–∏–∑ –∏ —Ä–∞–∑–±–æ—Ä —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫'
            };
            return actions[action] || action;
        }

        // 7. –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–ê–¶–ò–Ø
        function initAdvancedSearch() {
            const html = `
                <div class="search-filters">
                    <div class="form-group">
                        <label>–ü–æ–∏—Å–∫ –ø–æ —É—á–∞—â–∏–º—Å—è:</label>
                        <input type="text" id="studentSearch" placeholder="–§–∞–º–∏–ª–∏—è –∏–ª–∏ –∏–º—è..." onkeyup="filterStudents()">
                    </div>
                    
                    <div class="form-group">
                        <label>–û—Ü–µ–Ω–∫–∞:</label>
                        <select id="gradeFilter" onchange="filterStudents()">
                            <option value="">–í—Å–µ –æ—Ü–µ–Ω–∫–∏</option>
                            <option value="5">5</option>
                            <option value="4">4</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–£—Ä–æ–≤–µ–Ω—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                        <select id="performanceFilter" onchange="filterStudents()">
                            <option value="">–í—Å–µ</option>
                            <option value="high">–í—ã—Å–æ–∫–∏–π (&gt;80%)</option>
                            <option value="medium">–°—Ä–µ–¥–Ω–∏–π (50-80%)</option>
                            <option value="low">–ù–∏–∑–∫–∏–π (&lt;50%)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–∏–ø—ã –æ—à–∏–±–æ–∫:</label>
                        <select id="errorFilter" onchange="filterStudents()">
                            <option value="">–í—Å–µ</option>
                            ${Object.entries(errorTypes).map(([key, data]) => 
                                `<option value="${key}">${data.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
                
                <div id="filteredResults" style="max-height: 400px; overflow-y: auto;"></div>
            `;
            
            showModal('–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫', html);
            filterStudents();
        }

        function filterStudents() {
            const searchText = document.getElementById('studentSearch').value.toLowerCase();
            const gradeFilter = document.getElementById('gradeFilter').value;
            const performanceFilter = document.getElementById('performanceFilter').value;
            const errorFilter = document.getElementById('errorFilter').value;
            
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            
            const filtered = appData.students
                .map((student, index) => {
                    const totalScore = appData.results[index].reduce((sum, score) => sum + score, 0);
                    const grade = calculateGrade(totalScore);
                    const percentage = (totalScore / maxPossible) * 100;
                    const studentErrors = appData.errors.filter(e => e.studentIndex === index);
                    
                    return { student, index, totalScore, grade, percentage, studentErrors };
                })
                .filter(data => {
                    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–∫—Å—Ç—É
                    if (searchText && !data.student.toLowerCase().includes(searchText)) return false;
                    
                    // –§–∏–ª—å—Ç—Ä –ø–æ –æ—Ü–µ–Ω–∫–µ
                    if (gradeFilter && data.grade != gradeFilter) return false;
                    
                    // –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    if (performanceFilter === 'high' && data.percentage < 80) return false;
                    if (performanceFilter === 'medium' && (data.percentage < 50 || data.percentage >= 80)) return false;
                    if (performanceFilter === 'low' && data.percentage >= 50) return false;
                    
                    // –§–∏–ª—å—Ç—Ä –ø–æ –æ—à–∏–±–∫–∞–º
                    if (errorFilter && !data.studentErrors.some(e => e.type === errorFilter)) return false;
                    
                    return true;
                });
            
            displayFilteredResults(filtered);
        }

        function displayFilteredResults(filtered) {
            const container = document.getElementById('filteredResults');
            
            if (filtered.length === 0) {
                container.innerHTML = '<p>–£—á–∞—â–∏–µ—Å—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }
            
            let html = '<table style="width: 100%;"><thead><tr><th>–£—á–∞—â–∏–π—Å—è</th><th>–ë–∞–ª–ª—ã</th><th>–û—Ü–µ–Ω–∫–∞</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–û—à–∏–±–∫–∏</th></tr></thead><tbody>';
            
            filtered.forEach(data => {
                html += `
                    <tr>
                        <td><strong>${data.student}</strong></td>
                        <td>${data.totalScore}</td>
                        <td class="grade-${data.grade}">${data.grade}</td>
                        <td>${data.percentage.toFixed(1)}%</td>
                        <td>${data.studentErrors.length > 0 ? 
                            data.studentErrors.map(e => `<span class="error-type error-${e.type}">${errorTypes[e.type].name}</span>`).join(' ') : 
                            '‚Äî'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // 8. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –í–ù–ï–®–ù–ò–ú–ò –°–ò–°–¢–ï–ú–ê–ú–ò
        function exportForEJournal() {
            const data = {
                subject: appData.test.subject,
                class: appData.test.class,
                workTheme: appData.test.theme,
                workDate: appData.test.testDate,
                results: appData.students.map((student, index) => ({
                    student: student,
                    score: appData.results[index].reduce((sum, score) => sum + score, 0),
                    grade: calculateGrade(appData.results[index].reduce((sum, score) => sum + score, 0)),
                    comment: generateStudentComment(index)
                }))
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π_–¥–Ω–µ–≤–Ω–∏–∫_${appData.test.subject}_${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('–î–∞–Ω–Ω—ã–µ –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–Ω–µ–≤–Ω–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        function generateStudentComment(studentIndex) {
            const totalScore = appData.results[studentIndex].reduce((sum, score) => sum + score, 0);
            const grade = calculateGrade(totalScore);
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            const percentage = (totalScore / maxPossible) * 100;
            
            if (percentage >= 80) return '–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            if (percentage >= 60) return '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            if (percentage >= 40) return '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            return '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞';
        }

        // ==================== –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ ====================


        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
			document.querySelectorAll('.tab-content').forEach(tab => {
				tab.classList.remove('active');
			});
			
			// –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
			document.querySelectorAll('.tab-btn').forEach(btn => {
				btn.classList.remove('active');
			});
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
			document.getElementById(tabName).classList.add('active');
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
			event.target.classList.add('active');
			
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
			if (tabName === 'analytics') {
				updateAnalytics();
			} else if (tabName === 'visualization') {
				updateVisualization();
			} else if (tabName === 'recommendations') {
				updateRecommendations();
			} else if (tabName === 'export') {
				updateReportPreview();
			}
			
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('testAnalyticsData', JSON.stringify(appData));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadData() {
			try {
				const saved = localStorage.getItem('testAnalyticsData');
				if (saved) {
					const parsed = JSON.parse(saved);
					
					// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å
					appData = {
						...appData, // –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
						...parsed,  // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
						test: {
							...appData.test, // –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
							...parsed.test   // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
						}
					};
					
					// –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç
					if (!appData.test.criteriaType) appData.test.criteriaType = 'points';
					if (!appData.test.criteriaSystem) appData.test.criteriaSystem = 'standard';
					if (!appData.test.customCriteria) appData.test.customCriteria = [];
					if (!appData.test.criteriaCount) appData.test.criteriaCount = 4;
					if (!appData.test.criteriaScale) appData.test.criteriaScale = '2-5';
					if (!appData.psychologyFeatures) appData.psychologyFeatures = [];
					
					console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
				}
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
			}
		}

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã
        function updateWorkType() {
            appData.test.workType = document.getElementById('workType').value;
            updateCriteriaForWorkType();
            appData.tasks = [];
            saveData();
            renderAll();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç
        function updateCriteriaForWorkType() {
            const criteria = appData.test.criteria;
			const workType = appData.test.workType;
            
            switch(appData.test.workType) {
                case 'oge':
                    criteria[5] = { min: 22, max: 32 };
                    criteria[4] = { min: 15, max: 21 };
                    criteria[3] = { min: 8, max: 14 };
                    criteria[2] = { min: 0, max: 7 };
                    break;
                case 'ege':
                    criteria[5] = { min: 27, max: 31 };
                    criteria[4] = { min: 20, max: 26 };
                    criteria[3] = { min: 12, max: 19 };
                    criteria[2] = { min: 0, max: 11 };
                    break;
                case 'vpr':
                    criteria[5] = { min: 18, max: 20 };
                    criteria[4] = { min: 15, max: 17 };
                    criteria[3] = { min: 10, max: 14 };
                    criteria[2] = { min: 0, max: 9 };
                    break;
                case 'func_literacy':
                    criteria[5] = { min: 90, max: 100 };
                    criteria[4] = { min: 75, max: 89 };
                    criteria[3] = { min: 50, max: 74 };
                    criteria[2] = { min: 0, max: 49 };
                    break;
				case 'psychology':
					// –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —à–∫–∞–ª—ã
					appData.test.criteriaScale = 'points'; // –∏–ª–∏ 'percentage', 'levels'
					appData.test.criteriaSystem = 'custom'; // –∏–ª–∏ 'standard'
					
					// –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
					if (!appData.test.psychologySettings) {
						appData.test.psychologySettings = {
							scaleType: '1-5', // '1-5', '1-10', 'percentage', 'levels'
							levels: [
								{ name: "–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å", min: 0, max: 25, color: "#e74c3c" },
								{ name: "–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å", min: 26, max: 50, color: "#f39c12" },
								{ name: "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ", min: 51, max: 75, color: "#3498db" },
								{ name: "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å", min: 76, max: 100, color: "#27ae60" }
							],
							usePercentages: true,
							customLabels: {
								2: "–ù–∏–∑–∫–∏–π",
								3: "–°—Ä–µ–¥–Ω–∏–π", 
								4: "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ",
								5: "–í—ã—Å–æ–∫–∏–π"
							}
						};
					}
					break;
                default:
                    break;
            }
            
            renderTestSettings();
        }

		function renderPsychologyCriteria() {
			return `
				<h3 class="section-title">üéØ –®–∫–∞–ª–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è (–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è)</h3>
				
				<div class="form-group">
					<label>–¢–∏–ø —à–∫–∞–ª—ã:</label>
					<select id="psychologyScaleType" onchange="updatePsychologyScale()">
						<option value="1-5">–ë–∞–ª–ª—ã 1-5</option>
						<option value="1-10">–ë–∞–ª–ª—ã 1-10</option>
						<option value="percentage">–ü—Ä–æ—Ü–µ–Ω—Ç—ã (%)</option>
						<option value="levels">–£—Ä–æ–≤–Ω–∏ (–Ω–∏–∑–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π/–≤—ã—Å–æ–∫–∏–π)</option>
						<option value="stens">–°—Ç–µ–Ω—ã (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 10)</option>
						<option value="t-scores">–¢-–±–∞–ª–ª—ã</option>
						<option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è —à–∫–∞–ª–∞</option>
					</select>
				</div>
				
				<div id="psychologyCriteriaContainer">
					<!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ -->
				</div>
				
				<div class="form-group">
					<label>–ú–µ—Ç–æ–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏:</label>
					<select id="interpretationMethod">
						<option value="normative">–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–æ–π)</option>
						<option value="ipsative">–ò–ø—Å–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–∞–º–∏–º —Å–æ–±–æ–π)</option>
						<option value="criterion">–ö—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏)</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å):</label>
					<input type="text" id="normGroup" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–¥—Ä–æ—Å—Ç–∫–∏ 14-16 –ª–µ—Ç, n=150">
				</div>
			`;
		}

		function updatePsychologyScale() {
			const scaleType = document.getElementById('psychologyScaleType').value;
			let html = '';
			
			switch(scaleType) {
				case '1-5':
					html = `
						<div class="criteria-grid">
							${[1,2,3,4,5].map(level => `
								<div class="criteria-item">
									<label>–£—Ä–æ–≤–µ–Ω—å ${level}:</label>
									<input type="number" id="psychologyMin${level}" placeholder="–ú–∏–Ω" value="${(level-1)*20}">
									<input type="number" id="psychologyMax${level}" placeholder="–ú–∞–∫—Å" value="${level*20}">
									<input type="text" id="psychologyLabel${level}" placeholder="–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è" 
										   value="${['–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π', '–ù–∏–∑–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–í—ã—Å–æ–∫–∏–π', '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π'][level-1]}">
								</div>
							`).join('')}
						</div>
					`;
					break;
					
				case 'percentage':
					html = `
						<div class="criteria-grid">
							<div class="criteria-item">
								<label>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π (&lt;10%):</label>
								<input type="number" max="100" value="10" readonly>
							</div>
							<div class="criteria-item">
								<label>–ù–∏–∑–∫–∏–π (10-25%):</label>
								<input type="number" max="100" value="10" min="0">
								<input type="number" max="100" value="25" min="0">
							</div>
							<div class="criteria-item">
								<label>–°—Ä–µ–¥–Ω–∏–π (25-75%):</label>
								<input type="number" max="100" value="25" min="0">
								<input type="number" max="100" value="75" min="0">
							</div>
							<div class="criteria-item">
								<label>–í—ã—Å–æ–∫–∏–π (&gt;75%):</label>
								<input type="number" max="100" value="75" readonly>
							</div>
						</div>
					`;
					break;
					
				case 'levels':
					html = `
						<div class="criteria-grid">
							<div class="criteria-item">
								<label>üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å:</label>
								<input type="number" placeholder="–ú–∏–Ω %" value="0">
								<input type="number" placeholder="–ú–∞–∫—Å %" value="30">
							</div>
							<div class="criteria-item">
								<label>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:</label>
								<input type="number" placeholder="–ú–∏–Ω %" value="31">
								<input type="number" placeholder="–ú–∞–∫—Å %" value="70">
							</div>
							<div class="criteria-item">
								<label>üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å:</label>
								<input type="number" placeholder="–ú–∏–Ω %" value="71">
								<input type="number" placeholder="–ú–∞–∫—Å %" value="100">
							</div>
						</div>
					`;
					break;
					
				case 'stens':
					html = `
						<p><strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —à–∫–∞–ª–∞ —Å—Ç–µ–Ω–æ–≤ (1-10):</strong></p>
						<div class="criteria-grid">
							${[1,2,3,4,5,6,7,8,9,10].map(sten => `
								<div class="criteria-item">
									<label>–°—Ç–µ–Ω ${sten}:</label>
									<input type="number" value="${(sten-1)*10}" readonly>
									<input type="number" value="${sten*10}" readonly>
									<small>${getStenInterpretation(sten)}</small>
								</div>
							`).join('')}
						</div>
					`;
					break;
			}
			
			document.getElementById('psychologyCriteriaContainer').innerHTML = html;
		}

		function updatePsychologyAnalysis() {
			let html = '<h3 class="section-title">üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>';
			
			// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculatePsychologyAverage()}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateStandardDeviation()}œÉ</div>
						<div class="stat-label">–°—Ç–∞–Ω–¥. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculatePsychologyReliability()}</div>
						<div class="stat-label">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${identifyExtremeScores().length}</div>
						<div class="stat-label">–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</div>
					</div>
				</div>
			`;
			
			// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
			html += generatePsychologyLevelsDistribution();
			
			// –ü—Ä–æ—Ñ–∏–ª—å –≥—Ä—É–ø–ø—ã
			html += generateGroupProfile();
			
			// –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
			html += generateIndividualProfiles();
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
			html += generatePsychologyRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		function generatePsychologyLevelsDistribution() {
			const levels = appData.test.psychologySettings?.levels || [
				{ name: "–ù–∏–∑–∫–∏–π", min: 0, max: 40, color: "#e74c3c" },
				{ name: "–°—Ä–µ–¥–Ω–∏–π", min: 41, max: 70, color: "#f39c12" },
				{ name: "–í—ã—Å–æ–∫–∏–π", min: 71, max: 100, color: "#27ae60" }
			];
			
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			const levelCounts = {};
			levels.forEach(level => {
				levelCounts[level.name] = totalScores.filter(score => 
					score >= level.min && score <= level.max
				).length;
			});
			
			let html = '<h4>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(levelCounts).forEach(([name, count]) => {
				const level = levels.find(l => l.name === name);
				const percentage = (count / totalScores.length) * 100;
				
				html += `
					<div class="kpi-card" style="border-left-color: ${level.color}">
						<div class="kpi-value">${count}</div>
						<div class="kpi-label">${name}</div>
						<small>${percentage.toFixed(1)}% –≥—Ä—É–ø–ø—ã</small>
					</div>
				`;
			});
			
			html += '</div>';
			
			return html;
		}

		function updatePsychologyVisualization() {
			let html = `
				<div class="chart-row">
					<div class="chart-container" style="height: 400px;">
						<h3>üìà –ü—Ä–æ—Ñ–∏–ª—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≥—Ä—É–ø–ø—ã</h3>
						<canvas id="psychologyProfileChart"></canvas>
						<div class="chart-legend">
							<div class="legend-item">
								<div class="legend-color" style="background-color: #c0392b"></div>
								<span>–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π (&lt;30%)</span>
							</div>
							<div class="legend-item">
								<div class="legend-color" style="background-color: #f39c12"></div>
								<span>–°—Ä–µ–¥–Ω–∏–π (50-70%)</span>
							</div>
							<div class="legend-item">
								<div class="legend-color" style="background-color: #27ae60"></div>
								<span>–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π (&gt;85%)</span>
							</div>
						</div>
					</div>
					
					<div class="chart-container" style="height: 400px;">
						<h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥—Ä—É–ø–ø—ã</h3>
						<canvas id="normDistributionChart"></canvas>
						<div class="chart-legend">
							<div class="legend-item">
								<div class="legend-color" style="background-color: rgba(52, 152, 219, 0.7)"></div>
								<span>–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</span>
							</div>
							<div class="legend-item">
								<div class="legend-color" style="background-color: rgba(231, 76, 60, 0.8)"></div>
								<span>–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</span>
							</div>
						</div>
					</div>
				</div>
				
				<div class="chart-container" style="height: 500px;">
					<h3>üéØ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π (—Ç–æ–ø-3 –∏ –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)</h3>
					<canvas id="psychologyRadarChart"></canvas>
					<small>–°–ø–ª–æ—à–Ω—ã–µ –ª–∏–Ω–∏–∏ - –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–µ - –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</small>
				</div>
				
				<div class="chart-container">
					<h3>üë• –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Ä–∞–∑–≤–∏—Ç–∏—è</h3>
					<div id="individualProfiles" style="max-height: 400px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 8px;">
						<!-- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
					</div>
				</div>
			`;
			
			document.getElementById('specializedCharts').innerHTML = html;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ HTML
			setTimeout(() => {
				initPsychologyCharts();
				updateIndividualProfiles();
			}, 100);
		}

		function updateIndividualProfiles() {
			const container = document.getElementById('individualProfiles');
			if (!container) return;
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ –±–∞–ª–ª—ã
			const totalScores = appData.results.map((scores, index) => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				const percentage = (total / maxPossible) * 100;
				
				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
				const levels = appData.test.psychologySettings?.levels || [];
				let levelName = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
				let levelColor = '#7f8c8d';
				
				for (let level of levels) {
					if (percentage >= level.min && percentage <= level.max) {
						levelName = level.name;
						levelColor = level.color;
						break;
					}
				}
				
				// –ù–∞—Ö–æ–¥–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
				const features = (appData.psychologyFeatures || []).filter(f => f.studentIndex === index);
				
				return {
					name: appData.students[index],
					percentage: percentage,
					levelName: levelName,
					levelColor: levelColor,
					features: features
				};
			});
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
			totalScores.sort((a, b) => b.percentage - a.percentage);
			
			let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">';
			
			totalScores.forEach(student => {
				html += `
					<div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 4px solid ${student.levelColor};">
						<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
							<strong>${student.name}</strong>
							<span style="background: ${student.levelColor}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px;">
								${student.levelName}
							</span>
						</div>
						
						<div style="margin: 10px 0;">
							<div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
								<span>–û–±—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å:</span>
								<strong>${student.percentage.toFixed(1)}%</strong>
							</div>
							<div style="height: 8px; background: #ecf0f1; border-radius: 4px; margin-top: 5px; overflow: hidden;">
								<div style="height: 100%; width: ${student.percentage}%; background: ${student.levelColor}; border-radius: 4px;"></div>
							</div>
						</div>
						
						${student.features.length > 0 ? `
							<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
								<small style="color: #666; display: block; margin-bottom: 5px;">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</small>
								${student.features.map(feature => `
									<span style="display: inline-block; background: #e8f4fc; color: #3498db; font-size: 11px; padding: 2px 6px; border-radius: 10px; margin: 2px;">
										${feature.name}
									</span>
								`).join('')}
							</div>
						` : ''}
					</div>
				`;
			});
			
			html += '</div>';
			container.innerHTML = html;
		}

		function initPsychologyCharts() {
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
			if (window.psychologyProfileChartInstance) {
				window.psychologyProfileChartInstance.destroy();
			}
			if (window.normDistributionChartInstance) {
				window.normDistributionChartInstance.destroy();
			}
			if (window.radarChartInstance) {
				window.radarChartInstance.destroy();
			}
			
			// 1. –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ñ–∏–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
			const profileCtx = document.getElementById('psychologyProfileChart').getContext('2d');
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º
			const dimensions = appData.test.psychologySettings?.dimensions || [
				{ id: 'dim1', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 1' },
				{ id: 'dim2', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 2' },
				{ id: 'dim3', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 3' },
				{ id: 'dim4', name: '–ò–∑–º–µ—Ä–µ–Ω–∏–µ 4' }
			];
			
			const dimensionAverages = dimensions.map(dimension => {
				// –ù–∞—Ö–æ–¥–∏–º –∑–∞–¥–∞–Ω–∏—è —ç—Ç–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è
				const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
				if (dimensionTasks.length === 0) return 0;
				
				let totalScore = 0;
				let totalMax = 0;
				
				dimensionTasks.forEach(task => {
					const taskIndex = appData.tasks.indexOf(task);
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					totalScore += actualTotal;
					totalMax += maxScore * appData.results.length;
				});
				
				return totalMax > 0 ? (totalScore / totalMax) * 100 : 0;
			});
			
			// –¶–≤–µ—Ç–∞ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏–π
			const dimensionColors = [
				'rgba(255, 99, 132, 0.8)',
				'rgba(54, 162, 235, 0.8)',
				'rgba(255, 206, 86, 0.8)',
				'rgba(75, 192, 192, 0.8)',
				'rgba(153, 102, 255, 0.8)'
			];
			
			window.psychologyProfileChartInstance = new Chart(profileCtx, {
				type: 'bar',
				data: {
					labels: dimensions.map(d => d.name),
					datasets: [{
						label: '–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –≥—Ä—É–ø–ø—ã (%)',
						data: dimensionAverages,
						backgroundColor: dimensionColors.slice(0, dimensions.length),
						borderColor: dimensionColors.slice(0, dimensions.length).map(color => color.replace('0.8', '1')),
						borderWidth: 2,
						borderRadius: 6,
						barPercentage: 0.6
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: true,
					plugins: {
						legend: {
							display: true,
							position: 'top'
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									const dimension = dimensions[context.dataIndex];
									const value = context.raw;
									let interpretation = '';
									
									if (value < 30) interpretation = ' (–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π)';
									else if (value < 50) interpretation = ' (–ù–∏–∑–∫–∏–π)';
									else if (value < 70) interpretation = ' (–°—Ä–µ–¥–Ω–∏–π)';
									else if (value < 85) interpretation = ' (–í—ã—Å–æ–∫–∏–π)';
									else interpretation = ' (–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π)';
									
									return `${dimension.name}: ${value.toFixed(1)}%${interpretation}`;
								},
								afterLabel: function(context) {
									const dimension = dimensions[context.dataIndex];
									return dimension.description || '';
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							max: 100,
							title: {
								display: true,
								text: '–£—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è (%)',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								callback: function(value) {
									return value + '%';
								},
								font: {
									size: 12
								}
							},
							grid: {
								color: function(context) {
									const value = context.tick.value;
									if (value === 30 || value === 50 || value === 70 || value === 85) {
										return 'rgba(0, 0, 0, 0.3)';
									}
									return 'rgba(0, 0, 0, 0.1)';
								},
								lineWidth: function(context) {
									const value = context.tick.value;
									if (value === 30 || value === 50 || value === 70 || value === 85) {
										return 2;
									}
									return 1;
								}
							}
						},
						x: {
							title: {
								display: true,
								text: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								font: {
									size: 12
								}
							}
						}
					},
					animation: {
						duration: 1000,
						easing: 'easeOutQuart'
					}
				}
			});
			
			// 2. –ì—Ä–∞—Ñ–∏–∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
			const normCtx = document.getElementById('normDistributionChart').getContext('2d');
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ –±–∞–ª–ª—ã –≤—Å–µ—Ö —É—á–∞—â–∏—Ö—Å—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			// –°–æ–∑–¥–∞–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É
			const bins = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
			const histogramData = new Array(bins.length - 1).fill(0);
			
			totalScores.forEach(score => {
				for (let i = 0; i < bins.length - 1; i++) {
					if (score >= bins[i] && score < bins[i + 1]) {
						histogramData[i]++;
						break;
					}
				}
			});
			
			// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
			const mean = totalScores.reduce((a, b) => a + b, 0) / totalScores.length;
			const std = Math.sqrt(totalScores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / totalScores.length);
			
			const normalDistribution = bins.map(bin => {
				return totalScores.length * 0.1 * (1 / (std * Math.sqrt(2 * Math.PI))) * 
					   Math.exp(-0.5 * Math.pow((bin - mean) / std, 2));
			});
			
			window.normDistributionChartInstance = new Chart(normCtx, {
				type: 'bar',
				data: {
					labels: ['0-10%', '10-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-70%', '70-80%', '80-90%', '90-100%'],
					datasets: [
						{
							label: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã',
							data: histogramData,
							backgroundColor: 'rgba(52, 152, 219, 0.7)',
							borderColor: 'rgba(52, 152, 219, 1)',
							borderWidth: 1,
							borderRadius: 4
						},
						{
							label: '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ',
							data: normalDistribution,
							type: 'line',
							fill: false,
							borderColor: 'rgba(231, 76, 60, 0.8)',
							borderWidth: 3,
							pointRadius: 0,
							tension: 0.4
						}
					]
				},
				options: {
					responsive: true,
					maintainAspectRatio: true,
					plugins: {
						legend: {
							display: true,
							position: 'top'
						},
						tooltip: {
							callbacks: {
								title: function(context) {
									return `–î–∏–∞–ø–∞–∑–æ–Ω: ${context[0].label}`;
								},
								label: function(context) {
									if (context.datasetIndex === 0) {
										const count = context.raw;
										const percentage = (count / totalScores.length) * 100;
										return `–£—á–∞—â–∏—Ö—Å—è: ${count} (${percentage.toFixed(1)}%)`;
									} else {
										return `–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: ${context.raw.toFixed(2)}`;
									}
								}
							}
						},
						annotation: {
							annotations: {
								meanLine: {
									type: 'line',
									yMin: 0,
									yMax: Math.max(...histogramData) * 1.1,
									xMin: mean / 10,
									xMax: mean / 10,
									borderColor: 'rgba(46, 204, 113, 0.8)',
									borderWidth: 2,
									borderDash: [5, 5],
									label: {
										display: true,
										content: `–°—Ä–µ–¥–Ω–µ–µ: ${mean.toFixed(1)}%`,
										position: 'center',
										backgroundColor: 'rgba(46, 204, 113, 0.8)',
										color: 'white',
										font: {
											size: 12,
											weight: 'bold'
										}
									}
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							title: {
								display: true,
								text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								font: {
									size: 12
								}
							}
						},
						x: {
							title: {
								display: true,
								text: '–£—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è (%)',
								font: {
									size: 14,
									weight: 'bold'
								}
							},
							ticks: {
								font: {
									size: 12
								}
							}
						}
					}
				}
			});
			
			// 3. –†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–ª—è —Ç–æ–ø-3 –∏ –Ω–∏–∑–∫–∏—Ö —É—á–∞—â–∏—Ö—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç radarChart)
			const radarCanvas = document.getElementById('psychologyRadarChart');
			if (radarCanvas) {
				const radarCtx = radarCanvas.getContext('2d');
				
				// –í—ã–±–∏—Ä–∞–µ–º 3 –ª—É—á—à–∏—Ö –∏ 3 —Ö—É–¥—à–∏—Ö —É—á–∞—â–∏—Ö—Å—è
				const studentScores = totalScores.map((score, index) => ({
					name: appData.students[index],
					score: score,
					index: index
				}));
				
				studentScores.sort((a, b) => b.score - a.score);
				const topStudents = studentScores.slice(0, 3);
				const bottomStudents = studentScores.slice(-3);
				
				// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è
				const radarLabels = dimensions.map(d => d.name);
				
				const topStudentData = topStudents.map(student => {
					return dimensions.map(dimension => {
						const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
						if (dimensionTasks.length === 0) return 0;
						
						let studentScore = 0;
						let maxScore = 0;
						
						dimensionTasks.forEach(task => {
							const taskIndex = appData.tasks.indexOf(task);
							studentScore += appData.results[student.index][taskIndex] || 0;
							maxScore += task.maxScore;
						});
						
						return maxScore > 0 ? (studentScore / maxScore) * 100 : 0;
					});
				});
				
				const bottomStudentData = bottomStudents.map(student => {
					return dimensions.map(dimension => {
						const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
						if (dimensionTasks.length === 0) return 0;
						
						let studentScore = 0;
						let maxScore = 0;
						
						dimensionTasks.forEach(task => {
							const taskIndex = appData.tasks.indexOf(task);
							studentScore += appData.results[student.index][taskIndex] || 0;
							maxScore += task.maxScore;
						});
						
						return maxScore > 0 ? (studentScore / maxScore) * 100 : 0;
					});
				});
				
				const radarDatasets = [
					...topStudentData.map((data, i) => ({
						label: `–¢–æ–ø ${i+1}: ${topStudents[i].name}`,
						data: data,
						backgroundColor: `rgba(39, 174, 96, ${0.2 + i * 0.1})`,
						borderColor: `rgba(39, 174, 96, ${0.8})`,
						pointBackgroundColor: `rgba(39, 174, 96, 1)`,
						pointBorderColor: '#fff',
						pointHoverRadius: 8,
						borderWidth: 2
					})),
					...bottomStudentData.map((data, i) => ({
						label: `–ù–∏–∑–∫–∏–π ${i+1}: ${bottomStudents[i].name}`,
						data: data,
						backgroundColor: `rgba(231, 76, 60, ${0.2 + i * 0.1})`,
						borderColor: `rgba(231, 76, 60, ${0.8})`,
						pointBackgroundColor: `rgba(231, 76, 60, 1)`,
						pointBorderColor: '#fff',
						pointHoverRadius: 8,
						borderWidth: 2,
						borderDash: [5, 5]
					}))
				];
				
				window.radarChartInstance = new Chart(radarCtx, {
					type: 'radar',
					data: {
						labels: radarLabels,
						datasets: radarDatasets
					},
					options: {
						responsive: true,
						maintainAspectRatio: true,
						plugins: {
							legend: {
								position: 'top',
								labels: {
									font: {
										size: 11
									}
								}
							},
							tooltip: {
								callbacks: {
									label: function(context) {
										return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
									}
								}
							}
						},
						scales: {
							r: {
								beginAtZero: true,
								max: 100,
								ticks: {
									callback: function(value) {
										return value + '%';
									},
									stepSize: 20
								},
								pointLabels: {
									font: {
										size: 11
									}
								}
							}
						}
					}
				});
			}
			
			// 4. –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
			window.addEventListener('resize', function() {
				if (window.psychologyProfileChartInstance) {
					window.psychologyProfileChartInstance.resize();
				}
				if (window.normDistributionChartInstance) {
					window.normDistributionChartInstance.resize();
				}
				if (window.radarChartInstance) {
					window.radarChartInstance.resize();
				}
			});
		}

		function generatePsychologyRecommendations() {
			return `
				<div class="recommendation-card">
					<h4>üí° –ü—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
					
					<p><strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong></p>
					<ul>
						<li>–£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</li>
						<li>–°–æ–æ—Ç–Ω–æ—Å–∏—Ç—å —Å –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º–∏ –Ω–æ—Ä–º–∞–º–∏</li>
						<li>–£—á–∏—Ç—ã–≤–∞—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω–æ-–∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</li>
						<li>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–ª–µ–∫—Å–µ —Å –¥—Ä—É–≥–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</li>
					</ul>
					
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong></p>
					<ul>
						<li>–î–ª—è —É—á–∞—â–∏—Ö—Å—è —Å –Ω–∏–∑–∫–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</li>
						<li>–î–ª—è –≥—Ä—É–ø–ø—ã: —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∑–∞–Ω—è—Ç–∏—è</li>
						<li>–î–ª—è –ø–µ–¥–∞–≥–æ–≥–æ–≤: –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
						<li>–î–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–µ—Å–µ–¥—ã</li>
					</ul>
				</div>
			`;
		}

		function generatePsychologyReport() {
			return `
				<div class="section">
					<h3>üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ</h3>
					
					<div class="recommendation-card">
						<p><strong>–¶–µ–ª—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:</strong> ${appData.test.goals || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ú–µ—Ç–æ–¥–∏–∫–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
						<p><strong>–í—ã–±–æ—Ä–∫–∞:</strong> ${appData.students.length} —á–µ–ª–æ–≤–µ–∫, ${appData.test.class}</p>
					</div>
					
					<h4>–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:</h4>
					${generatePsychologyConclusions()}
					
					<h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
					${generateDetailedPsychologyRecommendations()}
				</div>
			`;
		}
		
		function calculatePsychologyGrade(totalScore) {
			const settings = appData.test.psychologySettings;
			if (!settings) return calculateGrade(totalScore); // fallback
			
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (totalScore / maxPossible) * 100;
			
			switch(settings.scaleType) {
				case '1-5':
					for (let i = 1; i <= 5; i++) {
						if (percentage >= settings[`min${i}`] && percentage <= settings[`max${i}`]) {
							return i;
						}
					}
					break;
					
				case 'percentage':
					if (percentage < 25) return '–ù–∏–∑–∫–∏–π';
					if (percentage < 50) return '–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ';
					if (percentage < 75) return '–°—Ä–µ–¥–Ω–∏–π';
					if (percentage < 90) return '–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ';
					return '–í—ã—Å–æ–∫–∏–π';
					
				case 'levels':
					const levels = settings.levels || [];
					for (let level of levels) {
						if (percentage >= level.min && percentage <= level.max) {
							return level.name;
						}
					}
					break;
			}
			
			return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
		}		

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadSampleData() {
            const workType = document.getElementById('workType').value;
            
            if (workType === 'vpr') {
                loadVPRSample();
            } else if (workType === 'func_literacy') {
                loadLiteracySample();
            } else if (workType === 'oge') {
                loadOGESample();
            } else if (workType === 'psychology') {
                loadPsychologySample();
			} else if (workType === 'ege') {
                loadEGESample();
            } else {
                loadStandardSample();
            }
        }
		
		function loadPsychologySample() {
			appData = {
				test: {
					subject: "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è",
					class: "10–ê",
					testDate: new Date().toISOString().split('T')[0],
					theme: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ (—Ç–µ—Å—Ç MSCEIT)",
					goals: "–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Ä–∞–∑–≤–∏—Ç–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –ø–æ 4 –≤–µ—Ç–≤—è–º: –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π, –ø–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
					workType: "psychology",
					workFormat: "test",
					timeLimit: 40,
					totalStudents: 25,
					presentStudents: 22,
					absentReason: "3 —É—á–∞—â–∏—Ö—Å—è - —É—á–∞—Å—Ç–∏–µ –≤ –æ–ª–∏–º–ø–∏–∞–¥–µ",
					criteria: {
						5: { min: 85, max: 100, label: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π" },
						4: { min: 70, max: 84, label: "–í—ã—Å–æ–∫–∏–π" },
						3: { min: 50, max: 69, label: "–°—Ä–µ–¥–Ω–∏–π" },
						2: { min: 30, max: 49, label: "–ù–∏–∑–∫–∏–π" },
						1: { min: 0, max: 29, label: "–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π" }
					},
					psychologySettings: {
						scaleType: '1-5',
						usePercentages: true,
						interpretationMethod: "normative",
						normGroup: "–ü–æ–¥—Ä–æ—Å—Ç–∫–∏ 15-17 –ª–µ—Ç, n=500",
						reliability: 0.87,
						validity: "–°–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–∞—è –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–Ω–∞—è",
						levels: [
							{ 
								id: 1, 
								name: "–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π", 
								min: 0, 
								max: 29, 
								color: "#c0392b",
								interpretation: "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ –±–∞–∑–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤",
								recommendation: "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞"
							},
							{ 
								id: 2, 
								name: "–ù–∏–∑–∫–∏–π", 
								min: 30, 
								max: 49, 
								color: "#e74c3c",
								interpretation: "–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω–æ–π —Å—Ñ–µ—Ä–µ",
								recommendation: "–ì—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è"
							},
							{ 
								id: 3, 
								name: "–°—Ä–µ–¥–Ω–∏–π", 
								min: 50, 
								max: 69, 
								color: "#f39c12",
								interpretation: "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ",
								recommendation: "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ –∑–∞–Ω—è—Ç–∏—è"
							},
							{ 
								id: 4, 
								name: "–í—ã—Å–æ–∫–∏–π", 
								min: 70, 
								max: 84, 
								color: "#3498db",
								interpretation: "–•–æ—Ä–æ—à–æ —Ä–∞–∑–≤–∏—Ç—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
								recommendation: "–†–∞–∑–≤–∏—Ç–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤"
							},
							{ 
								id: 5, 
								name: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π", 
								min: 85, 
								max: 100, 
								color: "#27ae60",
								interpretation: "–í—ã–¥–∞—é—â–∏–µ—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
								recommendation: "–ü—Ä–æ—Ñ–∏–ª—å–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ"
							}
						],
						dimensions: [
							{
								id: "perception",
								name: "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ç–æ—á–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —ç–º–æ—Ü–∏–∏"
							},
							{
								id: "use",
								name: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º—ã—à–ª–µ–Ω–∏—è"
							},
							{
								id: "understanding",
								name: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –∏ –∏—Ö –ø–µ—Ä–µ—Ö–æ–¥—ã"
							},
							{
								id: "management",
								name: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
								description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏—è–º–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π"
							}
						],
						reportSections: [
							"–û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –≤—ã–±–æ—Ä–∫–∏",
							"–ü—Ä–æ—Ñ–∏–ª—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞",
							"–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–æ–π",
							"–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏",
							"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"
						]
					}
				},
				tasks: [
					{ 
						type: "–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π –ø–æ —Ñ–æ—Ç–æ", 
						maxScore: 10, 
						level: 1, 
						knowledge: "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "perception",
						subscale: "–õ–∏—Ü–µ–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è",
						number: 1 
					},
					{ 
						type: "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–º–æ—Ü–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏", 
						maxScore: 8, 
						level: 2, 
						knowledge: "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "perception",
						subscale: "–≠–º–æ—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ",
						number: 2 
					},
					{ 
						type: "–≠–º–æ—Ü–∏–∏ –∏ —Ü–≤–µ—Ç–∞", 
						maxScore: 6, 
						level: 1, 
						knowledge: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "use",
						subscale: "–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏",
						number: 3 
					},
					{ 
						type: "–≠–º–æ—Ü–∏–∏ –∏ —Ä–µ—à–µ–Ω–∏—è", 
						maxScore: 12, 
						level: 3, 
						knowledge: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "use",
						subscale: "–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π",
						number: 4 
					},
					{ 
						type: "–°–ª–æ–∂–Ω—ã–µ —ç–º–æ—Ü–∏–∏", 
						maxScore: 15, 
						level: 3, 
						knowledge: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "understanding",
						subscale: "–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è",
						number: 5 
					},
					{ 
						type: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã", 
						maxScore: 10, 
						level: 4, 
						knowledge: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π",
						dimension: "understanding",
						subscale: "–î–∏–Ω–∞–º–∏–∫–∞",
						number: 6 
					},
					{ 
						type: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–Ω–µ–≤–æ–º", 
						maxScore: 12, 
						level: 2, 
						knowledge: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
						dimension: "management",
						subscale: "–†–µ–≥—É–ª—è—Ü–∏—è",
						number: 7 
					},
					{ 
						type: "–≠–º–ø–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç", 
						maxScore: 17, 
						level: 4, 
						knowledge: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏—è–º–∏",
						dimension: "management",
						subscale: "–≠–º–ø–∞—Ç–∏—è",
						number: 8 
					}
				],
				students: [
					"–ò–≤–∞–Ω–æ–≤–∞ –ê–Ω–Ω–∞", "–ü–µ—Ç—Ä–æ–≤ –ú–∞–∫—Å–∏–º", "–°–∏–¥–æ—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",
					"–ö–æ–∑–ª–æ–≤ –ê—Ä—Ç–µ–º", "–ù–∏–∫–æ–ª–∞–µ–≤–∞ –°–æ—Ñ–∏—è", "–§–µ–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π",
					"–ú–æ—Ä–æ–∑–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è", "–í–æ–ª–∫–æ–≤ –ö–∏—Ä–∏–ª–ª", "–õ–µ–±–µ–¥–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è",
					"–°–µ–º–µ–Ω–æ–≤ –ò–ª—å—è", "–ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ú–∞—Ä–∏—è", "–ü–∞–≤–ª–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
					"–û—Ä–ª–æ–≤–∞ –î–∞—Ä—å—è", "–ñ—É–∫–æ–≤ –ù–∏–∫–∏—Ç–∞", "–¢–∏—Ö–æ–Ω–æ–≤–∞ –ï–ª–µ–Ω–∞",
					"–ë–µ–ª–æ–≤ –†–æ–º–∞–Ω", "–ì—Ä–æ–º–æ–≤–∞ –ê–ª–∏—Å–∞", "–õ–∞—Ä–∏–Ω –ú–∏—Ö–∞–∏–ª",
					"–ï—Ñ–∏–º–æ–≤–∞ –ü–æ–ª–∏–Ω–∞", "–°–æ—Ä–æ–∫–∏–Ω –ò–≤–∞–Ω", "–î–∞–Ω–∏–ª–æ–≤–∞ –û–ª—å–≥–∞",
					"–ö–æ–º–∞—Ä–æ–≤ –ì–µ–æ—Ä–≥–∏–π"
				],
				results: [
					// –ò–≤–∞–Ω–æ–≤–∞ –ê–Ω–Ω–∞
					[8, 6, 4, 9, 12, 8, 9, 14],
					// –ü–µ—Ç—Ä–æ–≤ –ú–∞–∫—Å–∏–º
					[6, 5, 3, 7, 8, 6, 7, 10],
					// –°–∏–¥–æ—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞
					[9, 7, 5, 10, 14, 9, 11, 16],
					// –ö–æ–∑–ª–æ–≤ –ê—Ä—Ç–µ–º
					[7, 5, 4, 8, 10, 7, 8, 12],
					// –ù–∏–∫–æ–ª–∞–µ–≤–∞ –°–æ—Ñ–∏—è
					[5, 4, 2, 6, 7, 5, 6, 9],
					// –§–µ–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π
					[10, 8, 6, 12, 15, 10, 12, 17],
					// –ú–æ—Ä–æ–∑–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è
					[8, 6, 5, 9, 13, 8, 10, 15],
					// –í–æ–ª–∫–æ–≤ –ö–∏—Ä–∏–ª–ª
					[4, 3, 2, 5, 6, 4, 5, 8],
					// –õ–µ–±–µ–¥–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è
					[7, 6, 4, 8, 11, 7, 9, 13],
					// –°–µ–º–µ–Ω–æ–≤ –ò–ª—å—è
					[9, 7, 5, 11, 14, 9, 11, 16],
					// –ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ú–∞—Ä–∏—è
					[6, 5, 3, 7, 9, 6, 7, 11],
					// –ü–∞–≤–ª–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
					[8, 6, 4, 9, 12, 8, 10, 14],
					// –û—Ä–ª–æ–≤–∞ –î–∞—Ä—å—è
					[5, 4, 2, 6, 8, 5, 6, 9],
					// –ñ—É–∫–æ–≤ –ù–∏–∫–∏—Ç–∞
					[10, 8, 6, 12, 15, 10, 12, 17],
					// –¢–∏—Ö–æ–Ω–æ–≤–∞ –ï–ª–µ–Ω–∞
					[7, 5, 4, 8, 11, 7, 9, 13],
					// –ë–µ–ª–æ–≤ –†–æ–º–∞–Ω
					[8, 6, 5, 9, 13, 8, 10, 15],
					// –ì—Ä–æ–º–æ–≤–∞ –ê–ª–∏—Å–∞
					[6, 5, 3, 7, 10, 6, 8, 12],
					// –õ–∞—Ä–∏–Ω –ú–∏—Ö–∞–∏–ª
					[9, 7, 5, 10, 14, 9, 11, 16],
					// –ï—Ñ–∏–º–æ–≤–∞ –ü–æ–ª–∏–Ω–∞
					[4, 3, 2, 5, 7, 4, 5, 8],
					// –°–æ—Ä–æ–∫–∏–Ω –ò–≤–∞–Ω
					[8, 6, 4, 9, 12, 8, 9, 14],
					// –î–∞–Ω–∏–ª–æ–≤–∞ –û–ª—å–≥–∞
					[7, 5, 4, 8, 11, 7, 9, 13],
					// –ö–æ–º–∞—Ä–æ–≤ –ì–µ–æ—Ä–≥–∏–π
					[6, 5, 3, 7, 9, 6, 7, 11]
				],
				errors: []
			};
			
			// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫/–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π
			generatePsychologyFeatures();
			
			saveData();
			renderAll();
			showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è.", "success");
		}

		function generatePsychologyFeatures() {
			const features = [
				{ type: "perception_bias", name: "–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏", color: "#9b59b6" },
				{ type: "emotional_avoidance", name: "–ò–∑–±–µ–≥–∞–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π", color: "#e67e22" },
				{ type: "overcontrol", name: "–ß—Ä–µ–∑–º–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —ç–º–æ—Ü–∏–π", color: "#3498db" },
				{ type: "empathy_deficit", name: "–î–µ—Ñ–∏—Ü–∏—Ç —ç–º–ø–∞—Ç–∏–∏", color: "#e74c3c" },
				{ type: "emotional_awareness", name: "–í—ã—Å–æ–∫–∞—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç—å", color: "#27ae60" },
				{ type: "stress_tolerance", name: "–í—ã—Å–æ–∫–∞—è —Å—Ç—Ä–µ—Å—Å–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", color: "#2ecc71" }
			];
			
			appData.psychologyFeatures = [];
			
			features.forEach(feature => {
				const randomStudents = [];
				const count = Math.floor(Math.random() * 4) + 2; // 2-5 —É—á–∞—â–∏—Ö—Å—è
				
				for (let i = 0; i < count; i++) {
					const studentIndex = Math.floor(Math.random() * appData.students.length);
					if (!randomStudents.includes(studentIndex)) {
						randomStudents.push(studentIndex);
						
						appData.psychologyFeatures.push({
							studentIndex: studentIndex,
							type: feature.type,
							name: feature.name,
							severity: Math.floor(Math.random() * 3) + 1, // 1-3
							description: `–ü—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–∏—è—Ö ${getRandomTasks()}`,
							recommendation: getFeatureRecommendation(feature.type)
						});
					}
				}
			});
		}

		function getRandomTasks() {
			const tasks = [];
			const count = Math.floor(Math.random() * 3) + 1;
			for (let i = 0; i < count; i++) {
				tasks.push(Math.floor(Math.random() * appData.tasks.length) + 1);
			}
			return tasks.join(', ');
		}

		function getFeatureRecommendation(featureType) {
			const recommendations = {
				"perception_bias": "–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è",
				"emotional_avoidance": "–≠–∫—Å–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è",
				"overcontrol": "–¢—Ä–µ–Ω–∏–Ω–≥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç–∫—Å–ø—Ä–µ—Å—Å–∏–∏",
				"empathy_deficit": "–¢—Ä–µ–Ω–∏–Ω–≥ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–º–ø–∞—Ç–∏–∏",
				"emotional_awareness": "–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤",
				"stress_tolerance": "–û–±—É—á–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∞–º —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏"
			};
			return recommendations[featureType] || "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è";
		}

        function loadStandardSample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "5–ê",
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–î—Ä–æ–±–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã",
                    goals: "1. –°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –¥—Ä–æ–±–µ–π\n2. –£–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π\n3. –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –æ—Ç —á–∏—Å–ª–∞\n4. –†–µ—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã",
                    workType: "current",
                    workFormat: "mixed",
                    timeLimit: 45,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 22, max: 24 },
                        4: { min: 18, max: 21 },
                        3: { min: 12, max: 17 },
                        2: { min: 0, max: 11 }
                    }
                },
                tasks: [
                    { type: "–°–ª–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 3, level: 1, knowledge: "–ø—Ä–∞–≤–∏–ª–∞ —Å–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–±–µ–π" },
                    { type: "–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 2, level: 1, knowledge: "–ø—Ä–∞–≤–∏–ª–∞ –≤—ã—á–∏—Ç–∞–Ω–∏—è –¥—Ä–æ–±–µ–π" },
                    { type: "–£–º–Ω–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 4, level: 2, knowledge: "—É–º–Ω–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π" },
                    { type: "–î–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π", maxScore: 3, level: 2, knowledge: "–¥–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π" },
                    { type: "–ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —á–∏—Å–ª–∞", maxScore: 2, level: 2, knowledge: "–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤" },
                    { type: "–ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —á–∏—Å–ª–∞ –ø–æ %", maxScore: 3, level: 3, knowledge: "–æ–±—Ä–∞—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã" },
                    { type: "–ó–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã", maxScore: 4, level: 3, knowledge: "—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏" },
                    { type: "–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏", maxScore: 3, level: 4, knowledge: "–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏" }
                ],
                students: [
                    "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π", "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π",
                    "–ö–æ–∑–ª–æ–≤–∞ –ê–Ω–Ω–∞", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò–≤–∞–Ω", "–§–µ–¥–æ—Ä–æ–≤–∞ –ï–ª–µ–Ω–∞",
                    "–ú–æ—Ä–æ–∑–æ–≤ –ü–∞–≤–µ–ª", "–í–∞—Å–Ω–µ—Ü–æ–≤–∞ –û–ª—å–≥–∞", "–õ–µ–±–µ–¥–µ–≤ –°–µ—Ä–≥–µ–π",
                    "–°–µ–º–µ–Ω–æ–≤–∞ –ò—Ä–∏–Ω–∞", "–ö—É–∑–Ω–µ—Ü–æ–≤ –ê–Ω–¥—Ä–µ–π", "–ü–∞–≤–ª–æ–≤–∞ –ù–∞—Ç–∞–ª—å—è",
                    "–û—Ä–ª–æ–≤ –ú–∞–∫—Å–∏–º", "–ñ—É–∫–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è", "–¢–∏—Ö–æ–Ω–æ–≤ –ê—Ä—Ç–µ–º",
                    "–ë–µ–ª–æ–≤–∞ –°–æ—Ñ–∏—è", "–ì—Ä–æ–º–æ–≤ –ö–∏—Ä–∏–ª–ª", "–õ–∞—Ä–∏–Ω–∞ –î–∞—Ä—å—è",
                    "–ï—Ñ–∏–º–æ–≤ –†–æ–º–∞–Ω", "–°–æ—Ä–æ–∫–∏–Ω–∞ –ê–ª–∏—Å–∞", "–î–∞–Ω–∏–ª–æ–≤ –ú–∞—Ä–∫",
                    "–ö–æ–º–∞—Ä–æ–≤–∞ –ü–æ–ª–∏–Ω–∞", "–ù–æ–≤–∏–∫–æ–≤ –ì–ª–µ–±"
                ],
                results: [
                    [3, 2, 4, 3, 2, 3, 4, 3],
                    [2, 1, 3, 2, 2, 2, 3, 2],
                    [3, 2, 4, 3, 1, 3, 4, 3],
                    [1, 1, 2, 1, 1, 1, 2, 1],
                    [3, 2, 3, 3, 2, 3, 3, 3],
                    [2, 2, 3, 2, 2, 2, 3, 2],
                    [3, 1, 4, 3, 2, 3, 4, 3],
                    [2, 2, 3, 2, 1, 2, 3, 2],
                    [3, 2, 4, 3, 2, 3, 4, 3],
                    [1, 1, 2, 1, 1, 1, 2, 1],
                    [3, 2, 3, 3, 2, 3, 3, 3],
                    [2, 2, 3, 2, 2, 2, 3, 2],
                    [3, 2, 4, 3, 2, 3, 4, 2],
                    [2, 2, 3, 2, 2, 2, 3, 1],
                    [3, 1, 4, 3, 1, 3, 3, 2],
                    [2, 2, 3, 2, 2, 2, 2, 1],
                    [3, 2, 3, 3, 2, 2, 3, 2],
                    [2, 1, 3, 2, 1, 2, 2, 1],
                    [3, 2, 4, 3, 2, 3, 3, 2],
                    [2, 2, 3, 2, 2, 2, 3, 1],
                    [3, 1, 3, 3, 1, 2, 2, 1],
                    [2, 2, 2, 2, 2, 1, 2, 0],
                    [1, 1, 2, 1, 1, 1, 1, 0]
                ],
                errors: []
            };
            
            generateSampleErrors();
            
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω! –ú–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤.", "success");
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ (VPR, Literacy, OGE, EGE) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        function loadVPRSample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "5–ê",
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–í–ü–† –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ",
                    goals: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π —É—á–∞—â–∏—Ö—Å—è",
                    workType: "vpr",
                    workFormat: "test",
                    timeLimit: 45,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 18, max: 20 },
                        4: { min: 15, max: 17 },
                        3: { min: 10, max: 14 },
                        2: { min: 0, max: 9 }
                    }
                },
                tasks: [
                    { type: "–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è", maxScore: 1, level: 1, knowledge: "–≤—ã—á–∏—Å–ª–µ–Ω–∏—è", competence: "calculations", vprLevel: 1, number: 1 },
                    { type: "–¢–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞", maxScore: 1, level: 1, knowledge: "—Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á", competence: "text_work", vprLevel: 1, number: 2 },
                    { type: "–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 1, level: 1, knowledge: "–≥–µ–æ–º–µ—Ç—Ä–∏—è", competence: "graphics", vprLevel: 1, number: 3 },
                    { type: "–†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π", maxScore: 2, level: 2, knowledge: "–∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö", competence: "data_work", vprLevel: 2, number: 4 },
                    { type: "–õ–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 2, level: 2, knowledge: "–ª–æ–≥–∏–∫–∞", competence: "logic", vprLevel: 2, number: 5 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [1, 1, 1, 2, 2],
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 2, 1],
                    [0, 1, 1, 1, 0],
                    [1, 1, 0, 1, 1]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –í–ü–† –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        function loadLiteracySample() {
            appData = {
                test: {
                    subject: "–ú–µ–∂–ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è",
                    class: "6–ê", 
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏",
                    goals: "–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏",
                    workType: "func_literacy",
                    workFormat: "mixed",
                    timeLimit: 60,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 90, max: 100 },
                        4: { min: 75, max: 89 },
                        3: { min: 50, max: 74 },
                        2: { min: 0, max: 49 }
                    }
                },
                tasks: [
                    { type: "–ß—Ç–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏", maxScore: 2, level: 1, knowledge: "–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞", literacyType: "reading", skill: "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π", context: "personal", number: 1 },
                    { type: "–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞", maxScore: 3, level: 2, knowledge: "—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å", literacyType: "financial", skill: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤", context: "personal", number: 2 },
                    { type: "–ê–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞", maxScore: 2, level: 2, knowledge: "—Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏", literacyType: "math", skill: "–ß—Ç–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤", context: "social", number: 3 },
                    { type: "–û—Ü–µ–Ω–∫–∞ –Ω–æ–≤–æ—Å—Ç–∏", maxScore: 3, level: 3, knowledge: "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", literacyType: "digital", skill: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ", context: "global", number: 4 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [2, 3, 2, 3],
                    [2, 2, 1, 2],
                    [1, 3, 2, 2],
                    [1, 1, 1, 1],
                    [2, 2, 2, 2]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        function loadOGESample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "9–ê", 
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–ü—Ä–æ–±–Ω—ã–π –û–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ",
                    goals: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏",
                    workType: "oge",
                    workFormat: "mixed",
                    timeLimit: 235,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 22, max: 32 },
                        4: { min: 15, max: 21 },
                        3: { min: 8, max: 14 },
                        2: { min: 0, max: 7 }
                    }
                },
                tasks: [
                    { type: "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π", maxScore: 1, level: 1, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.1", pu: "–í—ã—á–∏—Å–ª–µ–Ω–∏—è", answerType: "short", number: 1 },
                    { type: "–£—Ä–∞–≤–Ω–µ–Ω–∏—è", maxScore: 1, level: 1, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.2", pu: "–†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π", answerType: "short", number: 2 },
                    { type: "–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 1, level: 2, knowledge: "–≥–µ–æ–º–µ—Ç—Ä–∏—è", kes: "2.1", pu: "–†–µ—à–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á", answerType: "short", number: 3 },
                    { type: "–¢–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞", maxScore: 2, level: 2, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.3", pu: "–†–µ—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á", answerType: "detailed", number: 4 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [1, 1, 1, 2],
                    [1, 1, 0, 1],
                    [1, 1, 1, 2],
                    [0, 1, 1, 1],
                    [1, 1, 1, 1]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –û–ì–≠ –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        function loadEGESample() {
            appData = {
                test: {
                    subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
                    class: "11–ê", 
                    testDate: new Date().toISOString().split('T')[0],
                    theme: "–ü—Ä–æ–±–Ω—ã–π –ï–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ (–ø—Ä–æ—Ñ–∏–ª—å)",
                    goals: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –µ–¥–∏–Ω–æ–º—É –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É",
                    workType: "ege",
                    workFormat: "mixed",
                    timeLimit: 235,
                    totalStudents: 25,
                    presentStudents: 23,
                    absentReason: "2 —É—á–∞—â–∏—Ö—Å—è - –±–æ–ª–µ–∑–Ω—å",
                    criteria: {
                        5: { min: 27, max: 31 },
                        4: { min: 20, max: 26 },
                        3: { min: 12, max: 19 },
                        2: { min: 0, max: 11 }
                    }
                },
                tasks: [
                    { type: "–ü—Ä–æ—Å—Ç–µ–π—à–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è", maxScore: 1, level: 1, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.1", pu: "–†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π", answerType: "short", number: 1 },
                    { type: "–°—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—è", maxScore: 1, level: 2, knowledge: "–≥–µ–æ–º–µ—Ç—Ä–∏—è", kes: "2.1", pu: "–†–µ—à–µ–Ω–∏–µ —Å—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á", answerType: "short", number: 2 },
                    { type: "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞", maxScore: 2, level: 3, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.4", pu: "–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –∑–∞–¥–∞—á", answerType: "detailed", number: 3 },
                    { type: "–ó–∞–¥–∞—á–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º", maxScore: 4, level: 4, knowledge: "–∞–ª–≥–µ–±—Ä–∞", kes: "1.5", pu: "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π", answerType: "detailed", number: 4 }
                ],
                students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î.", "–ö–æ–∑–ª–æ–≤–∞ –ê.", "–ù–∏–∫–æ–ª–∞–µ–≤ –ò."],
                results: [
                    [1, 1, 2, 3],
                    [1, 1, 1, 1],
                    [1, 1, 2, 2],
                    [0, 1, 1, 0],
                    [1, 0, 1, 1]
                ],
                errors: []
            };
            
            generateSampleErrors();
            saveData();
            renderAll();
            showNotification("–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ï–ì–≠ –∑–∞–≥—Ä—É–∂–µ–Ω!", "success");
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ –æ—à–∏–±–æ–∫
        function generateSampleErrors() {
            const errorDistribution = {
                factual: 2,
                conceptual: 4,
                application: 3,
                calculation: 6,
                logical: 3,
                attention: 5,
                technical: 2
            };
            
            appData.errors = [];
            Object.keys(errorDistribution).forEach(errorType => {
                for (let i = 0; i < errorDistribution[errorType]; i++) {
                    const randomTask = Math.floor(Math.random() * appData.tasks.length);
                    const randomStudent = Math.floor(Math.random() * appData.students.length);
                    
                    appData.errors.push({
                        studentIndex: randomStudent,
                        taskIndex: randomTask,
                        type: errorType,
                        description: `–ü—Ä–∏–º–µ—Ä ${errorTypes[errorType].name.toLowerCase()} –≤ –∑–∞–¥–∞–Ω–∏–∏ ${randomTask + 1}`,
                        count: Math.floor(Math.random() * 3) + 1
                    });
                }
            });
        }
		function validateGradeCalculation() {
			console.log('=== VALIDATION ===');
			console.log('Test data:', appData.test);
			console.log('Tasks:', appData.tasks);
			
			// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
			const testScores = [0, 10, 50, 75, 90, 100];
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			
			console.log('\nTest calculations:');
			testScores.forEach(score => {
				const grade = calculateGrade(score);
				console.log(`${score} –±–∞–ª–ª–æ–≤ ‚Üí ${grade} (${getGradeDisplay(grade)})`);
			});
		}
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Å—Ç–∞
		function saveTestSettings() {
			console.log('=== –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê–°–¢–†–û–ï–ö –¢–ï–°–¢–ê ===');
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
			appData.test.subject = document.getElementById('subject').value;
			appData.test.class = document.getElementById('class').value;
			appData.test.testDate = document.getElementById('testDate').value;
			appData.test.theme = document.getElementById('testTheme').value;
			appData.test.goals = document.getElementById('testGoals').value;
			appData.test.workType = document.getElementById('workType').value;
			appData.test.workFormat = document.getElementById('workFormat').value;
			appData.test.timeLimit = parseInt(document.getElementById('timeLimit').value);
			appData.test.totalStudents = parseInt(document.getElementById('totalStudents').value);
			appData.test.presentStudents = parseInt(document.getElementById('presentStudents').value);
			appData.test.absentReason = document.getElementById('absentReason').value;
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
			appData.test.criteriaType = document.getElementById('criteriaType').value;
			appData.test.criteriaSystem = document.getElementById('criteriaSystem').value;
			
			let criteriaCount = parseInt(document.getElementById('criteriaCount').value) || 4;
			
			// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–∫—Å–∏—Ä—É–µ–º 4 —É—Ä–æ–≤–Ω—è
			if (appData.test.criteriaSystem === 'standard') {
				criteriaCount = 4;
			}
			
			appData.test.criteriaCount = criteriaCount;
			
			console.log('–¢–∏–ø –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤:', appData.test.criteriaType);
			console.log('–°–∏—Å—Ç–µ–º–∞:', appData.test.criteriaSystem);
			console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π:', criteriaCount);
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
			const newStudentCount = parseInt(document.getElementById('presentStudents').value);
			const currentStudentCount = appData.students.length;
			
			if (newStudentCount !== currentStudentCount) {
				setStudentsCount(newStudentCount);
			}
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
			appData.test.criteria = {}; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ
			
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			console.log('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:', maxPossible);
			
			for (let i = 1; i <= criteriaCount; i++) {
				const minElement = document.getElementById(`criteria${i}min`);
				const maxElement = document.getElementById(`criteria${i}max`);
				
				if (minElement && maxElement) {
					const minValue = parseInt(minElement.value) || 0;
					const maxValue = parseInt(maxElement.value) || 0;
					
					// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –µ—Å–ª–∏ min > max
					if (minValue > maxValue) {
						appData.test.criteria[i] = {
							min: maxValue,
							max: minValue
						};
						console.log(`–ö—Ä–∏—Ç–µ—Ä–∏–π ${i}: —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω (${maxValue}-${minValue})`);
					} else {
						appData.test.criteria[i] = {
							min: minValue,
							max: maxValue
						};
						console.log(`–ö—Ä–∏—Ç–µ—Ä–∏–π ${i}: ${minValue}-${maxValue}`);
					}
				} else {
					// –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–∑–¥–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
					console.warn(`–ü–æ–ª—è –¥–ª—è –∫—Ä–∏—Ç–µ—Ä–∏—è ${i} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! –°–æ–∑–¥–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.`);
					
					if (appData.test.criteriaType === 'percentage') {
						const step = 100 / criteriaCount;
						appData.test.criteria[i] = {
							min: Math.round((i - 1) * step),
							max: Math.round(i * step)
						};
					} else {
						const step = maxPossible / criteriaCount;
						appData.test.criteria[i] = {
							min: Math.round((i - 1) * step),
							max: Math.round(i * step)
						};
					}
				}
			}
			
			console.log('–ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:', appData.test.criteria);
			
			saveData();
			renderAll();
			showNotification("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
			debugCriteria();
		}

        // –†–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
        function renderAll() {
            renderTestSettings();
            renderTasks();
            renderStudents();
            renderResults();
			renderCriteriaSettings(); // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É
        }

        // –†–µ–Ω–¥–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Å—Ç–∞
        function renderTestSettings() {
			try {
				// –ë–µ–∑–æ–ø–∞—Å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				safeSetValue('subject', appData.test.subject);
				safeSetValue('class', appData.test.class);
				safeSetValue('testDate', appData.test.testDate);
				safeSetValue('testTheme', appData.test.theme);
				safeSetValue('testGoals', appData.test.goals);
				safeSetValue('workType', appData.test.workType);
				safeSetValue('workFormat', appData.test.workFormat);
				safeSetValue('timeLimit', appData.test.timeLimit);
				safeSetValue('totalStudents', appData.test.totalStudents);
				safeSetValue('presentStudents', appData.test.presentStudents);
				safeSetValue('absentReason', appData.test.absentReason);
				
				// –ö—Ä–∏—Ç–µ—Ä–∏–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π
				if (appData.test.criteria) {
					safeSetValue('criteria5min', appData.test.criteria[5]?.min || 0);
					safeSetValue('criteria5max', appData.test.criteria[5]?.max || 0);
					safeSetValue('criteria4min', appData.test.criteria[4]?.min || 0);
					safeSetValue('criteria4max', appData.test.criteria[4]?.max || 0);
					safeSetValue('criteria3min', appData.test.criteria[3]?.min || 0);
					safeSetValue('criteria3max', appData.test.criteria[3]?.max || 0);
					safeSetValue('criteria2min', appData.test.criteria[2]?.min || 0);
					safeSetValue('criteria2max', appData.test.criteria[2]?.max || 0);
				}
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≤ renderTestSettings:', error);
			}
        }

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
		function safeSetValue(elementId, value) {
			try {
				const element = document.getElementById(elementId);
				if (element) {
					element.value = value || '';
				}
			} catch (error) {
				console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ ${elementId}:`, error);
			}
		}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–¥–∞–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function getDefaultTaskCount() {
            switch(appData.test.workType) {
                case 'oge': return 15;
                case 'ege': return 19;
                case 'vpr': return 12;
                case 'func_literacy': return 8;
                default: return 8;
            }
        }

        // –†–µ–Ω–¥–µ—Ä –∑–∞–¥–∞–Ω–∏–π —Å —Ç–∞–∫—Å–æ–Ω–æ–º–∏–µ–π
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = '';
            
            const controlsDiv = document.createElement('div');
            controlsDiv.style.marginBottom = '20px';
            controlsDiv.style.padding = '15px';
            controlsDiv.style.background = '#f8f9fa';
            controlsDiv.style.borderRadius = '8px';
            controlsDiv.innerHTML = `
                <h4>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏</h4>
                <button class="btn btn-success" onclick="addTask()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
                <span style="margin: 0 10px;">–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${appData.tasks.length}</span>
                <button class="btn btn-danger" onclick="removeLastTask()">‚ûñ –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ</button>
                <small style="display: block; margin-top: 8px; color: #666;">
                    –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ 50 –∑–∞–¥–∞–Ω–∏–π. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è —Ç–∞–∫–∂–µ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –Ω–µ–º—É.
                </small>
            `;
            container.appendChild(controlsDiv);			
            
            if (appData.tasks.length === 0) {
                const defaultTaskCount = getDefaultTaskCount();
                for (let i = 0; i < defaultTaskCount; i++) {
                    appData.tasks.push({
                        type: `–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è ${i + 1}`,
                        maxScore: 2,
                        level: 1,
                        knowledge: "",
                        number: i + 1
                    });
                }
            }
            
            appData.tasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item level-${task.level}`;
                
                let additionalFields = '';
                
                if (appData.test.workType === 'vpr') {
                    additionalFields = `
                        <div class="form-group">
                            <label>–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è –í–ü–†:</label>
                            <select onchange="updateTask(${index}, 'competence', this.value)">
                                ${Object.entries(vprCompetencies).map(([key, name]) => 
                                    `<option value="${key}" ${task.competence === key ? 'selected' : ''}>${name}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–£—Ä–æ–≤–µ–Ω—å –í–ü–†:</label>
                            <select onchange="updateTask(${index}, 'vprLevel', parseInt(this.value))">
                                <option value="1" ${task.vprLevel === 1 ? 'selected' : ''}>–ë–∞–∑–æ–≤—ã–π</option>
                                <option value="2" ${task.vprLevel === 2 ? 'selected' : ''}>–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π</option>
                            </select>
                        </div>
                    `;
                } else if (appData.test.workType === 'func_literacy') {
                    additionalFields = `
                        <div class="form-group">
                            <label>–í–∏–¥ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏:</label>
                            <select onchange="updateTask(${index}, 'literacyType', this.value)">
                                ${Object.entries(functionalLiteracyTypes).map(([key, data]) => 
                                    `<option value="${key}" ${task.literacyType === key ? 'selected' : ''}>${data.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –Ω–∞–≤—ã–∫:</label>
                            <input type="text" value="${task.skill || ''}" 
                                   onchange="updateTask(${index}, 'skill', this.value)" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∏–∫–æ–≤, –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π...">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è:</label>
                            <select onchange="updateTask(${index}, 'context', this.value)">
                                ${Object.entries(literacyContexts).map(([key, name]) => 
                                    `<option value="${key}" ${task.context === key ? 'selected' : ''}>${name}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `;
                } else if (appData.test.workType === 'oge' || appData.test.workType === 'ege') {
                    additionalFields = `
                        <div class="form-group">
                            <label>–ö–æ–¥ –ö–≠–°:</label>
                            <input type="text" value="${task.kes || ''}" 
                                   onchange="updateTask(${index}, 'kes', this.value)" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1.2.3">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–¥ –ü–£:</label>
                            <input type="text" value="${task.pu || ''}" 
                                   onchange="updateTask(${index}, 'pu', this.value)" 
                                   placeholder="–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ —É–º–µ–Ω–∏–µ">
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø –æ—Ç–≤–µ—Ç–∞:</label>
                            <select onchange="updateTask(${index}, 'answerType', this.value)">
                                <option value="short" ${task.answerType === 'short' ? 'selected' : ''}>–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç</option>
                                <option value="detailed" ${task.answerType === 'detailed' ? 'selected' : ''}>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç</option>
                                <option value="multiple" ${task.answerType === 'multiple' ? 'selected' : ''}>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä</option>
                            </select>
                        </div>
                    `;
                }
                
                taskDiv.innerHTML = `
                    <h4>–ó–∞–¥–∞–Ω–∏–µ ${task.number || index + 1}</h4>
                    <div class="form-group">
                        <label>–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è:</label>
                        <input type="text" value="${task.type}" onchange="updateTask(${index}, 'type', this.value)" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ–æ—Ä–∏—è, –ü—Ä–∞–∫—Ç–∏–∫–∞...">
                    </div>
                    <div class="form-group">
                        <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:</label>
                        <input type="number" value="${task.maxScore}" min="1" max="20" onchange="updateTask(${index}, 'maxScore', parseInt(this.value))">
                    </div>
                    <div class="form-group">
                        <label>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
                        <select onchange="updateTask(${index}, 'level', parseInt(this.value))">
                            ${Object.entries(complexityLevels).map(([level, data]) => 
                                `<option value="${level}" ${task.level == level ? 'selected' : ''}>${level}. ${data.name}</option>`
                            ).join('')}
                        </select>
                        <small style="color: #666;">${complexityLevels[task.level].desc}</small>
                    </div>
                    <div class="form-group">
                        <label>–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:</label>
                        <input type="text" value="${task.knowledge}" onchange="updateTask(${index}, 'knowledge', this.value)" placeholder="–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?">
                    </div>
                    ${additionalFields}
                    <button class="btn btn-danger" onclick="removeTask(${index})" style="margin-top: 10px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
                `;
                container.appendChild(taskDiv);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
        function updateTask(index, field, value) {
            appData.tasks[index][field] = value;
            saveData();
            scheduleAutoSave();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
        function addTask() {
            const newTask = {
                type: `–ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ ${appData.tasks.length + 1}`,
                maxScore: 1,
                level: 1,
                knowledge: "",
                number: appData.tasks.length + 1
            };
            
            if (appData.test.workType === 'vpr') {
                newTask.competence = 'calculations';
                newTask.vprLevel = 1;
            } else if (appData.test.workType === 'func_literacy') {
                newTask.literacyType = 'reading';
                newTask.skill = '';
                newTask.context = 'personal';
            } else if (appData.test.workType === 'oge' || appData.test.workType === 'ege') {
                newTask.kes = '';
                newTask.pu = '';
                newTask.answerType = 'short';
            }
            
            appData.tasks.push(newTask);
            
            appData.results.forEach(studentResults => {
                studentResults.push(0);
            });
            
            saveData();
            renderTasks();
            renderResults();
            showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ${newTask.number}`, "success");
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
        function removeTask(taskIndex) {
            if (appData.tasks.length <= 1) {
                showNotification("–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ!", "error");
                return;
            }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ ‚Ññ${taskIndex + 1}?`)) {
                appData.tasks.splice(taskIndex, 1);
                
                appData.tasks.forEach((task, index) => {
                    task.number = index + 1;
                });
                
                appData.results.forEach(studentResults => {
                    studentResults.splice(taskIndex, 1);
                });
                
                appData.errors = appData.errors.filter(error => error.taskIndex !== taskIndex);
                appData.errors.forEach(error => {
                    if (error.taskIndex > taskIndex) {
                        error.taskIndex--;
                    }
                });
                
                saveData();
                renderTasks();
                renderResults();
                showNotification("–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!", "success");
            }
        }

        function removeLastTask() {
            if (appData.tasks.length > 0) {
                removeTask(appData.tasks.length - 1);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
        function saveTasks() {
            saveData();
            showNotification("–ó–∞–¥–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
        }

        // –†–µ–Ω–¥–µ—Ä —É—á–∞—â–∏—Ö—Å—è
        function renderStudents() {
            const container = document.getElementById('studentsContainer');
            container.innerHTML = '';
            
            if (appData.students.length === 0) {
                for (let i = 0; i < appData.test.presentStudents; i++) {
                    appData.students.push(`–£—á–∞—â–∏–π—Å—è ${i + 1}`);
                    appData.results.push(new Array(appData.tasks.length).fill(0));
                }
            }
            
            const controlsDiv = document.createElement('div');
            controlsDiv.style.marginBottom = '20px';
            controlsDiv.style.padding = '15px';
            controlsDiv.style.background = '#f8f9fa';
            controlsDiv.style.borderRadius = '8px';
            controlsDiv.innerHTML = `
                <h4>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —É—á–∞—â–∏—Ö—Å—è</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 10px;">
                    <button class="btn btn-success" onclick="addStudent()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—â–µ–≥–æ—Å—è</button>
                    <button class="btn btn-danger" onclick="removeLastStudent()">‚ûñ –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ</button>
                    <button class="btn btn-warning" onclick="showQuickSetDialog()">üéØ –ó–∞–¥–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</button>
                    <button class="btn" onclick="showMassImportDialog()">üìù –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</button>
                </div>
                <div style="font-size: 14px; color: #666;">
                    <strong>–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${appData.students.length} —É—á–∞—â–∏—Ö—Å—è
                    ${appData.test.totalStudents ? ` (–∏–∑ ${appData.test.totalStudents} –ø–æ —Å–ø–∏—Å–∫—É)` : ''}
                </div>
            `;
            container.appendChild(controlsDiv);
            
            appData.students.forEach((student, index) => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'student-item';
                studentDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="flex: 1;">
                            <div class="form-group">
                                <label>–£—á–∞—â–∏–π—Å—è ${index + 1}:</label>
                                <input type="text" value="${student}" onchange="updateStudent(${index}, this.value)" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è">
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="removeStudent(${index})" style="flex-shrink: 0;">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(studentDiv);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
        function updateStudent(index, value) {
            appData.students[index] = value;
            saveData();
            scheduleAutoSave();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è
        function addStudent() {
            const newStudent = `–ù–æ–≤—ã–π —É—á–∞—â–∏–π—Å—è ${appData.students.length + 1}`;
            appData.students.push(newStudent);
            
            const emptyResults = new Array(appData.tasks.length).fill(0);
            appData.results.push(emptyResults);
            
            saveData();
            renderStudents();
            renderResults();
            
            setTimeout(() => {
                const studentsContainer = document.getElementById('studentsContainer');
                const lastStudent = studentsContainer.lastElementChild;
                if (lastStudent) {
                    lastStudent.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
            
            showNotification(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —É—á–∞—â–∏–π—Å—è: ${newStudent}`, "success");
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—â–µ–≥–æ—Å—è
        function removeStudent(studentIndex) {
            if (appData.students.length <= 1) {
                showNotification("–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—â–µ–≥–æ—Å—è!", "error");
                return;
            }
            
            const studentName = appData.students[studentIndex];
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —É—á–∞—â–µ–≥–æ—Å—è "${studentName}"? –í—Å–µ –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
                appData.students.splice(studentIndex, 1);
                appData.results.splice(studentIndex, 1);
                
                appData.errors = appData.errors.filter(error => error.studentIndex !== studentIndex);
                appData.errors.forEach(error => {
                    if (error.studentIndex > studentIndex) {
                        error.studentIndex--;
                    }
                });
                
                saveData();
                renderStudents();
                renderResults();
                showNotification(`–£—á–∞—â–∏–π—Å—è "${studentName}" —É–¥–∞–ª–µ–Ω!`, "success");
            }
        }

        function removeLastStudent() {
            if (appData.students.length > 0) {
                removeStudent(appData.students.length - 1);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—â–∏—Ö—Å—è
        function setStudentsCount(count) {
            if (count < 1 || count > 100) {
                showNotification("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 100", "error");
                return;
            }
            
            const currentCount = appData.students.length;
            
            if (count > currentCount) {
                for (let i = currentCount; i < count; i++) {
                    addStudent();
                }
            } else if (count < currentCount) {
                if (confirm(`–£–¥–∞–ª–∏—Ç—å ${currentCount - count} –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É—á–∞—â–∏—Ö—Å—è? –í—Å–µ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) {
                    for (let i = currentCount - 1; i >= count; i--) {
                        appData.students.pop();
                        appData.results.pop();
                    }
                    saveData();
                    renderStudents();
                    renderResults();
                }
            }
            
            document.getElementById('presentStudents').value = count;
            appData.test.presentStudents = count;
            saveData();
            
            showNotification(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${count} —É—á–∞—â–∏—Ö—Å—è`, "success");
        }

        // –î–∏–∞–ª–æ–≥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function showQuickSetDialog() {
            const count = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è:', appData.students.length);
            if (count !== null) {
                const numCount = parseInt(count);
                if (!isNaN(numCount) && numCount > 0) {
                    setStudentsCount(numCount);
                } else {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ!', "error");
                }
            }
        }

        // –î–∏–∞–ª–æ–≥ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
        function showMassImportDialog() {
            const namesText = prompt(`–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è (–∫–∞–∂–¥–æ–µ –∏–º—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):\n\n–ü—Ä–∏–º–µ—Ä:\n–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π\n–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è\n–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π`, appData.students.join('\n'));
            
            if (namesText !== null) {
                const names = namesText.split('\n')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);
                
                if (names.length > 0) {
                    generateStudents(names);
                } else {
                    showNotification('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∏–º–µ–Ω —É—á–∞—â–∏—Ö—Å—è!', "error");
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —É—á–∞—â–∏—Ö—Å—è
        function generateStudents(names) {
            if (!names || names.length === 0) {
                showNotification("–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω —É—á–∞—â–∏—Ö—Å—è!", "error");
                return;
            }
            
            appData.students = [];
            appData.results = [];
            appData.errors = [];
            
            names.forEach((name, index) => {
                appData.students.push(name.trim());
                appData.results.push(new Array(appData.tasks.length).fill(0));
            });
            
            appData.test.presentStudents = names.length;
            document.getElementById('presentStudents').value = names.length;
            
            saveData();
            renderStudents();
            renderResults();
            showNotification(`–°–æ–∑–¥–∞–Ω–æ ${names.length} —É—á–∞—â–∏—Ö—Å—è!`, "success");
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function saveStudents() {
            saveData();
            showNotification("–°–ø–∏—Å–æ–∫ —É—á–∞—â–∏—Ö—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω!", "success");
        }



        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
        function addError() {
            const studentIndex = parseInt(document.getElementById('errorStudent').value);
            const taskIndex = parseInt(document.getElementById('errorTask').value);
            const type = document.getElementById('errorType').value;
            const description = document.getElementById('errorDescription').value;
            
            if (!description) {
                showNotification("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏!", "error");
                return;
            }
            
            appData.errors.push({
                studentIndex,
                taskIndex,
                type,
                description,
                count: 1
            });
            
            saveData();
            renderResults();
            document.getElementById('errorDescription').value = '';
            showNotification("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞", "success");
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function updateResult(studentIndex, taskIndex, value) {
            if (!appData.results[studentIndex]) {
                appData.results[studentIndex] = [];
            }
            appData.results[studentIndex][taskIndex] = value;
            saveData();
            scheduleAutoSave();
            renderResults();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function saveResults() {
            saveData();
            showNotification("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", "success");
        }

        // –†–∞—Å—á–µ—Ç –æ—Ü–µ–Ω–∫–∏
		function calculateGrade(totalScore) {
			const criteriaType = appData.test.criteriaType;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + (parseInt(task.maxScore) || 0), 0);
			
			// –û—Ç–ª–∞–¥–∫–∞
			console.log('calculateGrade called:', { totalScore, criteriaType, maxPossible });
			
			if (criteriaType === 'percentage') {
				const percentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
				console.log('Percentage calculated:', percentage);
				return calculateGradeByPercentage(percentage);
			} else if (criteriaType === 'custom') {
				const grade = calculateGradeByCustomScale(totalScore, maxPossible);
				console.log('Custom grade:', grade);
				return grade;
			} else {
				console.log('Points grade calculation');
				return calculateGradeByPoints(totalScore);
			}
		}


        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—â–∏—Ö—Å—è
        function syncStudentsCount() {
            const currentCount = appData.students.length;
            document.getElementById('presentStudents').value = currentCount;
            appData.test.presentStudents = currentCount;
            saveData();
            showNotification(`–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${currentCount}`, "success");
        }

        // ==================== –ê–ù–ê–õ–ò–¢–ò–ö–ê ====================

		// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é updateAnalytics()
		function updateAnalytics() {
			try {
				// –í–°–ï –§–£–ù–ö–¶–ò–ò –í –ë–õ–û–ö–ï try-catch
				updateKPIDashboard();
				updateTaxonomyAnalysis();
				updateErrorsAnalysis();
				updatePersonalAnalysis();
				showSmartRecommendations();
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ä–∞–±–æ—Ç—ã
				const workType = safeGet(appData, 'test.workType', 'current');
				
				switch(workType) {
					case 'vpr':
						updateVPRAnalysis();
						break;
					case 'func_literacy':
						updateLiteracyAnalysis();
						break;
					case 'oge':
					case 'ege':
						updateGIAnalysis();
						break;
					case 'final':
						updateFinalAnalysis();
						break;
					case 'milestone':
						updateMilestoneAnalysis();
						break;
					case 'current':
						updateCurrentAnalysis();
						break;
					case 'diagnostic':
						updateDiagnosticAnalysis();
						break;
					case 'psychology':
					updatePsychologyAnalysis();
					break;
					default:
						document.getElementById('specializedAnalysis').innerHTML = 
							'<p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã</p>';
				}
			} catch (error) {
				console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ updateAnalytics:', error);
				document.getElementById('specializedAnalysis').innerHTML = 
					`<div class="alert alert-danger">
						<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: ${error.message}</p>
						<button class="btn btn-sm" onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
					</div>`;
			}
		}

        // KPI –¥–∞—à–±–æ—Ä–¥
        function updateKPIDashboard() {
            if (appData.results.length === 0) {
                document.getElementById('kpiDashboard').innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>';
                return;
            }
            
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            const completionRate = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
            
            const sou = (grades.filter(g => g >= 3).length / grades.length * 100);
            
            const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
            grades.forEach(grade => gradeCounts[grade]++);
            const mode = Object.keys(gradeCounts).reduce((a, b) => gradeCounts[a] > gradeCounts[b] ? a : b);
            const median = calculateMedian(totalScores);
            
            const stdDev = Math.sqrt(totalScores.reduce((sum, score) => sum + Math.pow(score - avgScore, 2), 0) / totalScores.length);
            
            document.getElementById('kpiDashboard').innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-value">${avgScore.toFixed(1)}</div>
                    <div class="kpi-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${successRate.toFixed(1)}%</div>
                    <div class="kpi-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${qualityRate.toFixed(1)}%</div>
                    <div class="kpi-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${sou.toFixed(1)}%</div>
                    <div class="kpi-label">–°–û–£</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${completionRate.toFixed(1)}%</div>
                    <div class="kpi-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${stdDev.toFixed(2)}</div>
                    <div class="kpi-label">–°—Ç–∞–Ω–¥. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${mode}</div>
                    <div class="kpi-label">–ú–æ–¥–∞ –æ—Ü–µ–Ω–æ–∫</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">${median.toFixed(1)}</div>
                    <div class="kpi-label">–ú–µ–¥–∏–∞–Ω–∞ –±–∞–ª–ª–æ–≤</div>
                </div>
            `;
        }

		// –ì–õ–û–ë–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö
		window.addEventListener('error', function(event) {
			console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
			if (event.error.message && event.error.message.includes('Cannot read properties')) {
				showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
			}
			
			// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
			event.preventDefault();
		});

		// –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø PROMISE –û–®–ò–ë–û–ö
		window.addEventListener('unhandledrejection', function(event) {
			console.error('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ Promise:', event.reason);
			showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏', 'error');
		});

		// –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ
		function initializeDefaultData() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º appData –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π
				if (!appData) {
					appData = {
						test: {},
						tasks: [],
						students: [],
						results: [],
						errors: []
					};
				}
				
				// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				appData.test = appData.test || {};
				appData.tasks = appData.tasks || [];
				appData.students = appData.students || [];
				appData.results = appData.results || [];
				appData.errors = appData.errors || [];
				
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
				if (!appData.test.criteria) {
					appData.test.criteria = {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					};
				}
				
				saveData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
			}
		}

		// ==================== –ï–î–ò–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –≠–ö–°–ü–û–†–¢–ê/–ò–ú–ü–û–†–¢–ê ====================
		function exportAppData(format = 'json') {
			try {
				// –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö
				const exportData = {
					version: '2.0',
					timestamp: new Date().toISOString(),
					appData: JSON.parse(JSON.stringify(appData)),
					metadata: {
						testCount: appData.tasks.length,
						studentCount: appData.students.length,
						errorCount: appData.errors.length,
						avgScore: calculateAverageScore().toFixed(2)
					}
				};
				
				const dataStr = JSON.stringify(exportData, null, 2);
				
				if (format === 'json') {
					// –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
					const blob = new Blob([dataStr], { type: 'application/json' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = `–∞–Ω–∞–ª–∏–∑_${appData.test.subject || '–¥–∞–Ω–Ω—ã–µ'}_${new Date().toISOString().slice(0, 10)}.json`;
					a.click();
					URL.revokeObjectURL(url);
					
					showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON', 'success');
					return true;
				}
				
				return false;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', 'error');
				return false;
			}
		}

		function importAppData(jsonString) {
			try {
				const importedData = JSON.parse(jsonString);
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
				if (!importedData.appData) {
					throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö');
				}
				
				// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
				createBackup();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
				Object.assign(appData, importedData.appData);
				
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è
				initializeAppData();
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º
				saveData();
				renderAll();
				
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
				showNotification('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.', 'error');
				return false;
			}
		}

		function handleFileImport(event) {
			const file = event.target.files[0];
			if (!file) return;
			
			const reader = new FileReader();
			reader.onload = function(e) {
				if (confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
					importAppData(e.target.result);
				}
			};
			reader.readAsText(file);
			
			// –°–±—Ä–∞—Å—ã–≤–∞–µ–º input
			event.target.value = '';
		}
		
		// ==================== –ù–ê–î–ï–ñ–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ====================
		function initializeAppData() {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ appData
				if (!window.appData) {
					window.appData = {
						test: {},
						tasks: [],
						students: [],
						results: [],
						errors: [],
						psychologyFeatures: []
					};
				}
				
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Ç–µ—Å—Ç–∞
				const defaultTest = {
					subject: "",
					class: "",
					testDate: new Date().toISOString().split('T')[0],
					theme: "",
					goals: "",
					workType: "current",
					workFormat: "mixed",
					timeLimit: 45,
					totalStudents: 25,
					presentStudents: 23,
					absentReason: "",
					criteria: {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					},
					criteriaType: 'points',
					criteriaSystem: 'standard',
					customCriteria: [],
					criteriaCount: 4,
					criteriaScale: '2-5'
				};
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
				appData.test = { ...defaultTest, ...(appData.test || {}) };
				
				// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ –º–∞—Å—Å–∏–≤—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
				appData.tasks = appData.tasks || [];
				appData.students = appData.students || [];
				appData.results = appData.results || [];
				appData.errors = appData.errors || [];
				appData.psychologyFeatures = appData.psychologyFeatures || [];
				
				console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				// –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ
				window.appData = {
					test: {
						subject: "–ù–æ–≤—ã–π —Ç–µ—Å—Ç",
						class: "5–ê",
						testDate: new Date().toISOString().split('T')[0],
						criteria: {
							5: { min: 18, max: 20 },
							4: { min: 15, max: 17 },
							3: { min: 10, max: 14 },
							2: { min: 0, max: 9 }
						}
					},
					tasks: [],
					students: [],
					results: [],
					errors: [],
					psychologyFeatures: []
				};
				return false;
			}
		}		
		
		// –û–ë–ù–û–í–õ–Ø–ï–ú –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
		document.addEventListener('DOMContentLoaded', function() {
			try {
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
				initializeAppData();
				
				// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
				loadData();
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
				if (appData.tasks.length === 0 || appData.students.length === 0) {
					console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö...');
					loadSampleData();
				} else {
					console.log('–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...');
					renderAll();
				}
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
				showTab('setup');
				
				// –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
				window.addEventListener('error', function(event) {
					console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
					showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ', 'error');
				});
				
				// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ Promise
				window.addEventListener('unhandledrejection', function(event) {
					console.error('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ Promise:', event.reason);
					showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏', 'error');
				});
				
				console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
				
			} catch (error) {
				console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', error);
				
				// –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
				try {
					localStorage.removeItem('testAnalyticsData');
					initializeAppData();
					loadSampleData();
					showNotification('–°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ —Å–±–æ—è', 'warning');
				} catch (recoveryError) {
					console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:', recoveryError);
					alert('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
				}
			}
		});

        // –†–∞—Å—á–µ—Ç –º–µ–¥–∏–∞–Ω—ã
        function calculateMedian(scores) {
            const sorted = [...scores].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
        function calculateAverageScore() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            return totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
        }

        function calculateSuccessRate() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            return (grades.filter(grade => grade >= 3).length / grades.length * 100);
        }

        function calculateQualityRate() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            return (grades.filter(grade => grade >= 4).length / grades.length * 100);
        }

        function calculateSou() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            return (grades.filter(g => g >= 3).length / grades.length * 100);
        }

        // –¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
        function updateTaxonomyAnalysis() {
            let html = '<div class="table-container"><table>';
            html += '<thead><tr><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>–°—Ä. –±–∞–ª–ª</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–ê–Ω–∞–ª–∏–∑</th></tr></thead><tbody>';
            
            Object.entries(complexityLevels).forEach(([level, data]) => {
                const levelTasks = appData.tasks.filter(task => task.level == level);
                if (levelTasks.length === 0) {
                    html += `<tr><td>${level}. ${data.name}</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>`;
                    return;
                }
                
                let totalMaxScore = 0;
                let totalActualScore = 0;
                let taskNumbers = [];
                
                levelTasks.forEach((task, index) => {
                    const taskIndex = appData.tasks.indexOf(task);
                    taskNumbers.push(taskIndex + 1);
                    
                    const maxScore = task.maxScore;
                    const actualScores = appData.results.map(student => student[taskIndex] || 0);
                    const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
                    
                    totalMaxScore += maxScore * appData.results.length;
                    totalActualScore += actualTotal;
                });
                
                const avgScore = totalActualScore / (levelTasks.length * appData.results.length);
                const completion = (totalActualScore / totalMaxScore) * 100;
                
                let analysis = "";
                if (completion >= 80) analysis = "üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
                else if (completion >= 60) analysis = "üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
                else if (completion >= 40) analysis = "üü† –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è";
                else analysis = "üî¥ –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã";
                
                html += `<tr>
                    <td><strong>${level}. ${data.name}</strong></td>
                    <td>${taskNumbers.join(', ')}</td>
                    <td>${avgScore.toFixed(2)}</td>
                    <td>${completion.toFixed(1)}%</td>
                    <td>${analysis}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('taxonomyAnalysis').innerHTML = html;
        }

        // –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫
        function updateErrorsAnalysis() {
            if (appData.errors.length === 0) {
                document.getElementById('errorsAnalysis').innerHTML = '<p>–î–∞–Ω–Ω—ã–µ –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–µ –≤–Ω–µ—Å–µ–Ω—ã</p>';
                return;
            }
            
            const errorStats = {};
            Object.keys(errorTypes).forEach(type => {
                errorStats[type] = appData.errors.filter(e => e.type === type).length;
            });
            
            const topErrors = Object.entries(errorStats)
                .filter(([_, count]) => count > 0)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            let html = '<div class="kpi-grid">';
            topErrors.forEach(([type, count]) => {
                html += `
                    <div class="kpi-card">
                        <div class="kpi-value">${count}</div>
                        <div class="kpi-label">${errorTypes[type].name}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            html += '<div class="table-container"><table><thead><tr><th>–¢–∏–ø –æ—à–∏–±–∫–∏</th><th>–ö–æ–ª-–≤–æ</th><th>% –æ—Ç –≤—Å–µ—Ö</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr></thead><tbody>';
            
            topErrors.forEach(([type, count]) => {
                const percentage = (count / appData.errors.length * 100).toFixed(1);
                let recommendation = "";
                
                switch(type) {
                    case 'calculation': recommendation = "–û—Ç—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤"; break;
                    case 'conceptual': recommendation = "–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞"; break;
                    case 'attention': recommendation = "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"; break;
                    case 'application': recommendation = "–†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞—á"; break;
                    case 'factual': recommendation = "–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π"; break;
                    default: recommendation = "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞";
                }
                
                html += `<tr>
                    <td><span class="error-type error-${type}">${errorTypes[type].name}</span></td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                    <td>${recommendation}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('errorsAnalysis').innerHTML = html;
        }

        // –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
        function updatePersonalAnalysis() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            
            const excellent = [];
            const good = [];
            const satisfactory = [];
            const unsatisfactory = [];
            
            appData.students.forEach((student, index) => {
                const data = {
                    name: student,
                    score: totalScores[index],
                    grade: grades[index],
                    percentage: (totalScores[index] / maxPossible) * 100,
                    errors: appData.errors.filter(e => e.studentIndex === index)
                };
                
                if (data.grade === 5) excellent.push(data);
                else if (data.grade === 4) good.push(data);
                else if (data.grade === 3) satisfactory.push(data);
                else unsatisfactory.push(data);
            });
            
            let html = `
                <div class="kpi-grid">
                    <div class="kpi-card" style="border-left-color: #27ae60">
                        <div class="kpi-value">${excellent.length}</div>
                        <div class="kpi-label">–û—Ç–ª–∏—á–Ω–∏–∫–∏ (5)</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #3498db">
                        <div class="kpi-value">${good.length}</div>
                        <div class="kpi-label">–•–æ—Ä–æ—à–∏—Å—Ç—ã (4)</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #f39c12">
                        <div class="kpi-value">${satisfactory.length}</div>
                        <div class="kpi-label">–£–¥–æ–≤–ª–µ—Ç–≤. (3)</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #e74c3c">
                        <div class="kpi-value">${unsatisfactory.length}</div>
                        <div class="kpi-label">–ù–µ—É–¥–æ–≤–ª. (2)</div>
                    </div>
                </div>
            `;
            
            html += '<div class="sub-section"><h4>üë• –£—á–∞—â–∏–µ—Å—è –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞ (–Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ):</h4>';
            if (unsatisfactory.length > 0) {
                unsatisfactory.forEach(student => {
                    html += `<div class="recommendation-card">
                        <strong>${student.name}</strong> - ${student.score} –±–∞–ª–ª–æ–≤ (${student.percentage.toFixed(1)}%)<br>
                        <small>–û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏: ${student.errors.length > 0 ? 
                            student.errors.map(e => errorTypes[e.type].name).join(', ') : '—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞'}</small>
                    </div>`;
                });
            } else {
                html += '<p>‚úÖ –ù–µ—Ç —É—á–∞—â–∏—Ö—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</p>';
            }
            html += '</div>';
            
            document.getElementById('personalAnalysis').innerHTML = html;
        }

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –í–ü–†
		// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –í–ü–†
		function updateVPRAnalysis() {
			let html = '<h3 class="section-title">üìä –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º –í–ü–†</h3>';
			
			const competenceStats = {};
			const levelStats = {1: {total: 0, max: 0, count: 0}, 2: {total: 0, max: 0, count: 0}};
			
			// –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º –∏ —É—Ä–æ–≤–Ω—è–º
			appData.tasks.forEach((task, taskIndex) => {
				if (task.competence && competenceStats[task.competence]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					competenceStats[task.competence].total += actualTotal;
					competenceStats[task.competence].max += maxScore * appData.results.length;
					competenceStats[task.competence].count++;
				}
				
				// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º –í–ü–†
				if (task.vprLevel && levelStats[task.vprLevel]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					levelStats[task.vprLevel].total += actualTotal;
					levelStats[task.vprLevel].max += maxScore * appData.results.length;
					levelStats[task.vprLevel].count++;
				}
			});
			
			// KPI –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º
			html += '<div class="kpi-grid">';
			Object.entries(competenceStats).forEach(([comp, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const competenceName = vprCompetencies[comp];
					let status = '';
					
					if (percentage >= 80) status = 'success';
					else if (percentage >= 60) status = 'warning';
					else status = 'danger';
					
					html += `
						<div class="kpi-card ${status}">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${competenceName}</div>
						</div>
					`;
				}
			});
			html += '</div>';
			
			// –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º
			html += '<h4 style="margin-top: 20px;">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr></thead><tbody>';
			
			Object.entries(competenceStats).forEach(([comp, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const competenceName = vprCompetencies[comp];
					
					let level = '';
					let levelColor = '';
					let recommendations = '';
					
					if (percentage >= 80) {
						level = '–í—ã—Å–æ–∫–∏–π';
						levelColor = '#27ae60';
						recommendations = '–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞. –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ';
					} else if (percentage >= 60) {
						level = '–°—Ä–µ–¥–Ω–∏–π';
						levelColor = '#f39c12';
						recommendations = '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∞';
					} else {
						level = '–ù–∏–∑–∫–∏–π';
						levelColor = '#e74c3c';
						recommendations = '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞';
					}
					
					html += `
						<tr>
							<td><strong>${competenceName}</strong></td>
							<td>${percentage.toFixed(1)}%</td>
							<td style="color: ${levelColor}; font-weight: bold;">${level}</td>
							<td>${recommendations}</td>
						</tr>
					`;
				}
			});
			
			html += '</tbody></table></div>';
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º –í–ü–†
			html += '<h4 style="margin-top: 20px;">üìà –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –í–ü–†</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(levelStats).forEach(([level, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const levelName = vprLevels[level].name;
					const levelColor = vprLevels[level].color;
					
					html += `
						<div class="kpi-card" style="border-left-color: ${levelColor}">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${levelName} —É—Ä–æ–≤–µ–Ω—å</div>
							<small>${stats.count} –∑–∞–¥–∞–Ω–∏–π</small>
						</div>
					`;
				}
			});
			
			html += '</div>';
			
			// –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
			html += '<h4 style="margin-top: 20px;">üìã –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –í–ü–†</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>‚Ññ</th><th>–ó–∞–¥–∞–Ω–∏–µ</th><th>–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
			
			appData.tasks.forEach((task, index) => {
				const completion = calculateTaskCompletion(index);
				const competenceName = task.competence ? vprCompetencies[task.competence] : '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
				const levelName = task.vprLevel ? vprLevels[task.vprLevel].name : '–ù–µ —É–∫–∞–∑–∞–Ω';
				
				let status = '';
				let statusColor = '';
				
				if (completion >= 80) {
					status = '–í—ã—Å–æ–∫–∏–π';
					statusColor = '#27ae60';
				} else if (completion >= 60) {
					status = '–°—Ä–µ–¥–Ω–∏–π';
					statusColor = '#f39c12';
				} else if (completion >= 40) {
					status = '–ù–∏–∑–∫–∏–π';
					statusColor = '#e74c3c';
				} else {
					status = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';
					statusColor = '#c0392b';
				}
				
				html += `
					<tr>
						<td><strong>${index + 1}</strong></td>
						<td>${task.type}</td>
						<td>${competenceName}</td>
						<td>${levelName}</td>
						<td>${completion.toFixed(1)}%</td>
						<td style="color: ${statusColor}; font-weight: bold;">${status}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div>';
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –í–ü–†
			html += generateVPRRecommendations(competenceStats, levelStats);
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –í–ü–†
		function generateVPRRecommendations(competenceStats, levelStats) {
			let html = '<h4 style="margin-top: 20px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –í–ü–†</h4>';
			html += '<div class="recommendation-card">';
			
			// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π
			const problemCompetences = Object.entries(competenceStats)
				.filter(([_, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					return percentage < 60;
				})
				.map(([comp, _]) => vprCompetencies[comp]);
			
			if (problemCompetences.length > 0) {
				html += `<strong>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏:</strong> ${problemCompetences.join(', ')}<br>`;
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong><br>';
				html += '‚Ä¢ –£—Å–∏–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏<br>';
				html += '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –í–ü–† –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏<br>';
				html += '‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è<br>';
			} else {
				html += '<strong>‚úÖ –í—Å–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ</strong><br>';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏';
			}
			
			// –ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
			const baseLevelPercentage = levelStats[1].max > 0 ? (levelStats[1].total / levelStats[1].max) * 100 : 0;
			const advancedLevelPercentage = levelStats[2].max > 0 ? (levelStats[2].total / levelStats[2].max) * 100 : 0;
			
			html += '<br><strong>üìä –ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π:</strong><br>';
			html += `‚Ä¢ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${baseLevelPercentage.toFixed(1)}%<br>`;
			html += `‚Ä¢ –ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: ${advancedLevelPercentage.toFixed(1)}%<br>`;
			
			if (advancedLevelPercentage < 60) {
				html += '<br><strong>üéØ –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ù–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ.<br>';
				html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å–∏–ª–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ —Å–ª–æ–∂–Ω—ã–º –∑–∞–¥–∞–Ω–∏—è–º.';
			}
			
			html += '</div>';
			
			// –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
			html += `
				<div class="recommendation-card">
					<h5>üìÖ –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –í–ü–†</h5>
					<ul>
						<li>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –í–ü–†</li>
						<li>–†–∞–±–æ—Ç–∞ —Å —Ç–∏–ø–æ–≤—ã–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º</li>
						<li>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –∏—Ö —Ä–∞–∑–±–æ—Ä</li>
						<li>–ü—Ä–æ–±–Ω–∞—è –í–ü–† –∑–∞ 2 –Ω–µ–¥–µ–ª–∏ –¥–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏</li>
					</ul>
				</div>
			`;
			
			return html;
		}

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
		function updateLiteracyAnalysis() {
			let html = '<h3 class="section-title">üéØ –ü—Ä–æ—Ñ–∏–ª—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∞</h3>';
			
			const literacyStats = {};
			const contextStats = {};
			const skillStats = {};
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
			Object.keys(functionalLiteracyTypes).forEach(type => {
				literacyStats[type] = { total: 0, max: 0, count: 0 };
			});
			
			Object.keys(literacyContexts).forEach(context => {
				contextStats[context] = { total: 0, max: 0, count: 0 };
			});
			
			// –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
			appData.tasks.forEach((task, taskIndex) => {
				if (task.literacyType && literacyStats[task.literacyType]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					literacyStats[task.literacyType].total += actualTotal;
					literacyStats[task.literacyType].max += maxScore * appData.results.length;
					literacyStats[task.literacyType].count++;
				}
				
				if (task.context && contextStats[task.context]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					contextStats[task.context].total += actualTotal;
					contextStats[task.context].max += maxScore * appData.results.length;
					contextStats[task.context].count++;
				}
				
				// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –Ω–∞–≤—ã–∫–∞–º
				if (task.skill) {
					if (!skillStats[task.skill]) {
						skillStats[task.skill] = { total: 0, max: 0, count: 0 };
					}
					
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					skillStats[task.skill].total += actualTotal;
					skillStats[task.skill].max += maxScore * appData.results.length;
					skillStats[task.skill].count++;
				}
			});
			
			// KPI –ø–æ –≤–∏–¥–∞–º –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			html += '<h4>üìä –£—Ä–æ–≤–µ–Ω—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(literacyStats).forEach(([type, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const literacyData = functionalLiteracyTypes[type];
					
					let status = '';
					if (percentage >= 80) status = 'success';
					else if (percentage >= 60) status = 'warning';
					else status = 'danger';
					
					html += `
						<div class="kpi-card ${status}" style="border-left-color: ${literacyData.color}">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${literacyData.name}</div>
							<small>${stats.count} –∑–∞–¥–∞–Ω–∏–π</small>
						</div>
					`;
				}
			});
			
			html += '</div>';
			
			// –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			html += '<h4 style="margin-top: 20px;">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–í–∏–¥ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</th></tr></thead><tbody>';
			
			Object.entries(literacyStats).forEach(([type, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const literacyData = functionalLiteracyTypes[type];
					
					let level = '';
					let interpretation = '';
					
					if (percentage >= 80) {
						level = '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ —É—Å—Ç–æ–π—á–∏–≤–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω';
					} else if (percentage >= 60) {
						level = '–ë–∞–∑–æ–≤—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–º —É—Ä–æ–≤–Ω–µ';
					} else if (percentage >= 40) {
						level = '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–≤–∏—Ç–∏—è';
					} else {
						level = '–ù–∞—á–∞–ª—å–Ω—ã–π';
						interpretation = '–ù–∞–≤—ã–∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω';
					}
					
					html += `
						<tr>
							<td><strong>${literacyData.name}</strong></td>
							<td>${percentage.toFixed(1)}%</td>
							<td style="color: ${literacyData.color}; font-weight: bold;">${level}</td>
							<td>${interpretation}</td>
						</tr>
					`;
				}
			});
			
			html += '</tbody></table></div>';
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º
			html += '<h4 style="margin-top: 20px;">üåç –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è</h4>';
			html += '<div class="kpi-grid">';
			
			Object.entries(contextStats).forEach(([context, stats]) => {
				if (stats.count > 0) {
					const percentage = (stats.total / stats.max) * 100;
					const contextName = literacyContexts[context];
					
					html += `
						<div class="kpi-card">
							<div class="kpi-value">${percentage.toFixed(1)}%</div>
							<div class="kpi-label">${contextName} –∫–æ–Ω—Ç–µ–∫—Å—Ç</div>
							<small>${stats.count} –∑–∞–¥–∞–Ω–∏–π</small>
						</div>
					`;
				}
			});
			
			html += '</div>';
			
			// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤
			if (Object.keys(skillStats).length > 0) {
				html += '<h4 style="margin-top: 20px;">üõ†Ô∏è –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤</h4>';
				html += '<div class="table-container"><table>';
				html += '<thead><tr><th>–ù–∞–≤—ã–∫</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr></thead><tbody>';
				
				Object.entries(skillStats).forEach(([skill, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					
					let status = '';
					let recommendations = '';
					
					if (percentage >= 80) {
						status = '–û—Å–≤–æ–µ–Ω';
						recommendations = '–ó–∞–∫—Ä–µ–ø–ª—è—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –Ω–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö';
					} else if (percentage >= 60) {
						status = '–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–≤–æ–µ–Ω';
						recommendations = '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞';
					} else {
						status = '–ù–µ –æ—Å–≤–æ–µ–Ω';
						recommendations = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ';
					}
					
					html += `
						<tr>
							<td>${skill}</td>
							<td>${percentage.toFixed(1)}%</td>
							<td>${status}</td>
							<td>${recommendations}</td>
						</tr>
					`;
				});
				
				html += '</tbody></table></div>';
			}
			
			// –†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
			// –ü–û–õ–ù–ê–Ø –ó–ê–ú–ï–ù–ê –±–ª–æ–∫–∞ —Å —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º–æ–π
			html += `
<div class="chart-container" style="
    height: 450px; 
    min-height: 450px; 
    position: relative; 
    margin: 25px 0; 
    border: 1px solid #e0e0e0; 
    border-radius: 10px; 
    padding: 20px; 
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
">
    <h4 style="margin: 0 0 20px 0; padding: 0; color: #2c3e50;">üìà –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
    <div style="height: 380px; position: relative; background: #f8f9fa; border-radius: 6px; padding: 10px;">
        <canvas id="literacyRadarChart" 
                style="display: block; width: 100%; height: 100%; background: white; border-radius: 4px;"></canvas>
    </div>
</div>
			`;
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é
			html += generateLiteracyRecommendations(literacyStats, contextStats, skillStats);
			
			document.getElementById('specializedAnalysis').innerHTML = html;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã
			setTimeout(() => {
				initLiteracyRadarChart();
			}, 100);
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
		function generateLiteracyRecommendations(literacyStats, contextStats, skillStats) {
			let html = '<h4 style="margin-top: 20px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>';
			html += '<div class="recommendation-card">';
			
			// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			const problemLiteracies = Object.entries(literacyStats)
				.filter(([_, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					return percentage < 60;
				})
				.map(([type, _]) => functionalLiteracyTypes[type].name);
			
			if (problemLiteracies.length > 0) {
				html += `<strong>‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç —Ä–∞–∑–≤–∏—Ç–∏—è:</strong> ${problemLiteracies.join(', ')}<br>`;
				html += '<strong>–ú–µ—Ä—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é:</strong><br>';
				
				problemLiteracies.forEach(literacy => {
					switch(literacy) {
						case '–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –í–∫–ª—é—á–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Ç–µ–∫—Å—Ç–æ–≤<br>';
							break;
						case '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á<br>';
							break;
						case '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–Ω–∞—É—á–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤<br>';
							break;
						case '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∑–∞–¥–∞—á<br>';
							break;
						case '–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏':
							html += '‚Ä¢ –û–±—Å—É–∂–¥–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏<br>';
							break;
						case '–¶–∏—Ñ—Ä–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å':
							html += '‚Ä¢ –†–∞–±–æ—Ç–∞ —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π<br>';
							break;
					}
				});
			} else {
				html += '<strong>‚úÖ –í—Å–µ –≤–∏–¥—ã –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç—ã –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ</strong><br>';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —É–≥–ª—É–±–ª—è—Ç—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏';
			}
			
			// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
			const problemContexts = Object.entries(contextStats)
				.filter(([_, stats]) => {
					const percentage = (stats.total / stats.max) * 100;
					return percentage < 60;
				})
				.map(([context, _]) => literacyContexts[context]);
			
			if (problemContexts.length > 0) {
				html += `<br><strong>üåç –°–ª–∞–±—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:</strong> ${problemContexts.join(', ')}<br>`;
				html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π';
			}
			
			html += '</div>';
			
			// –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è
			html += `
				<div class="recommendation-card">
					<h5>üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h5>
					<ul>
						<li>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –≤ —É—Ä–æ—á–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–ø—Ä–µ–¥–º–µ—Ç–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π –≤ –æ–±—É—á–µ–Ω–∏–∏</li>
						<li>–†–∞–∑–≤–∏—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
						<li>–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</li>
					</ul>
				</div>
			`;
			
			return html;
		}

        function initLiteracyChart() {
            if (window.literacyChartInstance) {
                window.literacyChartInstance.destroy();
            }
            
            const literacyStats = {};
            Object.keys(functionalLiteracyTypes).forEach(type => {
                literacyStats[type] = { total: 0, max: 0, count: 0 };
            });
            
            appData.tasks.forEach((task, taskIndex) => {
                if (task.literacyType && literacyStats[task.literacyType]) {
                    const maxScore = task.maxScore;
                    const actualScores = appData.results.map(student => student[taskIndex] || 0);
                    const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
                    
                    literacyStats[task.literacyType].total += actualTotal;
                    literacyStats[task.literacyType].max += maxScore * appData.results.length;
                }
            });
            
            const ctx = document.getElementById('literacyChart').getContext('2d');
            const labels = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].name);
            const data = Object.values(literacyStats).map(stats => 
                stats.max > 0 ? (stats.total / stats.max) * 100 : 0
            );
            const colors = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].color);
            
            window.literacyChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–£—Ä–æ–≤–µ–Ω—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ (%)',
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 0.8)',
                        pointBackgroundColor: colors,
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –û–ì–≠/–ï–ì–≠
		function updateGIAnalysis() {
			let html = '<h3 class="section-title">üéì –ê–Ω–∞–ª–∏–∑ –ø–æ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º (–ö–≠–°)</h3>';
			
			const kesStats = {};
			const puStats = {};
			
			// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏–π –ø–æ –ö–≠–° –∏ –ü–£
			appData.tasks.forEach((task, taskIndex) => {
				if (task.kes) {
					const kesCode = task.kes.split('.')[0];
					if (!kesStats[kesCode]) {
						kesStats[kesCode] = { 
							total: 0, 
							max: 0, 
							count: 0, 
							tasks: [],
							name: getKESName(kesCode)
						};
					}
					
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					kesStats[kesCode].total += actualTotal;
					kesStats[kesCode].max += maxScore * appData.results.length;
					kesStats[kesCode].count++;
					kesStats[kesCode].tasks.push(taskIndex + 1);
				}
				
				// –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —É–º–µ–Ω–∏—è–º (–ü–£)
				if (task.pu) {
					if (!puStats[task.pu]) {
						puStats[task.pu] = { 
							total: 0, 
							max: 0, 
							count: 0,
							tasks: []
						};
					}
					
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					puStats[task.pu].total += actualTotal;
					puStats[task.pu].max += maxScore * appData.results.length;
					puStats[task.pu].count++;
					puStats[task.pu].tasks.push(taskIndex + 1);
				}
			});
			
			// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ö–≠–°, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–∏–π –∞–Ω–∞–ª–∏–∑
			if (Object.keys(kesStats).length === 0) {
				html += `
					<div class="alert-card">
						<strong>‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ –ö–≠–° –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã</strong>
						<p>–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –û–ì–≠ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–¥—ã –ö–≠–° –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∑–∞–¥–∞–Ω–∏–π.</p>
					</div>
					
					<h4>üìä –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞–Ω–∏–π –û–ì–≠</h4>
					<div class="kpi-grid">
						<div class="kpi-card">
							<div class="kpi-value">${calculateAverageScore().toFixed(1)}</div>
							<div class="kpi-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
						</div>
						<div class="kpi-card">
							<div class="kpi-value">${calculateSuccessRate().toFixed(1)}%</div>
							<div class="kpi-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
						</div>
						<div class="kpi-card">
							<div class="kpi-value">${calculateTaskCompletion(0).toFixed(1)}%</div>
							<div class="kpi-label">1 —á–∞—Å—Ç—å</div>
						</div>
						<div class="kpi-card">
							<div class="kpi-value">${calculateTaskCompletion(appData.tasks.length-1).toFixed(1)}%</div>
							<div class="kpi-label">2 —á–∞—Å—Ç—å</div>
						</div>
					</div>
				`;
			} else {
				// –ê–Ω–∞–ª–∏–∑ –ø–æ –ö–≠–°
				html += '<div class="table-container"><table>';
				html += '<thead><tr><th>–ë–ª–æ–∫ –ö–≠–°</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–ê–Ω–∞–ª–∏–∑</th></tr></thead><tbody>';
				
				Object.entries(kesStats).forEach(([kes, stats]) => {
					const percentage = stats.max > 0 ? (stats.total / stats.max) * 100 : 0;
					let analysis = "";
					let analysisIcon = "";
					
					if (percentage >= 80) {
						analysis = "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";
						analysisIcon = "üü¢";
					} else if (percentage >= 60) {
						analysis = "–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å";
						analysisIcon = "üü°";
					} else if (percentage >= 40) {
						analysis = "–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è";
						analysisIcon = "üü†";
					} else {
						analysis = "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";
						analysisIcon = "üî¥";
					}
					
					html += `<tr>
						<td><strong>${kes}</strong></td>
						<td>${stats.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
						<td>${stats.tasks.join(', ')}</td>
						<td>${percentage.toFixed(1)}%</td>
						<td>${analysisIcon} ${analysis}</td>
					</tr>`;
				});
				
				html += '</tbody></table></div>';
			}
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —É–º–µ–Ω–∏—è–º
			if (Object.keys(puStats).length > 0) {
				html += '<h4 style="margin-top: 20px;">üéØ –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —É–º–µ–Ω–∏—è–º (–ü–£)</h4>';
				html += '<div class="table-container"><table>';
				html += '<thead><tr><th>–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ —É–º–µ–Ω–∏–µ</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–£—Ä–æ–≤–µ–Ω—å</th></tr></thead><tbody>';
				
				Object.entries(puStats).forEach(([pu, stats]) => {
					const percentage = stats.max > 0 ? (stats.total / stats.max) * 100 : 0;
					let level = "";
					
					if (percentage >= 80) level = "–û—Å–≤–æ–µ–Ω–æ";
					else if (percentage >= 60) level = "–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–≤–æ–µ–Ω–æ";
					else if (percentage >= 40) level = "–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏";
					else level = "–ù–µ –æ—Å–≤–æ–µ–Ω–æ";
					
					html += `<tr>
						<td>${pu}</td>
						<td>${stats.tasks.join(', ')}</td>
						<td>${percentage.toFixed(1)}%</td>
						<td>${level}</td>
					</tr>`;
				});
				
				html += '</tbody></table></div>';
			}
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –û–ì–≠
			html += generateOGERecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –±–ª–æ–∫–æ–≤ –ö–≠–°
		function getKESName(kesCode) {
			const kesNames = {
				'1': '–ß–∏—Å–ª–∞ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è',
				'2': '–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è',
				'3': '–£—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞',
				'4': '–ß–∏—Å–ª–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
				'5': '–§—É–Ω–∫—Ü–∏–∏',
				'6': '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –ø—Ä—è–º–æ–π –∏ –ø–ª–æ—Å–∫–æ—Å—Ç–∏',
				'7': '–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∏–≥—É—Ä—ã –∏ –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞',
				'8': '–ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –≤–µ–ª–∏—á–∏–Ω',
				'9': '–í–µ–∫—Ç–æ—Ä—ã –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–∏'
			};
			return kesNames[kesCode] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±–ª–æ–∫';
		}

		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –û–ì–≠
		function generateOGERecommendations() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			
			let html = '<h4 style="margin-top: 20px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –û–ì–≠</h4>';
			html += '<div class="recommendation-card">';
			
			// –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			const percentage = (avgScore / maxPossible) * 100;
			
			if (percentage >= 80) {
				html += '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–£—á–∞—â–∏–µ—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –û–ì–≠. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –†–∞–±–æ—Ç–∞ –Ω–∞–¥ —Å–ª–æ–∂–Ω—ã–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏<br>';
				html += '‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è<br>';
				html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏<br>';
			} else if (percentage >= 60) {
				html += '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–£—á–∞—â–∏–µ—Å—è —É—Å–≤–æ–∏–ª–∏ –±–∞–∑–æ–≤—ã–µ —Ç–µ–º—ã, –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–µ–ª—ã. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º<br>';
				html += '‚Ä¢ –û—Ç—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π<br>';
				html += '‚Ä¢ –†–∞–±–æ—Ç–∞ –Ω–∞–¥ –∑–∞–¥–∞–Ω–∏—è–º–∏ —Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º<br>';
			} else if (percentage >= 40) {
				html += '<strong>üü† –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å–∏–ª–µ–Ω–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</strong><br>';
				html += '–ï—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–µ–º<br>';
				html += '‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç—Å—Ç–∞—é—â–∏–º–∏<br>';
				html += '‚Ä¢ –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è<br>';
			} else {
				html += '<strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ. ';
				html += '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:<br>';
				html += '‚Ä¢ –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞<br>';
				html += '‚Ä¢ –§–æ–∫—É—Å –Ω–∞ –±–∞–∑–æ–≤—ã—Ö —Ç–µ–º–∞—Ö<br>';
				html += '‚Ä¢ –ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∫ –∫–æ–Ω—Ç—Ä–æ–ª—é<br>';
			}
			
			// –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –∑–∞–¥–∞–Ω–∏–π
			const firstPartTasks = appData.tasks.filter(task => task.answerType === 'short');
			const secondPartTasks = appData.tasks.filter(task => task.answerType === 'detailed');
			
			if (firstPartTasks.length > 0 && secondPartTasks.length > 0) {
				const firstPartCompletion = firstPartTasks.reduce((sum, task) => {
					const taskIndex = appData.tasks.indexOf(task);
					return sum + calculateTaskCompletion(taskIndex);
				}, 0) / firstPartTasks.length;
				
				const secondPartCompletion = secondPartTasks.reduce((sum, task) => {
					const taskIndex = appData.tasks.indexOf(task);
					return sum + calculateTaskCompletion(taskIndex);
				}, 0) / secondPartTasks.length;
				
				html += `<br><strong>–ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–µ–π —ç–∫–∑–∞–º–µ–Ω–∞:</strong><br>`;
				html += `‚Ä¢ 1 —á–∞—Å—Ç—å (—Ç–µ—Å—Ç–æ–≤–∞—è): ${firstPartCompletion.toFixed(1)}%<br>`;
				html += `‚Ä¢ 2 —á–∞—Å—Ç—å (—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è): ${secondPartCompletion.toFixed(1)}%<br>`;
				
				if (secondPartCompletion < 50) {
					html += '<br><strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ù–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ 2 —á–∞—Å—Ç–∏. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å–∏–ª–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –∑–∞–¥–∞–Ω–∏—è–º —Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º.';
				}
			}
			
			html += '</div>';
			
			return html;
		}


        // ==================== –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø ====================
		function addVisualizationButton() {
			const nav = document.querySelector('.nav-tabs, .navigation, header');
			if (nav) {
				const button = document.createElement('button');
				button.className = 'btn btn-primary';
				button.innerHTML = 'üìà –ì—Ä–∞—Ñ–∏–∫–∏';
				button.onclick = () => {
					renderVisualizationSection();
					showNotification('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
				};
				nav.appendChild(button);
			}
		}
				
		// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			addVisualizationButton();
		});
		
		function updateVisualization() {
			console.log('=== –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò ===');
			
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ª–∏ –≤–∫–ª–∞–¥–∫–∞ visualization
				const vizTab = document.getElementById('visualization');
				const gradesChart = document.getElementById('gradesChart');
				
				if (!gradesChart || !vizTab || vizTab.innerHTML.trim().length < 100) {
					console.log('–í–∫–ª–∞–¥–∫–∞ visualization –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º...');
					setupVisualizationTab();
					return;
				}
				
				// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
				destroyAllCharts();
				
				// –ñ–¥–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ DOM
				setTimeout(() => {
					try {
						// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏
						updateCharts();
						
						// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É
						updateHeatmap();
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
						if (appData.test.workType === 'func_literacy') {
							console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏');
							initLiteracyCharts();
						} else if (appData.test.workType === 'psychology') {
							console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≥—Ä–∞—Ñ–∏–∫–∏');
							initPsychologyCharts();
						}
						
						// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Å–∞–π–∑ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
						setTimeout(() => {
							safeResizeCharts();
							console.log('–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
						}, 300);
						
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤:', error);
						showChartError();
					}
				}, 150);
				
			} catch (error) {
				console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ updateVisualization:', error);
				showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
			}
		}
		// –ù–∞–π–¥–∏—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã –∏ –¥–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
		function setupTabsNavigation() {
			const tabs = document.querySelectorAll('.nav-link');
			tabs.forEach(tab => {
				tab.addEventListener('click', function() {
					const tabId = this.getAttribute('href')?.replace('#', '');
					if (tabId === 'visualization') {
						console.log('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–∫–ª–∞–¥–∫—É visualization');
						
						// –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ DOM
						setTimeout(() => {
							if (document.getElementById('visualization').querySelectorAll('canvas').length === 0) {
								console.log('–í–∫–ª–∞–¥–∫–∞ –ø—É—Å—Ç–∞—è, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º...');
								setupVisualizationTab();
							} else {
								console.log('–û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏...');
								updateVisualization();
							}
						}, 100);
					}
				});
			});
		}

		// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			setupTabsNavigation();
			console.log('–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
		});

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		function updateCharts() {
			console.log('updateCharts –≤—ã–∑–≤–∞–Ω–∞, –¥–∞–Ω–Ω—ã–µ:', {
				results: appData.results.length,
				tasks: appData.tasks.length
			});
			
			if (appData.results.length === 0 || appData.tasks.length === 0) {
				console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤');
				showNoDataMessage();
				return;
			}
			
			try {
				// 1. –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
				updateGradesChart();
				
				// 2. –ì—Ä–∞—Ñ–∏–∫ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π
				updateSolvabilityChart();
				
				// 3. –ì—Ä–∞—Ñ–∏–∫ —Å–≤—è–∑–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏
				updateComplexityChart();
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≤ updateCharts:', error);
				throw error;
			}
		}

		function updateGradesChart() {
			const canvas = document.getElementById('gradesChart');
			if (!canvas) {
				console.warn('Canvas gradesChart –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			}
			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫...');
			
			const totalScores = appData.results.map(scores => 
				scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0)
			);
			
			const grades = totalScores.map(score => {
				const grade = calculateGrade(score);
				console.log(`–ë–∞–ª–ª—ã: ${score}, –û—Ü–µ–Ω–∫–∞: ${grade}`);
				return grade;
			});
			
			console.log('–í—Å–µ –æ—Ü–µ–Ω–∫–∏:', grades);
			
			// –°—á–∏—Ç–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
			const gradeCounts = {};
			grades.forEach(grade => {
				if (grade && grade !== '?') {
					gradeCounts[grade] = (gradeCounts[grade] || 0) + 1;
				}
			});
			
			console.log('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫:', gradeCounts);
			
			// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è Chart.js
			const labels = Object.keys(gradeCounts).sort();
			const data = labels.map(label => gradeCounts[label]);
			const backgroundColors = labels.map(label => getGradeColor(label));
			
			if (labels.length === 0) {
				canvas.parentElement.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫</p>';
				return;
			}
			
			const ctx = canvas.getContext('2d');
			window.gradesChartInstance = new Chart(ctx, {
				type: 'doughnut',
				data: {
					labels: labels.map(label => `–û—Ü–µ–Ω–∫–∞ ${label}`),
					datasets: [{
						data: data,
						backgroundColor: backgroundColors,
						borderWidth: 2,
						borderColor: '#fff',
						hoverOffset: 10
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { 
							position: 'bottom',
							labels: {
								padding: 20,
								usePointStyle: true,
								font: { size: 12 }
							}
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									const label = context.label || '';
									const value = context.raw || 0;
									const total = context.dataset.data.reduce((a, b) => a + b, 0);
									const percentage = Math.round((value / total) * 100);
									return `${label}: ${value} —É—á. (${percentage}%)`;
								}
							}
						},
						title: {
							display: true,
							text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫',
							font: { size: 16, weight: 'bold' },
							padding: { top: 10, bottom: 20 }
						}
					},
					cutout: '50%'
				}
			});
		}

		function updateSolvabilityChart() {
			const canvas = document.getElementById('solvabilityChart');
			if (!canvas) {
				console.warn('Canvas solvabilityChart –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			}
			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏...');
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ—à–∞–µ–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
			const taskStats = [];
			for (let i = 0; i < appData.tasks.length; i++) {
				const task = appData.tasks[i];
				const maxScore = parseInt(task.maxScore) || 1;
				const actualScores = appData.results.map(student => parseInt(student[i]) || 0);
				const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
				const completion = maxScore > 0 ? (actualTotal / (maxScore * appData.results.length)) * 100 : 0;
				
				taskStats.push({
					taskNumber: i + 1,
					completion: completion,
					type: task.type,
					level: task.level
				});
			}
			
			console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π:', taskStats);
			
			const ctx = canvas.getContext('2d');
			window.solvabilityChartInstance = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: taskStats.map(t => `–ó–∞–¥. ${t.taskNumber}`),
					datasets: [{
						label: '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
						data: taskStats.map(t => t.completion),
						backgroundColor: taskStats.map(t => complexityLevels[t.level]?.color || '#3498db'),
						borderColor: '#2c3e50',
						borderWidth: 1
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						x: {
							title: { 
								display: true, 
								text: '–ù–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è',
								font: { size: 14, weight: 'bold' }
							},
							grid: { display: false }
						},
						y: {
							title: { 
								display: true, 
								text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
								font: { size: 14, weight: 'bold' }
							},
							min: 0,
							max: 100,
							ticks: {
								callback: function(value) {
									return value + '%';
								}
							}
						}
					},
					plugins: {
						legend: { display: false },
						tooltip: {
							callbacks: {
								label: function(context) {
									const task = taskStats[context.dataIndex];
									return [
										`–ó–∞–¥–∞–Ω–∏–µ ${task.taskNumber}: ${task.type}`,
										`–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${task.level}`,
										`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${context.raw.toFixed(1)}%`
									];
								}
							}
						},
						title: {
							display: true,
							text: '–†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π',
							font: { size: 16, weight: 'bold' },
							padding: { top: 10, bottom: 20 }
						}
					}
				}
			});
		}
		function createAllCharts() {
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö canvas —ç–ª–µ–º–µ–Ω—Ç–æ–≤
			const chartIds = ['gradesChart', 'solvabilityChart', 'complexityChart'];
			
			chartIds.forEach(id => {
				if (!document.getElementById(id)) {
					console.log(`–°–æ–∑–¥–∞–µ–º canvas –¥–ª—è ${id}...`);
					createChartContainer(id);
				}
			});
		}

		function createChartContainer(chartId) {
			const container = document.getElementById('chartsContainer') || createChartsSection();
			
			const chartContainer = document.createElement('div');
			chartContainer.className = 'chart-container';
			chartContainer.innerHTML = `
				<h3>${getChartTitle(chartId)}</h3>
				<div class="chart-wrapper">
					<canvas id="${chartId}"></canvas>
				</div>
			`;
			
			container.appendChild(chartContainer);
			return chartContainer;
		}

		function getChartTitle(chartId) {
			const titles = {
				'gradesChart': 'üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫',
				'solvabilityChart': 'üìà –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π',
				'complexityChart': 'üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å'
			};
			return titles[chartId] || chartId;
		}
		// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏
		function findChartsContainer() {
			console.log('=== –ü–û–ò–°–ö –ö–û–ù–¢–ï–ô–ù–ï–†–ê –ì–†–ê–§–ò–ö–û–í ===');
			
			// –í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
			const possibleIds = [
				'visualizationContainer', 'chartsContainer', 'graphsContainer',
				'analyticsContainer', 'statisticsContainer', 'resultsCharts'
			];
			
			const possibleClasses = [
				'charts-section', 'graphs-section', 'visualization-section',
				'analytics-tab', 'statistics-tab', 'chart-container'
			];
			
			// –ò—â–µ–º –ø–æ ID
			console.log('–ü–æ–∏—Å–∫ –ø–æ ID:');
			possibleIds.forEach(id => {
				const element = document.getElementById(id);
				if (element) {
					console.log(`‚úì –ù–∞–π–¥–µ–Ω: #${id}`, element);
					console.log('  –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π HTML:', element.innerHTML.substring(0, 200) + '...');
				}
			});
			
			// –ò—â–µ–º –ø–æ –∫–ª–∞—Å—Å–∞–º
			console.log('\n–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∞—Å—Å–∞–º:');
			possibleClasses.forEach(className => {
				const elements = document.getElementsByClassName(className);
				if (elements.length > 0) {
					console.log(`‚úì –ù–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–æ–º .${className}:`, elements.length);
					console.log('  –ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç:', elements[0]);
				}
			});
			
			// –ò—â–µ–º –≤—Å–µ canvas
			console.log('\n–í—Å–µ canvas –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:');
			const allCanvas = document.getElementsByTagName('canvas');
			console.log(`–í—Å–µ–≥–æ canvas: ${allCanvas.length}`);
			for (let i = 0; i < allCanvas.length; i++) {
				const canvas = allCanvas[i];
				console.log(`${i+1}. id="${canvas.id}", —Ä–æ–¥–∏—Ç–µ–ª—å:`, canvas.parentElement);
			}
			
			// –ò—â–µ–º –≤–∫–ª–∞–¥–∫–∏/—Ç–∞–±—ã
			console.log('\n–í—Å–µ –≤–∫–ª–∞–¥–∫–∏ (tabs):');
			const tabs = document.querySelectorAll('[role="tab"], .tab-pane, .tab-content');
			tabs.forEach(tab => {
				console.log('–í–∫–ª–∞–¥–∫–∞:', tab.id || tab.className, tab);
			});
		}

		function setupVisualizationTab() {
			console.log('=== –ù–ê–°–¢–†–û–ô–ö–ê –í–ö–õ–ê–î–ö–ò –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò ===');
			
			const vizTab = document.getElementById('visualization');
			if (!vizTab) {
				console.error('–í–∫–ª–∞–¥–∫–∞ visualization –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
				return;
			}
			
			// –û—á–∏—â–∞–µ–º –≤–∫–ª–∞–¥–∫—É
			vizTab.innerHTML = '';
			
			// –ó–∞–≥–æ–ª–æ–≤–æ–∫
			vizTab.innerHTML += `
				<h2>üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
				
				<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
					<button class="btn btn-primary" onclick="updateVisualization()" style="margin-right: 10px;">
						üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
					</button>
					<button class="btn btn-warning" onclick="exportAllCharts()" style="margin-right: 10px;">
						üì• –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
					</button>
					<button class="btn" onclick="toggleDarkMode()" style="margin-right: 10px;">
						üåô –¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º
					</button>
					<button class="btn" onclick="debugCharts()">
						üêõ –û—Ç–ª–∞–¥–∫–∞
					</button>
				</div>
				
				<div class="charts-grid" id="chartsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px;">
					<!-- –ì—Ä–∞—Ñ–∏–∫ 1: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
						</h3>
						<div style="position: relative; height: 300px;">
							<canvas id="gradesChart"></canvas>
						</div>
						<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
							–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—á–∞—â–∏—Ö—Å—è –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –æ—Ü–µ–Ω–∫–∞–º
						</p>
					</div>
					
					<!-- –ì—Ä–∞—Ñ–∏–∫ 2: –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üìà –†–µ—à–∞–µ–º–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π
						</h3>
						<div style="position: relative; height: 300px;">
							<canvas id="solvabilityChart"></canvas>
						</div>
						<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
							–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
						</p>
					</div>
					
					<!-- –ì—Ä–∞—Ñ–∏–∫ 3: –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å -->
					<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
						<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
							üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å vs –†–µ—à–∞–µ–º–æ—Å—Ç—å
						</h3>
						<div style="position: relative; height: 300px;">
							<canvas id="complexityChart"></canvas>
						</div>
						<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
							–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
						</p>
					</div>
				</div>
				
				<!-- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ -->
				<div class="chart-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
					<h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
						üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
					</h3>
					<div id="heatmapContainer"></div>
					<p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
						–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –∫–∞–∂–¥—ã–º —É—á–∞—â–∏–º—Å—è
					</p>
				</div>
				
				<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ -->
				<div id="additionalCharts"></div>
			`;
			
			console.log('–í–∫–ª–∞–¥–∫–∞ visualization –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
			setTimeout(() => {
				updateVisualization();
				console.log('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
			}, 500);
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		function exportAllCharts() {
			console.log('–≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤...');
			// –†–µ–∞–ª–∏–∑—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
			showNotification('–≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤', 'info');
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
		function toggleDarkMode() {
			document.body.classList.toggle('dark-mode');
			updateVisualization();
			showNotification('–¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞', 'info');
		}
		function updateComplexityChart() {
			const canvas = document.getElementById('complexityChart');
			if (!canvas) {
				console.error('Canvas complexityChart –Ω–µ –Ω–∞–π–¥–µ–Ω!');
				return;
			}
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
			if (!appData.results || appData.results.length === 0 || !appData.tasks || appData.tasks.length === 0) {
				console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è complexity chart');
				return;
			}
			
			console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏...');
			
			// –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –æ—Ç–ª–∞–¥–∫–æ–π
			const taskStats = [];
			
			for (let i = 0; i < appData.tasks.length; i++) {
				const task = appData.tasks[i];
				const maxScore = parseInt(task.maxScore) || 1;
				const level = parseInt(task.level) || 1;
				
				console.log(`–ó–∞–¥–∞–Ω–∏–µ ${i+1}: —É—Ä–æ–≤–µ–Ω—å=${level}, maxScore=${maxScore}`);
				
				// –°–æ–±–∏—Ä–∞–µ–º –æ—Ü–µ–Ω–∫–∏ –∑–∞ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ
				const scores = [];
				for (let j = 0; j < appData.results.length; j++) {
					const studentScore = appData.results[j][i];
					const normalizedScore = Math.min(parseInt(studentScore) || 0, maxScore);
					scores.push(normalizedScore);
				}
				
				// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
				const totalPossible = maxScore * scores.length;
				const actualTotal = scores.reduce((sum, score) => sum + score, 0);
				const completion = totalPossible > 0 ? (actualTotal / totalPossible) * 100 : 0;
				
				console.log(`  –û—Ü–µ–Ω–∫–∏: ${scores.slice(0, 5).join(', ')}...`);
				console.log(`  –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${completion.toFixed(1)}% (${actualTotal}/${totalPossible})`);
				
				taskStats.push({
					taskNumber: i + 1,
					completion: completion,
					level: level,
					type: task.type || `–ó–∞–¥–∞–Ω–∏–µ ${i+1}`,
					actualTotal: actualTotal,
					totalPossible: totalPossible
				});
			}
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
			taskStats.sort((a, b) => a.level - b.level);
			
			console.log('–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', taskStats);
			
			// –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
			const ctx = canvas.getContext('2d');
			
			// –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
			if (window.complexityChartInstance) {
				window.complexityChartInstance.destroy();
			}
			
			window.complexityChartInstance = new Chart(ctx, {
				type: 'scatter',
				data: {
					datasets: [{
						label: '–ó–∞–¥–∞–Ω–∏—è',
						data: taskStats.map(t => ({
							x: t.level,
							y: t.completion,
							taskNumber: t.taskNumber,
							type: t.type,
							details: `${t.actualTotal}/${t.totalPossible}`
						})),
						backgroundColor: taskStats.map(t => 
							complexityLevels[t.level]?.color || '#3498db'
						),
						pointRadius: 10,
						pointHoverRadius: 12,
						pointBorderWidth: 2,
						pointBorderColor: '#ffffff'
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						x: {
							type: 'linear',
							title: { 
								display: true, 
								text: '–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏',
								font: { size: 14, weight: 'bold' },
								color: '#2c3e50'
							},
							min: 0.5,
							max: 4.5,
							ticks: {
								stepSize: 1,
								callback: function(value) {
									if (Number.isInteger(value)) {
										const level = complexityLevels[value];
										return level ? `${value}. ${level.name}` : value;
									}
									return value;
								},
								font: { size: 12 }
							},
							grid: {
								color: 'rgba(0,0,0,0.05)'
							}
						},
						y: {
							title: { 
								display: true, 
								text: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (%)',
								font: { size: 14, weight: 'bold' },
								color: '#2c3e50'
							},
							min: 0,
							max: 100,
							ticks: {
								callback: function(value) {
									return value + '%';
								},
								font: { size: 12 }
							},
							grid: {
								color: 'rgba(0,0,0,0.05)'
							}
						}
					},
					plugins: {
						tooltip: {
							backgroundColor: 'rgba(0, 0, 0, 0.8)',
							titleColor: '#fff',
							bodyColor: '#fff',
							borderColor: '#3498db',
							borderWidth: 1,
							callbacks: {
								title: function(context) {
									const point = context[0].raw;
									return `–ó–∞–¥–∞–Ω–∏–µ ${point.taskNumber}: ${point.type}`;
								},
								label: function(context) {
									const point = context.raw;
									return [
										`–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${complexityLevels[point.x]?.name || point.x}`,
										`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${point.y.toFixed(1)}%`,
										`–ë–∞–ª–ª—ã: ${point.details}`
									];
								}
							}
						},
						legend: { 
							display: false 
						},
						title: {
							display: true,
							text: '–°–≤—è–∑—å —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π',
							font: { size: 16, weight: 'bold' },
							color: '#2c3e50',
							padding: { top: 10, bottom: 30 }
						}
					}
				}
			});
			
			console.log('–ì—Ä–∞—Ñ–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function getGradeColor(grade) {
			const colorMap = {
				'1': '#c0392b', '2': '#e74c3c', '3': '#f39c12',
				'4': '#3498db', '5': '#27ae60',
				'?': '#95a5a6'
			};
			return colorMap[grade] || '#3498db';
		}

		function safeResizeCharts() {
			const charts = [
				window.gradesChartInstance,
				window.complexityChartInstance,
				window.solvabilityChartInstance
			];
			
			charts.forEach(chart => {
				if (chart) {
					try {
						chart.resize();
					} catch (error) {
						console.warn('–û—à–∏–±–∫–∞ —Ä–µ—Å–∞–π–∑–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
					}
				}
			});
		}

		function showNoDataMessage() {
			const containers = [
				document.getElementById('gradesChart')?.parentElement,
				document.getElementById('solvabilityChart')?.parentElement,
				document.getElementById('complexityChart')?.parentElement
			];
			
			containers.forEach(container => {
				if (container) {
					container.innerHTML = `
						<div style="text-align: center; padding: 40px 20px; color: #666;">
							<div style="font-size: 48px; margin-bottom: 10px;">üìä</div>
							<h4 style="margin-bottom: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h4>
							<p style="font-size: 14px;">–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ</p>
						</div>
					`;
				}
			});
		}

		function showChartError() {
			const containers = [
				document.getElementById('gradesChart')?.parentElement,
				document.getElementById('solvabilityChart')?.parentElement,
				document.getElementById('complexityChart')?.parentElement
			];
			
			containers.forEach(container => {
				if (container) {
					container.innerHTML = `
						<div style="text-align: center; padding: 40px 20px; color: #e74c3c;">
							<div style="font-size: 48px; margin-bottom: 10px;">‚ùå</div>
							<h4 style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</h4>
							<p style="font-size: 14px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
						</div>
					`;
				}
			});
		}

		function destroyAllCharts() {
			// –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
			const chartInstances = [
				'gradesChartInstance',
				'complexityChartInstance',
				'solvabilityChartInstance',
				'literacyChartInstance',
				'literacyRadarChartInstance',
				'trendChartInstance',
				'psychologyProfileChartInstance',
				'normDistributionChartInstance',
				'radarChartInstance'
			];
			
			chartInstances.forEach(chartName => {
				if (window[chartName]) {
					try {
						window[chartName].destroy();
						window[chartName] = null;
					} catch (error) {
						console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ ${chartName}:`, error);
					}
				}
			});
		}

		// –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ resize
		window.addEventListener('resize', debounce(safeResizeCharts, 250));

		function debounce(func, wait) {
			let timeout;
			return function executedFunction(...args) {
				const later = () => {
					clearTimeout(timeout);
					func(...args);
				};
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
			};
		}

		// ==================== –°–ë–†–û–° –î–ê–ù–ù–´–• ====================
		function resetAppData() {
			if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
				try {
					// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º
					const backupKey = `backup_pre_reset_${new Date().toISOString().replace(/[:.]/g, '-')}`;
					localStorage.setItem(backupKey, JSON.stringify({
						data: JSON.parse(JSON.stringify(appData)),
						timestamp: new Date().toLocaleString(),
						reason: 'pre-reset'
					}));
					
					// –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
					localStorage.removeItem('testAnalyticsData');
					
					// –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π
					const backups = Object.keys(localStorage)
						.filter(key => key.startsWith('backup_'))
						.sort()
						.reverse()
						.slice(1);
					
					backups.forEach(key => localStorage.removeItem(key));
					
					// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
					location.reload();
					
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö:', error);
					showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
				}
			}
		}

		function showResetDialog() {
			const html = `
				<h3>‚ö†Ô∏è –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã</h3>
				
				<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4 style="color: #856404;">–í–Ω–∏–º–∞–Ω–∏–µ!</h4>
					<p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç:</p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤</li>
						<li>–°–ø–∏—Å–∫–∏ —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ—Ü–µ–Ω–∫–∏</li>
						<li>–ê–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –æ—Ç—á–µ—Ç—ã</li>
					</ul>
					<p><strong>–î–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</strong></p>
				</div>
				
				<div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0;">
					<h4>üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º:</h4>
					<ol style="margin: 10px 0; padding-left: 20px;">
						<li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
						<li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</li>
						<li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</li>
					</ol>
				</div>
				
				<div style="margin-top: 20px;">
					<button class="btn" onclick="exportAppData('json')" style="margin-right: 10px;">
						üíæ –°–Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
					</button>
					<button class="btn btn-danger" onclick="resetAppData()">
						‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
					</button>
				</div>
			`;
			
			showModal('–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã', html);
		}

		
		function safeResizeCharts() {
			// –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∞–¥—Ä–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
			requestAnimationFrame(() => {
				const chartInstances = [
					window.gradesChartInstance,
					window.complexityChartInstance,
					window.solvabilityChartInstance,
					window.trendChartInstance,
					window.psychologyProfileChartInstance,
					window.normDistributionChartInstance,
					window.radarChartInstance
				];
				
				chartInstances.forEach(chart => {
					if (chart) {
						try {
							chart.resize();
						} catch (error) {
							console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
						}
					}
				});
			});
		}
        // –£–ª—É—á—à–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∫–æ—Ä–∏–¥–æ—Ä–∞ —Ä–µ—à–∞–µ–º–æ—Å—Ç–∏
        function updateSolvabilityChart() {
            const taskStats = [];
            for (let i = 0; i < appData.tasks.length; i++) {
                const task = appData.tasks[i];
                const maxScore = task.maxScore;
                const actualScores = appData.results.map(student => student[i] || 0);
                const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
                const completion = (actualTotal / (maxScore * appData.results.length)) * 100;
                
                taskStats.push({
                    task: i + 1,
                    completion: completion,
                    level: task.level,
                    type: task.type
                });
            }
            
            const ctx = document.getElementById('solvabilityChart').getContext('2d');
            
            if (window.solvabilityChartInstance) {
                window.solvabilityChartInstance.destroy();
            }
            
            window.solvabilityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: taskStats.map(t => `–ó–∞–¥. ${t.task}`),
                    datasets: [{
                        label: '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
                        data: taskStats.map(t => t.completion),
                        backgroundColor: taskStats.map(t => {
                            if (t.completion >= 90) return '#27ae60';
                            if (t.completion >= 60) return '#2ecc71';
                            if (t.completion >= 30) return '#f39c12';
                            return '#e74c3c';
                        }),
                        borderColor: taskStats.map(t => {
                            if (t.completion >= 90) return '#219a52';
                            if (t.completion >= 60) return '#27ae60';
                            if (t.completion >= 30) return '#e67e22';
                            return '#c0392b';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { 
                                display: true, 
                                text: '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: { size: 12 }
                            },
                            grid: {
                                color: function(context) {
                                    const value = context.tick.value;
                                    if (value === 30 || value === 60 || value === 90) {
                                        return 'rgba(0,0,0,0.3)';
                                    }
                                    return 'rgba(0,0,0,0.1)';
                                },
                                lineWidth: function(context) {
                                    const value = context.tick.value;
                                    if (value === 30 || value === 60 || value === 90) {
                                        return 2;
                                    }
                                    return 1;
                                }
                            }
                        },
                        x: {
                            title: { 
                                display: true, 
                                text: '–ù–æ–º–µ—Ä–∞ –∑–∞–¥–∞–Ω–∏–π',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                font: { size: 12 }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const task = taskStats[context.dataIndex];
                                    return [
                                        `–ó–∞–¥–∞–Ω–∏–µ ${task.task}: ${task.completion.toFixed(1)}%`,
                                        `–¢–∏–ø: ${task.type}`,
                                        `–£—Ä–æ–≤–µ–Ω—å: ${complexityLevels[task.level].name}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
        function updateHeatmap() {
            let html = '<div class="table-container"><table>';
            
            html += '<thead><tr><th>–£—á–∞—â–∏–π—Å—è</th>';
            for (let i = 0; i < appData.tasks.length; i++) {
                html += `<th>${i+1}</th>`;
            }
            html += '<th>‚àë</th><th>–û—Ü–µ–Ω–∫–∞</th></tr></thead><tbody>';
            
            appData.students.forEach((student, studentIndex) => {
                const scores = appData.results[studentIndex] || [];
                const totalScore = scores.reduce((sum, score) => sum + score, 0);
                const grade = calculateGrade(totalScore);
                
                html += `<tr>
                    <td><strong>${student}</strong></td>`;
                
                for (let taskIndex = 0; taskIndex < appData.tasks.length; taskIndex++) {
                    const maxScore = appData.tasks[taskIndex].maxScore;
                    const score = scores[taskIndex] || 0;
                    const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
                    const heatmapClass = `heatmap-${Math.floor(percentage / 20) * 20}`;
                    
                    html += `<td class="heatmap-cell ${heatmapClass}" title="–ó–∞–¥–∞–Ω–∏–µ ${taskIndex+1}: ${score}/${maxScore} (${percentage.toFixed(0)}%)">
                        ${score}
                    </td>`;
                }
                
                html += `<td><strong>${totalScore}</strong></td>
                    <td class="grade-${grade}"><strong>${grade}</strong></td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('heatmapContainer').innerHTML = html;
        }

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
        function updateLiteracyVisualization() {
            let html = '<div class="chart-container">';
            html += `
<div class="chart-container" style="
    height: 450px; 
    min-height: 450px; 
    position: relative; 
    margin: 25px 0; 
    border: 1px solid #e0e0e0; 
    border-radius: 10px; 
    padding: 20px; 
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
">
    <h4 style="margin: 0 0 20px 0; padding: 0; color: #2c3e50;">üìà –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
    <div style="height: 380px; position: relative; background: #f8f9fa; border-radius: 6px; padding: 10px;">
        <canvas id="literacyRadarChart" 
                style="display: block; width: 100%; height: 100%; background: white; border-radius: 4px;"></canvas>
    </div>
</div>
			`;
            
            document.getElementById('specializedCharts').innerHTML = html;
            
            setTimeout(() => {
                initLiteracyRadarChart();
            }, 100);
        }

		// –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π
		function updateMilestoneAnalysis() {
			let html = '<h3 class="section-title">üìÖ –ê–Ω–∞–ª–∏–∑ —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ —Å –Ω–∞—á–∞–ª–∞ —É—á–µ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
			const history = JSON.parse(localStorage.getItem('workHistory') || '[]')
				.filter(item => item.data.test.subject === appData.test.subject && 
							   item.data.test.class === appData.test.class &&
							   item.data.test.workType === 'current') // –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ —Ä–∞–±–æ—Ç—ã
				.sort((a, b) => new Date(a.data.test.testDate) - new Date(b.data.test.testDate));
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateQualityRate().toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${history.length + 1}</div>
						<div class="stat-label">–†–∞–±–æ—Ç–∞ ‚Ññ</div>
					</div>
				</div>
			`;
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–±–æ—Ç—ã
			if (history.length > 0) {
				const currentSummary = generateWorkSummary();
				const previousSummary = history[history.length - 1].summary;
				
				html += `
					<h4>üìà –î–∏–Ω–∞–º–∏–∫–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–∞–±–æ—Ç—ã</h4>
					<div class="comparative-grid">
						<div class="comparative-card">
							<h5>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h5>
							<div class="comparative-value ${currentSummary.avgScore > previousSummary.avgScore ? 'positive' : 'negative'}">
								${currentSummary.avgScore.toFixed(1)} 
								<span class="trend">${currentSummary.avgScore > previousSummary.avgScore ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.avgScore.toFixed(1)}</div>
						</div>
						<div class="comparative-card">
							<h5>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</h5>
							<div class="comparative-value ${currentSummary.successRate > previousSummary.successRate ? 'positive' : 'negative'}">
								${currentSummary.successRate.toFixed(1)}%
								<span class="trend">${currentSummary.successRate > previousSummary.successRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.successRate.toFixed(1)}%</div>
						</div>
						<div class="comparative-card">
							<h5>–ö–∞—á–µ—Å—Ç–≤–æ</h5>
							<div class="comparative-value ${currentSummary.qualityRate > previousSummary.qualityRate ? 'positive' : 'negative'}">
								${currentSummary.qualityRate.toFixed(1)}%
								<span class="trend">${currentSummary.qualityRate > previousSummary.qualityRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ü—Ä–µ–¥—ã–¥—É—â–∏–π: ${previousSummary.qualityRate.toFixed(1)}%</div>
						</div>
					</div>
				`;
			}
			
			// –ê–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
			html += generateLearningElementsAnalysis();
			
			// –ü—Ä–æ–≥–Ω–æ–∑ –∏—Ç–æ–≥–æ–≤–æ–π —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
			html += generateProgressForecast();
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞
			html += generateMilestoneRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π
		function updateCurrentAnalysis() {
			let html = '<h3 class="section-title">üìù –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${countStudentsByPerformanceLevel('mastered')}</div>
						<div class="stat-label">–û—Å–≤–æ–∏–ª–∏ —Ç–µ–º—É</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${countStudentsByPerformanceLevel('need_help')}</div>
						<div class="stat-label">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å</div>
					</div>
				</div>
			`;
			
			// –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —Ç–µ–º—ã
			html += generateTopicMasteryAnalysis();
			
			// –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
			html += generateCurrentErrorsAnalysis();
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É—Ä–æ–∫–∞
			html += generateLessonRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã
		function updateDiagnosticAnalysis() {
			let html = '<h3 class="section-title">üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateBaselineLevel()}</div>
						<div class="stat-label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${identifyGaps().length}</div>
						<div class="stat-label">–í—ã—è–≤–ª–µ–Ω–æ –ø—Ä–æ–±–µ–ª–æ–≤</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateReadinessLevel()}</div>
						<div class="stat-label">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é</div>
					</div>
				</div>
			`;
			
			// –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤
			html += generateGapsAnalysis();
			
			// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º
			html += generateDiagnosticGroups();
			
			// –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
			html += generateDiagnosticRecommendations();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

		// –ê–Ω–∞–ª–∏–∑ —É—á–µ–±–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
		function generateLearningElementsAnalysis() {
			let html = '<h4>üìö –ê–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h4>';
			
			const elementStats = {};
			
			appData.tasks.forEach((task, taskIndex) => {
				const element = task.knowledge || '–£—á–µ–±–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç';
				if (!elementStats[element]) {
					elementStats[element] = {
						completion: 0,
						count: 0,
						importance: task.level // –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞–∫ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –≤–∞–∂–Ω–æ—Å—Ç–∏
					};
				}
				
				const completion = calculateTaskCompletion(taskIndex);
				elementStats[element].completion += completion;
				elementStats[element].count++;
			});
			
			// –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
			Object.keys(elementStats).forEach(element => {
				elementStats[element].completion = elementStats[element].completion / elementStats[element].count;
			});
			
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–£—á–µ–±–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç</th><th>–í–∞–∂–Ω–æ—Å—Ç—å</th><th>% –æ—Å–≤–æ–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
			
			Object.entries(elementStats).forEach(([element, stats]) => {
				let status = '';
				let statusIcon = '';
				
				if (stats.completion >= 80) {
					status = '–û—Å–≤–æ–µ–Ω';
					statusIcon = 'üü¢';
				} else if (stats.completion >= 60) {
					status = '–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–≤–æ–µ–Ω';
					statusIcon = 'üü°';
				} else {
					status = '–ù–µ –æ—Å–≤–æ–µ–Ω';
					statusIcon = 'üî¥';
				}
				
				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–∂–Ω–æ—Å—Ç—å
				const importance = stats.importance <= 2 ? '–ë–∞–∑–æ–≤–∞—è' : '–ö–ª—é—á–µ–≤–∞—è';
				
				html += `
					<tr>
						<td>${element}</td>
						<td>${importance}</td>
						<td>${stats.completion.toFixed(1)}%</td>
						<td>${statusIcon} ${status}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div>';
			
			return html;
		}

		// –ü—Ä–æ–≥–Ω–æ–∑ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
		function generateProgressForecast() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			let forecast = '';
			let forecastColor = '';
			
			if (percentage >= 80) {
				forecast = '–í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
				forecastColor = '#27ae60';
			} else if (percentage >= 60) {
				forecast = '–°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ö–æ—Ä–æ—à–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã';
				forecastColor = '#3498db';
			} else if (percentage >= 40) {
				forecast = '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
				forecastColor = '#f39c12';
			} else {
				forecast = '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –Ω–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
				forecastColor = '#e74c3c';
			}
			
			return `
				<div class="recommendation-card">
					<h4>üéØ –ü—Ä–æ–≥–Ω–æ–∑ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h4>
					<p style="color: ${forecastColor}; font-weight: bold;">${forecast}</p>
					<p><strong>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Å–≤–æ–µ–Ω–∏—è:</strong> ${percentage.toFixed(1)}%</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${generateForecastRecommendation(percentage)}</p>
				</div>
			`;
		}

		function generateForecastRecommendation(percentage) {
			if (percentage >= 80) return '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –æ–±—É—á–µ–Ω–∏—è';
			if (percentage >= 60) return '–£—Å–∏–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —Å–ª–æ–∂–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏';
			if (percentage >= 40) return '–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è';
			return '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º';
		}

		// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä—É–±–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
		function generateMilestoneRecommendations() {
			return `
				<div class="recommendation-card">
					<h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥</h4>
					<ul>
						<li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π</li>
						<li>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≥—Ä—É–ø–ø —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö</li>
						<li>–í–µ—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏–Ω–∞–º–∏–∫–∏ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</li>
					</ul>
				</div>
			`;
		}

		// –ê–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —Ç–µ–º—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
		function generateTopicMasteryAnalysis() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const avgPercentage = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
			
			let masteryLevel = '';
			if (avgPercentage >= 80) masteryLevel = '–¢–µ–º–∞ —É—Å–≤–æ–µ–Ω–∞';
			else if (avgPercentage >= 60) masteryLevel = '–¢–µ–º–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —É—Å–≤–æ–µ–Ω–∞';
			else if (avgPercentage >= 40) masteryLevel = '–¢–µ–º–∞ —É—Å–≤–æ–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ';
			else masteryLevel = '–¢–µ–º–∞ –Ω–µ —É—Å–≤–æ–µ–Ω–∞';
			
			return `
				<div class="recommendation-card">
					<h4>üìñ –û—Å–≤–æ–µ–Ω–∏–µ —É—á–µ–±–Ω–æ–π —Ç–µ–º—ã</h4>
					<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme}</p>
					<p><strong>–£—Ä–æ–≤–µ–Ω—å –æ—Å–≤–æ–µ–Ω–∏—è:</strong> ${masteryLevel}</p>
					<p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${avgPercentage.toFixed(1)}%</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${generateTopicRecommendation(avgPercentage)}</p>
				</div>
			`;
		}

		function generateTopicRecommendation(percentage) {
			if (percentage >= 80) return '–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º–µ';
			if (percentage >= 60) return '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ —É—Ä–æ–∫ –æ–±–æ–±—â–µ–Ω–∏—è';
			if (percentage >= 40) return '–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–∫ –ø–æ —Ç–µ–º–µ';
			return '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ —Ç–µ–º—ã';
		}

		// –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
		function generateCurrentErrorsAnalysis() {
			if (appData.errors.length === 0) {
				return `
					<div class="recommendation-card">
						<h4>‚úÖ –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h4>
						<p>–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã. –£—á–∞—â–∏–µ—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å –∑–∞–¥–∞–Ω–∏—è–º–∏.</p>
					</div>
				`;
			}
			
			const errorStats = {};
			appData.errors.forEach(error => {
				errorStats[error.type] = (errorStats[error.type] || 0) + 1;
			});
			
			const topErrors = Object.entries(errorStats)
				.sort(([,a], [,b]) => b - a)
				.slice(0, 3);
			
			let html = '<div class="recommendation-card">';
			html += '<h4>‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏</h4>';
			html += '<ul>';
			
			topErrors.forEach(([type, count]) => {
				html += `<li>${errorTypes[type].name}: ${count} —Å–ª—É—á–∞–µ–≤</li>`;
			});
			
			html += '</ul>';
			html += '<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong></p>';
			html += '<ul>';
			
			topErrors.forEach(([type, _]) => {
				switch(type) {
					case 'calculation':
						html += '<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –º–∏–Ω—É—Ç–∫—É –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–∫–µ</li>';
						break;
					case 'conceptual':
						html += '<li>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è —Ç–µ–º—ã</li>';
						break;
					case 'attention':
						html += '<li>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏–π</li>';
						break;
					default:
						html += '<li>–ü—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏</li>';
				}
			});
			
			html += '</ul></div>';
			
			return html;
		}

		// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É—Ä–æ–∫–∞
		function generateLessonRecommendations() {
			const needHelpCount = countStudentsByPerformanceLevel('need_help');
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞</h4>';
			
			if (needHelpCount === 0) {
				html += '<p>–í—Å–µ —É—á–∞—â–∏–µ—Å—è —É—Å–ø–µ—à–Ω–æ –æ—Å–≤–æ–∏–ª–∏ —Ç–µ–º—É. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –Ω–æ–≤–æ–º—É –º–∞—Ç–µ—Ä–∏–∞–ª—É.</p>';
			} else if (needHelpCount <= 5) {
				html += `
					<p><strong>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${needHelpCount} —É—á–∞—â–∏–º—Å—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å</p>
					<ul>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –ø–∞—Ä–∞—Ö</li>
						<li>–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏-–ø–æ–º–æ—â–Ω–∏–∫–∏</li>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤</li>
					</ul>
				`;
			} else {
				html += `
					<p><strong>–ì—Ä—É–ø–ø–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${needHelpCount} —É—á–∞—â–∏–º—Å—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å</p>
					<ul>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —É—Ä–æ–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –º–∞–ª—ã—Ö –≥—Ä—É–ø–ø–∞—Ö</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</li>
					</ul>
				`;
			}
			
			html += '</div>';
			return html;
		}

		// –ü–æ–¥—Å—á–µ—Ç —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
		function countStudentsByPerformanceLevel(level) {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentages = totalScores.map(score => (score / maxPossible) * 100);
			
			switch(level) {
				case 'mastered':
					return percentages.filter(p => p >= 70).length;
				case 'need_help':
					return percentages.filter(p => p < 50).length;
				default:
					return 0;
			}
		}

		// –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function calculateBaselineLevel() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			if (percentage >= 70) return '–í—ã—Å–æ–∫–∏–π';
			if (percentage >= 50) return '–°—Ä–µ–¥–Ω–∏–π';
			if (percentage >= 30) return '–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ';
			return '–ù–∏–∑–∫–∏–π';
		}

		function identifyGaps() {
			const gaps = [];
			
			appData.tasks.forEach((task, index) => {
				const completion = calculateTaskCompletion(index);
				if (completion < 50) {
					gaps.push({
						task: task.type,
						completion: completion,
						knowledge: task.knowledge
					});
				}
			});
			
			return gaps;
		}

		function calculateReadinessLevel() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			if (percentage >= 80) return '–ì–æ—Ç–æ–≤';
			if (percentage >= 60) return '–£—Å–ª–æ–≤–Ω–æ –≥–æ—Ç–æ–≤';
			if (percentage >= 40) return '–¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏';
			return '–ù–µ –≥–æ—Ç–æ–≤';
		}

		// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã
		function generateGapsAnalysis() {
			const gaps = identifyGaps();
			
			if (gaps.length === 0) {
				return `
					<div class="recommendation-card">
						<h4>‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤</h4>
						<p>–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã.</p>
					</div>
				`;
			}
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö</h4>';
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–û–±–ª–∞—Å—Ç—å –∑–Ω–∞–Ω–∏–π</th><th>–ó–∞–¥–∞–Ω–∏–µ</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å</th></tr></thead><tbody>';
			
			gaps.forEach(gap => {
				let criticality = '';
				let color = '';
				
				if (gap.completion < 30) {
					criticality = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';
					color = '#e74c3c';
				} else if (gap.completion < 40) {
					criticality = '–í—ã—Å–æ–∫–∏–π';
					color = '#f39c12';
				} else {
					criticality = '–°—Ä–µ–¥–Ω–∏–π';
					color = '#3498db';
				}
				
				html += `
					<tr>
						<td>${gap.knowledge}</td>
						<td>${gap.task}</td>
						<td>${gap.completion.toFixed(1)}%</td>
						<td style="color: ${color}; font-weight: bold;">${criticality}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div></div>';
			
			return html;
		}

		// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É—á–∞—â–∏—Ö—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
		function generateDiagnosticGroups() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentages = totalScores.map(score => (score / maxPossible) * 100);
			
			const groups = {
				advanced: percentages.filter(p => p >= 80).length,
				proficient: percentages.filter(p => p >= 60 && p < 80).length,
				basic: percentages.filter(p => p >= 40 && p < 60).length,
				below_basic: percentages.filter(p => p < 40).length
			};
			
			return `
				<div class="recommendation-card">
					<h4>üë• –ì—Ä—É–ø–ø—ã —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</h4>
					<div class="kpi-grid">
						<div class="kpi-card" style="border-left-color: #27ae60">
							<div class="kpi-value">${groups.advanced}</div>
							<div class="kpi-label">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</div>
							<small>> 80%</small>
						</div>
						<div class="kpi-card" style="border-left-color: #3498db">
							<div class="kpi-value">${groups.proficient}</div>
							<div class="kpi-label">–ë–∞–∑–æ–≤—ã–π</div>
							<small>60-79%</small>
						</div>
						<div class="kpi-card" style="border-left-color: #f39c12">
							<div class="kpi-value">${groups.basic}</div>
							<div class="kpi-label">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π</div>
							<small>40-59%</small>
						</div>
						<div class="kpi-card" style="border-left-color: #e74c3c">
							<div class="kpi-value">${groups.below_basic}</div>
							<div class="kpi-label">–ù–∏–∑–∫–∏–π</div>
							<small>< 40%</small>
						</div>
					</div>
				</div>
			`;
		}

		// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
		function generateDiagnosticRecommendations() {
			const gaps = identifyGaps();
			const readiness = calculateReadinessLevel();
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üí° –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>';
			
			html += `<p><strong>–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:</strong> ${readiness}</p>`;
			html += `<p><strong>–í—ã—è–≤–ª–µ–Ω–æ –ø—Ä–æ–±–µ–ª–æ–≤:</strong> ${gaps.length}</p>`;
			
			html += '<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</strong></p>';
			html += '<ul>';
			
			if (gaps.length > 5) {
				html += '<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</li>';
				html += '<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</li>';
				html += '<li>–í–µ—Å—Ç–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>';
			} else if (gaps.length > 0) {
				html += '<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ü–µ–ª–µ–≤—ã–µ —É—Ä–æ–∫–∏ –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>';
				html += '<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â—å –≤ –∫–ª–∞—Å—Å–µ</li>';
				html += '<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</li>';
			} else {
				html += '<li>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ</li>';
				html += '<li>–í–∫–ª—é—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è</li>';
				html += '<li>–†–∞–∑–≤–∏–≤–∞—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è</li>';
			}
			
			html += '</ul></div>';
			
			return html;
		}

		// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
		function generateMilestoneSpecializedReport() {
			updateMilestoneAnalysis();
			return `
				<h3>üìÖ –ê–Ω–∞–ª–∏–∑ —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>
				<p>–û—Ü–µ–Ω–∫–∞ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å –∞–Ω–∞–ª–∏–∑–æ–º –¥–∏–Ω–∞–º–∏–∫–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–º –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.</p>
				${document.getElementById('specializedAnalysis').innerHTML}
			`;
		}

		function generateCurrentSpecializedReport() {
			updateCurrentAnalysis();
			return `
				<h3>üìù –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>
				<p>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω–æ–π —Ç–µ–º—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ —É—Ä–æ–∫–µ.</p>
				${document.getElementById('specializedAnalysis').innerHTML}
			`;
		}

		function generateDiagnosticSpecializedReport() {
			updateDiagnosticAnalysis();
			return `
				<h3>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
				<p>–í—ã—è–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –∑–Ω–∞–Ω–∏—è—Ö –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π.</p>
				${document.getElementById('specializedAnalysis').innerHTML}
			`;
		}

		// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é exportSpecializedReport()
		function exportSpecializedReport() {
			const workType = appData.test.workType;
			let reportTitle = "";
			let reportDescription = "";
			let specializedContent = "";
			
			switch(workType) {
				case 'vpr': 
					updateVPRAnalysis();
					specializedContent = generateVPRSpecializedReport();
					reportTitle = "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –í–ü–†";
					reportDescription = "–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã";
					break;
				case 'oge': 
					updateGIAnalysis();
					specializedContent = generateOGESpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –û–ì–≠";
					reportDescription = "–û—Ç—á–µ—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –ø–æ –∫–æ–¥–∞–º –ö–≠–° –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —ç–∫–∑–∞–º–µ–Ω—É";
					break;
				case 'ege': 
					updateGIAnalysis();
					specializedContent = generateEGESpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ï–ì–≠";
					reportDescription = "–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É";
					break;
				case 'func_literacy': 
					updateLiteracyAnalysis();
					specializedContent = generateLiteracySpecializedReport();
					reportTitle = "–û—Ç—á–µ—Ç –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏";
					reportDescription = "–ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è";
					break;
				case 'final':
					updateFinalAnalysis();
					specializedContent = generateFinalSpecializedReport();
					reportTitle = "–ò—Ç–æ–≥–æ–≤—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑";
					reportDescription = "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥";
					break;
				case 'milestone':
					updateMilestoneAnalysis();
					specializedContent = generateMilestoneSpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ä—É–±–µ–∂–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã";
					reportDescription = "–û—Ü–µ–Ω–∫–∞ —É—á–µ–±–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥";
					break;
				case 'current':
					updateCurrentAnalysis();
					specializedContent = generateCurrentSpecializedReport();
					reportTitle = "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã";
					reportDescription = "–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω–æ–π —Ç–µ–º—ã";
					break;
				case 'diagnostic':
					updateDiagnosticAnalysis();
					specializedContent = generateDiagnosticSpecializedReport();
					reportTitle = "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑";
					reportDescription = "–í—ã—è–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ —É—á–∞—â–∏—Ö—Å—è";
					break;
				case 'psychology': 
					specializedContent = generatePsychologyPrintReport();
					reportTitle = "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ";
					reportDescription = "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏";
					break;
				default: 
					specializedContent = generateStandardSpecializedReport();
					reportTitle = "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑";
					reportDescription = "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤";
			}
			
			const fullReport = generateSpecializedReportHTML(reportTitle, reportDescription, specializedContent);
			
			const blob = new Blob([fullReport], { type: 'text/html' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `${reportTitle.toLowerCase().replace(/\s+/g, '_')}_${new Date().toLocaleDateString()}.html`;
			a.click();
			URL.revokeObjectURL(url);
			showNotification("–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", "success");
		}

		function initLiteracyRadarChart() {
		    const canvas = document.getElementById('literacyRadarChart');
			const container = canvas.parentElement;
			
			// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—è
			canvas.width = container.offsetWidth;
			canvas.height = container.offsetHeight - 50; // –ú–∏–Ω—É—Å –º–µ—Å—Ç–æ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
			
			if (window.literacyRadarChartInstance) {
				window.literacyRadarChartInstance.destroy();
			}
			
			const literacyStats = {};
			Object.keys(functionalLiteracyTypes).forEach(type => {
				literacyStats[type] = { total: 0, max: 0, count: 0 };
			});
			
			appData.tasks.forEach((task, taskIndex) => {
				if (task.literacyType && literacyStats[task.literacyType]) {
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					literacyStats[task.literacyType].total += actualTotal;
					literacyStats[task.literacyType].max += maxScore * appData.results.length;
				}
			});
			
			const ctx = document.getElementById('literacyRadarChart').getContext('2d');
			const labels = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].name);
			const data = Object.values(literacyStats).map(stats => 
				stats.max > 0 ? (stats.total / stats.max) * 100 : 0
			);
			const colors = Object.keys(literacyStats).map(type => functionalLiteracyTypes[type].color);
			
			window.literacyRadarChartInstance = new Chart(ctx, {
				type: 'radar',
				data: {
					labels: labels,
					datasets: [{
						label: '–£—Ä–æ–≤–µ–Ω—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (%)',
						data: data,
						backgroundColor: 'rgba(54, 162, 235, 0.2)',
						borderColor: 'rgba(54, 162, 235, 0.8)',
						pointBackgroundColor: colors,
						pointBorderColor: '#fff',
						pointHoverBackgroundColor: '#fff',
						pointHoverBorderColor: colors,
						pointRadius: 4,
						pointBorderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						r: {
							beginAtZero: true,
							max: 100,
							ticks: {
								callback: function(value) {
									return value + '%';
								},
								stepSize: 20
							},
							pointLabels: {
								font: {
									size: 11
								}
							}
						}
					},
					plugins: {
						legend: {
							display: true,
							position: 'top'
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									return `${context.label}: ${context.raw.toFixed(1)}%`;
								}
							}
						}
					}
				}
			});
			// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Ñ–ª–æ—É –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ layout
			setTimeout(() => {
				const chartContainer = document.querySelector('.chart-container');
				if (chartContainer) {
					chartContainer.style.display = 'none';
					chartContainer.offsetHeight; // trigger reflow
					chartContainer.style.display = 'block';
				}
			}, 100);
		}

        // ==================== –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ====================

        function updateRecommendations() {
            updatePrintHeaders();
            updateKeyConclusions();
            updateCorrectionPlan();
            updateNextSteps();
        }

        function updatePrintHeaders() {
            document.getElementById('printSubjectClass').textContent = `${appData.test.subject}, ${appData.test.class}`;
            document.getElementById('printTheme').textContent = appData.test.theme;
            document.getElementById('printDate').textContent = new Date(appData.test.testDate).toLocaleDateString();
        }

        // –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã
        function updateKeyConclusions() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            
            let html = '<div class="recommendation-card">';
            
            if (successRate >= 80) {
                html += '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
                html += '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å —Ä–∞–±–æ—Ç–æ–π. ';
            } else if (successRate >= 60) {
                html += '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
                html += '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ —É—á–∞—â–∏—Ö—Å—è. ';
            } else {
                html += '<strong>üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
                html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç–æ–¥—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ. ';
            }
            
            const difficultTasks = [];
            appData.tasks.forEach((task, index) => {
                const completion = calculateTaskCompletion(index);
                if (completion < 50) {
                    difficultTasks.push({ task: index + 1, completion: completion, type: task.type });
                }
            });
            
            if (difficultTasks.length > 0) {
                html += `<br><strong>–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:</strong> `;
                html += difficultTasks.map(t => `‚Ññ${t.task} (${t.completion.toFixed(1)}%)`).join(', ');
            }
            
            if (appData.errors.length > 0) {
                const topErrorType = getTopErrorType();
                html += `<br><strong>–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–µ –æ—à–∏–±–∫–∏:</strong> ${errorTypes[topErrorType].name}`;
            }
            
            const workType = appData.test.workType;
            if (workType === 'vpr') {
                html += `<br><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –í–ü–†:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–µ–ª–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π.`;
            } else if (workType === 'func_literacy') {
                html += `<br><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏:</strong> –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —É–º–µ–Ω–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.`;
            } else if (workType === 'oge' || workType === 'ege') {
                html += `<br><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ì–ò–ê:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ —ç–∫–∑–∞–º–µ–Ω—É.`;
            }
            
            html += '</div>';
            document.getElementById('keyConclusions').innerHTML = html;
        }

        // –ü–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
        function updateCorrectionPlan() {
            let html = '';
            
            html += '<div class="sub-section"><h4>üë®‚Äçüè´ –î–ª—è –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞:</h4>';
            html += '<div class="recommendation-card">';
            html += '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏<br>';
            html += '‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º<br>';
            html += '‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π<br>';
            html += '‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—é —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º';
            
            const workType = appData.test.workType;
            if (workType === 'vpr') {
                html += '<br>‚Ä¢ –ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –í–ü–†';
            } else if (workType === 'func_literacy') {
                html += '<br>‚Ä¢ –í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏';
                html += '<br>‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π';
            } else if (workType === 'oge' || workType === 'ege') {
                html += '<br>‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ì–ò–ê';
                html += '<br>‚Ä¢ –†–∞–±–æ—Ç–∞ —Å –∫–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π';
            }
            
            html += '</div></div>';
            
            const unsatisfactory = appData.results.map((scores, index) => ({
                name: appData.students[index],
                score: scores.reduce((sum, score) => sum + score, 0),
                grade: calculateGrade(scores.reduce((sum, score) => sum + score, 0))
            })).filter(s => s.grade === 2);
            
            if (unsatisfactory.length > 0) {
                html += '<div class="sub-section"><h4>üî¥ –î–ª—è —É—á–∞—â–∏—Ö—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:</h4>';
                unsatisfactory.forEach(student => {
                    html += `<div class="recommendation-card">
                        <strong>${student.name}</strong><br>
                        ‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏<br>
                        ‚Ä¢ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–µ–º<br>
                        ‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è<br>
                        ‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
                    </div>`;
                });
                html += '</div>';
            }
            
            document.getElementById('correctionPlan').innerHTML = html;
        }

        // –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏
        function updateNextSteps() {
            let html = `
                <div class="recommendation-card">
                    <strong>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</strong><br>
                    ‚Ä¢ –°—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏: 1 –Ω–µ–¥–µ–ª—è<br>
                    ‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: –ø–æ –≥—Ä–∞—Ñ–∏–∫—É<br>
                    ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π: –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –¥–Ω–µ–π<br>
                    ‚Ä¢ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å: —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏<br>
                    ‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ö–¢–ü: –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º—ã
            `;
            
            const workType = appData.test.workType;
            if (workType === 'vpr') {
                html += '<br>‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏';
                html += '<br>‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –¥–µ—Ñ–∏—Ü–∏—Ç–æ–≤';
            } else if (workType === 'func_literacy') {
                html += '<br>‚Ä¢ –í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫';
                html += '<br>‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏';
            } else if (workType === 'oge' || workType === 'ege') {
                html += '<br>‚Ä¢ –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤';
                html += '<br>‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–±–Ω—ã—Ö —ç–∫–∑–∞–º–µ–Ω–∞—Ö';
            }
            
            html += '</div>';
            document.getElementById('nextSteps').innerHTML = html;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function calculateTaskCompletion(taskIndex) {
			try {
				if (!appData.tasks || !appData.results || appData.results.length === 0) {
					return 0;
				}
				
				const task = appData.tasks[taskIndex];
				if (!task || typeof task.maxScore !== 'number' || task.maxScore <= 0) {
					return 0;
				}
				
				const maxScore = task.maxScore;
				const actualScores = appData.results.map(student => 
					student && student[taskIndex] !== undefined ? student[taskIndex] : 0
				);
				const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
				const totalPossible = maxScore * appData.results.length;
				
				return totalPossible > 0 ? (actualTotal / totalPossible) * 100 : 0;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error, taskIndex);
				return 0;
			}
		}

        function getTopErrorType() {
            const errorStats = {};
            appData.errors.forEach(error => {
                errorStats[error.type] = (errorStats[error.type] || 0) + 1;
            });
            return Object.entries(errorStats).sort(([,a], [,b]) => b - a)[0][0];
        }

        // ==================== –≠–ö–°–ü–û–†–¢ –ò –ü–ï–ß–ê–¢–¨ ====================

		function generateFullReportForPrint() {
			if (!appData.test.subject && !appData.test.class) {
				return `
					<div class="header">
						<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
						<p>–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—Ç—ã –∏ –≤–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.</p>
					</div>
				`;
			}

			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.length > 0 ? totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length : 0;
			const successRate = totalScores.length > 0 ? (grades.filter(grade => grade >= 3).length / grades.length * 100) : 0;
			const qualityRate = totalScores.length > 0 ? (grades.filter(grade => grade >= 4).length / grades.length * 100) : 0;
			
			const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
			grades.forEach(grade => gradeCounts[grade]++);

			const taskAnalysis = appData.tasks.map((task, index) => {
				const completion = calculateTaskCompletion(index);
				let zone = '';
				let zoneColor = '';
				if (completion >= 90) { zone = '–û—Ç–ª–∏—á–Ω–∞—è'; zoneColor = '#27ae60'; }
				else if (completion >= 60) { zone = '–ó–µ–ª–µ–Ω–∞—è'; zoneColor = '#2ecc71'; }
				else if (completion >= 30) { zone = '–ñ–µ–ª—Ç–∞—è'; zoneColor = '#f39c12'; }
				else { zone = '–ö—Ä–∞—Å–Ω–∞—è'; zoneColor = '#e74c3c'; }
				
				return { task, index, completion, zone, zoneColor };
			});

			const levelAnalysis = {};
			Object.keys(complexityLevels).forEach(level => {
				const levelTasks = appData.tasks.filter(task => task.level == level);
				if (levelTasks.length > 0) {
					let totalMaxScore = 0;
					let totalActualScore = 0;
					
					levelTasks.forEach(task => {
						const taskIndex = appData.tasks.indexOf(task);
						const maxScore = task.maxScore;
						const actualScores = appData.results.map(student => student[taskIndex] || 0);
						const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
						
						totalMaxScore += maxScore * appData.results.length;
						totalActualScore += actualTotal;
					});
					
					const completion = totalMaxScore > 0 ? (totalActualScore / totalMaxScore) * 100 : 0;
					levelAnalysis[level] = { completion, count: levelTasks.length };
				}
			});

			let reportContent = `
				<div class="header">
					<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
					<h2>${appData.test.subject || '–ü—Ä–µ–¥–º–µ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω'}, ${appData.test.class || '–ö–ª–∞—Å—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</h2>
					<p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'} | <strong>–î–∞—Ç–∞:</strong> ${appData.test.testDate ? new Date(appData.test.testDate).toLocaleDateString() : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
					<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType]?.name || appData.test.workType}</p>
				</div>

				<div class="section">
					<h3 class="section-title">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
					<div class="stats-grid">
						<div class="stat-card">
							<div class="stat-value">${avgScore.toFixed(1)}</div>
							<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${successRate.toFixed(1)}%</div>
							<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${qualityRate.toFixed(1)}%</div>
							<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${appData.students.length}</div>
							<div class="stat-label">–£—á–∞—â–∏—Ö—Å—è</div>
						</div>
					</div>
					
					<div class="kpi-grid">
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[5]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 5</div>
						</div>
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[4]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 4</div>
						</div>
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[3]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 3</div>
						</div>
						<div class="kpi-card">
							<div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[2]}</div>
							<div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 2</div>
						</div>
					</div>
				</div>

				<div class="section print-break">
					<h3 class="section-title">üéØ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π</h3>
					${taskAnalysis.length > 0 ? `
						<table>
							<thead>
								<tr>
									<th>‚Ññ</th>
									<th>–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è</th>
									<th>–£—Ä–æ–≤–µ–Ω—å</th>
									<th>–ú–∞–∫—Å. –±–∞–ª–ª</th>
									<th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
									<th>–ó–æ–Ω–∞</th>
								</tr>
							</thead>
							<tbody>
								${taskAnalysis.map(item => `
									<tr>
										<td><strong>${item.index + 1}</strong></td>
										<td>${item.task.type}</td>
										<td>${item.task.level}. ${complexityLevels[item.task.level]?.name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
										<td>${item.task.maxScore}</td>
										<td>${item.completion.toFixed(1)}%</td>
										<td style="color: ${item.zoneColor}; font-weight: bold;">${item.zone}</td>
									</tr>
								`).join('')}
							</tbody>
						</table>
					` : '<p>–ó–∞–¥–∞–Ω–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>'}
				</div>

				<div class="section">
					<h3 class="section-title">üìà –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
					${Object.keys(levelAnalysis).length > 0 ? `
						<table>
							<thead>
								<tr>
									<th>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</th>
									<th>–ö–æ–ª-–≤–æ –∑–∞–¥–∞–Ω–∏–π</th>
									<th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
									<th>–ê–Ω–∞–ª–∏–∑</th>
								</tr>
							</thead>
							<tbody>
								${Object.entries(levelAnalysis).map(([level, data]) => {
									let analysis = "";
									if (data.completion >= 80) analysis = "üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
									else if (data.completion >= 60) analysis = "üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è";
									else if (data.completion >= 40) analysis = "üü† –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è";
									else analysis = "üî¥ –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã";
									
									return `
										<tr>
											<td><strong>${level}. ${complexityLevels[level]?.name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</strong></td>
											<td>${data.count}</td>
											<td>${data.completion.toFixed(1)}%</td>
											<td>${analysis}</td>
										</tr>
									`;
								}).join('')}
							</tbody>
						</table>
					` : '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>'}
				</div>
			`;
			reportContent += generateCriteriaSummary();
			// –î–û–ë–ê–í–õ–Ø–ï–ú –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –ï–°–õ–ò –≠–¢–û –ü–°–ò–•–û–õ–û–ì–ò–Ø
			if (appData.test.workType === 'psychology') {
				reportContent += generatePsychologyPrintReport();
			}

			reportContent += `
				<div class="section print-break">
					<h3 class="section-title">üí° –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
					<div class="recommendation-card">
						${generateKeyConclusionsText()}
					</div>
					
					<h4 style="margin-top: 20px;">üìÖ –ü–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:</h4>
					<div class="recommendation-card">
						<ul style="margin: 0; padding-left: 20px;">
							<li>–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏</li>
							<li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
							<li>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>
							<li>–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ä–∞–±–æ—Ç—ã</li>
							<li>–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏</li>
						</ul>
					</div>
				</div>

				<div class="section small-text text-center">
					<p><em>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()} —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</em></p>
				</div>
			`;
			
			return reportContent;
		}		
        
		// –î–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤
		function addCriteriaPresets() {
			return `
				<div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
					<h5 style="margin: 0 0 10px 0; font-size: 14px;">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</h5>
					<div style="display: flex; flex-wrap: wrap; gap: 5px;">
						<button class="btn btn-sm" onclick="applyPreset('standard_5')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('five_point')" 
								style="font-size: 12px; padding: 5px 10px;">
							1Ô∏è‚É£ –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('vpr_percent')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìù –í–ü–† (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('ege_points')" 
								style="font-size: 12px; padding: 5px 10px;">
							üéì –ï–ì–≠ (–±–∞–ª–ª—ã)
						</button>
					</div>
					<small style="display: block; margin-top: 8px; color: #666;">
						–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞ —Å–±—Ä–æ—Å–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
					</small>
				</div>
			`;
		}
		function addCriteriaPresets() {
			return `
				<div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
					<h5 style="margin: 0 0 10px 0; font-size: 14px;">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</h5>
					<div style="display: flex; flex-wrap: wrap; gap: 5px;">
						<button class="btn btn-sm" onclick="applyPreset('standard_5')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìä –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('five_point')" 
								style="font-size: 12px; padding: 5px 10px;">
							1Ô∏è‚É£ –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('vpr_percent')" 
								style="font-size: 12px; padding: 5px 10px;">
							üìù –í–ü–† (–ø—Ä–æ—Ü–µ–Ω—Ç—ã)
						</button>
						<button class="btn btn-sm" onclick="applyPreset('ege_points')" 
								style="font-size: 12px; padding: 5px 10px;">
							üéì –ï–ì–≠ (–±–∞–ª–ª—ã)
						</button>
					</div>
					<small style="display: block; margin-top: 8px; color: #666;">
						–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞ —Å–±—Ä–æ—Å–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
					</small>
				</div>
			`;
		}

		function applyPreset(presetName) {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			switch(presetName) {
				case 'standard_5':
					appData.test.criteriaType = 'points';
					appData.test.criteriaSystem = 'standard';
					appData.test.criteriaCount = 4;
					appData.test.criteria = {
						1: { min: 0, max: Math.round(maxPossible * 0.49) },
						2: { min: Math.round(maxPossible * 0.5), max: Math.round(maxPossible * 0.69) },
						3: { min: Math.round(maxPossible * 0.7), max: Math.round(maxPossible * 0.84) },
						4: { min: Math.round(maxPossible * 0.85), max: maxPossible }
					};
					break;
					
				case 'five_point':
					appData.test.criteriaType = 'points';
					appData.test.criteriaSystem = 'five_point';
					appData.test.criteriaCount = 5;
					appData.test.criteria = {
						1: { min: 0, max: Math.round(maxPossible * 0.2) },
						2: { min: Math.round(maxPossible * 0.21), max: Math.round(maxPossible * 0.4) },
						3: { min: Math.round(maxPossible * 0.41), max: Math.round(maxPossible * 0.6) },
						4: { min: Math.round(maxPossible * 0.61), max: Math.round(maxPossible * 0.8) },
						5: { min: Math.round(maxPossible * 0.81), max: maxPossible }
					};
					break;
					
				case 'vpr_percent':
					appData.test.criteriaType = 'percentage';
					appData.test.criteriaSystem = 'standard';
					appData.test.criteriaCount = 4;
					appData.test.criteria = {
						1: { min: 0, max: 44 },
						2: { min: 45, max: 64 },
						3: { min: 65, max: 84 },
						4: { min: 85, max: 100 }
					};
					break;
					
				case 'psychology_levels':
					appData.test.criteriaType = 'percentage';
					appData.test.criteriaSystem = 'custom';
					appData.test.criteriaCount = 5;
					appData.test.customCriteria = [
						{
							name: "–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π",
							min: 0,
							max: 29,
							description: "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–∏—Ç–∏–µ –±–∞–∑–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤",
							color: "#c0392b"
						},
						{
							name: "–ù–∏–∑–∫–∏–π",
							min: 30,
							max: 49,
							description: "–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
							color: "#e74c3c"
						},
						{
							name: "–°—Ä–µ–¥–Ω–∏–π",
							min: 50,
							max: 69,
							description: "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ",
							color: "#f39c12"
						},
						{
							name: "–í—ã—Å–æ–∫–∏–π",
							min: 70,
							max: 84,
							description: "–•–æ—Ä–æ—à–æ —Ä–∞–∑–≤–∏—Ç—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
							color: "#3498db"
						},
						{
							name: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π",
							min: 85,
							max: 100,
							description: "–í—ã–¥–∞—é—â–∏–µ—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
							color: "#27ae60"
						}
					];
					appData.test.criteria = {
						1: { min: 0, max: 29 },
						2: { min: 30, max: 49 },
						3: { min: 50, max: 69 },
						4: { min: 70, max: 84 },
						5: { min: 85, max: 100 }
					};
					break;
			}
			
			renderCriteriaSettings();
			showNotification(`–ü—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–µ—Å–µ—Ç: ${presetName}`, "success");
		}
		
		function generatePsychologyPrintReport() {
			if (appData.test.workType !== 'psychology') return '';
			
			const settings = appData.test.psychologySettings;
			const levels = settings?.levels || [];
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			const levelCounts = {};
			levels.forEach(level => {
				levelCounts[level.name] = totalScores.filter(score => 
					score >= level.min && score <= level.max
				).length;
			});
			
			// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º
			const dimensions = settings?.dimensions || [];
			const dimensionStats = [];
			
			dimensions.forEach(dimension => {
				const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
				if (dimensionTasks.length === 0) return;
				
				let totalScore = 0;
				let totalMax = 0;
				
				dimensionTasks.forEach(task => {
					const taskIndex = appData.tasks.indexOf(task);
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					totalScore += actualTotal;
					totalMax += maxScore * appData.results.length;
				});
				
				const percentage = totalMax > 0 ? (totalScore / totalMax) * 100 : 0;
				dimensionStats.push({
					name: dimension.name,
					percentage: percentage,
					description: dimension.description || ''
				});
			});
			
			// –ù–∞—Ö–æ–¥–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥—Ä—É–ø–ø—ã
			const groupFeatures = [];
			if (appData.psychologyFeatures && appData.psychologyFeatures.length > 0) {
				const featureCounts = {};
				appData.psychologyFeatures.forEach(feature => {
					featureCounts[feature.name] = (featureCounts[feature.name] || 0) + 1;
				});
				
				// –ë–µ—Ä–µ–º 3 —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
				Object.entries(featureCounts)
					.sort(([,a], [,b]) => b - a)
					.slice(0, 3)
					.forEach(([name, count]) => {
						const percentage = (count / appData.students.length) * 100;
						if (percentage >= 20) { // –ï—Å–ª–∏ —É 20% –∏ –±–æ–ª–µ–µ —É—á–∞—â–∏—Ö—Å—è
							groupFeatures.push(`${name} (${count} —á–µ–ª., ${percentage.toFixed(0)}%)`);
						}
					});
			}
			
			return `
				<div class="section print-break">
					<h3 class="section-title">üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
					
					<div class="recommendation-card">
						<h4>üìã –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</h4>
						<p><strong>–ú–µ—Ç–æ–¥–∏–∫–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞:</strong> ${settings?.normGroup || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞:</strong> ${settings?.reliability ? settings.reliability.toFixed(2) : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–ú–µ—Ç–æ–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏:</strong> ${settings?.interpretationMethod === 'normative' ? '–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–æ–π)' : 
																   settings?.interpretationMethod === 'ipsative' ? '–ò–ø—Å–∞—Ç–∏–≤–Ω—ã–π (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–∞–º–∏–º —Å–æ–±–æ–π)' : 
																   settings?.interpretationMethod === 'criterion' ? '–ö—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏)' : '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
					</div>
					
					<h4>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º —Ä–∞–∑–≤–∏—Ç–∏—è</h4>
					<table>
						<thead>
							<tr>
								<th>–£—Ä–æ–≤–µ–Ω—å</th>
								<th>–î–∏–∞–ø–∞–∑–æ–Ω</th>
								<th>–ö–æ–ª-–≤–æ —É—á–∞—â–∏—Ö—Å—è</th>
								<th>% –æ—Ç –≥—Ä—É–ø–ø—ã</th>
								<th>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</th>
							</tr>
						</thead>
						<tbody>
							${levels.map(level => {
								const count = levelCounts[level.name] || 0;
								const percentage = (count / appData.students.length) * 100;
								return `
									<tr>
										<td style="color: ${level.color}; font-weight: bold;">${level.name}</td>
										<td>${level.min}-${level.max}%</td>
										<td>${count}</td>
										<td>${percentage.toFixed(1)}%</td>
										<td>${level.interpretation || ''}</td>
									</tr>
								`;
							}).join('')}
						</tbody>
					</table>
					
					${dimensionStats.length > 0 ? `
						<h4 style="margin-top: 20px;">üéØ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º</h4>
						<table>
							<thead>
								<tr>
									<th>–ò–∑–º–µ—Ä–µ–Ω–∏–µ</th>
									<th>–£—Ä–æ–≤–µ–Ω—å –≥—Ä—É–ø–ø—ã</th>
									<th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
									<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
								</tr>
							</thead>
							<tbody>
								${dimensionStats.map(dim => {
									let levelText = '';
									let levelColor = '';
									
									if (dim.percentage >= 85) {
										levelText = '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π';
										levelColor = '#27ae60';
									} else if (dim.percentage >= 70) {
										levelText = '–í—ã—Å–æ–∫–∏–π';
										levelColor = '#3498db';
									} else if (dim.percentage >= 50) {
										levelText = '–°—Ä–µ–¥–Ω–∏–π';
										levelColor = '#f39c12';
									} else if (dim.percentage >= 30) {
										levelText = '–ù–∏–∑–∫–∏–π';
										levelColor = '#e74c3c';
									} else {
										levelText = '–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π';
										levelColor = '#c0392b';
									}
									
									return `
										<tr>
											<td><strong>${dim.name}</strong></td>
											<td style="color: ${levelColor}; font-weight: bold;">${levelText}</td>
											<td>${dim.percentage.toFixed(1)}%</td>
											<td><small>${dim.description}</small></td>
										</tr>
									`;
								}).join('')}
							</tbody>
						</table>
					` : ''}
					
					${groupFeatures.length > 0 ? `
						<div class="recommendation-card" style="margin-top: 20px;">
							<h4>üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–æ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h4>
							<ul style="margin: 0; padding-left: 20px;">
								${groupFeatures.map(feature => `<li>${feature}</li>`).join('')}
							</ul>
						</div>
					` : ''}
					
					<div class="recommendation-card" style="margin-top: 20px;">
						<h4>üí° –ü—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
						${generatePsychologyRecommendationsText()}
					</div>
				</div>
			`;
		}

		function generatePsychologyRecommendationsText() {
			const totalScores = appData.results.map(scores => {
				const total = scores.reduce((sum, score) => sum + score, 0);
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				return (total / maxPossible) * 100;
			});
			
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			
			let recommendations = '';
			
			if (avgScore >= 70) {
				recommendations = `
					<p><strong>–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è –≥—Ä—É–ø–ø—ã.</strong> –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong></p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å</li>
						<li>–í–∫–ª—é—á–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è</li>
						<li>–†–∞–∑–≤–∏–≤–∞—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∏ –ª–∏–¥–µ—Ä—Å–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≥—Ä—É–ø–ø—ã –¥–ª—è –ø–æ–º–æ—â–∏ –æ—Ç—Å—Ç–∞—é—â–∏–º</li>
					</ul>
				`;
			} else if (avgScore >= 50) {
				recommendations = `
					<p><strong>–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è –≥—Ä—É–ø–ø—ã.</strong> –£—á–∞—â–∏–µ—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–µ, –Ω–æ –µ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤—ã –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è.</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong></p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∑–∞–Ω—è—Ç–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –º–∞–ª—ã—Ö –≥—Ä—É–ø–ø–∞—Ö</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</li>
						<li>–†–∞–∑–≤–∏–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏ —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</li>
					</ul>
				`;
			} else {
				recommendations = `
					<p><strong>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ.</strong> –í—ã—è–≤–ª–µ–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —É –≥—Ä—É–ø–ø—ã.</p>
					<p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</strong></p>
					<ul style="margin: 10px 0; padding-left: 20px;">
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</li>
						<li>–ü—Ä–∏–≤–ª–µ—á—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∫ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ</li>
						<li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —â–∞–¥—è—â–∏–µ –º–µ—Ç–æ–¥—ã –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</li>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü</li>
					</ul>
				`;
			}
			
			// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤
			const individualRisks = [];
			totalScores.forEach((score, index) => {
				if (score < 30) {
					individualRisks.push(appData.students[index]);
				}
			});
			
			if (individualRisks.length > 0) {
				recommendations += `
					<p><strong>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${individualRisks.length} —É—á–∞—â–∏–º—Å—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ (${individualRisks.slice(0, 3).join(', ')}${individualRisks.length > 3 ? ' –∏ –¥—Ä—É–≥–∏–µ' : ''})</p>
				`;
			}
			
			return recommendations;
		}
		
        // –ü–µ—á–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
        function printFullReport() {
			const printContent = generateFullReportForPrint();
			
			const printWindow = window.open('', '_blank');
			
			printWindow.document.write(`
				<!DOCTYPE html>
				<html>
				<head>
					<title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç - ${appData.test.theme || '–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞'}</title>
					<meta charset="UTF-8">
					<style>
						body { 
							font-family: 'Arial', sans-serif; 
							margin: 0; 
							padding: 15mm; 
							line-height: 1.4;
							color: #333;
							font-size: 12pt;
						}
						@page {
							size: A4;
							margin: 15mm;
						}
						.header { 
							text-align: center; 
							margin-bottom: 20px;
							padding-bottom: 15px;
							border-bottom: 2px solid #3498db;
							background: linear-gradient(135deg, #2c3e50, #3498db);
							color: white;
							padding: 20px;
							border-radius: 8px;
						}
						.section { 
							margin: 25px 0; 
							page-break-inside: avoid;
						}
						.section-title {
							color: #2c3e50;
							margin: 15px 0 10px 0;
							padding-bottom: 8px;
							border-bottom: 1px solid #3498db;
							font-size: 1.2em;
						}
						.stats-grid { 
							display: grid; 
							grid-template-columns: repeat(2, 1fr); 
							gap: 10px; 
							margin: 15px 0; 
						}
						.stat-card { 
							background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
							color: white; 
							padding: 15px; 
							border-radius: 8px; 
							text-align: center; 
							box-shadow: 0 3px 10px rgba(0,0,0,0.2);
						}
						.stat-value { 
							font-size: 1.6em; 
							font-weight: bold; 
							margin: 8px 0; 
						}
						.stat-label { 
							font-size: 0.8em; 
							opacity: 0.9; 
						}
						table { 
							width: 100%; 
							border-collapse: collapse; 
							margin: 10px 0;
							font-size: 10pt;
							page-break-inside: avoid;
						}
						th, td { 
							border: 1px solid #ddd; 
							padding: 8px; 
							text-align: left; 
						}
						th { 
							background-color: #34495e; 
							color: white; 
							font-weight: bold;
						}
						.kpi-grid { 
							display: grid; 
							grid-template-columns: repeat(4, 1fr); 
							gap: 10px; 
							margin: 15px 0; 
						}
						.kpi-card { 
							background: #f8f9fa; 
							padding: 12px; 
							border-radius: 6px; 
							text-align: center; 
							border-left: 4px solid #3498db; 
						}
						.kpi-card.success { border-left-color: #27ae60 !important; }
						.kpi-card.warning { border-left-color: #f39c12 !important; }
						.kpi-card.danger { border-left-color: #e74c3c !important; }

						.kpi-card.success .kpi-value { color: #27ae60; }
						.kpi-card.warning .kpi-value { color: #f39c12; }
						.kpi-card.danger .kpi-value { color: #e74c3c; }
						
						.psychology-level {
							display: inline-block;
							padding: 2px 8px;
							border-radius: 12px;
							font-size: 11px;
							margin: 2px;
							color: white;
						}
						.level-very-high { background: #27ae60; }
						.level-high { background: #3498db; }
						.level-medium { background: #f39c12; }
						.level-low { background: #e74c3c; }
						.level-very-low { background: #c0392b; }
						
						.recommendation-card {
							background: #e8f4fc;
							padding: 12px;
							margin: 8px 0;
							border-radius: 6px;
							border-left: 4px solid #3498db;
						}
						.task-analysis {
							background: #f8f9fa;
							padding: 10px;
							margin: 5px 0;
							border-radius: 4px;
							border-left: 3px solid #3498db;
						}
						.print-break { 
							page-break-before: always; 
						}
						.no-print { display: none; }
						.small-text { font-size: 10pt; }
						.text-center { text-align: center; }
						.grade-5 { background-color: #d4edda !important; }
						.grade-4 { background-color: #fff3cd !important; }
						.grade-3 { background-color: #ffeaa7 !important; }
						.grade-2 { background-color: #f8d7da !important; }
						/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π */
						.psychology-feature {
							display: inline-block;
							background: #f8f9fa;
							border: 1px solid #ddd;
							padding: 3px 8px;
							margin: 2px;
							border-radius: 4px;
							font-size: 10pt;
						}
						ul {
							margin: 10px 0;
							padding-left: 20px;
						}
						li {
							margin: 5px 0;
						}
						.dimension-table {
							margin: 15px 0;
						}
						.dimension-table td {
							vertical-align: top;
						}
						.interpretation-box {
							background: #f8f9fa;
							border-left: 4px solid #3498db;
							padding: 10px;
							margin: 10px 0;
							border-radius: 0 4px 4px 0;
						}
					</style>
				</head>
				<body>
					${printContent}
				</body>
				</html>
			`);
			
			printWindow.document.close();
			
			setTimeout(() => {
				printWindow.print();
				setTimeout(() => {
					printWindow.close();
				}, 500);
			}, 500);
		}

        function exportHTML() {
            const reportContent = generateFullReport();
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–∞–Ω–∞–ª–∏–∑_${appData.test.subject}_${appData.test.class}_${new Date().toLocaleDateString()}.html`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification("HTML –æ—Ç—á–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", "success");
        }

        function generateFullReport() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            const completionRate = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
            
            const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
            grades.forEach(grade => gradeCounts[grade]++);
            
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: ${appData.test.theme}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
            color: #333;
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            padding-bottom: 20px; 
            border-bottom: 2px solid #3498db; 
        }
        .section { 
            margin: 30px 0; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 10px; 
            text-align: left; 
        }
        th { 
            background-color: #34495e; 
            color: white; 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .stat-value { 
            font-size: 2em; 
            font-weight: bold; 
            margin: 10px 0; 
        }
        .stat-label { 
            font-size: 0.9em; 
            opacity: 0.9; 
        }
        .recommendation-card {
            background: #e8f4fc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .kpi-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .kpi-card { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center; 
            border-left: 4px solid #3498db; 
        }
		.kpi-card.success { border-left-color: #27ae60 !important; }
		.kpi-card.warning { border-left-color: #f39c12 !important; }
		.kpi-card.danger { border-left-color: #e74c3c !important; }

		.kpi-card.success .kpi-value { color: #27ae60; }
		.kpi-card.warning .kpi-value { color: #f39c12; }
		.kpi-card.danger .kpi-value { color: #e74c3c; }
        .print-break { 
            page-break-before: always; 
        }
		/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
		#literacyRadarChart {
			max-height: 400px !important;
			width: 100% !important;
			margin: 0 auto;
		}

		/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
		.chart-container {
			position: relative;
			height: 400px;
			min-height: 400px;
		}
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
        <h2>${appData.test.subject}, ${appData.test.class}</h2>
        <p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme} | <strong>–î–∞—Ç–∞:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
        <p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType].name}</p>
    </div>
    
    <div class="section">
        <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">${avgScore.toFixed(1)}</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${successRate.toFixed(1)}%</div>
                <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${qualityRate.toFixed(1)}%</div>
                <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${completionRate.toFixed(1)}%</div>
                <div class="stat-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[5]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 5</div>
            </div>
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[4]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 4</div>
            </div>
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[3]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 3</div>
            </div>
            <div class="kpi-card">
                <div style="font-size: 1.4em; font-weight: bold; color: #2c3e50;">${gradeCounts[2]}</div>
                <div style="color: #7f8c8d; font-size: 0.9em;">–û—Ü–µ–Ω–∫–∞ 2</div>
            </div>
        </div>
    </div>
    
    <div class="section print-break">
        <h3>üìà –¢–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
        ${document.getElementById('taxonomyAnalysis').innerHTML}
    </div>
    
    <div class="section">
        <h3>üí° –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        ${document.getElementById('keyConclusions').innerHTML}
        ${document.getElementById('correctionPlan').innerHTML}
        ${document.getElementById('nextSteps').innerHTML}
    </div>

    <div class="section">
        <p style="text-align: center; color: #7f8c8d; font-size: 0.9em;">
            –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()} —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        </p>
    </div>
</body>
</html>`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—á–∞—Ç–∏
        function printOptimizedReport() {
            const printWindow = window.open('', '_blank');
            const reportContent = generatePrintableReport();
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç - ${appData.test.theme}</title>
                    <meta charset="UTF-8">
                    <style>
                        body { 
                            font-family: 'Arial', sans-serif; 
                            margin: 0; 
                            padding: 15mm; 
                            line-height: 1.4;
                            color: #333;
                            font-size: 12pt;
                        }
                        @page {
                            size: A4;
                            margin: 15mm;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 20px;
                            padding-bottom: 15px;
                            border-bottom: 2px solid #3498db;
                        }
                        .stats-grid { 
                            display: grid; 
                            grid-template-columns: repeat(2, 1fr); 
                            gap: 10px; 
                            margin: 15px 0; 
                        }
                        .stat-card { 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; 
                            padding: 15px; 
                            border-radius: 8px; 
                            text-align: center; 
                            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                        }
                        .stat-value { 
                            font-size: 1.6em; 
                            font-weight: bold; 
                            margin: 8px 0; 
                        }
                        .stat-label { 
                            font-size: 0.8em; 
                            opacity: 0.9; 
                        }
                        .section { 
                            margin: 20px 0; 
                            page-break-inside: avoid;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 10px 0;
                            font-size: 10pt;
                            page-break-inside: avoid;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #34495e; 
                            color: white; 
                        }
                        .recommendation-card {
                            background: #e8f4fc;
                            padding: 12px;
                            margin: 8px 0;
                            border-radius: 6px;
                            border-left: 4px solid #3498db;
                        }
                        .no-print { display: none; }
                        .print-break { page-break-before: always; }
                        .small-text { font-size: 10pt; }
						/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
						#literacyRadarChart {
							max-height: 400px !important;
							width: 100% !important;
							margin: 0 auto;
						}

						/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
						.chart-container {
							position: relative;
							height: 400px;
							min-height: 400px;
						}
                    </style>
                </head>
                <body>
                    ${reportContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
        function generatePrintableReport() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
            const completionRate = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
            
            const gradeCounts = {5: 0, 4: 0, 3: 0, 2: 0};
            grades.forEach(grade => gradeCounts[grade]++);
            
            const taskAnalysis = appData.tasks.map((task, index) => {
                const completion = calculateTaskCompletion(index);
                let zone = '';
                let zoneColor = '';
                if (completion >= 90) { zone = '–û—Ç–ª–∏—á–Ω–∞—è'; zoneColor = '#27ae60'; }
                else if (completion >= 60) { zone = '–ó–µ–ª–µ–Ω–∞—è'; zoneColor = '#2ecc71'; }
                else if (completion >= 30) { zone = '–ñ–µ–ª—Ç–∞—è'; zoneColor = '#f39c12'; }
                else { zone = '–ö—Ä–∞—Å–Ω–∞—è'; zoneColor = '#e74c3c'; }
                
                return { task, index, completion, zone, zoneColor };
            });
            
            return `
                <div class="header">
                    <h1>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ</h1>
                    <h2>${appData.test.subject}, ${appData.test.class}</h2>
                    <p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme}</p>
                    <p><strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
                    <p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType].name}</p>
                </div>

                <div class="section">
                    <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${avgScore.toFixed(1)}</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${successRate.toFixed(1)}%</div>
                            <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${qualityRate.toFixed(1)}%</div>
                            <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${completionRate.toFixed(1)}%</div>
                            <div class="stat-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0;">
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #27ae60;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[5]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 5</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #2ecc71;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[4]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 4</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[3]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 3</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;">
                            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">${gradeCounts[2]}</div>
                            <div style="color: #7f8c8d; font-size: 0.8em;">–û—Ü–µ–Ω–∫–∞ 2</div>
                        </div>
                    </div>
                </div>

                <div class="section print-break">
                    <h3>üéØ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>–ó–∞–¥–∞–Ω–∏–µ</th>
                                <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                <th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                                <th>–ó–æ–Ω–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${taskAnalysis.map(item => `
                                <tr>
                                    <td>${item.index + 1}. ${item.task.type}</td>
                                    <td>${item.task.level}. ${complexityLevels[item.task.level].name}</td>
                                    <td>${item.completion.toFixed(1)}%</td>
                                    <td style="color: ${item.zoneColor}; font-weight: bold;">${item.zone}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h3>üí° –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                    <div class="recommendation-card">
                        ${generateKeyConclusionsText()}
                    </div>
                </div>

                <div class="section small-text">
                    <p><em>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()} —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</em></p>
                </div>
            `;
        }
		
		// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Ç–æ–≥–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã
		function updateFinalAnalysis() {
			let html = '<h3 class="section-title">üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>';
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
			const history = JSON.parse(localStorage.getItem('workHistory') || '[]')
				.filter(item => item.data.test.subject === appData.test.subject && 
							   item.data.test.class === appData.test.class)
				.sort((a, b) => new Date(a.data.test.testDate) - new Date(b.data.test.testDate));
			
			html += `
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${successRate.toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${qualityRate.toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSou().toFixed(1)}%</div>
						<div class="stat-label">–°–û–£</div>
					</div>
				</div>
			`;
			
			// –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è
			if (history.length > 1) {
				const currentSummary = generateWorkSummary();
				const firstSummary = history[0].summary;
				
				html += `
					<h4>üìà –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥</h4>
					<div class="comparative-grid">
						<div class="comparative-card">
							<h5>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h5>
							<div class="comparative-value ${currentSummary.avgScore > firstSummary.avgScore ? 'positive' : 'negative'}">
								${currentSummary.avgScore.toFixed(1)} 
								<span class="trend">${currentSummary.avgScore > firstSummary.avgScore ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ù–∞—á–∞–ª–æ: ${firstSummary.avgScore.toFixed(1)}</div>
						</div>
						<div class="comparative-card">
							<h5>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</h5>
							<div class="comparative-value ${currentSummary.successRate > firstSummary.successRate ? 'positive' : 'negative'}">
								${currentSummary.successRate.toFixed(1)}%
								<span class="trend">${currentSummary.successRate > firstSummary.successRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ù–∞—á–∞–ª–æ: ${firstSummary.successRate.toFixed(1)}%</div>
						</div>
						<div class="comparative-card">
							<h5>–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</h5>
							<div class="comparative-value ${currentSummary.qualityRate > firstSummary.qualityRate ? 'positive' : 'negative'}">
								${currentSummary.qualityRate.toFixed(1)}%
								<span class="trend">${currentSummary.qualityRate > firstSummary.qualityRate ? '‚Üó' : '‚Üò'}</span>
							</div>
							<div class="comparative-previous">–ù–∞—á–∞–ª–æ: ${firstSummary.qualityRate.toFixed(1)}%</div>
						</div>
					</div>
				`;
			}
			
			// –ê–Ω–∞–ª–∏–∑ –ø–æ —É—Ä–æ–≤–Ω—è–º —É—Å–≤–æ–µ–Ω–∏—è
			html += `
				<h4>üéØ –£—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</h4>
				<div class="kpi-grid">
					<div class="kpi-card" style="border-left-color: #27ae60">
						<div class="kpi-value">${countStudentsByLevel('high')}</div>
						<div class="kpi-label">–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ 80-100%</small>
					</div>
					<div class="kpi-card" style="border-left-color: #3498db">
						<div class="kpi-value">${countStudentsByLevel('medium')}</div>
						<div class="kpi-label">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ 60-79%</small>
					</div>
					<div class="kpi-card" style="border-left-color: #f39c12">
						<div class="kpi-value">${countStudentsByLevel('low')}</div>
						<div class="kpi-label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ 40-59%</small>
					</div>
					<div class="kpi-card" style="border-left-color: #e74c3c">
						<div class="kpi-value">${countStudentsByLevel('critical')}</div>
						<div class="kpi-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å</div>
						<small>–£—Å–≤–æ–∏–ª–∏ –º–µ–Ω–µ–µ 40%</small>
					</div>
				</div>
			`;
			
			// –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º
			html += generateKeyTopicsAnalysis();
			
			// –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã
			html += generatePedagogicalConclusions();
			
			document.getElementById('specializedAnalysis').innerHTML = html;
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —É—á–∞—â–∏—Ö—Å—è –ø–æ —É—Ä–æ–≤–Ω—è–º —É—Å–≤–æ–µ–Ω–∏—è
		function countStudentsByLevel(level) {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			
			const percentages = totalScores.map(score => (score / maxPossible) * 100);
			
			switch(level) {
				case 'high':
					return percentages.filter(p => p >= 80).length;
				case 'medium':
					return percentages.filter(p => p >= 60 && p < 80).length;
				case 'low':
					return percentages.filter(p => p >= 40 && p < 60).length;
				case 'critical':
					return percentages.filter(p => p < 40).length;
				default:
					return 0;
			}
		}

		// –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º
		function generateKeyTopicsAnalysis() {
			let html = '<h4>üìö –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º</h4>';
			
			// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ —Ç–µ–º–∞–º (–ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è)
			const topicStats = {};
			
			appData.tasks.forEach((task, taskIndex) => {
				const topic = task.knowledge || '–û–±—â–∞—è —Ç–µ–º–∞';
				if (!topicStats[topic]) {
					topicStats[topic] = {
						completion: 0,
						count: 0,
						tasks: []
					};
				}
				
				const completion = calculateTaskCompletion(taskIndex);
				topicStats[topic].completion += completion;
				topicStats[topic].count++;
				topicStats[topic].tasks.push(taskIndex + 1);
			});
			
			// –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —Ç–µ–º–∞–º
			Object.keys(topicStats).forEach(topic => {
				topicStats[topic].completion = topicStats[topic].completion / topicStats[topic].count;
			});
			
			// –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–µ–º—ã –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
			const sortedTopics = Object.entries(topicStats)
				.sort(([,a], [,b]) => a.completion - b.completion);
			
			html += '<div class="table-container"><table>';
			html += '<thead><tr><th>–¢–µ–º–∞</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
			
			sortedTopics.forEach(([topic, stats]) => {
				let status = '';
				let statusIcon = '';
				
				if (stats.completion >= 80) {
					status = '–£—Å–≤–æ–µ–Ω–∞';
					statusIcon = 'üü¢';
				} else if (stats.completion >= 60) {
					status = '–ß–∞—Å—Ç–∏—á–Ω–æ —É—Å–≤–æ–µ–Ω–∞';
					statusIcon = 'üü°';
				} else if (stats.completion >= 40) {
					status = '–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏';
					statusIcon = 'üü†';
				} else {
					status = '–ü—Ä–æ–±–ª–µ–º–Ω–∞—è';
					statusIcon = 'üî¥';
				}
				
				html += `
					<tr>
						<td>${topic}</td>
						<td>${stats.tasks.join(', ')}</td>
						<td>${stats.completion.toFixed(1)}%</td>
						<td>${statusIcon} ${status}</td>
					</tr>
				`;
			});
			
			html += '</tbody></table></div>';
			
			return html;
		}

		// –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã
		function generatePedagogicalConclusions() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const percentage = (avgScore / maxPossible) * 100;
			
			let html = '<h4>üí° –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã</h4>';
			html += '<div class="recommendation-card">';
			
			if (percentage >= 80) {
				html += '<strong>‚úÖ –í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è</strong><br>';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É—é—Ç –æ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ —É—Å–≤–æ–µ–Ω–∏—è —É—á–µ–±–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞. ';
				html += '<strong>–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:</strong><br>';
				html += '‚Ä¢ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å –≤ –∏–∑—É—á–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞<br>';
				html += '‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω—è–µ–º—ã—Ö –º–µ—Ç–æ–¥–∏–∫<br>';
				html += '‚Ä¢ –•–æ—Ä–æ—à–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è —É—á–∞—â–∏—Ö—Å—è<br>';
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>';
				html += '‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫<br>';
				html += '‚Ä¢ –í–Ω–µ–¥—Ä—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è<br>';
				html += '‚Ä¢ –†–∞–∑–≤–∏–≤–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏<br>';
			} else if (percentage >= 60) {
				html += '<strong>üü° –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è</strong><br>';
				html += '–£—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª —É—Å–≤–æ–µ–Ω –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ. ';
				html += '<strong>–ù–∞–±–ª—é–¥–µ–Ω–∏—è:</strong><br>';
				html += '‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π<br>';
				html += '‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è —Å–ª–∞–±–æ—É—Å–ø–µ–≤–∞—é—â–∏—Ö<br>';
				html += '‚Ä¢ –ù—É–∂–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—Ç—å —Ñ–æ—Ä–º—ã —Ä–∞–±–æ—Ç—ã<br>';
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>';
				html += '‚Ä¢ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Ñ–æ—Ä–º —Ä–∞–±–æ—Ç—ã<br>';
				html += '‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è<br>';
				html += '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤<br>';
			} else if (percentage >= 40) {
				html += '<strong>üü† –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞</strong><br>';
				html += '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö. ';
				html += '<strong>–ü—Ä–æ–±–ª–µ–º—ã:</strong><br>';
				html += '‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —É—Å–≤–æ–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏–π<br>';
				html += '‚Ä¢ –ù–∏–∑–∫–∞—è —É—á–µ–±–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è<br>';
				html += '‚Ä¢ –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–∏—Ö –º–µ—Ç–æ–¥–∏–∫<br>';
				html += '<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>';
				html += '‚Ä¢ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –æ–±—ä—è—Å–Ω–µ–Ω–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–∞<br>';
				html += '‚Ä¢ –£—Å–∏–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã<br>';
				html += '‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –≤ —É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å<br>';
			} else {
				html += '<strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤ –æ–±—É—á–µ–Ω–∏–∏</strong><br>';
				html += '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ. ';
				html += '<strong>–ü—Ä–∏—á–∏–Ω—ã:</strong><br>';
				html += '‚Ä¢ –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –∑–Ω–∞–Ω–∏—è—Ö<br>';
				html += '‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—á–µ–±–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã<br>';
				html += '‚Ä¢ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ—Ç–æ–¥–∏–∫ —É—Ä–æ–≤–Ω—é –∫–ª–∞—Å—Å–∞<br>';
				html += '<strong>–°—Ä–æ—á–Ω—ã–µ –º–µ—Ä—ã:</strong><br>';
				html += '‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º<br>';
				html += '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π<br>';
				html += '‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –º–µ—Ç–æ–¥–∏—Å—Ç–æ–º<br>';
			}
			
			html += '</div>';
			
			// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
			html += `
				<div class="recommendation-card">
					<h5>üìÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
					<ul>
						<li>–£—á–µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—á–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥</li>
						<li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ-—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
						<li>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–µ–º –≤ –Ω–∞—á–∞–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è —Å–ª–∞–±–æ—É—Å–ø–µ–≤–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–Ω–∞–Ω–∏–π</li>
					</ul>
				</div>
			`;
			
			return html;
		}

		// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ –≤–∞—à JavaScript –∫–æ–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–¥ updateVisualization()
		function debugCharts() {
			console.log('=== –û–¢–õ–ê–î–ö–ê –ì–†–ê–§–ò–ö–û–í ===');
			console.log('Chart.js –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof Chart !== 'undefined');
			console.log('Chart –≤–µ—Ä—Å–∏—è:', Chart ? Chart.version : '–Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
			
			console.log('\nCanvas —ç–ª–µ–º–µ–Ω—Ç—ã:');
			const canvasIds = ['gradesChart', 'solvabilityChart', 'complexityChart'];
			canvasIds.forEach(id => {
				const canvas = document.getElementById(id);
				console.log(`- ${id}:`, canvas);
				if (canvas) {
					console.log(`  –†–∞–∑–º–µ—Ä: ${canvas.width}x${canvas.height}`);
					console.log(`  –°—Ç–∏–ª—å:`, canvas.style.cssText);
				}
			});
			
			console.log('\n–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:');
			canvasIds.forEach(id => {
				const canvas = document.getElementById(id);
				if (canvas) {
					console.log(`- ${id} —Ä–æ–¥–∏—Ç–µ–ª—å:`, canvas.parentElement);
					console.log(`  –í–∏–¥–∏–º—ã–π:`, canvas.parentElement ? canvas.parentElement.offsetParent !== null : '–Ω–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è');
				}
			});
			
			console.log('\n–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:');
			console.log('- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:', appData.results ? appData.results.length : '–Ω–µ—Ç');
			console.log('- –ó–∞–¥–∞–Ω–∏—è:', appData.tasks ? appData.tasks.length : '–Ω–µ—Ç');
			console.log('- –°—Ç—É–¥–µ–Ω—Ç—ã:', appData.students ? appData.students.length : '–Ω–µ—Ç');
			
			console.log('\ncomplexityLevels:', complexityLevels);
			
			console.log('\n–¢–µ–∫—É—â–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤:');
			const chartInstances = [
				'gradesChartInstance',
				'complexityChartInstance',
				'solvabilityChartInstance'
			];
			chartInstances.forEach(name => {
				console.log(`- ${name}:`, window[name]);
			});
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
			if (appData.results && appData.results.length > 0 && appData.tasks && appData.tasks.length > 0) {
				console.log('\n–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è:');
				const firstTaskScores = appData.results.map(student => student[0] || 0);
				console.log('- –û—Ü–µ–Ω–∫–∏:', firstTaskScores);
				console.log('- –ú–∞–∫—Å –±–∞–ª–ª:', appData.tasks[0].maxScore);
			}
		}

		// –¢–∞–∫–∂–µ –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
		function testChart() {
			console.log('=== –¢–ï–°–¢–û–í–´–ô –ì–†–ê–§–ò–ö ===');
			
			// –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
			const testCanvas = document.createElement('canvas');
			testCanvas.id = 'testChart';
			testCanvas.style.width = '400px';
			testCanvas.style.height = '300px';
			document.body.appendChild(testCanvas);
			
			const ctx = testCanvas.getContext('2d');
			const testChart = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: ['–¢–µ—Å—Ç 1', '–¢–µ—Å—Ç 2', '–¢–µ—Å—Ç 3'],
					datasets: [{
						label: '–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ',
						data: [10, 20, 30],
						backgroundColor: ['#ff6384', '#36a2eb', '#cc65fe']
					}]
				}
			});
			
			console.log('–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω:', testChart);
			console.log('–ï—Å–ª–∏ —ç—Ç–æ—Ç –≥—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –∑–Ω–∞—á–∏—Ç Chart.js —Ä–∞–±–æ—Ç–∞–µ—Ç');
			
			// –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
			setTimeout(() => {
				testChart.destroy();
				testCanvas.remove();
				console.log('–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —É–¥–∞–ª–µ–Ω');
			}, 5000);
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
		function drawSimpleGradesChart() {
			console.log('=== –ü–†–û–°–¢–û–ô –ì–†–ê–§–ò–ö –û–¶–ï–ù–û–ö ===');
			
			const canvas = document.getElementById('gradesChart');
			if (!canvas) {
				console.error('Canvas gradesChart –Ω–µ –Ω–∞–π–¥–µ–Ω!');
				// –ü—Ä–æ–≤–µ—Ä–∏–º, –≥–¥–µ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
				const container = document.querySelector('[id*="grade"], [class*="grade"]');
				console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:', container);
				return;
			}
			
			console.log('Canvas –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫...');
			
			// –ü—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
			const testData = {
				labels: ['5', '4', '3', '2'],
				datasets: [{
					data: [5, 10, 7, 3],
					backgroundColor: ['#27ae60', '#2ecc71', '#f39c12', '#e74c3c']
				}]
			};
			
			const ctx = canvas.getContext('2d');
			try {
				window.gradesChartInstance = new Chart(ctx, {
					type: 'pie',
					data: testData,
					options: {
						responsive: true,
						plugins: {
							title: {
								display: true,
								text: '–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫'
							}
						}
					}
				});
				console.log('–¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞:', error);
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã
		function generateFinalSpecializedReport() {
			updateFinalAnalysis();
			const analysisContent = document.getElementById('specializedAnalysis').innerHTML;
			
			return `
				<h3>üìä –ò—Ç–æ–≥–æ–≤—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
				<p>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ —É—á–µ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –≤—ã–≤–æ–¥–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculateAverageScore().toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateQualityRate().toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSou().toFixed(1)}%</div>
						<div class="stat-label">–°–û–£</div>
					</div>
				</div>
				
				${analysisContent}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üéØ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è</h4>
					<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>
					<ul>
						<li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–µ–±–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —É—á–µ—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π</li>
						<li>–í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–ü–æ–≤—ã—Å–∏—Ç—å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</li>
						<li>–ê–∫—Ç–∏–≤–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –ø–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—é –æ–±—É—á–µ–Ω–∏—è</li>
					</ul>
				</div>
			`;
		}
		
		
        // –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–ª—é—á–µ–≤—ã—Ö –≤—ã–≤–æ–¥–æ–≤ –¥–ª—è –ø–µ—á–∞—Ç–∏
		function generateKeyConclusionsText() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			
			let conclusions = '';
			
			if (appData.test.workType === 'psychology') {
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				const avgPercentage = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
				
				const levels = appData.test.psychologySettings?.levels || [];
				let dominantLevel = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
				
				for (let level of levels) {
					const count = totalScores.filter(score => {
						const percentage = (score / maxPossible) * 100;
						return percentage >= level.min && percentage <= level.max;
					}).length;
					
					if (count >= totalScores.length * 0.4) { // –ï—Å–ª–∏ 40% –∏ –±–æ–ª–µ–µ –≤ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ
						dominantLevel = level.name;
						break;
					}
				}
				
				conclusions = `
					<strong>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –≥—Ä—É–ø–ø—ã:</strong> ${dominantLevel} —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–≤–∏—Ç–∏—è<br>
					<strong>–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å:</strong> ${avgPercentage.toFixed(1)}%<br>
					<strong>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</strong> ${grades.filter(g => g === 5).length} —á–µ–ª. - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å, 
					${grades.filter(g => g === 4).length} —á–µ–ª. - –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ,
					${grades.filter(g => g === 3).length} —á–µ–ª. - —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å,
					${grades.filter(g => g <= 2).length} —á–µ–ª. - –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å<br>
				`;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
				if (appData.test.psychologySettings?.dimensions) {
					const dimensions = appData.test.psychologySettings.dimensions;
					const weakestDimension = findWeakestDimension();
					if (weakestDimension) {
						conclusions += `<strong>–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:</strong> ${weakestDimension.name} (${weakestDimension.percentage.toFixed(1)}%)<br>`;
					}
				}
			} else {
				// –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç
				if (successRate >= 80) {
					conclusions = '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
					conclusions += '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å —Ä–∞–±–æ—Ç–æ–π. ';
				} else if (successRate >= 60) {
					conclusions = '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
					conclusions += '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ —É—á–∞—â–∏—Ö—Å—è. ';
				} else {
					conclusions = '<strong>üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong><br>';
					conclusions += '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç–æ–¥—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ. ';
				}
				
				const difficultTasks = [];
				appData.tasks.forEach((task, index) => {
					const completion = calculateTaskCompletion(index);
					if (completion < 50) {
						difficultTasks.push({ task: index + 1, completion: completion, type: task.type });
					}
				});
				
				if (difficultTasks.length > 0) {
					conclusions += `<br><strong>–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:</strong> `;
					conclusions += difficultTasks.map(t => `‚Ññ${t.task} (${t.completion.toFixed(1)}%)`).join(', ');
				}
				
				if (appData.errors.length > 0) {
					const topErrorType = getTopErrorType();
					conclusions += `<br><strong>–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–µ –æ—à–∏–±–∫–∏:</strong> ${errorTypes[topErrorType].name}`;
				}
			}
			
			return conclusions;
		}

		function findWeakestDimension() {
			if (!appData.test.psychologySettings?.dimensions) return null;
			
			const dimensions = appData.test.psychologySettings.dimensions;
			let weakest = null;
			let minPercentage = 100;
			
			dimensions.forEach(dimension => {
				const dimensionTasks = appData.tasks.filter(task => task.dimension === dimension.id);
				if (dimensionTasks.length === 0) return;
				
				let totalScore = 0;
				let totalMax = 0;
				
				dimensionTasks.forEach(task => {
					const taskIndex = appData.tasks.indexOf(task);
					const maxScore = task.maxScore;
					const actualScores = appData.results.map(student => student[taskIndex] || 0);
					const actualTotal = actualScores.reduce((sum, score) => sum + score, 0);
					
					totalScore += actualTotal;
					totalMax += maxScore * appData.results.length;
				});
				
				const percentage = totalMax > 0 ? (totalScore / totalMax) * 100 : 0;
				if (percentage < minPercentage) {
					minPercentage = percentage;
					weakest = { name: dimension.name, percentage: percentage };
				}
			});
			
			return weakest;
		}
        function updateReportPreview() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            
            document.getElementById('reportPreview').innerHTML = `
                <div class="recommendation-card">
                    <h4>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h4>
                    <p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${appData.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p><strong>–ö–ª–∞—Å—Å:</strong> ${appData.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p><strong>–¢–µ–º–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                    <p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[appData.test.workType].name}</p>
                    <p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${appData.students.length} –∏–∑ ${appData.test.presentStudents}</p>
                    <p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${appData.tasks.length}</p>
                    <p><strong>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong> ${totalScores.length > 0 ? avgScore.toFixed(1) : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</p>
                </div>
            `;
        }
        
        // –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç


		// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –í–ü–†
		function generateVPRSpecializedReport() {
			updateVPRAnalysis();
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const grades = totalScores.map(score => calculateGrade(score));
			const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
			const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
			
			// –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –í–ü–†
			const vprCriteriaAnalysis = analyzeVPRCriteria();
			
			return `
				<h3>üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>
				<p>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –í–ü–† —Å –æ—Ü–µ–Ω–∫–æ–π —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculateAverageScore().toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${successRate.toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${qualityRate.toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${appData.students.length}</div>
						<div class="stat-label">–£—á–∞—â–∏—Ö—Å—è</div>
					</div>
				</div>
				
				${vprCriteriaAnalysis}
				
				<div class="section-title">üéØ –û—Ü–µ–Ω–∫–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</div>
				${document.getElementById('specializedAnalysis').innerHTML}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üìã –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
					<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –í–ü–† —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>
					<ul>
						<li>–í–∫–ª—é—á–∏—Ç—å –≤ —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–≥—É–ª—è—Ä–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ –í–ü–†</li>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —É—á–∞—â–∏—Ö—Å—è —Å –Ω–∏–∑–∫–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</li>
						<li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫—É—é —Ä–∞–±–æ—Ç—É –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –í–ü–†</li>
						<li>–û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏</li>
					</ul>
				</div>
			`;
		}

		// –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –í–ü–†
		function analyzeVPRCriteria() {
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const avgPercentage = (totalScores.reduce((sum, score) => sum + score, 0) / (maxPossible * totalScores.length)) * 100;
			
			let html = '<div class="recommendation-card">';
			html += '<h4>üìà –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –í–ü–†</h4>';
			
			if (avgPercentage >= 80) {
				html += '<strong>‚úÖ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–ö–ª–∞—Å—Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –í–ü–†. ';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç —Å—Ä–µ–¥–Ω–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏.';
			} else if (avgPercentage >= 60) {
				html += '<strong>üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–ö–ª–∞—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–∞–∑–æ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –í–ü–†. ';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ä–µ–¥–Ω–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π.';
			} else if (avgPercentage >= 40) {
				html += '<strong>üü† –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å–∏–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–µ–ª—ã –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –í–ü–†. ';
				html += '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏.';
			} else {
				html += '<strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</strong><br>';
				html += '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. ';
				html += '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ –±–∞–∑–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –í–ü–†.';
			}
			
			html += `<br><strong>–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${avgPercentage.toFixed(1)}%`;
			html += '</div>';
			
			return html;
		}

		function generateLiteracySpecializedReport() {
			updateLiteracyAnalysis();
			
			const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
			const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
			const avgPercentage = (avgScore / maxPossible) * 100;
			
			// –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
			const overallLevel = analyzeOverallLiteracyLevel(avgPercentage);
			
			return `
				<h3>üéØ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h3>
				<p>–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –∂–∏–∑–Ω–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –æ–±—â–µ—Å—Ç–≤–µ.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${avgScore.toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${avgPercentage.toFixed(1)}%</div>
						<div class="stat-label">–û–±—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${overallLevel.level}</div>
						<div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${appData.tasks.length}</div>
						<div class="stat-label">–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –æ—Ü–µ–Ω–µ–Ω–æ</div>
					</div>
				</div>
				
				<div class="recommendation-card">
					<h4>üìà –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —É—Ä–æ–≤–Ω—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
					<p><strong>${overallLevel.title}</strong></p>
					<p>${overallLevel.description}</p>
					<p><strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:</strong> ${overallLevel.interpretation}</p>
				</div>
				
				<div class="section-title">üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π</div>
				${document.getElementById('specializedAnalysis').innerHTML}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üìã –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–∏—Ç–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h4>
					<p>–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:</p>
					<ul>
						<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≤–∏—Ç–∏—è –¥–ª—è —É—á–∞—â–∏—Ö—Å—è</li>
						<li>–í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</li>
						<li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –ø–µ–¥–∞–≥–æ–≥–æ–≤</li>
						<li>–°–æ–∑–¥–∞—Ç—å –±–∞–Ω–∫ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∏–¥–æ–≤ –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</li>
						<li>–û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏</li>
					</ul>
				</div>
			`;
		}
		
		// ==================== –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• ====================
		
		// 1. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª JSON
		function exportToFile() {
			try {
				// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
				const dataToExport = {
					appData: appData,
					timestamp: new Date().toISOString(),
					version: '1.0',
					metadata: {
						exportedBy: '–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
						exportedAt: new Date().toLocaleString('ru-RU'),
						subject: appData.test.subject,
						class: appData.test.class,
						workType: appData.test.workType,
						studentCount: appData.students.length,
						taskCount: appData.tasks.length,
						theme: appData.test.theme
					}
				};
				
				const dataStr = JSON.stringify(dataToExport, null, 2);
				const blob = new Blob([dataStr], { type: 'application/json' });
				const url = URL.createObjectURL(blob);
				
				const a = document.createElement('a');
				a.href = url;
				a.download = generateExportFilename();
				a.click();
				
				URL.revokeObjectURL(url);
				
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª', 'success');
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º —ç–∫—Å–ø–æ—Ä—Ç–µ
				saveExportHistory();
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
			}
		}

		// –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
		function createTestImportFile() {
			const testData = {
				test: {
					subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
					class: "5–ê",
					testDate: new Date().toISOString().split('T')[0],
					theme: "–¢–µ—Å—Ç–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞",
					goals: "–¢–µ—Å—Ç–æ–≤—ã–µ —Ü–µ–ª–∏",
					workType: "current",
					workFormat: "mixed",
					timeLimit: 45,
					totalStudents: 25,
					presentStudents: 23,
					absentReason: "",
					criteria: {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					}
				},
				tasks: [
					{ type: "–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1", maxScore: 2, level: 1, knowledge: "—Ç–µ—Å—Ç" },
					{ type: "–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2", maxScore: 3, level: 2, knowledge: "—Ç–µ—Å—Ç" }
				],
				students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î."],
				results: [
					[2, 3],
					[1, 2],
					[2, 3]
				],
				errors: [],
				_metadata: {
					exportedAt: new Date().toLocaleString('ru-RU'),
					system: '–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
					version: '1.0'
				}
			};
			
			const dataStr = JSON.stringify(testData, null, 2);
			
			// –î–æ–±–∞–≤–ª—è–µ–º BOM –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8
			const BOM = '\uFEFF';
			const blob = new Blob([BOM + dataStr], { 
				type: 'application/json;charset=utf-8' 
			});
			
			const url = URL.createObjectURL(blob);
			
			const a = document.createElement('a');
			a.href = url;
			a.download = '—Ç–µ—Å—Ç–æ–≤—ã–π_—Ñ–∞–π–ª_–¥–ª—è_–∏–º–ø–æ—Ä—Ç–∞.json';
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			
			URL.revokeObjectURL(url);
			
			showNotification('–¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω', 'success');
		}

		// –ó–ê–ú–ï–ù–ò–¢–ï –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ
		//document.addEventListener('DOMContentLoaded', function() {
		//	setTimeout(() => {
		//		addFixedTransferButtons();
		//	}, 1000);
		//});

		// 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
		function generateExportFilename() {
			const date = new Date().toISOString().split('T')[0];
			const time = new Date().toTimeString().split(' ')[0].replace(/:/g, '-');
			const subject = appData.test.subject || '–ø—Ä–µ–¥–º–µ—Ç';
			const className = appData.test.class || '–∫–ª–∞—Å—Å';
			
			return `–∞–Ω–∞–ª–∏–∑_${subject}_${className}_${date}_${time}.json`;
		}

		// 3. –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
		function importFromFile() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json,.txt,application/json';
			
			input.onchange = function(event) {
				const file = event.target.files[0];
				if (!file) return;
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
				showNotification('–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...', 'info');
				
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const content = e.target.result;
						console.log('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:', content.length, '—Å–∏–º–≤–æ–ª–æ–≤');
						
						const importedData = JSON.parse(content);
						console.log('–ü–∞—Ä—Å–∏–Ω–≥ JSON —É—Å–ø–µ—à–µ–Ω');
						
						// –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
						if (validateImportedData(importedData)) {
							console.log('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é');
							showImportConfirmationDialog(importedData);
						} else {
							console.error('–î–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é');
							
							// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
							if (alternativeValidate(importedData)) {
								console.log('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—à–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é');
								showImportConfirmationDialog(importedData);
								return;
							}
							
							// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
							let errorHtml = `
								<h3>‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
								<p>–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞.</p>
								
								<div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 15px 0;">
									<h4>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:</h4>
									<ol>
										<li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –±—ã–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã</li>
										<li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é</li>
										<li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–Ω–æ–≤–∞</li>
										<li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å UTF-8)</li>
									</ol>
								</div>
							`;
							
							// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
							errorHtml += `
								<div class="form-group">
									<h4>–ü–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤ —Ñ–∞–π–ª–∞:</h4>
									<div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 10px;">
										${content.substring(0, 1000).replace(/</g, '&lt;').replace(/>/g, '&gt;')}
									</div>
								</div>
							`;
							
							errorHtml += `
								<div style="margin-top: 20px;">
									<button class="btn btn-warning" onclick="tryForceImport('${content.replace(/'/g, "\\'").substring(0, 5000)}')">
										–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç
									</button>
									<button class="btn" onclick="hideModal()" style="margin-left: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
								</div>
							`;
							
							showModal('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞', errorHtml);
						}
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error);
						
						let errorMessage = `
							<h3>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞</h3>
							<p><strong>${error.name}:</strong> ${error.message}</p>
							
							<div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 15px 0;">
								<h4>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</h4>
								<ul>
									<li>–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω</li>
									<li>–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (–Ω–µ JSON)</li>
									<li>–§–∞–π–ª –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é</li>
									<li>–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å UTF-8)</li>
								</ul>
							</div>
							
							<div class="form-group">
								<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞:</h4>
								<div style="background: #f8f9fa; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 10px;">
									${file.name}<br>
									–†–∞–∑–º–µ—Ä: ${file.size} –±–∞–π—Ç<br>
									–¢–∏–ø: ${file.type || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}
								</div>
							</div>
						`;
						
						errorMessage += `
							<div style="margin-top: 20px;">
								<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
							</div>
						`;
						
						showModal('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞', errorMessage);
					}
				};
				
				reader.onerror = function(e) {
					console.error('–û—à–∏–±–∫–∞ FileReader:', e);
					showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
				};
				
				reader.readAsText(file, 'UTF-8');
			};
			
			input.click();
		}

		// –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø (–±–æ–ª–µ–µ –º—è–≥–∫–∞—è)
		function alternativeValidate(data) {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
				if (!data) return false;
				
				// –í–∞—Ä–∏–∞–Ω—Ç 1: –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å appData
				if (data.appData && typeof data.appData === 'object') {
					const appData = data.appData;
					if (appData.test && appData.tasks && appData.students && appData.results) {
						return true;
					}
				}
				
				// –í–∞—Ä–∏–∞–Ω—Ç 2: —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –±–µ–∑ appData
				if (data.test && data.tasks && data.students && data.results) {
					return true;
				}
				
				// –í–∞—Ä–∏–∞–Ω—Ç 3: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
				if (Array.isArray(data.tasks) && Array.isArray(data.students)) {
					return true;
				}
				
				return false;
			} catch (error) {
				return false;
			}
		}

		// –§–£–ù–ö–¶–ò–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –ò–ú–ü–û–†–¢–ê
		function tryForceImport(content) {
			try {
				// –ü—Ä–æ–±—É–µ–º –æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
				let cleanedContent = content;
				
				// –£–¥–∞–ª—è–µ–º BOM (–±–∞–π—Ç–æ–≤—É—é –º–µ—Ç–∫—É –ø–æ—Ä—è–¥–∫–∞)
				if (cleanedContent.charCodeAt(0) === 0xFEFF) {
					cleanedContent = cleanedContent.substring(1);
				}
				
				// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
				let importedData;
				
				try {
					// –ú–µ—Ç–æ–¥ 1: –æ–±—ã—á–Ω—ã–π JSON.parse
					importedData = JSON.parse(cleanedContent);
				} catch (e1) {
					try {
						// –ú–µ—Ç–æ–¥ 2: –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
						cleanedContent = cleanedContent
							.replace(/\r\n/g, '\n') // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫
							.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, ''); // –£–¥–∞–ª—è–µ–º —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã
						
						importedData = JSON.parse(cleanedContent);
					} catch (e2) {
						try {
							// –ú–µ—Ç–æ–¥ 3: –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ JSON –≤ —Ç–µ–∫—Å—Ç–µ
							const jsonMatch = cleanedContent.match(/\{.*\}/s);
							if (jsonMatch) {
								importedData = JSON.parse(jsonMatch[0]);
							} else {
								throw new Error('JSON –Ω–µ –Ω–∞–π–¥–µ–Ω');
							}
						} catch (e3) {
							showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞–Ω–Ω—ã–µ', 'error');
							return;
						}
					}
				}
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞
				hideModal();
				setTimeout(() => {
					showImportConfirmationDialog(importedData);
				}, 100);
				
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ: ' + error.message, 'error');
			}
		}


		// –£–ü–†–û–©–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –≠–ö–°–ü–û–†–¢–ê/–ò–ú–ü–û–†–¢–ê (–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
		function simpleImportExport() {
			const html = `
				<div style="text-align: center; padding: 20px;">
					<h3>üîÑ –ü—Ä–æ—Å—Ç–æ–π –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="margin: 30px 0;">
						<h4>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
						<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON —Ñ–∞–π–ª</p>
						<button class="btn btn-success" onclick="simpleExport()" style="width: 100%; margin-bottom: 20px;">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
						
						<h4>üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
						<p>–ó–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON —Ñ–∞–π–ª–∞ (–ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞)</p>
						<button class="btn btn-warning" onclick="simpleImport()" style="width: 100%;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
					</div>
					
					<div style="background: #e8f4fc; padding: 15px; border-radius: 8px; text-align: left;">
						<h5>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h5>
						<ol>
							<li>–ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ê: —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ</li>
							<li>–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ë (—Ñ–ª–µ—à–∫–∞, email, –æ–±–ª–∞–∫–æ)</li>
							<li>–ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ë: –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ</li>
							<li>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–∞–±–æ—Ç—É</li>
						</ol>
					</div>
				</div>
			`;
			
			showModal('–ü—Ä–æ—Å—Ç–æ–π –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç', html);
		}

		// –ü–†–û–°–¢–û–ô –≠–ö–°–ü–û–†–¢
		function simpleExport() {
			try {
				const data = {
					test: appData.test,
					tasks: appData.tasks,
					students: appData.students,
					results: appData.results,
					errors: appData.errors,
					timestamp: new Date().toISOString()
				};
				
				const dataStr = JSON.stringify(data, null, 2);
				const blob = new Blob([dataStr], { type: 'application/json' });
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = `–¥–∞–Ω–Ω—ã–µ_${appData.test.subject || '–ø—Ä–µ–¥–º–µ—Ç'}_${new Date().toLocaleDateString()}.json`;
				a.click();
				URL.revokeObjectURL(url);
				
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message, 'error');
			}
		}

		// –ü–†–û–°–¢–û–ô –ò–ú–ü–û–†–¢
		function simpleImport() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json';
			
			input.onchange = function(e) {
				const file = e.target.files[0];
				const reader = new FileReader();
				
				reader.onload = function(event) {
					try {
						const importedData = JSON.parse(event.target.result);
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
						if (importedData.test && importedData.tasks && importedData.students) {
							appData = importedData;
							saveData();
							renderAll();
							showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
						} else {
							showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
						}
					} catch (error) {
						showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message, 'error');
					}
				};
				
				reader.readAsText(file);
			};
			
			input.click();
		}
		
		// 5. –î–ò–ê–õ–û–ì –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ò–ú–ü–û–†–¢–ê
		function showImportConfirmationSimple(dataToImport, exportInfo = {}) {
			const studentCount = dataToImport.students?.length || 0;
			const taskCount = dataToImport.tasks?.length || 0;
			const subject = dataToImport.test?.subject || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const className = dataToImport.test?.class || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const exportDate = exportInfo.date || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
			
			const html = `
				<div style="max-width: 600px;">
					<h3>üîÑ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${subject}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${studentCount}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${taskCount}</p>
						<p><strong>–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:</strong> ${exportDate}</p>
						<p><strong>–í–µ—Ä—Å–∏—è:</strong> ${exportInfo.version || '1.0'}</p>
					</div>
					
					<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
						<h4>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h4>
						<p>–í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					</div>
					
					<div class="form-group">
						<label>
							<input type="radio" name="importMode" value="replace" checked>
							–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
						</label>
						<small style="display: block; color: #666; margin-left: 20px;">
							–ó–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
						</small>
					</div>
					
					<div class="form-group">
						<label>
							<input type="radio" name="importMode" value="merge">
							–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ)
						</label>
						<small style="display: block; color: #666; margin-left: 20px;">
							–ü–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
						</small>
					</div>
				</div>
			`;
			
			showModal('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="performImport('${encodeURIComponent(JSON.stringify(dataToImport))}')">
						–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
					</button>
				</div>
			`);
		}

		// 6. –í–´–ü–û–õ–ù–ï–ù–ò–ï –ò–ú–ü–û–†–¢–ê
		function performImport(encodedData) {
			try {
				// –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
				const jsonString = decodeURIComponent(encodedData);
				const dataToImport = JSON.parse(jsonString);
				
				// –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
				const importMode = document.querySelector('input[name="importMode"]:checked').value;
				
				if (importMode === 'replace') {
					// –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞
					appData = JSON.parse(JSON.stringify(dataToImport));
				} else if (importMode === 'merge') {
					// –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
					mergeData(dataToImport);
				}
				
				// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã
				syncDataArrays();
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º
				saveData();
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
				renderAll();
				
				// –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
				hideModal();
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
				showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:', error);
				showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ: ' + error.message, 'error');
			}
		}

		// 7. –û–ë–™–ï–î–ò–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•
		function mergeData(newData) {
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
			const oldData = JSON.parse(JSON.stringify(appData));
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞ (–Ω–æ–≤—ã–µ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
			appData.test = { ...oldData.test, ...newData.test };
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏
			if (newData.test.criteria) {
				appData.test.criteria = { ...oldData.test.criteria, ...newData.test.criteria };
			}
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –∑–∞–¥–∞–Ω–∏—è (–¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ)
			const oldTaskKeys = oldData.tasks.map(t => `${t.type}|${t.maxScore}|${t.level}`).join('|');
			newData.tasks.forEach(newTask => {
				const newTaskKey = `${newTask.type}|${newTask.maxScore}|${newTask.level}`;
				if (!oldTaskKeys.includes(newTaskKey)) {
					appData.tasks.push(newTask);
				}
			});
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º —É—á–∞—â–∏—Ö—Å—è (–¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö)
			const oldStudentsLower = oldData.students.map(s => s.toLowerCase().trim());
			newData.students.forEach(newStudent => {
				if (!oldStudentsLower.includes(newStudent.toLowerCase().trim())) {
					appData.students.push(newStudent);
					// –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
					appData.results.push(new Array(appData.tasks.length).fill(0));
				}
			});
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ—à–∏–±–∫–∏
			appData.errors = [...oldData.errors, ...(newData.errors || [])];
			
			// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞)
			mergeResults(oldData, newData);
		}

		// 8. –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ê–°–°–ò–í–û–í
		function syncDataArrays() {
			// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—â–∏—Ö—Å—è
			while (appData.results.length < appData.students.length) {
				appData.results.push(new Array(appData.tasks.length).fill(0));
			}
			
			// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			if (appData.results.length > appData.students.length) {
				appData.results = appData.results.slice(0, appData.students.length);
			}
			
			// –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–ª–∏–Ω—É –∫–∞–∂–¥–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			appData.results.forEach((studentResults, index) => {
				while (studentResults.length < appData.tasks.length) {
					studentResults.push(0);
				}
				if (studentResults.length > appData.tasks.length) {
					appData.results[index] = studentResults.slice(0, appData.tasks.length);
				}
			});
		}
		// 9. –ú–ï–ù–Æ –ò–ú–ü–û–†–¢–ê/–≠–ö–°–ü–û–†–¢–ê
		function showImportExportMenu() {
			const html = `
				<div style="text-align: center; padding: 20px;">
					<h3>üîÑ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
						<div style="background: #d4edda; padding: 20px; border-radius: 10px; text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì§</div>
							<h4>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª JSON</p>
							<button class="btn btn-success" onclick="simpleExport()" style="width: 100%; margin-top: 10px;">
								–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
							</button>
							<small style="display: block; margin-top: 10px; color: #666;">
								–°–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª .json —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
							</small>
						</div>
						
						<div style="background: #fff3cd; padding: 20px; border-radius: 10px; text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì•</div>
							<h4>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ JSON</p>
							<button class="btn btn-warning" onclick="simpleImport()" style="width: 100%; margin-top: 10px;">
								–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
							</button>
							<small style="display: block; margin-top: 10px; color: #666;">
								–ó–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ .json
							</small>
						</div>
					</div>
					
					<div style="background: #d1ecf1; padding: 15px; border-radius: 8px; text-align: left; margin-top: 20px;">
						<h5>üì± –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:</h5>
						<ol>
							<li><strong>–ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ 1:</strong> –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –≠–∫—Å–ø–æ—Ä—Ç</li>
							<li><strong>–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ñ–∞–π–ª</strong> –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 2 (—Ñ–ª–µ—à–∫–∞, email, –æ–±–ª–∞–∫–æ)</li>
							<li><strong>–ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ 2:</strong> –ò–º–ø–æ—Ä—Ç ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–∞–±–æ—Ç—É ‚Üí –≠–∫—Å–ø–æ—Ä—Ç</li>
							<li><strong>–í–µ—Ä–Ω–∏—Ç–µ —Ñ–∞–π–ª</strong> –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 1 –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
						</ol>
					</div>
					
					<div style="margin-top: 20px; text-align: left;">
						<h5>üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</h5>
						<button class="btn" onclick="createSampleFile()" style="margin-right: 10px;">
							üß™ –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞
						</button>
						<button class="btn" onclick="checkDataStructure()">
							üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
						</button>
					</div>
				</div>
			`;
			
			showModal('–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö', html);
		}
		// 12. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–ù–û–ü–û–ö –í –ò–ù–¢–ï–†–§–ï–ô–°
		function addImportExportButtons() {
			// –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞
			const exportSection = document.getElementById('export');
			if (!exportSection) return;
			<!--
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –Ω–∞—á–∞–ª–æ
			const buttonsContainer = exportSection.querySelector('.export-buttons');
			if (buttonsContainer) {
				buttonsContainer.innerHTML = `
					<button class="btn btn-success" onclick="simpleExport()">
						üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)
					</button>
					<button class="btn btn-warning" onclick="simpleImport()">
						üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)  
					</button>
					<button class="btn" onclick="showImportExportMenu()">
						üîÑ –ú–µ–Ω—é –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞
					</button>
					<button class="btn" onclick="createSampleFile()">
						üß™ –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞
					</button>
					${buttonsContainer.innerHTML}
				`;
			}
			-->
			// –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å
			const tabsContainer = document.querySelector('.tabs');
			if (tabsContainer && !document.querySelector('.tab-btn[onclick*="showImportExportMenu"]')) {
				const transferTab = document.createElement('button');
				transferTab.className = 'tab-btn';
				transferTab.innerHTML = 'üîÑ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç';
				transferTab.onclick = showImportExportMenu;
				tabsContainer.appendChild(transferTab);
			}
		}
		
		// 10. –°–û–ó–î–ê–ù–ò–ï –ü–†–ò–ú–ï–†–ù–û–ì–û –§–ê–ô–õ–ê
		function createSampleFile() {
			// –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
			const sampleData = {
				test: {
					subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
					class: "5–ê",
					testDate: new Date().toISOString().split('T')[0],
					theme: "–î—Ä–æ–±–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã",
					goals: "–ü—Ä–∏–º–µ—Ä —Ü–µ–ª–µ–π –æ–±—É—á–µ–Ω–∏—è",
					workType: "current",
					workFormat: "mixed",
					timeLimit: 45,
					totalStudents: 25,
					presentStudents: 23,
					absentReason: "",
					criteria: {
						5: { min: 18, max: 20 },
						4: { min: 15, max: 17 },
						3: { min: 10, max: 14 },
						2: { min: 0, max: 9 }
					}
				},
				tasks: [
					{ type: "–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è 1", maxScore: 2, level: 1, knowledge: "" },
					{ type: "–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è 2", maxScore: 3, level: 2, knowledge: "" }
				],
				students: ["–ò–≤–∞–Ω–æ–≤ –ê.", "–ü–µ—Ç—Ä–æ–≤–∞ –ú.", "–°–∏–¥–æ—Ä–æ–≤ –î."],
				results: [[1, 2], [2, 2], [0, 1]],
				errors: [],
				instructions: "–≠—Ç–æ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏."
			};
			
			const dataStr = JSON.stringify(sampleData, null, 2);
			const blob = new Blob([dataStr], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = "–ø—Ä–∏–º–µ—Ä_—Ñ–∞–π–ª–∞_–¥–∞–Ω–Ω—ã—Ö.json";
			a.click();
			URL.revokeObjectURL(url);
			
			showNotification('–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω', 'success');
		}

		// 11. –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•
		function checkDataStructure() {
			const html = `
				<div style="max-width: 800px;">
					<h3>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:</h4>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${appData.students.length}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${appData.tasks.length}</p>
						<p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> ${appData.results.length} √ó ${appData.results[0]?.length || 0}</p>
						<p><strong>–û—à–∏–±–æ–∫:</strong> ${appData.errors.length}</p>
					</div>
					
					<div style="background: #e8f4fc; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:</h4>
						<pre style="background: white; padding: 10px; border-radius: 4px; font-size: 10px; max-height: 300px; overflow: auto;">
							${JSON.stringify({
								test: { subject: "...", class: "..." },
								tasks: ["...", "..."],
								students: ["...", "..."],
								results: [["..."], ["..."]]
							}, null, 2)}
						</pre>
					</div>
					
					<div style="margin-top: 20px;">
						<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
					</div>
				</div>
			`;
			
			showModal('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö', html);
		}

		// 3. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞
		function readFileAsText(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = function(e) {
					resolve(e.target.result);
				};
				
				reader.onerror = function(e) {
					reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª'));
				};
				
				// –ß–∏—Ç–∞–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç —Å UTF-8
				reader.readAsText(file, 'UTF-8');
			});
		}
		
		// 4. –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø –¥–∞–Ω–Ω—ã—Ö
		function validateImportData(data) {
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
				if (!data || typeof data !== 'object') {
					return false;
				}
				
				// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–Ω–æ–≤—ã–π –∏–ª–∏ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
				const appData = data.appData || data;
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
				if (!appData.test || typeof appData.test !== 'object') {
					return false;
				}
				
				if (!Array.isArray(appData.tasks)) {
					return false;
				}
				
				if (!Array.isArray(appData.students)) {
					return false;
				}
				
				if (!Array.isArray(appData.results)) {
					return false;
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –º–∞—Å—Å–∏–≤–æ–≤
				if (appData.results.length !== appData.students.length) {
					console.warn('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—â–∏—Ö—Å—è');
					// –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∏–º–ø–æ—Ä—Ç, –Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
				}
				
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error);
				return false;
			}
		}

		
		// –î–û–ë–ê–í–¨–¢–ï –≠–¢–ò –ö–ù–û–ü–ö–ò –í –ò–ù–¢–ï–†–§–ï–ô–°
		function addFixedTransferButtons() {
			// –í —Ä–∞–∑–¥–µ–ª —ç–∫—Å–ø–æ—Ä—Ç–∞
			const exportTab = document.querySelector('#export .export-buttons');
			if (exportTab) {
				// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
				exportTab.innerHTML += `
					<button class="btn btn-success" onclick="simpleExport()">üíæ –≠–∫—Å–ø–æ—Ä—Ç (–ø—Ä–æ—Å—Ç–æ–π)</button>
					<button class="btn btn-warning" onclick="simpleImport()">üì• –ò–º–ø–æ—Ä—Ç (–ø—Ä–æ—Å—Ç–æ–π)</button>
					<button class="btn" onclick="simpleImportExport()">üîÑ –ü—Ä–æ—Å—Ç–æ–π –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç</button>
					<button class="btn" onclick="createTestImportFile()">üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</button>
					<button class="btn btn-danger" onclick="showResetDialog()">‚ö†Ô∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
				`;
			}
		}
		
		function printPsychologyReport() {
			if (appData.test.workType !== 'psychology') {
				showNotification('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤', 'warning');
				return;
			}
			
			const psychologyReport = generatePsychologyPrintReport();
			const fullReport = `
				<div class="header">
					<h1>üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ</h1>
					<h2>${appData.test.subject || '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞'}, ${appData.test.class || '–ö–ª–∞—Å—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</h2>
					<p><strong>–ú–µ—Ç–æ–¥–∏–∫–∞:</strong> ${appData.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'} | <strong>–î–∞—Ç–∞:</strong> ${appData.test.testDate ? new Date(appData.test.testDate).toLocaleDateString() : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
				</div>
				${psychologyReport}
				<div class="section small-text text-center">
					<p><em>–ó–∞–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–æ ${new Date().toLocaleDateString()}. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.</em></p>
				</div>
			`;
			
			const printWindow = window.open('', '_blank');
			printWindow.document.write(`
				<!DOCTYPE html>
				<html>
				<head>
					<title>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ - ${appData.test.theme}</title>
					<meta charset="UTF-8">
					<style>
						body { 
							font-family: 'Arial', sans-serif; 
							margin: 0; 
							padding: 15mm; 
							line-height: 1.5;
							color: #333;
							font-size: 11pt;
						}
						@page {
							size: A4;
							margin: 20mm;
						}
						.header { 
							text-align: center; 
							margin-bottom: 25px;
							padding-bottom: 15px;
							border-bottom: 2px solid #9b59b6;
							background: linear-gradient(135deg, #8e44ad, #9b59b6);
							color: white;
							padding: 20px;
							border-radius: 8px;
						}
						.section { 
							margin: 25px 0; 
							page-break-inside: avoid;
						}
						.section-title {
							color: #8e44ad;
							margin: 20px 0 15px 0;
							padding-bottom: 8px;
							border-bottom: 1px solid #9b59b6;
							font-size: 1.3em;
							font-weight: bold;
						}
						table { 
							width: 100%; 
							border-collapse: collapse; 
							margin: 15px 0;
							font-size: 10pt;
							page-break-inside: avoid;
						}
						th, td { 
							border: 1px solid #ddd; 
							padding: 8px; 
							text-align: left; 
							vertical-align: top;
						}
						th { 
							background-color: #8e44ad; 
							color: white; 
							font-weight: bold;
						}
						.recommendation-card {
							background: #f5eef8;
							padding: 15px;
							margin: 15px 0;
							border-radius: 6px;
							border-left: 4px solid #9b59b6;
						}
						.print-break { 
							page-break-before: always; 
						}
						.small-text { font-size: 9pt; }
						.text-center { text-align: center; }
						ul {
							margin: 10px 0;
							padding-left: 25px;
						}
						li {
							margin: 6px 0;
						}
						.level-indicator {
							display: inline-block;
							padding: 3px 10px;
							border-radius: 12px;
							font-size: 10pt;
							margin: 2px;
							color: white;
							font-weight: bold;
						}
						.psychology-note {
							background: #fff8e1;
							border: 1px solid #ffd54f;
							padding: 10px;
							margin: 15px 0;
							border-radius: 4px;
							font-size: 10pt;
						}
					</style>
				</head>
				<body>
					${fullReport}
				</body>
				</html>
			`);
			
			printWindow.document.close();
			
			setTimeout(() => {
				printWindow.print();
				setTimeout(() => {
					printWindow.close();
				}, 500);
			}, 500);
			
			showNotification('–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –ø–µ—á–∞—Ç–∏', 'success');
		}
		
		// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑–∞—Ç—å —Å—ã—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
		function showRawFileContent(encodedContent) {
			try {
				const content = atob(encodedContent);
				
				let html = `
					<h3>üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞</h3>
					<div style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<pre style="font-size: 10px; white-space: pre-wrap; word-break: break-all;">${content}</pre>
					</div>
					<div style="margin-top: 15px;">
						<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
					</div>
				`;
				
				showModal('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞', html);
				
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ', 'error');
			}
		}


		// 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function validateImportedData(data) {
			// –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
			if (!data || typeof data !== 'object') {
				console.error('–î–∞–Ω–Ω—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º:', data);
				return false;
			}
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ appData –∏–ª–∏ –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
			if (!data.appData && !data.test) {
				console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç appData –∏–ª–∏ test:', data);
				return false;
			}
			
			// –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö
			const importedAppData = data.appData || data;
			
			try {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
				const requiredKeys = ['test', 'tasks', 'students', 'results'];
				
				for (const key of requiredKeys) {
					if (!(key in importedAppData)) {
						console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á:', key);
						return false;
					}
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
				if (!Array.isArray(importedAppData.tasks)) {
					console.error('tasks –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.tasks);
					return false;
				}
				
				if (!Array.isArray(importedAppData.students)) {
					console.error('students –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.students);
					return false;
				}
				
				if (!Array.isArray(importedAppData.results)) {
					console.error('results –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.results);
					return false;
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ test –æ–±—ä–µ–∫—Ç–∞
				if (!importedAppData.test || typeof importedAppData.test !== 'object') {
					console.error('test –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º:', importedAppData.test);
					return false;
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º errors (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)
				if (importedAppData.errors && !Array.isArray(importedAppData.errors)) {
					console.error('errors –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', importedAppData.errors);
					return false;
				}
				
				// –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
				if (importedAppData.results.length > 0) {
					const firstResult = importedAppData.results[0];
					if (!Array.isArray(firstResult) && typeof firstResult !== 'number') {
						console.error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ results:', firstResult);
						return false;
					}
				}
				
				return true;
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				return false;
			}
		}

		// 5. –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞ - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function showImportConfirmationDialog(importedData) {
			// –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
			const actualData = importedData.appData || importedData;
			const metadata = importedData.metadata || {};
			
			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
			const subject = metadata.subject || actualData.test?.subject || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const className = metadata.class || actualData.test?.class || '–ù–µ —É–∫–∞–∑–∞–Ω';
			const studentCount = metadata.studentCount || actualData.students?.length || 0;
			const taskCount = metadata.taskCount || actualData.tasks?.length || 0;
			const exportDate = metadata.exportedAt || importedData.timestamp || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
			
			// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏
			const encodedData = safeEncode(importedData);
			
			const html = `
				<div style="max-width: 600px;">
					<h3>üîÑ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
						<h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${subject}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
						<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${actualData.test?.workType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${studentCount}</p>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${taskCount}</p>
						<p><strong>–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:</strong> ${exportDate}</p>
						<p><strong>–í–µ—Ä—Å–∏—è —Ñ–∞–π–ª–∞:</strong> ${importedData.version || '1.0'}</p>
					</div>
					
					<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
						<h4>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h4>
						<p>–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					</div>
					
					<div class="form-group">
						<label>
							<input type="checkbox" id="mergeData" checked>
							–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
						</label>
						<small style="display: block; color: #666; margin-top: 5px;">
							–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏: –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º, –∞ –Ω–µ –∑–∞–º–µ–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
						</small>
					</div>
					
					<div class="form-group">
						<label>–î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö:</label>
						<select id="conflictResolution">
							<option value="replace">–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</option>
							<option value="keep">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</option>
							<option value="merge">–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</option>
						</select>
					</div>
					
					<div class="form-group">
						<button class="btn" onclick="showDataPreview('${encodedData}')">
							üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
						</button>
					</div>
				</div>
			`;
			
			showModal('–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞', html + `
				<div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="confirmImport(true, '${encodedData}')">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
				</div>
			`);
		}

		// –í —Ä–∞–∑–¥–µ–ª —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
		function addDebugButtons() {
			const exportTab = document.querySelector('#export .export-buttons');
			if (exportTab) {
				exportTab.innerHTML += `
					<button class="btn btn-warning" onclick="createTestImportFile()">üß™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</button>
					<button class="btn btn-info" onclick="testDataStructure()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö</button>
				`;
			}
		}

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
		function testDataStructure() {
			console.log('–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ appData:', appData);
			console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:', validateImportedData({appData: appData}));
			
			let html = `
				<h3>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö</h3>
				<div style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
					<pre style="font-size: 10px; white-space: pre-wrap;">${JSON.stringify(appData, null, 2)}</pre>
				</div>
				<div style="margin-top: 15px;">
					<button class="btn" onclick="hideModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
				</div>
			`;
			
			showModal('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö', html);
		}


		// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
		function showDataPreview(encodedData) {
			try {
				const importedData = safeDecode(encodedData);
				
				if (!importedData) {
					showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
					return;
				}
				
				const actualData = importedData.appData || importedData;
				
				let html = `
					<h3>üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
					<div style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<pre style="font-size: 10px; white-space: pre-wrap;">${JSON.stringify(actualData, null, 2)}</pre>
					</div>
					<div style="margin-top: 15px;">
						<button class="btn" 
								onclick="hideModal(); showImportConfirmationDialog(this)"
								data-import='${JSON.stringify(importedData).replace(/'/g, "&apos;")}'>
							–ù–∞–∑–∞–¥
						</button>
					</div>
				`;
				
				showModal('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö', html);
				
			} catch (error) {
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
			}
		}

		// 6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function confirmImport(shouldImport, encodedData) {
			if (!shouldImport) {
				hideModal();
				return;
			}
			
			try {
				const importedData = JSON.parse(atob(encodedData));
				const mergeData = document.getElementById('mergeData')?.checked || false;
				const conflictResolution = document.getElementById('conflictResolution')?.value || 'replace';
				
				// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
				console.log('–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:', importedData);
				
				applyImportedData(importedData, mergeData, conflictResolution);
				
				hideModal();
				showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
				
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–º–ø–æ—Ä—Ç–µ
				if (importedData.metadata) {
					saveImportHistory(importedData.metadata);
				}
				
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:', error);
				showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
			}
		}

		// 7. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
		function applyImportedData(importedData, mergeData, conflictResolution) {
			const newData = importedData.appData || importedData;
			
			console.log('–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:', newData);
			console.log('–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:', conflictResolution);
			console.log('–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:', mergeData);
			
			if (!mergeData || conflictResolution === 'replace') {
				// –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö
				appData = JSON.parse(JSON.stringify(newData));
				console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–µ–Ω—ã');
				
			} else if (conflictResolution === 'merge') {
				// –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
				console.log('–ù–∞—á–∏–Ω–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞
				appData.test = { 
					...appData.test, 
					...newData.test,
					// –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ
					criteria: { ...appData.test.criteria, ...newData.test?.criteria }
				};
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º –∑–∞–¥–∞–Ω–∏—è (–¥–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)
				const existingTaskIds = new Set(appData.tasks.map(t => 
					`${t.type || ''}_${t.maxScore || 0}_${t.level || 0}`
				));
				
				newData.tasks?.forEach(task => {
					const taskId = `${task.type || ''}_${task.maxScore || 0}_${task.level || 0}`;
					if (!existingTaskIds.has(taskId)) {
						appData.tasks.push(task);
						existingTaskIds.add(taskId);
					}
				});
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º —É—á–∞—â–∏—Ö—Å—è
				const existingStudents = new Set(appData.students.map(s => s.toLowerCase().trim()));
				const newStudents = [];
				
				newData.students?.forEach(student => {
					const normalizedStudent = student.toLowerCase().trim();
					if (!existingStudents.has(normalizedStudent)) {
						appData.students.push(student);
						newStudents.push(student);
						existingStudents.add(normalizedStudent);
					}
				});
				
				// –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤
				newStudents.forEach(() => {
					appData.results.push(new Array(appData.tasks.length).fill(0));
				});
				
				// –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ—à–∏–±–∫–∏
				if (newData.errors) {
					appData.errors = [...appData.errors, ...newData.errors];
				}
				
				console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã');
				
			} else if (conflictResolution === 'keep') {
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–µ
				console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ...');
				
				// –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö —É—á–∞—â–∏—Ö—Å—è
				const existingStudents = new Set(appData.students.map(s => s.toLowerCase().trim()));
				
				newData.students?.forEach(student => {
					const normalizedStudent = student.toLowerCase().trim();
					if (!existingStudents.has(normalizedStudent)) {
						appData.students.push(student);
						existingStudents.add(normalizedStudent);
						// –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
						appData.results.push(new Array(appData.tasks.length).fill(0));
					}
				});
				
				console.log('–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —É—á–∞—â–∏–µ—Å—è');
			}
			
			// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è
			adjustResultsArray();
			
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
			saveData();
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
			renderAll();
			
			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–º–ø–æ—Ä—Ç–∞
			showImportStatistics(newData);
		}
		function renderPointsCriteria(system, count) {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			let html = `<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (–≤ –±–∞–ª–ª–∞—Ö)</h4>
						<p style="font-size: 12px; color: #666; margin-bottom: 15px;">
							–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–∞–ª–ª: <strong>${maxPossible}</strong>
						</p>`;
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				
				// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫–∏ 2-5
				const displayLevel = getDisplayLevel(system, i);
				const description = getLevelDescription(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayLevel} ${description}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-min" 
								   style="flex: 1;"
								   placeholder="–ú–∏–Ω. –±–∞–ª–ª—ã">
							<span>‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-max" 
								   style="flex: 1;"
								   placeholder="–ú–∞–∫—Å. –±–∞–ª–ª—ã">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function getDisplayLevel(system, levelIndex) {
			switch(system) {
				case 'standard':
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 2-5 –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
					return levelIndex === 1 ? '2 (–ù–µ—É–¥–æ–≤–ª.)' : 
						   levelIndex === 2 ? '3 (–£–¥–æ–≤–ª.)' : 
						   levelIndex === 3 ? '4 (–•–æ—Ä–æ—à–æ)' : 
						   levelIndex === 4 ? '5 (–û—Ç–ª–∏—á–Ω–æ)' : 
						   `–£—Ä–æ–≤–µ–Ω—å ${levelIndex + 1}`;
				
				case 'five_point':
					return levelIndex === 1 ? '1 (–û—á–µ–Ω—å –ø–ª–æ—Ö–æ)' :
						   levelIndex === 2 ? '2 (–ü–ª–æ—Ö–æ)' :
						   levelIndex === 3 ? '3 (–°—Ä–µ–¥–Ω–µ)' :
						   levelIndex === 4 ? '4 (–•–æ—Ä–æ—à–æ)' :
						   levelIndex === 5 ? '5 (–û—Ç–ª–∏—á–Ω–æ)' :
						   `–£—Ä–æ–≤–µ–Ω—å ${levelIndex}`;
				
				case 'ten_point':
					return levelIndex === 10 ? '10 (–ë–µ–∑—É–ø—Ä–µ—á–Ω–æ)' :
						   levelIndex >= 8 ? `${levelIndex} (–û—Ç–ª–∏—á–Ω–æ)` :
						   levelIndex >= 6 ? `${levelIndex} (–•–æ—Ä–æ—à–æ)` :
						   levelIndex >= 4 ? `${levelIndex} (–£–¥–æ–≤–ª.)` :
						   `${levelIndex} (–ü–ª–æ—Ö–æ)`;
				
				default:
					return `–£—Ä–æ–≤–µ–Ω—å ${levelIndex}`;
			}
		}

		function getLevelDescription(system, levelIndex) {
			// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
			if (system === 'standard') {
				return '(–î–∏–∞–ø–∞–∑–æ–Ω %)';
			}
			return '';
		}

		function setupCriteriaListeners() {
			// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏–º—É–º—ã/–º–∞–∫—Å–∏–º—É–º—ã
			document.querySelectorAll('.criteria-min').forEach(input => {
				input.addEventListener('change', function() {
					const level = this.id.replace('criteria', '').replace('min', '');
					const maxInput = document.getElementById(`criteria${level}max`);
					
					if (maxInput && parseInt(this.value) > parseInt(maxInput.value)) {
						maxInput.value = this.value;
					}
				});
			});
			
			document.querySelectorAll('.criteria-max').forEach(input => {
				input.addEventListener('change', function() {
					const level = this.id.replace('criteria', '').replace('max', '');
					const minInput = document.getElementById(`criteria${level}min`);
					
					if (minInput && parseInt(this.value) < parseInt(minInput.value)) {
						minInput.value = this.value;
					}
				});
			});
		}

		// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
		function updateCriteriaSystem() {
			const type = document.getElementById('criteriaType').value;
			const system = document.getElementById('criteriaSystem').value;
			let count = parseInt(document.getElementById('criteriaCount').value) || 4;
			
			// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã
			if (system === 'standard') {
				count = 4; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç 4 —É—Ä–æ–≤–Ω—è
				document.getElementById('criteriaCount').value = 4;
			} else if (system === 'five_point') {
				count = 5; // –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç 5 —É—Ä–æ–≤–Ω–µ–π
				document.getElementById('criteriaCount').value = 5;
			} else if (system === 'ten_point') {
				count = 10; // –î–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç 10 —É—Ä–æ–≤–Ω–µ–π
				document.getElementById('criteriaCount').value = 10;
			}
			
			appData.test.criteriaType = type;
			appData.test.criteriaSystem = system;
			appData.test.criteriaCount = count;
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
			if (!appData.test.criteria || Object.keys(appData.test.criteria).length === 0) {
				initializeDefaultCriteria();
			}
			
			renderCriteriaSettings();
		}

		function initializeDefaultCriteria() {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			appData.test.criteria = {};
			
			if (system === 'standard') {
				// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (2-5): 4 —É—Ä–æ–≤–Ω—è
				appData.test.criteria = {
					1: { min: 0, max: Math.round(maxPossible * 0.49) },         // 2
					2: { min: Math.round(maxPossible * 0.5), max: Math.round(maxPossible * 0.69) }, // 3
					3: { min: Math.round(maxPossible * 0.7), max: Math.round(maxPossible * 0.84) }, // 4
					4: { min: Math.round(maxPossible * 0.85), max: maxPossible } // 5
				};
			} else if (system === 'five_point') {
				// –ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (1-5): 5 —É—Ä–æ–≤–Ω–µ–π
				appData.test.criteria = {
					1: { min: 0, max: Math.round(maxPossible * 0.2) },          // 1
					2: { min: Math.round(maxPossible * 0.21), max: Math.round(maxPossible * 0.4) }, // 2
					3: { min: Math.round(maxPossible * 0.41), max: Math.round(maxPossible * 0.6) }, // 3
					4: { min: Math.round(maxPossible * 0.61), max: Math.round(maxPossible * 0.8) }, // 4
					5: { min: Math.round(maxPossible * 0.81), max: maxPossible } // 5
				};
			} else if (system === 'ten_point') {
				// –î–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (1-10): 10 —É—Ä–æ–≤–Ω–µ–π
				const step = maxPossible / 10;
				for (let i = 1; i <= 10; i++) {
					appData.test.criteria[i] = {
						min: Math.round((i - 1) * step),
						max: Math.round(i * step)
					};
				}
			}
		}

		// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
		function renderCriteriaSettings() {
			const container = document.getElementById('criteriaSettingsContainer');
			if (!container) return;
			
			const type = appData.test.criteriaType || 'points';
			const system = appData.test.criteriaSystem || 'standard';
			let count = appData.test.criteriaCount || 4;
			
			// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤—Å–µ–≥–¥–∞ 4 —É—Ä–æ–≤–Ω—è
			if (system === 'standard') {
				count = 4;
			}
			
			console.log('renderCriteriaSettings:', { type, system, count });
			
			let html = `
				<div class="form-group">
					<label>–¢–∏–ø –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è:</label>
					<select id="criteriaType" onchange="updateCriteriaSystem()">
						<option value="points" ${type === 'points' ? 'selected' : ''}>–ë–∞–ª–ª—ã</option>
						<option value="percentage" ${type === 'percentage' ? 'selected' : ''}>–ü—Ä–æ—Ü–µ–Ω—Ç—ã (%)</option>
						<option value="custom" ${type === 'custom' ? 'selected' : ''}>–°–≤–æ—è —à–∫–∞–ª–∞</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è:</label>
					<select id="criteriaSystem" onchange="updateCriteriaSystem()">
						<option value="standard" ${system === 'standard' ? 'selected' : ''}>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (2-5)</option>
						<option value="five_point" ${system === 'five_point' ? 'selected' : ''}>–ü—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-5)</option>
						<option value="ten_point" ${system === 'ten_point' ? 'selected' : ''}>–î–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–∞—è (1-10)</option>
						<option value="custom" ${system === 'custom' ? 'selected' : ''}>–°–≤–æ—è —Å–∏—Å—Ç–µ–º–∞</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π:</label>
					<input type="number" id="criteriaCount" min="2" max="10" 
						   value="${count}" ${system === 'standard' ? 'disabled' : ''} 
						   onchange="updateCriteriaSystem()"
						   style="${system === 'standard' ? 'background: #f0f0f0;' : ''}">
					${system === 'standard' ? '<small style="color: #666;">–î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 4 —É—Ä–æ–≤–Ω—è</small>' : ''}
				</div>
			`;
			
			// –î–æ–±–∞–≤–ª—è–µ–º –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã
			html += addCriteriaPresets();
			
			// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏
			html += '<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">';
			
			if (type === 'percentage') {
				html += '<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)</h4>';
				html += renderPercentageCriteria(system, count);
			} else if (type === 'points') {
				const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0);
				html += `<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (–≤ –±–∞–ª–ª–∞—Ö)</h4>
						 <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
							–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–∞–ª–ª: <strong>${maxPossible}</strong>
						 </p>`;
				html += renderPointsCriteria(system, count, maxPossible);
			} else {
				html += '<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —à–∫–∞–ª—ã</h4>';
				html += '<p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Å–µ—Ç—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É</p>';
			}
			
			html += '</div>';
			
			container.innerHTML = html;
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
			setupCriteriaListeners();
		}
		
		function debugCriteria() {
			console.log('=== –û–¢–õ–ê–î–ö–ê –ö–†–ò–¢–ï–†–ò–ï–í ===');
			console.log('–¢–∏–ø:', appData.test.criteriaType);
			console.log('–°–∏—Å—Ç–µ–º–∞:', appData.test.criteriaSystem);
			console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:', appData.test.criteriaCount);
			console.log('–ö—Ä–∏—Ç–µ—Ä–∏–∏:', appData.test.criteria);
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —É—Ä–æ–≤–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
			const count = appData.test.criteriaCount || 0;
			for (let i = 1; i <= count; i++) {
				if (!appData.test.criteria[i]) {
					console.error(`‚ùå –ö—Ä–∏—Ç–µ—Ä–∏–π ${i} –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!`);
				}
			}
		}

		function renderPercentageCriteria(system, count) {
			let html = '';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const displayName = getCriteriaDisplayName(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayName}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="100" step="1"
								   class="criteria-input"
								   placeholder="–ú–∏–Ω. %">
							<span style="color: #666;">‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="100" step="1"
								   class="criteria-input"
								   placeholder="–ú–∞–∫—Å. %">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function renderPointsCriteria(system, count, maxPossible) {
			let html = '';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const displayName = getCriteriaDisplayName(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayName}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-input"
								   placeholder="–ú–∏–Ω. –±–∞–ª–ª—ã">
							<span style="color: #666;">‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="${maxPossible}" step="1"
								   class="criteria-input"
								   placeholder="–ú–∞–∫—Å. –±–∞–ª–ª—ã">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function getCriteriaDisplayName(system, level) {
			if (system === 'standard') {
				const names = ['2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', 
							   '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
				return names[level - 1] || `–£—Ä–æ–≤–µ–Ω—å ${level + 1}`;
			} else if (system === 'five_point') {
				const names = ['1 (–û—á–µ–Ω—å –ø–ª–æ—Ö–æ)', '2 (–ü–ª–æ—Ö–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', 
							   '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
				return names[level - 1] || `–£—Ä–æ–≤–µ–Ω—å ${level}`;
			} else {
				return `–£—Ä–æ–≤–µ–Ω—å ${level}`;
			}
		}
		
		function renderSimplePercentageCriteria(count) {
			let html = '<h4>üéØ –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏</h4><div class="criteria-grid">';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const levelName = i === 1 ? '2' : i === 2 ? '3' : i === 3 ? '4' : '5';
				
				html += `
					<div class="criteria-item">
						<label>–û—Ü–µ–Ω–∫–∞ ${levelName}:</label>
						<input type="number" id="criteria${i}min" placeholder="–ú–∏–Ω" 
							   value="${criteria.min}" min="0" max="100" 
							   oninput="updateSimpleCriteria(${i}, 'min', this.value)">
						<input type="number" id="criteria${i}max" placeholder="–ú–∞–∫—Å" 
							   value="${criteria.max}" min="0" max="100"
							   oninput="updateSimpleCriteria(${i}, 'max', this.value)">
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}
		
		function renderSimplePointsCriteria(count) {
			const maxPossible = appData.tasks.reduce((sum, task) => sum + task.maxScore, 0) || 100;
			
			let html = `<h4>üìä –ë–∞–ª–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–º–∞–∫—Å–∏–º—É–º: ${maxPossible})</h4><div class="criteria-grid">`;
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				const levelName = i === 1 ? '2' : i === 2 ? '3' : i === 3 ? '4' : '5';
				
				html += `
					<div class="criteria-item">
						<label>–û—Ü–µ–Ω–∫–∞ ${levelName}:</label>
						<input type="number" id="criteria${i}min" placeholder="–ú–∏–Ω" 
							   value="${criteria.min}" min="0" max="${maxPossible}" 
							   oninput="updateSimpleCriteria(${i}, 'min', this.value)">
						<input type="number" id="criteria${i}max" placeholder="–ú–∞–∫—Å" 
							   value="${criteria.max}" min="0" max="${maxPossible}"
							   oninput="updateSimpleCriteria(${i}, 'max', this.value)">
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}		
		
		function updateSimpleCriteria(level, field, value) {
			if (!appData.test.criteria[level]) {
				appData.test.criteria[level] = { min: 0, max: 0 };
			}
			appData.test.criteria[level][field] = parseInt(value) || 0;
			saveData();
		}
		
		function renderPercentageCriteria() {
			const count = appData.test.criteriaCount;
			const system = appData.test.criteriaSystem;
			
			let labels = [];
			if (system === 'standard') {
				labels = ['2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
			} else if (system === 'five_point') {
				labels = ['1 (–û—á–µ–Ω—å –ø–ª–æ—Ö–æ)', '2 (–ü–ª–æ—Ö–æ)', '3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)', '4 (–•–æ—Ä–æ—à–æ)', '5 (–û—Ç–ª–∏—á–Ω–æ)'];
			} else if (system === 'ten_point') {
				labels = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
			} else {
				labels = appData.test.customCriteria.map(c => c.name) || Array.from({length: count}, (_, i) => `–£—Ä–æ–≤–µ–Ω—å ${i+1}`);
			}
			
			let html = '<h4>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤</h4>';
			html += '<div class="criteria-grid">';
			
			for (let i = 0; i < count; i++) {
				const label = labels[i] || `–£—Ä–æ–≤–µ–Ω—å ${i+1}`;
				const min = appData.test.criteria[i+1]?.min || 0;
				const max = appData.test.criteria[i+1]?.max || 100;
				
				html += `
					<div class="criteria-item">
						<label>${label}:</label>
						<div style="display: flex; gap: 5px; align-items: center;">
							<input type="number" 
								   id="criteria${i+1}min" 
								   placeholder="–ú–∏–Ω %" 
								   value="${min}" 
								   min="0" max="100"
								   oninput="updatePercentageCriteria(${i+1}, 'min', this.value)">
							<span>-</span>
							<input type="number" 
								   id="criteria${i+1}max" 
								   placeholder="–ú–∞–∫—Å %" 
								   value="${max}" 
								   min="0" max="100"
								   oninput="updatePercentageCriteria(${i+1}, 'max', this.value)">
						</div>
						<div style="margin-top: 5px;">
							<input type="text" 
								   id="criteria${i+1}label" 
								   placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è"
								   value="${appData.test.customCriteria[i]?.description || ''}"
								   oninput="updateCriteriaLabel(${i+1}, this.value)"
								   style="width: 100%; font-size: 12px;">
						</div>
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}

		function renderPercentageCriteria(system, count) {
			let html = '<h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)</h4>';
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i] || { min: 0, max: 0 };
				
				// –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫–∏ 2-5
				const displayLevel = getDisplayLevel(system, i);
				const description = getLevelDescription(system, i);
				
				html += `
					<div class="form-group">
						<label>${displayLevel} ${description}:</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<input type="number" id="criteria${i}min" 
								   value="${criteria.min}" 
								   min="0" max="100" step="1"
								   class="criteria-min" 
								   style="flex: 1;"
								   placeholder="–ú–∏–Ω. %">
							<span>‚Äî</span>
							<input type="number" id="criteria${i}max" 
								   value="${criteria.max}" 
								   min="0" max="100" step="1"
								   class="criteria-max" 
								   style="flex: 1;"
								   placeholder="–ú–∞–∫—Å. %">
						</div>
					</div>
				`;
			}
			
			return html;
		}

		function calculatePercentageRange(min, max, total) {
			if (total === 0) return '';
			const minPercent = Math.round((min / total) * 100);
			const maxPercent = Math.round((max / total) * 100);
			return `(${minPercent}% - ${maxPercent}%)`;
		}

		function renderCustomScaleCriteria() {
			const count = appData.test.criteriaCount;
			
			let html = '<h4>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–≤–æ–µ–π —à–∫–∞–ª—ã</h4>';
			html += '<p><small>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</small></p>';
			html += '<div class="criteria-grid">';
			
			for (let i = 0; i < count; i++) {
				const criterion = appData.test.customCriteria[i] || {
					name: `–£—Ä–æ–≤–µ–Ω—å ${i+1}`,
					min: 0,
					max: 0,
					description: '',
					color: getDefaultColor(i, count)
				};
				
				html += `
					<div class="criteria-item" style="border-left-color: ${criterion.color}">
						<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
							<input type="color" 
								   value="${criterion.color}"
								   onchange="updateCriteriaColor(${i}, this.value)"
								   style="width: 30px; height: 30px;">
							<input type="text" 
								   value="${criterion.name}"
								   onchange="updateCriteriaName(${i}, this.value)"
								   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è"
								   style="flex: 1;">
						</div>
						
						<div style="margin: 5px 0;">
							<label>–î–∏–∞–ø–∞–∑–æ–Ω:</label>
							<div style="display: flex; gap: 5px; align-items: center;">
								<input type="number" 
									   value="${criterion.min}"
									   onchange="updateCustomCriteria(${i}, 'min', this.value)"
									   placeholder="–ú–∏–Ω">
								<span>-</span>
								<input type="number" 
									   value="${criterion.max}"
									   onchange="updateCustomCriteria(${i}, 'max', this.value)"
									   placeholder="–ú–∞–∫—Å">
								<select onchange="updateCustomCriteria(${i}, 'type', this.value)" style="flex: 1;">
									<option value="points" ${criterion.type === 'points' ? 'selected' : ''}>–±–∞–ª–ª–æ–≤</option>
									<option value="percentage" ${criterion.type === 'percentage' ? 'selected' : ''}>%</option>
								</select>
							</div>
						</div>
						
						<div>
							<textarea 
								placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è (—á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å?)"
								onchange="updateCustomCriteria(${i}, 'description', this.value)"
								style="width: 100%; height: 60px; font-size: 12px; margin-top: 5px;">${criterion.description || ''}</textarea>
						</div>
					</div>
				`;
			}
			
			html += '</div>';
			return html;
		}

		function getDefaultColor(index, total) {
			const colors = [
				'#e74c3c', '#f39c12', '#3498db', '#27ae60',
				'#9b59b6', '#e67e22', '#1abc9c', '#d35400'
			];
			return colors[index % colors.length];
		}

		// –§—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
		function updatePercentageCriteria(level, field, value) {
			if (!appData.test.criteria[level]) {
				appData.test.criteria[level] = { min: 0, max: 0 };
			}
			appData.test.criteria[level][field] = parseInt(value) || 0;
			saveData();
		}

		function updatePointsCriteria(level, field, value) {
			if (!appData.test.criteria[level]) {
				appData.test.criteria[level] = { min: 0, max: 0 };
			}
			appData.test.criteria[level][field] = parseInt(value) || 0;
			saveData();
		}

		function updateCustomCriteria(index, field, value) {
			if (!appData.test.customCriteria[index]) {
				appData.test.customCriteria[index] = {
					name: `–£—Ä–æ–≤–µ–Ω—å ${index+1}`,
					min: 0,
					max: 0,
					description: '',
					color: getDefaultColor(index, appData.test.criteriaCount),
					type: 'points'
				};
			}
			appData.test.customCriteria[index][field] = value;
			saveData();
		}

		function updateCriteriaLabel(level, value) {
			if (!appData.test.customCriteria[level-1]) {
				appData.test.customCriteria[level-1] = {
					name: `–£—Ä–æ–≤–µ–Ω—å ${level}`,
					description: '',
					color: getDefaultColor(level-1, appData.test.criteriaCount)
				};
			}
			appData.test.customCriteria[level-1].description = value;
			saveData();
		}

		function updateCriteriaName(index, value) {
			if (!appData.test.customCriteria[index]) {
				appData.test.customCriteria[index] = {
					name: value,
					min: 0,
					max: 0,
					description: '',
					color: getDefaultColor(index, appData.test.criteriaCount)
				};
			}
			appData.test.customCriteria[index].name = value;
			saveData();
		}

		function updateCriteriaColor(index, value) {
			if (!appData.test.customCriteria[index]) {
				appData.test.customCriteria[index] = {
					name: `–£—Ä–æ–≤–µ–Ω—å ${index+1}`,
					min: 0,
					max: 0,
					description: '',
					color: value
				};
			}
			appData.test.customCriteria[index].color = value;
			saveData();
			renderCriteriaSettings();
		}

		function updateCustomLevels(value) {
			const levels = value.split(',').map(l => l.trim()).filter(l => l.length > 0);
			appData.test.customCriteria = levels.map((name, index) => ({
				name: name,
				min: 0,
				max: 0,
				description: '',
				color: getDefaultColor(index, levels.length),
				type: 'points'
			}));
			appData.test.criteriaCount = levels.length;
			saveData();
			renderCriteriaSettings();
		}

		// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –æ—Ü–µ–Ω–∫–∏
		function calculateGradeByPercentage(percentage) {
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			console.log('calculateGradeByPercentage:', { percentage, system, count });
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i];
				console.log(`Checking criteria ${i}:`, criteria);
				
				if (criteria && percentage >= criteria.min && percentage <= criteria.max) {
					console.log(`Found in criteria ${i}`);
					
					if (system === 'standard') {
						// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º 1-4 –≤ 2-5 –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
						const grade = i === 1 ? 2 : i + 1;
						console.log('Standard system grade:', grade);
						return grade;
					} else if (system === 'five_point' || system === 'ten_point') {
						console.log('Five/Ten point system grade:', i);
						return i;
					} else if (system === 'custom') {
						const customCriterion = appData.test.customCriteria[i-1];
						const grade = customCriterion ? customCriterion.name : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
						console.log('Custom system grade:', grade);
						return grade;
					} else {
						console.log('Default grade:', i);
						return i;
					}
				}
			}
			
			// –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –Ω–∏ –≤ –æ–¥–∏–Ω –¥–∏–∞–ø–∞–∑–æ–Ω
			console.log('Not found in any criteria');
			return system === 'standard' ? 2 : '?';
		}

		function calculateGradeByPercentage(percentage) {
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i];
				if (criteria && percentage >= criteria.min && percentage <= criteria.max) {
					if (system === 'standard') {
						// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º 1-4 –≤ 2-5 –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
						return i === 1 ? 2 : i + 1;
					} else if (system === 'five_point') {
						return i;
					} else if (system === 'ten_point') {
						return i;
					} else {
						// –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
						const customCriterion = appData.test.customCriteria[i-1];
						return customCriterion ? customCriterion.name : i;
					}
				}
			}
			
			return appData.test.criteriaSystem === 'standard' ? 2 : 1;
		}

		function calculateGradeByPoints(totalScore) {
			const system = appData.test.criteriaSystem;
			const count = appData.test.criteriaCount;
			
			console.log('calculateGradeByPoints:', { totalScore, system, count });
			
			for (let i = 1; i <= count; i++) {
				const criteria = appData.test.criteria[i];
				console.log(`Checking criteria ${i}:`, criteria);
				
				if (criteria && totalScore >= criteria.min && totalScore <= criteria.max) {
					console.log(`Found in criteria ${i}`);
					
					if (system === 'standard') {
						const grade = i === 1 ? 2 : i + 1;
						console.log('Standard system grade:', grade);
						return grade;
					} else if (system === 'five_point' || system === 'ten_point') {
						console.log('Five/Ten point system grade:', i);
						return i;
					} else if (system === 'custom') {
						const customCriterion = appData.test.customCriteria[i-1];
						const grade = customCriterion ? customCriterion.name : `–£—Ä–æ–≤–µ–Ω—å ${i}`;
						console.log('Custom system grade:', grade);
						return grade;
					} else {
						console.log('Default grade:', i);
						return i;
					}
				}
			}
			
			console.log('Not found in any criteria');
			return system === 'standard' ? 2 : '?';
		}


		function calculateGradeByCustomScale(totalScore, maxPossible) {
			const criteria = appData.test.customCriteria;
			
			if (!criteria || criteria.length === 0) {
				console.log('No custom criteria found');
				return '?';
			}
			
			console.log('calculateGradeByCustomScale:', { totalScore, maxPossible, criteria });
			
			const percentage = maxPossible > 0 ? (totalScore / maxPossible) * 100 : 0;
			console.log('Percentage for custom scale:', percentage);
			
			for (let i = 0; i < criteria.length; i++) {
				const criterion = criteria[i];
				console.log(`Checking custom criterion ${i}:`, criterion);
				
				if (!criterion) continue;
				
				let valueToCheck = totalScore;
				if (criterion.type === 'percentage') {
					valueToCheck = percentage;
				}
				
				console.log(`Value to check for criterion ${i}:`, valueToCheck);
				
				if (valueToCheck >= criterion.min && valueToCheck <= criterion.max) {
					console.log(`Found in custom criterion ${i}:`, criterion.name);
					return criterion.name;
				}
			}
			
			console.log('Not found in any custom criteria');
			return criteria.length > 0 ? criteria[criteria.length-1].name : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
		}

		// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
		function showImportStatistics(newData) {
			const importedStudents = newData.students?.length || 0;
			const importedTasks = newData.tasks?.length || 0;
			const importedErrors = newData.errors?.length || 0;
			
			console.log(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${importedStudents} —É—á–∞—â–∏—Ö—Å—è, ${importedTasks} –∑–∞–¥–∞–Ω–∏–π, ${importedErrors} –æ—à–∏–±–æ–∫`);
		}

		// 8. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
		function mergeResults(newData) {
			// –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —É—á–µ–Ω–∏–∫–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
			const studentMap = {};
			appData.students.forEach((student, index) => {
				studentMap[student] = index;
			});
			
			// –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É –∑–∞–¥–∞–Ω–∏–π
			const taskMap = {};
			appData.tasks.forEach((task, index) => {
				taskMap[task.type + task.maxScore + task.level] = index;
			});
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤
			newData.students.forEach((student, studentIndex) => {
				const existingStudentIndex = studentMap[student];
				if (existingStudentIndex !== undefined) {
					newData.results[studentIndex].forEach((score, taskIndex) => {
						const newTask = newData.tasks[taskIndex];
						const taskKey = newTask.type + newTask.maxScore + newTask.level;
						const existingTaskIndex = taskMap[taskKey];
						
						if (existingTaskIndex !== undefined) {
							// –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –µ—Å–ª–∏ –≤ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–Ω –ª—É—á—à–µ
							const currentScore = appData.results[existingStudentIndex][existingTaskIndex] || 0;
							if (score > currentScore) {
								appData.results[existingStudentIndex][existingTaskIndex] = score;
							}
						}
					});
				}
			});
		}

		// 9. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Å–∏–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
		function adjustResultsArray() {
			const expectedLength = appData.students.length;
			const taskCount = appData.tasks.length;
			
			// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			if (appData.results.length > expectedLength) {
				appData.results = appData.results.slice(0, expectedLength);
			}
			
			// –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			while (appData.results.length < expectedLength) {
				appData.results.push(new Array(taskCount).fill(0));
			}
			
			// –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–ª–∏–Ω—É –∫–∞–∂–¥–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
			appData.results.forEach((studentResults, index) => {
				if (studentResults.length > taskCount) {
					appData.results[index] = studentResults.slice(0, taskCount);
				} else if (studentResults.length < taskCount) {
					const missing = taskCount - studentResults.length;
					for (let i = 0; i < missing; i++) {
						studentResults.push(0);
					}
				}
			});
		}

		// 10. –ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
		function saveExportHistory() {
			const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
			history.push({
				timestamp: new Date().toISOString(),
				filename: generateExportFilename(),
				subject: appData.test.subject,
				class: appData.test.class,
				studentCount: appData.students.length,
				taskCount: appData.tasks.length
			});
			
			// –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∑–∞–ø–∏—Å–µ–π
			localStorage.setItem('exportHistory', JSON.stringify(history.slice(-20)));
		}

		function saveImportHistory(metadata) {
			const history = JSON.parse(localStorage.getItem('importHistory') || '[]');
			history.push({
				timestamp: new Date().toISOString(),
				metadata: metadata,
				subject: appData.test.subject,
				class: appData.test.class
			});
			
			// –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∑–∞–ø–∏—Å–µ–π
			localStorage.setItem('importHistory', JSON.stringify(history.slice(-20)));
		}

		// 11. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
		function showTransferHistory() {
			const exportHistory = JSON.parse(localStorage.getItem('exportHistory') || '[]');
			const importHistory = JSON.parse(localStorage.getItem('importHistory') || '[]');
			
			let html = `
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
					<div>
						<h4>üì§ –ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞</h4>
						${exportHistory.length > 0 ? 
							exportHistory.reverse().map(item => `
								<div class="backup-item">
									<strong>${new Date(item.timestamp).toLocaleString()}</strong><br>
									<small>${item.filename}</small><br>
									<small>${item.subject} - ${item.class} (${item.studentCount} —É—á., ${item.taskCount} –∑–∞–¥.)</small>
								</div>
							`).join('') : 
							'<p>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</p>'
						}
					</div>
					
					<div>
						<h4>üì• –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–∞</h4>
						${importHistory.length > 0 ? 
							importHistory.reverse().map(item => `
								<div class="backup-item">
									<strong>${new Date(item.timestamp).toLocaleString()}</strong><br>
									<small>${item.metadata?.subject || item.subject} - ${item.metadata?.class || item.class}</small><br>
									<small>${item.metadata?.exportedAt || ''}</small>
								</div>
							`).join('') : 
							'<p>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–º–ø–æ—Ä—Ç–∞</p>'
						}
					</div>
				</div>
				
				<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
					<h4>üí° –°–æ–≤–µ—Ç—ã –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É –¥–∞–Ω–Ω—ã—Ö</h4>
					<ul>
						<li>–†–µ–≥—É–ª—è—Ä–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π</li>
						<li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (Google Drive, –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
						<li>–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤—ã–±–∏—Ä–∞–π—Ç–µ —Ä–µ–∂–∏–º "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
						<li>–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞</li>
					</ul>
				</div>
			`;
			
			showModal('–ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∏–º–ø–æ—Ä—Ç–∞', html);
		}

		// 12. –ë—ã—Å—Ç—Ä–æ–µ –º–µ–Ω—é —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
		function showQuickTransferMenu() {
			const html = `
				<div style="text-align: center; padding: 20px;">
					<h3>üîÑ –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</h3>
					<p>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</p>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
						<div style="text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì§</div>
							<h4>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</p>
							<button class="btn btn-success" onclick="exportToFile()" style="width: 100%;">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–π–ª</button>
							<button class="btn" onclick="showExportOptions()" style="width: 100%; margin-top: 10px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
						</div>
						
						<div style="text-align: center;">
							<div style="font-size: 3em; margin-bottom: 10px;">üì•</div>
							<h4>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
							<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞</p>
							<button class="btn btn-warning" onclick="importFromFile()" style="width: 100%;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</button>
							<button class="btn" onclick="showImportOptions()" style="width: 100%; margin-top: 10px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
						</div>
					</div>
					
					<div style="background: #e8f4fc; padding: 15px; border-radius: 8px; text-align: left;">
						<h4>üì± –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:</h4>
						<ol>
							<li>–ù–∞ —Ä–∞–±–æ—Ç–µ: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ —Ñ–∞–π–ª</li>
							<li>–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π –∫–æ–º–ø—å—é—Ç–µ—Ä (—Ñ–ª–µ—à–∫–∞, –æ–±–ª–∞–∫–æ, email)</li>
							<li>–î–æ–º–∞: –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–∞–±–æ—Ç—É</li>
							<li>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –¥–æ–º–∞ —Å–Ω–æ–≤–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ</li>
							<li>–ù–∞ —Ä–∞–±–æ—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
						</ol>
					</div>
				</div>
			`;
			
			showModal('–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏', html);
		}

		// 13. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
		function showExportOptions() {
			const html = `
				<h3>üì§ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
				
				<div class="form-group">
					<label>–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
					<select id="exportFormat">
						<option value="json">–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON) - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</option>
						<option value="json_min">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)</option>
						<option value="csv">–¢–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (CSV)</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:</label>
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
						<label><input type="checkbox" id="exportSettings" checked> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</label>
						<label><input type="checkbox" id="exportTasks" checked> –ó–∞–¥–∞–Ω–∏—è</label>
						<label><input type="checkbox" id="exportStudents" checked> –£—á–∞—â–∏—Ö—Å—è</label>
						<label><input type="checkbox" id="exportResults" checked> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</label>
						<label><input type="checkbox" id="exportErrors" checked> –û—à–∏–±–∫–∏</label>
						<label><input type="checkbox" id="exportHistory"> –ò—Å—Ç–æ—Ä–∏—é</label>
					</div>
				</div>
				
				<div class="form-group">
					<label>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:</label>
					<input type="password" id="exportPassword" placeholder="–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" style="width: 100%;">
					<small style="color: #666;">–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞—Ä–æ–ª—è –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã</small>
				</div>
				
				<button class="btn btn-success" onclick="performCustomExport()">–í—ã–ø–æ–ª–Ω–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç</button>
			`;
			
			showModal('–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞', html);
		}

		// 14. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞
		function showImportOptions() {
			const html = `
				<h3>üì• –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞</h3>
				
				<div class="form-group">
					<label>–†–µ–∂–∏–º –∏–º–ø–æ—Ä—Ç–∞:</label>
					<select id="importMode">
						<option value="full">–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö</option>
						<option value="merge">–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</option>
						<option value="students">–¢–æ–ª—å–∫–æ —É—á–∞—â–∏–µ—Å—è</option>
						<option value="tasks">–¢–æ–ª—å–∫–æ –∑–∞–¥–∞–Ω–∏—è</option>
						<option value="results">–¢–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:</label>
					<select id="importConflict">
						<option value="skip">–ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ</option>
						<option value="overwrite">–ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</option>
						<option value="rename">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏</option>
					</select>
				</div>
				
				<div class="form-group">
					<label>–ü–∞—Ä–æ–ª—å (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã):</label>
					<input type="password" id="importPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="width: 100%;">
				</div>
				
				<div class="form-group">
					<label>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</label>
					<button class="btn" onclick="previewImportFile()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
				</div>
			`;
			
			showModal('–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞', html);
		}

		// 15. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
		function previewImportFile() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json,.txt,application/json';
			
			input.onchange = function(event) {
				const file = event.target.files[0];
				if (!file) return;
				
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const content = e.target.result;
						const importedData = JSON.parse(content);
						
						if (validateImportedData(importedData)) {
							showImportPreview(importedData);
						} else {
							showNotification('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª', 'error');
						}
					} catch (error) {
						showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
					}
				};
				
				reader.readAsText(file);
			};
			
			input.click();
		}

		// 16. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
		function showImportPreview(importedData) {
			const data = importedData.appData;
			
			let html = `
				<h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
				
				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h4>
						<p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> ${data.test.subject || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–ö–ª–∞—Å—Å:</strong> ${data.test.class || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
						<p><strong>–¢–µ–º–∞:</strong> ${data.test.theme || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
						<p><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> ${workTypes[data.test.workType]?.name || data.test.workType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
					</div>
					
					<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
						<h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
						<p><strong>–ó–∞–¥–∞–Ω–∏–π:</strong> ${data.tasks.length}</p>
						<p><strong>–£—á–∞—â–∏—Ö—Å—è:</strong> ${data.students.length}</p>
						<p><strong>–û—à–∏–±–æ–∫:</strong> ${data.errors.length}</p>
						<p><strong>–î–∞—Ç–∞:</strong> ${data.test.testDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
					</div>
				</div>
				
				<h4>üë• –£—á–∞—â–∏–µ—Å—è (–ø–µ—Ä–≤—ã–µ 5):</h4>
				<div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 6px;">
					<ul>
						${data.students.slice(0, 5).map(student => `<li>${student}</li>`).join('')}
						${data.students.length > 5 ? `<li>... –∏ –µ—â–µ ${data.students.length - 5} —É—á–∞—â–∏—Ö—Å—è</li>` : ''}
					</ul>
				</div>
				
				<h4 style="margin-top: 20px;">üìù –ó–∞–¥–∞–Ω–∏—è (–ø–µ—Ä–≤—ã–µ 5):</h4>
				<div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 6px;">
					<ul>
						${data.tasks.slice(0, 5).map(task => `<li>${task.type} (–º–∞–∫—Å. ${task.maxScore} –±–∞–ª–ª–æ–≤, —É—Ä–æ–≤–µ–Ω—å ${task.level})</li>`).join('')}
						${data.tasks.length > 5 ? `<li>... –∏ –µ—â–µ ${data.tasks.length - 5} –∑–∞–¥–∞–Ω–∏–π</li>` : ''}
					</ul>
				</div>
				
				<div style="margin-top: 20px; background: #fff3cd; padding: 15px; border-radius: 8px;">
					<h4>‚ö†Ô∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</h4>
					<p><strong>–¢–µ–∫—É—â–∏–µ —É—á–∞—â–∏–µ—Å—è:</strong> ${appData.students.length}</p>
					<p><strong>–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ —É—á–∞—â–∏–µ—Å—è:</strong> ${data.students.length}</p>
					<p><strong>–°–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –∏–º–µ–Ω:</strong> ${countCommonStudents(data.students)}</p>
				</div>
				
				<div style="margin-top: 20px; display: flex; gap: 10px;">
					<button class="btn btn-danger" onclick="hideModal()">–û—Ç–º–µ–Ω–∞</button>
					<button class="btn btn-success" onclick="confirmImportPreview('${btoa(JSON.stringify(importedData))}')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–º–ø–æ—Ä—Ç</button>
				</div>
			`;
			
			showModal('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö', html);
		}

		// 17. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function countCommonStudents(newStudents) {
			const currentStudentsSet = new Set(appData.students);
			return newStudents.filter(student => currentStudentsSet.has(student)).length;
		}

		function confirmImportPreview(encodedData) {
			hideModal();
			setTimeout(() => {
				confirmImport(true, encodedData);
			}, 300);
		}

		// 18. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
		function setupAutoBackup() {
			// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			window.addEventListener('beforeunload', function() {
				createBackup();
				localStorage.setItem('lastAutoBackup', new Date().toISOString());
			});
			
			// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
			setInterval(function() {
				if (document.hasFocus()) { // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω–∞
					createBackup();
					console.log('–ê–≤—Ç–æ—Ä–µ–∑–µ—Ä–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞');
				}
			}, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
		}

		// 19. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
		function restoreLastBackup() {
			const backups = Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.sort()
				.reverse();
			
			if (backups.length > 0) {
				restoreBackup(backups[0]);
			} else {
				showNotification('–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning');
			}
		}

		// ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================

		// 20. –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
		
		function addTransferButtonsToUI() {
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
			
			// –í —Ä–∞–∑–¥–µ–ª —ç–∫—Å–ø–æ—Ä—Ç–∞
			const exportTab = document.querySelector('#export .export-buttons');
			if (exportTab) {
				exportTab.innerHTML += `
					<button class="btn" onclick="exportToFile()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª</button>
					<button class="btn" onclick="importFromFile()">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞</button>
					<button class="btn" onclick="showQuickTransferMenu()">üîÑ –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–Ω–æ—Å</button>
					<button class="btn" onclick="showTransferHistory()">üìã –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤</button>
				`;
			}
			
			// –í –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–∫–ª–∞–¥–∫—É
			const tabs = document.querySelector('.tabs');
			if (tabs) {
				const transferTab = document.createElement('button');
				transferTab.className = 'tab-btn';
				transferTab.innerHTML = 'üîÑ –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö';
				transferTab.onclick = () => showTab('transfer');
				tabs.appendChild(transferTab);
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
				const container = document.querySelector('.container');
				const transferContent = document.createElement('div');
				transferContent.id = 'transfer';
				transferContent.className = 'tab-content';
				transferContent.innerHTML = `
					<h2>üîÑ –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</h2>
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 30px 0;">
						<div class="chart-container" style="text-align: center;">
							<h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
							<div style="font-size: 4em; margin: 20px;">üì§</div>
							<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</p>
							<button class="btn btn-success" onclick="exportToFile()" style="width: 100%; margin: 10px 0;">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–π–ª</button>
							<button class="btn" onclick="showExportOptions()" style="width: 100%;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
							
							<div style="margin-top: 30px; text-align: left;">
								<h4>üì± –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:</h4>
								<ol>
									<li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
									<li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª</li>
									<li>–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ –¥—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</li>
									<li>–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–æ–≤–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
									<li>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</li>
								</ol>
							</div>
						</div>
						
						<div class="chart-container" style="text-align: center;">
							<h3>üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
							<div style="font-size: 4em; margin: 20px;">üì•</div>
							<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã</p>
							<button class="btn btn-warning" onclick="importFromFile()" style="width: 100%; margin: 10px 0;">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</button>
							<button class="btn" onclick="showImportOptions()" style="width: 100%;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</button>
							
							<div style="margin-top: 30px; text-align: left;">
								<h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
								<ul>
									<li>–†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</li>
									<li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
									<li>–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞</li>
									<li>–•—Ä–∞–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π —Ñ–∞–π–ª–æ–≤</li>
								</ul>
							</div>
						</div>
					</div>
					
					<div class="chart-container">
						<h3>üìã –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
						<div style="display: flex; gap: 10px; flex-wrap: wrap;">
							<button class="btn" onclick="showTransferHistory()">üìú –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
							<button class="btn" onclick="restoreLastBackup()">üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button>
							<button class="btn" onclick="setupAutoBackup()">‚è∞ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ—Ä–µ–∑–µ—Ä–≤–∫—É</button>
							<button class="btn" onclick="showBackupManagement()">üóÉÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏</button>
						</div>
					</div>
					
					<div class="chart-container">
						<h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
						<div class="kpi-grid">
							<div class="kpi-card">
								<div class="kpi-value">${appData.students.length}</div>
								<div class="kpi-label">–£—á–∞—â–∏—Ö—Å—è</div>
							</div>
							<div class="kpi-card">
								<div class="kpi-value">${appData.tasks.length}</div>
								<div class="kpi-label">–ó–∞–¥–∞–Ω–∏–π</div>
							</div>
							<div class="kpi-card">
								<div class="kpi-value">${appData.errors.length}</div>
								<div class="kpi-label">–û—à–∏–±–æ–∫</div>
							</div>
							<div class="kpi-card">
								<div class="kpi-value">${new Date().toLocaleDateString()}</div>
								<div class="kpi-label">–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞</div>
							</div>
						</div>
					</div>
				`;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏
				const lastTab = document.querySelector('.tab-content:last-of-type');
				if (lastTab) {
					lastTab.parentNode.insertBefore(transferContent, lastTab.nextSibling);
				} else {
					container.appendChild(transferContent);
				}
			}
		}


		// 21. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', function() {
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
			//setTimeout(() => {
			//	addTransferButtonsToUI();
			//}, 1000);
			//setTimeout(() => {
			//	addDebugButtons();
			//}, 1000);
			// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è)
			setTimeout(() => {
				addImportExportButtons();
			}, 500);
			
			
			    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
			setTimeout(() => {
				if (appData.students.length === 0 && appData.tasks.length === 0) {
					// –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
					console.log('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞.');
				}
			}, 1000);
			
			// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–≤—Ç–æ—Ä–µ–∑–µ—Ä–≤–∫—É
			setupAutoBackup();
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
			checkForUnsavedData();
		});
		// –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–∏ 2 —Ñ—É–Ω–∫—Ü–∏–∏ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
		function workingExport() {
			const data = JSON.stringify(appData, null, 2);
			const blob = new Blob([data], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = '–¥–∞–Ω–Ω—ã–µ.json';
			a.click();
			showNotification('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
		}
		
		// 14. –≠–ö–°–¢–†–ï–ù–ù–´–ô –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
		function emergencyExport() {
			// –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
			let exportText = `–≠–ö–°–¢–†–ï–ù–ù–´–ô –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–•\n`;
			exportText += `–ü—Ä–µ–¥–º–µ—Ç: ${appData.test.subject}\n`;
			exportText += `–ö–ª–∞—Å—Å: ${appData.test.class}\n`;
			exportText += `–î–∞—Ç–∞: ${new Date().toLocaleString()}\n\n`;
			
			exportText += `–£–ß–ê–©–ò–ï–°–Ø –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´:\n`;
			appData.students.forEach((student, index) => {
				const totalScore = appData.results[index]?.reduce((sum, score) => sum + score, 0) || 0;
				const grade = calculateGrade(totalScore);
				exportText += `${student}: ${totalScore} –±–∞–ª–ª–æ–≤ (–æ—Ü–µ–Ω–∫–∞ ${grade})\n`;
			});
			
			const blob = new Blob([exportText], { type: 'text/plain' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `—ç–∫—Å–ø–æ—Ä—Ç_${new Date().toISOString().slice(0, 10)}.txt`;
			a.click();
			URL.revokeObjectURL(url);
			
			showNotification('–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
		}


		function emergencyImport() {
			if (confirm('–≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
				loadStandardSample();
			}
		}

		// –î–æ–±–∞–≤–ª—è–µ–º —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
		console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:');
		console.log('- simpleExport() - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö');
		console.log('- simpleImport() - –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö');
		console.log('- emergencyExport() - —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç');
		console.log('- emergencyImport() - —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç');
		console.log('- createSampleFile() - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞');		
		
		
		// –£–¢–ò–õ–ò–¢–ê–†–ù–´–ï –§–£–ù–ö–¶–ò–ò –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏
		function safeEncode(data) {
			try {
				// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –∏ –∫–æ–¥–∏—Ä—É–µ–º
				const str = JSON.stringify(data);
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É URI –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏
				return encodeURIComponent(str);
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				return '';
			}
		}
		
		function safeDecode(encodedData) {
			try {
				// –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∏–∑ URI
				const str = decodeURIComponent(encodedData);
				return JSON.parse(str);
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				return null;
			}
		}

		function workingImport() {
			const input = document.createElement('input');
			input.type = 'file';
			input.accept = '.json';
			input.onchange = function(e) {
				const file = e.target.files[0];
				const reader = new FileReader();
				reader.onload = function(e) {
					try {
						appData = JSON.parse(e.target.result);
						saveData();
						renderAll();
						showNotification('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
					} catch (err) {
						showNotification('–û—à–∏–±–∫–∞: ' + err.message, 'error');
					}
				};
				reader.readAsText(file);
			};
			input.click();
		}
		// 22. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
		function checkForUnsavedData() {
			const lastSave = localStorage.getItem('lastAutoSave');
			const lastBackup = localStorage.getItem('lastAutoBackup');
			
			if (lastSave && lastBackup) {
				const saveTime = new Date(lastSave);
				const backupTime = new Date(lastBackup);
				const now = new Date();
				
				// –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 30 –º–∏–Ω—É—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
				if ((now - saveTime) > 30 * 60 * 1000) {
					showNotification('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö', 'warning');
				}
			}
		}

		// 23. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
		function showBackupManagement() {
			const backups = Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.map(key => ({
					key,
					data: JSON.parse(localStorage.getItem(key)),
					size: JSON.stringify(localStorage.getItem(key)).length
				}))
				.sort((a, b) => new Date(b.data.timestamp) - new Date(a.data.timestamp));
			
			let html = `
				<h3>üóÉÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏</h3>
				<p>–í—Å–µ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π: ${backups.length}</p>
				
				<div style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
					${backups.map((backup, index) => `
						<div class="backup-item" style="display: flex; justify-content: space-between; align-items: center;">
							<div>
								<strong>${backup.data.timestamp}</strong><br>
								<small>${backup.data.data.test.subject} - ${backup.data.data.test.class}</small><br>
								<small>${Math.round(backup.size / 1024)} –ö–ë</small>
							</div>
							<div style="display: flex; gap: 5px;">
								<button class="btn btn-sm" onclick="restoreBackup('${backup.key}')">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
								<button class="btn btn-sm btn-danger" onclick="deleteBackup('${backup.key}')">–£–¥–∞–ª–∏—Ç—å</button>
								<button class="btn btn-sm" onclick="exportBackup('${backup.key}')">–≠–∫—Å–ø–æ—Ä—Ç</button>
							</div>
						</div>
					`).join('')}
				</div>
				
				<div style="display: flex; gap: 10px; margin-top: 20px;">
					<button class="btn btn-danger" onclick="deleteAllBackups()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–ø–∏–∏</button>
					<button class="btn" onclick="createBackup()">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–ø–∏—é</button>
					<button class="btn" onclick="exportAllBackups()">üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</button>
				</div>
			`;
			
			showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏', html);
		}
		// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Å–∫—Ä–∏–ø—Ç–∞
		document.addEventListener('DOMContentLoaded', function() {
			console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏...');
			setTimeout(updateVisualization, 1000);
		});
		// 24. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
		function deleteBackup(key) {
			if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é?')) {
				localStorage.removeItem(key);
				showBackupManagement();
				showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
			}
		}

		function deleteAllBackups() {
			if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
				Object.keys(localStorage)
					.filter(key => key.startsWith('backup_'))
					.forEach(key => localStorage.removeItem(key));
				showBackupManagement();
				showNotification('–í—Å–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —É–¥–∞–ª–µ–Ω—ã', 'success');
			}
		}

		function exportBackup(key) {
			const backup = localStorage.getItem(key);
			const blob = new Blob([backup], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			
			const a = document.createElement('a');
			a.href = url;
			a.download = key + '.json';
			a.click();
			
			URL.revokeObjectURL(url);
		}

		function exportAllBackups() {
			const allBackups = {};
			Object.keys(localStorage)
				.filter(key => key.startsWith('backup_'))
				.forEach(key => {
					allBackups[key] = JSON.parse(localStorage.getItem(key));
				});
			
			const dataStr = JSON.stringify(allBackups, null, 2);
			const blob = new Blob([dataStr], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			
			const a = document.createElement('a');
			a.href = url;
			a.download = `–≤—Å–µ_—Ä–µ–∑–µ—Ä–≤–Ω—ã–µ_–∫–æ–ø–∏–∏_${new Date().toISOString().split('T')[0]}.json`;
			a.click();
			
			URL.revokeObjectURL(url);
			showNotification('–í—Å–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
		}
		
		// –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏
		function analyzeOverallLiteracyLevel(percentage) {
			if (percentage >= 80) {
				return {
					level: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
					title: '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–£—á–∞—â–∏–µ—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.',
					interpretation: '–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ, –ø–æ–∑–≤–æ–ª—è—é—â–µ–º —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏'
				};
			} else if (percentage >= 60) {
				return {
					level: '–ë–∞–∑–æ–≤—ã–π',
					title: '–î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–£—á–∞—â–∏–µ—Å—è –≤–ª–∞–¥–µ—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.',
					interpretation: '–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏'
				};
			} else if (percentage >= 40) {
				return {
					level: '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π',
					title: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.',
					interpretation: '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π'
				};
			} else {
				return {
					level: '–ù–∞—á–∞–ª—å–Ω—ã–π',
					title: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏',
					description: '–£—á–∞—â–∏–µ—Å—è –∏—Å–ø—ã—Ç—ã–≤–∞—é—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π.',
					interpretation: '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –≤—Å–µ—Ö –≤–∏–¥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏'
				};
			}
		}
		function generateOGESpecializedReport() {
			// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞–Ω–∞–ª–∏–∑–∞
			updateGIAnalysis();
			const analysisContent = document.getElementById('specializedAnalysis').innerHTML;
			
			return `
				<h3>üéì –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠</h3>
				<p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ.</p>
				
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value">${calculateAverageScore().toFixed(1)}</div>
						<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateSuccessRate().toFixed(1)}%</div>
						<div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${calculateQualityRate().toFixed(1)}%</div>
						<div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
					</div>
					<div class="stat-card">
						<div class="stat-value">${appData.students.length}</div>
						<div class="stat-label">–£—á–∞—â–∏—Ö—Å—è</div>
					</div>
				</div>
				
				${analysisContent}
				
				<div class="recommendation-card" style="margin-top: 20px;">
					<h4>üìã –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠</h4>
					<ul>
						<li>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠</li>
						<li>–ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –Ω–∏–º–∏</li>
						<li>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö</li>
						<li>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–∞–Ω–∫–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤</li>
						<li>–ü—Ä–æ–±–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω –∑–∞ 1 –º–µ—Å—è—Ü –¥–æ –û–ì–≠</li>
					</ul>
				</div>
			`;
		}

        function generateEGESpecializedReport() {
            return `<h3>üéì –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ï–ì–≠</h3>
            <p>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –µ–¥–∏–Ω–æ–≥–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞.</p>
            ${document.getElementById('specializedAnalysis').innerHTML}`;
        }

        function generateStandardSpecializedReport() {
            return `<h3>üìä –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
            <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã.</p>
            ${document.getElementById('taxonomyAnalysis').innerHTML}
            ${document.getElementById('errorsAnalysis').innerHTML}`;
        }

        function generateSpecializedReportHTML(title, description, content) {
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${title}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px solid #3498db; }
        .section { margin: 30px 0; }
		/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
		#literacyRadarChart {
			max-height: 400px !important;
			width: 100% !important;
			margin: 0 auto;
		}

		/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
		.chart-container {
			position: relative;
			height: 400px;
			min-height: 400px;
		}
    </style>
</head>
<body>
    <div class="header">
        <h1>${title}</h1>
        <h2>${appData.test.subject}, ${appData.test.class}</h2>
        <p>${description}</p>
    </div>
    ${content}
</body>
</html>`;
        }

        // –û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è
        function exportForTeacher() {
            const reportContent = generateTeacherReport();
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–æ—Ç—á–µ—Ç_–¥–ª—è_—É—á–∏—Ç–µ–ª—è_${appData.test.subject}_${new Date().toLocaleDateString()}.html`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification("–û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", "success");
        }

        function generateTeacherReport() {
            const totalScores = appData.results.map(scores => scores.reduce((sum, score) => sum + score, 0));
            const grades = totalScores.map(score => calculateGrade(score));
            const avgScore = totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            const successRate = (grades.filter(grade => grade >= 3).length / grades.length * 100);
            const qualityRate = (grades.filter(grade => grade >= 4).length / grades.length * 100);
            
            const difficultTasks = appData.tasks
                .map((task, index) => ({ task, index, completion: calculateTaskCompletion(index) }))
                .filter(t => t.completion < 60)
                .slice(0, 5);
            
            const atRiskStudents = appData.students
                .map((student, index) => ({
                    name: student,
                    score: totalScores[index],
                    grade: grades[index],
                    percentage: (totalScores[index] / appData.tasks.reduce((sum, task) => sum + task.maxScore, 0)) * 100
                }))
                .filter(s => s.grade === 2)
                .slice(0, 10);
            
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è - ${appData.test.theme}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
            color: #333;
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            padding-bottom: 20px; 
            border-bottom: 2px solid #3498db; 
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            border-radius: 10px;
        }
        .section { 
            margin: 30px 0; 
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .stat-value { 
            font-size: 2em; 
            font-weight: bold; 
            margin: 10px 0; 
            color: #2c3e50;
        }
        .stat-label { 
            font-size: 0.9em; 
            color: #7f8c8d;
        }
        .alert-card {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .success-card {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .task-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .student-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
		/* –§–∏–∫—Å –¥–ª—è —Ä–∞–¥–∞—Ä–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
		#literacyRadarChart {
			max-height: 400px !important;
			width: 100% !important;
			margin: 0 auto;
		}

		/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
		.chart-container {
			position: relative;
			height: 400px;
			min-height: 400px;
		}
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã –û—Ç—á–µ—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è</h1>
        <h2>${appData.test.subject}, ${appData.test.class}</h2>
        <p><strong>–¢–µ–º–∞ —Ä–∞–±–æ—Ç—ã:</strong> ${appData.test.theme}</p>
        <p><strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong> ${new Date(appData.test.testDate).toLocaleDateString()}</p>
    </div>
    
    <div class="section">
        <h3>üìä –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">${avgScore.toFixed(1)}</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${successRate.toFixed(1)}%</div>
                <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${qualityRate.toFixed(1)}%</div>
                <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${appData.test.presentStudents}</div>
                <div class="stat-label">–ü–∏—Å–∞–ª–æ —Ä–∞–±–æ—Ç—É</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã</h3>
        ${successRate >= 70 ? 
            '<div class="success-card"><strong>‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞:</strong> –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è —É—Å–ø–µ—à–Ω–æ –æ—Å–≤–æ–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª.</div>' :
            '<div class="alert-card"><strong>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∞—Å—Å–æ–º.</div>'
        }
        
        ${difficultTasks.length > 0 ? `
            <div class="alert-card">
                <strong>üîç –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã:</strong>
                <ul>
                    ${difficultTasks.map(task => 
                        `<li>–ó–∞–¥–∞–Ω–∏–µ ${task.index + 1} "${task.task.type}" - ${task.completion.toFixed(1)}% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</li>`
                    ).join('')}
                </ul>
            </div>
        ` : '<div class="success-card"><strong>‚úÖ –í—Å–µ –∑–∞–¥–∞–Ω–∏—è —É—Å–≤–æ–µ–Ω—ã —Ö–æ—Ä–æ—à–æ</strong></div>'}
    </div>
    
    <div class="section">
        <h3>üë• –£—á–∞—â–∏–µ—Å—è, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è</h3>
        ${atRiskStudents.length > 0 ? `
            <div class="student-list">
                <p><strong>–£—á–∞—â–∏–µ—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (${atRiskStudents.length} —á–µ–ª.):</strong></p>
                <ul>
                    ${atRiskStudents.map(student => 
                        `<li>${student.name} - ${student.score} –±–∞–ª–ª–æ–≤ (${student.percentage.toFixed(1)}%)</li>`
                    ).join('')}
                </ul>
            </div>
        ` : '<div class="success-card"><strong>‚úÖ –ù–µ—Ç —É—á–∞—â–∏—Ö—Å—è —Å –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</strong></div>'}
    </div>
    
    <div class="section">
        <h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        <div class="task-list">
            <p><strong>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É:</strong></p>
            <ul>
                <li>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏</li>
                <li>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö —É—á–∞—â–∏—Ö—Å—è</li>
                ${difficultTasks.length > 0 ? '<li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º</li>' : ''}
                <li>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω —É—Ä–æ–∫–∞ —Å —É—á–µ—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π</li>
                <li>–ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ä–∞–±–æ—Ç—ã</li>
            </ul>
        </div>
    </div>

    <div style="text-align: center; margin-top: 40px; color: #7f8c8d; font-size: 0.9em;">
        <p>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ${new Date().toLocaleDateString()}</p>
        <p>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
    </div>
	<div id="globalError" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #e74c3c; color: white; padding: 15px; border-radius: 8px; z-index: 9999; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
    ‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
</div>
</body>
</html>`;
        }

        function exportJSON() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–¥–∞–Ω–Ω—ã–µ_–∞–Ω–∞–ª–∏–∑–∞_${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification("–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON", "success");
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', function() {
            if (document.getElementById('visualization').classList.contains('active')) {
                setTimeout(() => {
                    updateCharts();
                    updateSolvabilityChart();
                }, 300);
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                hideModal();
            }
        });

    </script>
</body>
</html>